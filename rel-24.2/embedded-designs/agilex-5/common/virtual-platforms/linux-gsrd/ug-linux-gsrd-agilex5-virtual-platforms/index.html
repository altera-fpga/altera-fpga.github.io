
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../../e-series/modular/boot-examples/ug-linux-boot-agx5e-modular/">
      
      
        <link rel="next" href="../../zephyr-gsrd/ug-zephyr-gsrd-agilex5-virtual-platforms/">
      
      <link rel="icon" href="../../../../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Linux GSRD - Altera-FPGA Site</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../../../../../.."> 
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../.." title="Altera-FPGA Site" class="md-header__button md-logo" aria-label="Altera-FPGA Site" data-md-component="logo">
      
  <img src="../../../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Altera-FPGA Site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Linux GSRD
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/altera-fpga" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    altera-fpga
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="Altera-FPGA Site" class="md-nav__button md-logo" aria-label="Altera-FPGA Site" data-md-component="logo">
      
  <img src="../../../../../../assets/logo.png" alt="logo">

    </a>
    Altera-FPGA Site
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/altera-fpga" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    altera-fpga
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../../driver-list_linux/">Linux Drivers</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Linux Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          HPS Host Drivers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          HPS Host Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/clock_manager/clock_manager/" class="md-nav__link">
        Clock Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/dma/dma/" class="md-nav__link">
        DMA Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/edac/edac/" class="md-nav__link">
        Error Detection & Correction (EDAC)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/ptp_tod/ptp_emb_tod/" class="md-nav__link">
        Ethernet 1588 PTP Time of Day Clock
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/emac/emac/" class="md-nav__link">
        Ethernet Media Access Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/hssi/hssi/" class="md-nav__link">
        Ethernet Subsystem FPGA IP MAC Specific Ctrl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/hssi_xtile/hssi_xtile/" class="md-nav__link">
        Ethernet Subsystem FPGA IP Tile Specific Ctrl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/apb_timers/apb_timers/" class="md-nav__link">
        General Purpose Timers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/gpio/gpio/" class="md-nav__link">
        General Purpose I/O (GPIO)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/i2c/i2c/" class="md-nav__link">
        I2C
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/i3c/i3c/" class="md-nav__link">
        I3C
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/interrupt_controller_GICv3/irq_gic_v3/" class="md-nav__link">
        Interrupt Controller (GICv3)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/msgdma/msgdma/" class="md-nav__link">
        MSGDMA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/nand/nand/" class="md-nav__link">
        NAND Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/qsfp/qsfp/" class="md-nav__link">
        QSFP Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/qspi/qspi/" class="md-nav__link">
        QSPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/reset_manager/reset_manager/" class="md-nav__link">
        Reset Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/sd-emmc/sd-emmc/" class="md-nav__link">
        SD/eMMC Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/spi/spi/" class="md-nav__link">
        SPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/system_manager/system_manager/" class="md-nav__link">
        System Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/smmu/smmu/" class="md-nav__link">
        System Memory Management Unit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/uart/uart/" class="md-nav__link">
        UART
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/usb2_0_otg/usb_2_0_otg/" class="md-nav__link">
        USB 2.0 OTG
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/watchdog_timers/watchdog_timers/" class="md-nav__link">
        Watchdog Timers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/zarlink_clock_synchronizer/zarlink_clock_synchronizer/" class="md-nav__link">
        Zarlink Clock Synchronizer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          PCIe Host Drivers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          PCIe Host Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/uart_16550/uart_16550/" class="md-nav__link">
        Altera 16550 Compatible UART
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_afu/dfl_afu/" class="md-nav__link">
        Accelerator Functional Unit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/intel_m10_bmc_core/intel_m10_bmc_core/" class="md-nav__link">
        Board Management Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl/dfl/" class="md-nav__link">
        Device Feature List
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/s10hssi/s10hssi/" class="md-nav__link">
        Ethernet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/ptp_dfl_tod/ptp_dfl_tod/" class="md-nav__link">
        Ethernet 1588 PTP Time of Day Clock
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_fme/dfl_fme/" class="md-nav__link">
        FPGA Management Engine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_pci/dfl_pci/" class="md-nav__link">
        PCIe Subsystem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_emif/dfl_emif/" class="md-nav__link">
        Memory Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/intel_m10_bmc_core/intel_m10_bmc_core/" class="md-nav__link">
        MAX 10 Board Management Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/spi_altera_dfl/spi_altera_dfl/" class="md-nav__link">
        SPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/uio_dfl/uio_dfl/" class="md-nav__link">
        User space I/O (UIO)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Host Attach Utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Host Attach Utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw-tools-list/host-attach-tools/" class="md-nav__link">
        Host Attach Utilities Summary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgaconf/fpgaconf/" class="md-nav__link">
        fpgaconf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgaport/fpgaport/" class="md-nav__link">
        fpgaport
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet loopback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/ofs_uio/ofs_uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/opae_io/opae_io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/pac_hssi_config/pac_hssi_config/" class="md-nav__link">
        pac_hssi_config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Example Designs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Example Designs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../ed-demo-list/ed-list/" class="md-nav__link">
        Example Designs Summary
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          Agilex 5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Agilex 5
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/premium/gsrd/ug-gsrd-agx5e-premium/" class="md-nav__link">
        Agilex 5 E-Series Premium Development Kit GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/premium/boot-examples/ug-linux-boot-agx5e-premium/" class="md-nav__link">
        Agilex 5 E-Series Premium Development Kit GHRD Linux Boot Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/modular/gsrd/ug-gsrd-agx5e-modular/" class="md-nav__link">
        Agilex 5 E-Series Modular Development Kit GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/modular/boot-examples/ug-linux-boot-agx5e-modular/" class="md-nav__link">
        Agilex 5 E-Series Modular Development Kit GHRD Linux Boot Examples
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Linux GSRD
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Linux GSRD
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#release-content" class="md-nav__link">
    Release Content
  </a>
  
    <nav class="md-nav" aria-label="Release Content">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prebuilt-binaries" class="md-nav__link">
    Prebuilt Binaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-instructions" class="md-nav__link">
    Build Instructions
  </a>
  
    <nav class="md-nav" aria-label="Build Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-up-the-environment" class="md-nav__link">
    Set Up the Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-hardware-design" class="md-nav__link">
    Build the Hardware Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-up-the-yocto-build-system" class="md-nav__link">
    Set Up the Yocto Build System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customize-the-yocto-build" class="md-nav__link">
    Customize the Yocto Build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-yocto" class="md-nav__link">
    Build Yocto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-qspi-boot-image" class="md-nav__link">
    Build QSPI Boot Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-nand-boot-image" class="md-nav__link">
    Build NAND Boot Image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#known-issues-with-the-release" class="md-nav__link">
    Known Issues with the Release
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agilextm-5-e-series-simics-virtual-platform-universal" class="md-nav__link">
    Agilex™ 5 E-Series Simics Virtual Platform - Universal
  </a>
  
    <nav class="md-nav" aria-label="Agilex™ 5 E-Series Simics Virtual Platform - Universal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-features-supported-by-the-intel-agilextm-5-e-series-universal-virtual-platform" class="md-nav__link">
    Main Features Supported by the Intel Agilex™ 5 E-Series Universal Virtual Platform
  </a>
  
    <nav class="md-nav" aria-label="Main Features Supported by the Intel Agilex™ 5 E-Series Universal Virtual Platform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#boot-an-operative-system" class="md-nav__link">
    Boot an Operative System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-ethernet" class="md-nav__link">
    Basic Ethernet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpu-power-on-and-boot-core-selection" class="md-nav__link">
    CPU Power-On and Boot Core Selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reset-flow" class="md-nav__link">
    Reset Flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpio-loopback-connection" class="md-nav__link">
    GPIO Loopback Connection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usb-disks-hot-plug-support" class="md-nav__link">
    USB Disks Hot-Plug Support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fpga-fabric-example-design" class="md-nav__link">
    FPGA Fabric Example Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fpga-to-hps-bridges" class="md-nav__link">
    FPGA-to-HPS Bridges
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configurable-parameters-in-the-intel-agilextm-5-e-series-universal-virtual-platform" class="md-nav__link">
    Configurable Parameters in the Intel Agilex™ 5 E-Series Universal Virtual Platform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-supported-by-the-agilextm-5-e-series-universal-virtual-platform" class="md-nav__link">
    Use Cases Supported by the Agilex™ 5 E-Series Universal Virtual Platform
  </a>
  
    <nav class="md-nav" aria-label="Use Cases Supported by the Agilex™ 5 E-Series Universal Virtual Platform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation-setup" class="md-nav__link">
    Simulation Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-exercise-sdcard-boot-flow-from-fsbl-to-linux" class="md-nav__link">
    Use Case: Exercise SDCard Boot Flow from FSBL to Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-exercise-hello-application" class="md-nav__link">
    Use Case: Exercise Hello Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-exercise-system-check-application-with-hps-led-turn-onoff-control" class="md-nav__link">
    Use Case: Exercise System Check Application with HPS LED Turn On/Off control
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-access-the-web-server-application-from-host-pc" class="md-nav__link">
    Use Case: Access the Web Server Application from Host PC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-access-on-chip-ram-in-fpga-example-design-from-linux-prompt" class="md-nav__link">
    Use Case: Access ON-Chip RAM in FPGA Example Design from Linux Prompt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-excercise-peripheral-components-in-fpga-fabric-example-design" class="md-nav__link">
    Use Case: Excercise Peripheral Components in FPGA Fabric Example Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-exercise-usb-disk-hot-plug" class="md-nav__link">
    Use Case: Exercise USB Disk Hot-Plug
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-exercise-ubifs-qspi-boot-flow-from-fsbl-to-linux" class="md-nav__link">
    Use Case: Exercise UBIFS QSPI Boot Flow from FSBL to Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-exercise-nand-boot-flow-from-fsbl-to-linux" class="md-nav__link">
    Use Case: Exercise NAND Boot Flow from FSBL to Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-debug-bare-metal-code-using-intel-simics-simulator" class="md-nav__link">
    Use Case: Debug Bare-Metal Code Using Intel Simics Simulator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-debug-bare-metal-code-using-simics-riscfree" class="md-nav__link">
    Use Case: Debug Bare-metal Code Using Simics-RiscFree
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-remote-debugging-of-a-linux-user-mode-program-using-arm-ds-debugger" class="md-nav__link">
    Use Case: Remote Debugging of a Linux User Mode Program Using ARM DS Debugger
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../zephyr-gsrd/ug-zephyr-gsrd-agilex5-virtual-platforms/" class="md-nav__link">
        Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Zephyr GSRD
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          Agilex™ 7
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Agilex™ 7
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/rsu/ug-rsu-agx7f-soc/" class="md-nav__link">
        Agilex™ 7 SoC HPS Remote System Update Example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          Stratix 10
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Stratix 10
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stratix-10/sx/soc/rsu/ug-rsu-s10sx-soc/" class="md-nav__link">
        Stratix 10 SoC HPS Remote System Update Example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Demos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Demos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../ed-demo-list/demo-list/" class="md-nav__link">
        Demos Summary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Linux GSRD</h1>

<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Agilex™ 5 E-Series devices provide the next-generation hard processor system (HPS) after those provided with the Agilex™ 7 and  Stratix® 10 SoC FPGA devices. Agilex™ 5 E-Series devices support new features, such as TSN, USB 3.1 Gen 1, and I3C, SPI.</p>
<p>The Agilex™ 5 E-Series HPS application processors can run Linux or an RTOS, such as Zephyr*, with a scalable performance using one to four Arm* Cortex*-A cores with variable frequencies that allow for a wide range of applications.</p>
<p>The Agilex™ 5 E-Series Simics virtual platform models the HPS processor with two Arm Cortex-A55 cores, two Arm Cortex-A76 cores, and HPS peripherals. The Agilex™ 5 E-Series HPS virtual platform is released as part of the Simics® Simulator for Intel® FPGAs software, which also includes several virtual platforms where the Agilex™ 5 E-Series device is instantiated, emulating the concept of having different versions of a development kit or daughter cards.</p>
<p>The Agilex™ 5 E-Series device has the following supported virtual platforms:</p>
<ul>
<li>Agilex™ 5 E-Series Virtual Platform - Universal</li>
</ul>
<p>The following sections describe the prerequisites for the Intel Simics Simulator for Intel® FPGA and the available virtual platforms, including prebuilt binaries, and instructions for building these binaries. It also covers some common use cases that you can exercise on the virtual platforms.</p>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h3>
<p>To exercise the instructions presented on this page (build your binaries and exercise the use cases), your system must satisfy the following prerequisites:</p>
<ul>
<li>Host PC with Linux OS. (<strong>Note:</strong> Instructions on this page use Ubuntu 22.04 LTS.)</li>
<li>The following packages are needed to deploy the Simics project:<ul>
<li>GCC 6.3 compiler or higher</li>
<li>g++ 9.4 or higher</li>
<li>GNU make 4.1 or higher</li>
</ul>
</li>
<li>Local Ethernet network with DHCP server (provides IP address to the board).</li>
<li>Intel Simics Simulator for Intel FPGAs installed.</li>
<li>Intel Agilex™ 5 Virtual Platform components available to be deployed.</li>
</ul>
<p><strong>Notes:</strong></p>
<ul>
<li>For binaries building instructions, see <a href="#build-instructions">Build Instructions</a>.</li>
<li>For installation instructions for the Intel Simics Simulator for Intel FPGAs and the Agilex™ 5 E-Series virtual platforms, refer to the following documents:<ul>
<li><a href="https://www.intel.com/content/www/us/en/docs/programmable/784383/">Intel® Simics® Simulator for Intel® FPGAs User Guide</a></li>
<li><a href="https://www.intel.com/content/www/us/en/docs/programmable/786901/">Agilex™ 5 E-Series Virtual Platform User Guide</a></li>
</ul>
</li>
<li>U-Boot, Linux compilation, Yocto compilation, and the creation of an SD card image require a Linux host PC.
  To create these binaries, the toolchain and other software required need to be downloaded. This is described as part of the instructions in each section.</li>
<li>The Intel Simics Simulator for Intel® FPGAs is available only for Linux systems.</li>
<li>In case any use case requires additional prerequisites, these are listed as part of the use case description.</li>
</ul>
<h2 id="release-content">Release Content<a class="headerlink" href="#release-content" title="Permanent link">&para;</a></h2>
<p><strong>Version: 24.2</strong></p>
<table>
<thead>
<tr>
<th align="left">SW Component</th>
<th align="left">Repository</th>
<th align="left">Branch/TAG/Version</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">U-Boot</td>
<td align="left">https://github.com/altera-opensource/u-boot-socfpga</td>
<td align="left">v2024.01/QPDS24.2_REL_GSRD_PR/ 157b759210e2024649081657b56adfc41fb56f34</td>
</tr>
<tr>
<td align="left">ATF</td>
<td align="left">https://github.com/altera-opensource/arm-trusted-firmware</td>
<td align="left">v2.10.1/QPDS24.2_REL_GSRD_PR/ 4837356693ede42b849ed72f1864cc9c76c53a46</td>
</tr>
<tr>
<td align="left">Linux</td>
<td align="left">https://github.com/altera-opensource/linux-socfpga</td>
<td align="left">v6.6.22/QPDS24.2_REL_GSRD_PR/ f939c80e4195178b511c7577e0dc2a570ca0a426</td>
</tr>
<tr>
<td align="left">Reference Design Sources</td>
<td align="left">https://github.com/altera-opensource/meta-intel-fpga-refdes</td>
<td align="left">scarthgap(5.0)/QPDS24.2_REL_GSRD_PR/ 538621d98ec91ce4c474c14e65b72c99615531e8</td>
</tr>
<tr>
<td align="left">GSRD</td>
<td align="left">https://github.com/altera-opensource/gsrd-socfpga</td>
<td align="left">scarthgap</td>
</tr>
<tr>
<td align="left">Yocto Project</td>
<td align="left">https://git.yoctoproject.org/poky</td>
<td align="left">scarthgap(5.0)/ a099b484c5b245a335a5ec9b293638e1362383ae</td>
</tr>
<tr>
<td align="left">Reference Design Recipes</td>
<td align="left">https://git.yoctoproject.org/meta-intel-fpga</td>
<td align="left">scarthgap(5.0)/QPDS24.2_REL_GSRD_PR/ 03de87a47b70d7cec1d6cb657714b0ef55e47cae</td>
</tr>
<tr>
<td align="left">Arm Debugger</td>
<td align="left">http://fpgasoftware.intel.com/armds</td>
<td align="left">ARM DS 2022.2</td>
</tr>
<tr>
<td align="left">Ashling RiscFree</td>
<td align="left">https://www.intel.com/content/www/us/en/software-kit/826843/intel-quartus-prime-pro-edition-design-software-version-24-2-for-linux.html Additional Software/Stand-Alone Software tab</td>
<td align="left">24.2</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> For information prior 24.2 release, please refer to <a href="https://www.rocketboards.org/foswiki/Documentation/Agilex5SoCSimicsVirtualPlatformsReferenceGuide">Linux GSRD Intel Simics Virtual Platform for Intel Agilex® 5 E-Series</a>. </p>
<h3 id="prebuilt-binaries">Prebuilt Binaries<a class="headerlink" href="#prebuilt-binaries" title="Permanent link">&para;</a></h3>
<p><strong>Note: For 24.2 release, there are not binaries since this is a source code release.</strong></p>
<p>You can find the prebuilt binaries from the GSRD prebuilt at the following URL: https://releases.rocketboards.org/2024.05/gsrd/agilex5_dk_a5e065bb32aes1_gsrd/ . The files in this folder allow you to boot directly from SDCard. It also contains some of the files that are used to generate the final images used to boot from QSPI and from NAND. The following folders contain the remaining files used by the recipes to create the binaries to boot from QSPI and NAND.</p>
<ul>
<li>QSPI: <a href="https://releases.rocketboards.org/2024.05/qspi/agilex5_dk_a5e065bb32aes1_qspi/">QSPI boot complement files</a>. Here is the link to obtain the <a href="https://github.com/altera-opensource/meta-intel-fpga-refdes/blob/nanbield/recipes-bsp/u-boot/files/uboot_script.its">uboot_script.its</a> file which is also needed.</li>
<li>NAND: No available since NAND is not supported in silicon yet.</li>
</ul>
<p><strong>Note:</strong> The final images used to boot from QSPI and NAND are not provided, but the binaries used to generate these are provided, so you can generate the final images following the instructions in <a href="#build-qspi-boot-image">Build QSPI Boot Image</a> and <a href="#build-nand-boot-image">Build NAND Boot Image</a> sections.</p>
<p><strong>Note:</strong>  In 24.2 release the binaries targeted for silicon can also be used with Simics simulator.</p>
<table>
<thead>
<tr>
<th align="left">HPS Peripheral</th>
<th align="left">Supported</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">eMMC/SDCard &amp; Combo Phy Controllers</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">DMA Controller</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">XGMAC Ethernet Controller</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">USB 3.1 Gen1 Controller</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">USB 2.0 Controller</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">GPIO Controller</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">I2C Controller Initiator/Target</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">SPI Controller Initiator/Target</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">I3C Controller Initiator</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">I3C Controller Target</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">NAND Controller &amp; Combo PHY Controller</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">APB Timer</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">QSPI Controller</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">GICv3 Interrupt controller</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">EDAC RAS Driver</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Clock manager</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Reset manager</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">UART</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">WatchDog timer</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">System manager</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">SVC SOC FPGA manager</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">SVC FPGA firmware</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">SMMU</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">SVC FCS Crypto</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">SVC HWMON</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">SVC RSU</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">CVP</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">PMU</td>
<td align="left">Yes</td>
</tr>
</tbody>
</table>
<h3 id="build-instructions">Build Instructions<a class="headerlink" href="#build-instructions" title="Permanent link">&para;</a></h3>
<p>The following diagram illustrates the full-build flow for the binaries used with the Intel Simics simulator. The build flow utilizes the source code placed in <a href="https://github.com/altera-opensource">GitHub</a> in repositories and uses a flow based on Yocto.</p>
<p><a class="glightbox" href="../images/BuildBinariesFlow.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/BuildBinariesFlow.jpg" /></a></p>
<!--{"type":"recipe", "name":"Agilex5SoCLinxSimicsGSRD", "results":["$TOP_FOLDER/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/gsrd-console-image-agilex5.wic", "$TOP_FOLDER/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/u-boot-agilex5-socdk-gsrd-atf/u-boot-spl-dtb.bin", "$TOP_FOLDER/qspi-bin/flash_image_jic.rpd", "$TOP_FOLDER/nand-bin/nand.img"]}-->

<h4 id="set-up-the-environment">Set Up the Environment<a class="headerlink" href="#set-up-the-environment" title="Permanent link">&para;</a></h4>
<!--{"type":"step", "name":"Setting up Environment"}-->
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>agilex5_gsrd
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>mkdir<span class="w"> </span>agilex5_gsrd
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">cd</span><span class="w"> </span>agilex5_gsrd
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TOP_FOLDER</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
</code></pre></div>
<!--{"type":"/code" }-->

<p>Download the compiler toolchain. Define environment variables so that the toolchain can be used to build the binaries:</p>
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Setup toolchain</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>wget<span class="w"> </span>https://developer.arm.com/-/media/Files/downloads/gnu/11.2-2022.02/binrel/gcc-arm-11.2-2022.02-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>tar<span class="w"> </span>xf<span class="w"> </span>gcc-arm-11.2-2022.02-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>rm<span class="w"> </span>-f<span class="w"> </span>gcc-arm-11.2-2022.02-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/gcc-arm-11.2-2022.02-x86_64-aarch64-none-linux-gnu/bin:<span class="nv">$PATH</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ARCH</span><span class="o">=</span>arm64
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CROSS_COMPILE</span><span class="o">=</span>aarch64-none-linux-gnu-
</code></pre></div>
<!--{"type":"/code" }-->

<p>Set up the Quartus tools in the PATH, so they are accessible without full path:</p>
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Setup Quartus tool in PATH</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_ROOTDIR</span><span class="o">=</span>~/intelFPGA_pro/24.2/quartus/
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/bin:<span class="nv">$QUARTUS_ROOTDIR</span>/linux64:<span class="nv">$QUARTUS_ROOTDIR</span>/../qsys/bin:<span class="nv">$PATH</span>
</code></pre></div>
<!--{"type":"/code" }-->

<!--{"type":"/step" }-->

<h4 id="build-the-hardware-design">Build the Hardware Design<a class="headerlink" href="#build-the-hardware-design" title="Permanent link">&para;</a></h4>
<p>In Simics, the SOF file generated as result of the build of the hardware design is not used at all in the simulation, but this is needed to create the RPD file to excercise the QSPI boot. This is the reason why we provide the steps to build the hardware desgin here.</p>
<!--{"type":"step","name":"Build Hardware Design", "results":["$TOP_FOLDER/agilex5_soc_devkit_ghrd/output_files/ghrd_a5ed065bb32ae6sr0.sof"]}-->
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>ghrd-socfpga<span class="w"> </span>agilex5_soc_devkit_ghrd
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>QPDS24.2_REL_GSRD_PR<span class="w"> </span>https://github.com/altera-opensource/ghrd-socfpga
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>mv<span class="w"> </span>ghrd-socfpga/agilex5_soc_devkit_ghrd<span class="w"> </span>.
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>rm<span class="w"> </span>-rf<span class="w"> </span>ghrd-socfpga
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="nb">cd</span><span class="w"> </span>agilex5_soc_devkit_ghrd
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>make<span class="w"> </span>config
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>make<span class="w"> </span><span class="nv">DEVICE</span><span class="o">=</span>A5ED065BB32AE6SR0<span class="w"> </span><span class="nv">HPS_EMIF_MEM_CLK_FREQ_MHZ</span><span class="o">=</span><span class="m">800</span><span class="w"> </span><span class="nv">HPS_EMIF_REF_CLK_FREQ_MHZ</span><span class="o">=</span><span class="m">100</span><span class="w"> </span>generate_from_tcl
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>make<span class="w"> </span>all
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>
<!--{"type":"/code" }-->

<p>The following file is created:</p>
<ul>
<li>$TOP_FOLDER/agilex5_soc_devkit_ghrd/output_files/ghrd_a5ed065bb32ae6sr0.sof</li>
</ul>
<!--{"type":"/step" }-->

<h4 id="set-up-the-yocto-build-system">Set Up the Yocto Build System<a class="headerlink" href="#set-up-the-yocto-build-system" title="Permanent link">&para;</a></h4>
<!--{"type":"step","name":"Setting Up Yocto Build System", "results":[]}-->

<ol>
<li>Ensure your system satisfies the Yocto system requirements provided at https://docs.yoctoproject.org/3.4.1/ref-manual/system-requirements.html#supported-linux-distributions.</li>
</ol>
<p>Use the following commands to install required packages on Ubuntu 22.04:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>upgrade
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>openssh-server<span class="w"> </span>mc<span class="w"> </span>libgmp3-dev<span class="w"> </span>libmpc-dev<span class="w"> </span>gawk<span class="w"> </span>wget<span class="w"> </span>git<span class="w"> </span>diffstat<span class="w"> </span>unzip<span class="w"> </span>texinfo<span class="w"> </span>gcc<span class="se">\ </span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>build-essential<span class="w"> </span>chrpath<span class="w"> </span>socat<span class="w"> </span>cpio<span class="w"> </span>python3<span class="w"> </span>python3-pip<span class="w"> </span>python3-pexpect<span class="w"> </span>xz-utils<span class="w"> </span>debianutils<span class="w"> </span>iputils-ping<span class="se">\ </span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>python3-git<span class="w"> </span>python3-jinja2<span class="w"> </span>libegl1-mesa<span class="w"> </span>libsdl1.2-dev<span class="w"> </span>pylint3<span class="w"> </span>xterm<span class="w"> </span>python3-subunit<span class="w"> </span>mesa-common-dev<span class="w"> </span>zstd<span class="se">\ </span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>liblz4-tool<span class="w"> </span>git<span class="w"> </span>fakeroot<span class="w"> </span>build-essential<span class="w"> </span>ncurses-dev<span class="w"> </span>xz-utils<span class="w"> </span>libssl-dev<span class="w"> </span>bc<span class="w"> </span>flex<span class="w"> </span>libelf-dev<span class="w"> </span>bison<span class="w"> </span>xinetd<span class="se">\ </span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>tftpd<span class="w"> </span>tftp<span class="w"> </span>nfs-kernel-server<span class="w"> </span>libncurses5<span class="w"> </span>libc6-i386<span class="w"> </span>libstdc++6:i386<span class="w"> </span>libgcc++1:i386<span class="w"> </span>lib32z1<span class="se">\ </span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>device-tree-compiler<span class="w"> </span>curl<span class="w"> </span>mtd-utils<span class="w"> </span>mtd-tools<span class="w"> </span>u-boot-tools<span class="w"> </span>net-tools<span class="w"> </span>swig<span class="w"> </span>-y
</code></pre></div>
<p>On Ubuntu 22.04, point the /bin/sh to /bin/bash, as the default is a link to /bin/dash:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>sudo<span class="w"> </span>ln<span class="w"> </span>-sf<span class="w"> </span>/bin/bash<span class="w"> </span>/bin/sh
</code></pre></div>
<p><strong>Note</strong>: You can also use Docker containers to build the Yocto recipes. Refer to https://rocketboards.org/foswiki/Documentation/DockerYoctoBuild for details. When using a Docker container, it does not matter what Linux distribution or packages you have installed on your host, as all dependencies are provided by the Docker container.</p>
<ol>
<li>Clone the Yocto script and prepare the build:</li>
</ol>
<!--{"type":"code" }-->
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>gsrd-socfpga
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>scarthgap<span class="w"> </span>https://github.com/altera-opensource/gsrd-socfpga
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nb">cd</span><span class="w"> </span>gsrd-socfpga
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>.<span class="w"> </span>agilex5_dk_a5e065bb32aes1-gsrd-build.sh
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>build_setup
</code></pre></div>
<!--{"type":"/code" }-->

<p><em>Note</em>: Run the following commands to set up the yocto build environments again, if you closed the current window (for example, when rebooting the Linux host) and want to resume the next steps:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>.<span class="w"> </span>./poky/oe-init-build-env<span class="w"> </span>agilex5_devkit-gsrd-rootfs/
</code></pre></div>
<!--{"type":"/step" }-->

<h4 id="customize-the-yocto-build">Customize the Yocto Build<a class="headerlink" href="#customize-the-yocto-build" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>(Optional) Change the following files in <strong>gsrd-socfpga/meta-intel-fpga-refdes/recipes-bsp/u-boot/files/</strong>:</p>
<ul>
<li>distroboot script:<a href="https://github.com/altera-opensource/meta-intel-fpga-refdes/blob/master/recipes-bsp/u-boot/files/uboot.txt">uboot.txt</a></li>
<li><strong>its</strong> file for creating FIT image fromthe above script: <a href="https://github.com/altera-opensource/meta-intel-fpga-refdes/blob/master/recipes-bsp/u-boot/files/uboot_script.its">uboot_script.its</a> </li>
</ul>
</li>
<li>
<p>(Optional) Change the following file in <strong>gsrd-socfpga/meta-intel-fpga-refdes/recipes-kernel/linux/linux-socfpga-lts</strong>:</p>
<ul>
<li><strong>its</strong> file for creating the <strong>kernel.itb</strong> image: <a href="https://github.com/altera-opensource/meta-intel-fpga-refdes/blob/master/recipes-kernel/linux/linux-socfpga-lts/fit_kernel_agilex5.its">fit_kernel_agilex5.its</a> , which by default contains the following:
    * Kernel
    * Distroboot boot script
    * Device tree configurations
    * Board configurations </li>
</ul>
</li>
</ol>
<h4 id="build-yocto">Build Yocto<a class="headerlink" href="#build-yocto" title="Permanent link">&para;</a></h4>
<!--{"type":"step","name":"Build Yocto", "results":["$TOP_FOLDER/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/gsrd-console-image-agilex5.wic","$TOP_FOLDER/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/u-boot-agilex5-socdk-gsrd-atf/u-boot-spl-dtb.bin"]}-->

<p>Build Yocto:</p>
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>bitbake_image
</code></pre></div>
<!--{"type":"/code" }-->

<p>Gather files:</p>
<!--{"type":"code" }-->
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>package<span class="w"> </span>
</code></pre></div>
<!--{"type":"/code" }-->

<!--{"type":"/step" }-->

<p>After the build is completed successfully, the following two folders are created:</p>
<ul>
<li><code>agilex5_devkit-gsrd-rootfs</code>: area used by OpenEmbedded build system for builds. For the description of the build directory structure, refer to https://docs.yoctoproject.org/ref-manual/structure.html#the-build-directory-build.</li>
<li><code>agilex5_devkit-gsrd-images</code>: the build script copies here are relevant files built by Yocto from the <code>agilex5_devkit-gsrd-rootfs/tmp/deploy/images/agilex5</code> folder. It also includes other relevant files.</li>
</ul>
<p><strong>Note</strong>: If you want to build binaries creating each one of the binaries independently, you could refer to <a href="https://altera-fpga.github.io/rel-24.2/embedded-designs/agilex-5/e-series/premium/boot-examples/ug-linux-boot-agx5e-premium/">Agilex™ 5 E-Series GHRD Linux Boot Examples</a>.</p>
<p>The most relevant files created in the <code>$TOP_FOLDER/gsrd-socfpga/agilex5_devkit-gsrd-images</code> folder are:</p>
<table>
<thead>
<tr>
<th align="center">File</th>
<th align="center">Description</th>
<th>SD Card Boot</th>
<th>QSPI Boot</th>
<th>NAND Boot</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">ghrd_a5ed065bb32ae6sr0.sof</td>
<td align="center">SOF file from the hardware design</td>
<td></td>
<td>*</td>
<td></td>
</tr>
<tr>
<td align="center">u-boot-spl-dtb.bin</td>
<td align="center">U-Boot SPL binary file</td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
<tr>
<td align="center">u-boot.itb</td>
<td align="center">U-Boot (SSBL)</td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
<tr>
<td align="center">boot.scr.uimg</td>
<td align="center">Distroboot boot script</td>
<td>*</td>
<td></td>
<td>*</td>
</tr>
<tr>
<td align="center">kernel.itb</td>
<td align="center">Linux kernel fit image</td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
<tr>
<td align="center">console-image-minimal-agilex5_nand.ubifs</td>
<td align="center">File system for NAND boot</td>
<td></td>
<td></td>
<td>*</td>
</tr>
<tr>
<td align="center">console-image-minimal-agilex5_nor.ubifs</td>
<td align="center">File system for QSPI boot</td>
<td></td>
<td>*</td>
<td></td>
</tr>
<tr>
<td align="center">gsrd-console-image-agilex5.wic</td>
<td align="center">SD Card Image</td>
<td>*</td>
<td></td>
<td></td>
</tr>
<tr>
<td align="center">uboot.txt</td>
<td align="center">U-Boot Distroboot script</td>
<td></td>
<td>*</td>
<td></td>
</tr>
<tr>
<td align="center">uboot_script.its</td>
<td align="center">ITS file to create FIT binary of U-Boot Distroboot script</td>
<td></td>
<td>*</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="build-qspi-boot-image">Build QSPI Boot Image<a class="headerlink" href="#build-qspi-boot-image" title="Permanent link">&para;</a></h4>
<p>The next step consists of creating the QSPI image with UBIFS format that will be used by in the simulation that exercises this use case. To build this image the same binaries generated from the GSRD build are used.</p>
<p>The layout of the QSPI image is shown in the following table:</p>
<table>
<thead>
<tr>
<th align="left">MTD Partition</th>
<th align="left">UBI Volume</th>
<th align="left">Volume Name</th>
<th align="left">Type</th>
<th align="left">Image/Individual File</th>
<th align="left">Group File</th>
<th align="left">Start Addr</th>
<th>Size</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0 (qspi_bootinfo)</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">RAW</td>
<td align="left">Bootinfo (Empty)</td>
<td align="left">N/A</td>
<td align="left">0x0</td>
<td>2MB</td>
</tr>
<tr>
<td align="left">1 (qspi_uboot)</td>
<td align="left">N/A<br>N/A</td>
<td align="left">N/A<br>N/A</td>
<td align="left">RAW<br>RAW</td>
<td align="left">bitstream (FPGA image, SDM firmware)<br>u-boot.itb</td>
<td align="left">N/A</td>
<td align="left">0x00200000<br>0x04000000</td>
<td>~1 MB<br>AUTO</td>
</tr>
<tr>
<td align="left">2 (qspi_root)</td>
<td align="left">0<br>1<br>2<br>3<br>4</td>
<td align="left">env<br>script<br>kernel<br>dtb<br>rootfs</td>
<td align="left">UBI<br>UBI<br>UBI<br>UBI<br>UBIFS</td>
<td align="left">u-boot.env<br>u-boot.scr<br>kernel.itb<br>kernel.dtb<br>rootfs.ubifs</td>
<td align="left"><br><br>root.ubi</td>
<td align="left">0x4200000<br>Auto<br>Auto<br>Auto<br>Auto</td>
<td>256KB<br>128KB<br>24MB<br>256KB<br>160MB</td>
</tr>
</tbody>
</table>
<!--{"type":"step", "name":"Build QSPI Image", "results":["$TOP_FOLDER/qspi-bin/flash_image_jic.rpd"]}-->
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Gattering files</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>rm<span class="w"> </span>-rf<span class="w"> </span>qspi-bin<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>qspi-bin<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>qspi-bin<span class="w"> </span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/agilex5_soc_devkit_ghrd/output_files/ghrd_a5ed065bb32ae6sr0.sof<span class="w"> </span>agilex5_factory.sof
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/u-boot-agilex5-socdk-gsrd-atf/u-boot.itb<span class="w"> </span>u-boot-itb.bin
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/u-boot-agilex5-socdk-gsrd-atf/u-boot-spl-dtb.hex<span class="w"> </span>u-boot-spl.hex
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/kernel.itb<span class="w"> </span>kernel-image
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/console-image-minimal-agilex5_nor.ubifs<span class="w">  </span>rootfs.ubifs
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/u-boot-agilex5-socdk-gsrd-atf/boot.scr.uimg<span class="w"> </span>boot.scr.uimg
</code></pre></div>
<!--{"type":"/code" }-->

<ol>
<li>Create the PFG file that describes the format of the QSPI image: </li>
</ol>
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># Gattering more files</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/qspi-bin
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; agilex5_flash_image.pfg</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="s">&lt;pfg version=&quot;1&quot;&gt;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="s">    &lt;settings custom_db_dir=&quot;./&quot; mode=&quot;ASX4&quot;/&gt;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="s">    &lt;output_files&gt;</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="s">        &lt;output_file name=&quot;flash_image&quot; directory=&quot;.&quot; type=&quot;JIC&quot;&gt;</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="s">            &lt;file_options/&gt;</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="s">            &lt;secondary_file type=&quot;MAP&quot; name=&quot;flash_image_jic&quot;&gt;</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="s">                &lt;file_options/&gt;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="s">            &lt;/secondary_file&gt;</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="s">            &lt;secondary_file type=&quot;SEC_RPD&quot; name=&quot;flash_image_jic&quot;&gt;</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="s">                &lt;file_options bitswap=&quot;1&quot;/&gt;</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="s">            &lt;/secondary_file&gt;</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="s">            &lt;flash_device_id&gt;Flash_Device_1&lt;/flash_device_id&gt;</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="s">        &lt;/output_file&gt;</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="s">    &lt;/output_files&gt;</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="s">    &lt;bitstreams&gt;</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="s">        &lt;bitstream id=&quot;Bitstream_1&quot;&gt;</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="s">            &lt;path hps_path=&quot;./u-boot-spl.hex&quot;&gt;./agilex5_factory.sof&lt;/path&gt;</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="s">        &lt;/bitstream&gt;</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="s">    &lt;/bitstreams&gt;</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="s">    &lt;raw_files&gt;</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="s">        &lt;raw_file bitswap=&quot;1&quot; type=&quot;RBF&quot; id=&quot;Raw_File_1&quot;&gt;u-boot-itb.bin&lt;/raw_file&gt;</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="s">        &lt;raw_file bitswap=&quot;1&quot; type=&quot;RBF&quot; id=&quot;Raw_File_2&quot;&gt;hps.bin&lt;/raw_file&gt;</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="s">    &lt;/raw_files&gt;</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="s">    &lt;flash_devices&gt;</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="s">        &lt;flash_device type=&quot;MT25QU02G&quot; id=&quot;Flash_Device_1&quot;&gt;</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="s">            &lt;partition reserved=&quot;1&quot; fixed_s_addr=&quot;1&quot; s_addr=&quot;0x00000000&quot; e_addr=&quot;0x001FFFFF&quot; fixed_e_addr=&quot;1&quot; id=&quot;BOOT_INFO&quot; size=&quot;0&quot;/&gt;</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="s">            &lt;partition reserved=&quot;0&quot; fixed_s_addr=&quot;0&quot; s_addr=&quot;0x00200000&quot; e_addr=&quot;0x0030FFFF&quot; fixed_e_addr=&quot;0&quot; id=&quot;P1&quot; size=&quot;0&quot;/&gt;</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="s">            &lt;partition reserved=&quot;0&quot; fixed_s_addr=&quot;0&quot; s_addr=&quot;0x04000000&quot; e_addr=&quot;auto&quot; fixed_e_addr=&quot;0&quot; id=&quot;U-Boot&quot; size=&quot;0&quot;/&gt;</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="s">            &lt;partition reserved=&quot;0&quot; fixed_e_addr=&quot;1&quot; e_addr=&quot;0xFFFFFFF&quot; id=&quot;HPS&quot; s_addr=&quot;0x4200000&quot;/&gt;</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="s">        &lt;/flash_device&gt;</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="s">        &lt;flash_loader&gt;A5ED065BB32AE6SR0&lt;/flash_loader&gt;</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="s">    &lt;/flash_devices&gt;</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="s">    &lt;assignments&gt;</span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="s">        &lt;assignment page=&quot;0&quot; partition_id=&quot;P1&quot;&gt;</span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="s">            &lt;bitstream_id&gt;Bitstream_1&lt;/bitstream_id&gt;</span>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a><span class="s">        &lt;/assignment&gt;</span>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="s">        &lt;assignment page=&quot;0&quot; partition_id=&quot;U-Boot&quot;&gt;</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a><span class="s">            &lt;raw_file_id&gt;Raw_File_1&lt;/raw_file_id&gt;</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a><span class="s">        &lt;/assignment&gt;</span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="s">        &lt;assignment page=&quot;0&quot; partition_id=&quot;HPS&quot;&gt;</span>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="s">            &lt;raw_file_id&gt;Raw_File_2&lt;/raw_file_id&gt;</span>
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a><span class="s">        &lt;/assignment&gt;</span>
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="s">    &lt;/assignments&gt;</span>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a><span class="s">&lt;/pfg&gt;</span>
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a><span class="s">EOF</span>
</code></pre></div>
<!--{"type":"/code" }-->

<ol>
<li>Create UBI configuration file for the rootfs partition:</li>
</ol>
<!--{"type":"code" }-->
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># Creating UBI Configuration file</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/qspi-bin
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>cat<span class="w"> </span><span class="s">&lt;&lt; EOT &gt;ubinize_nor.cfg </span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="s">[env]</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="s">mode=ubi</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="s">vol_id=0</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="s">vol_name=env</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="s">vol_size=256KiB</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="s">vol_type=dynamic</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="s">[script]</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="s">mode=ubi</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="s">image=boot.scr.uimg</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="s">vol_id=1</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="s">vol_name=script</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="s">vol_size=128KiB</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="s">vol_type=dynamic</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="s">[kernel]</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="s">mode=ubi</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="s">image=kernel-image     </span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="s">vol_id=2</span>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="s">vol_name=kernel</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="s">vol_size=24MiB</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="s">vol_type=dynamic</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="s">[dtb]</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="s">mode=ubi</span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="s">vol_id=3</span>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="s">vol_name=dtb</span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="s">vol_size=256KiB</span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="s">vol_type=dynamic</span>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a><span class="s">[rootfs]</span>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="s">mode=ubi</span>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a><span class="s">image=rootfs.ubifs</span>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a><span class="s">vol_id=4</span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a><span class="s">vol_name=rootfs</span>
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a><span class="s">vol_type=dynamic</span>
<a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a><span class="s">vol_size=160MiB</span>
<a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a><span class="s">vol_flag=autoresize</span>
<a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a><span class="s">EOT</span>
</code></pre></div>
<!--{"type":"/code" }-->

<p>The following file is created:
   * $TOP_FOLDER/qspi-bin/ubinize_nor.cfg</p>
<ol>
<li>Generate the <em>root.ubi</em> file for root partition. For this, the <em>ubinize_nor.cfg</em> is used with the files obtained from the previous steps. This file defines the components to be included in the root.ubi file as indicated in the table above. The ubinize executable is available as part of the <em>mtd-tools</em> package. 
The parameters for ubinize command are:
-p: physical erase block size of the flash
-m: minimum input/output unit size of the flash
-s: sub-pages and sub-page size <br></li>
</ol>
<p>Once the <em>root.ubi</em> files is created this is renamed as <em>hps.bin</em>. <br>
<em>Required files for this step:</em> ubinize_nor.cfg,  boot.scr.uimg,  kernel-image,  rootfs.ubifs</p>
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># Generate hps.bin file with UBI format</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>ubinize<span class="w"> </span>-o<span class="w"> </span>root.ubi<span class="w"> </span>-p<span class="w"> </span><span class="m">65536</span><span class="w"> </span>-m<span class="w"> </span><span class="m">1</span><span class="w"> </span>-s<span class="w"> </span><span class="m">1</span><span class="w"> </span>ubinize_nor.cfg
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>mv<span class="w"> </span>root.ubi<span class="w"> </span>hps.bin
</code></pre></div>
<!--{"type":"/code" }-->

<p>The following file is created:
   * $TOP_FOLDER/qspi-bin/hps.bin</p>
<ol>
<li>Using Quartus Programming File Generator to compile an RPD file by using the configuration specified in the PFG file.</li>
</ol>
<p><em>Required files for this step:</em> u-boot-spl.hex,  agilex5_factory.sof, u-boot-itb.bin and hps.bin  <br>
<em>Note:</em> Make sure the filenames are specified correctly in agilex5_flash_image.pfg</p>
<p>Run the Quartus File Generator command below to generate an RPD file:</p>
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># Creating QSPI image</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>quartus_pfg<span class="w"> </span>-c<span class="w"> </span>agilex5_flash_image.pfg
</code></pre></div>
<!--{"type":"/code" }-->
<!--{"type":"/step" }-->

<p>The following file is created:
   * $TOP_FOLDER/qspi-bin/flash_image_jic.rpd</p>
<h4 id="build-nand-boot-image">Build NAND Boot Image<a class="headerlink" href="#build-nand-boot-image" title="Permanent link">&para;</a></h4>
<p>The next step consists of creating the NAND image that will be used by in the simulation that exercises this use case. For this, the NAND image will have the layout shown in the following figure:</p>
<table>
<thead>
<tr>
<th align="left">MTD Partition</th>
<th align="left">UBI Volume</th>
<th align="left">Volume Name</th>
<th align="left">Type</th>
<th align="left">Image/Individual File</th>
<th align="left">Group File</th>
<th align="left">Flash Offset</th>
<th align="left">Size</th>
<th>Size in Hex</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0 (u-boot)</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">RAW</td>
<td align="left">u-boot.itb</td>
<td align="left">N/A</td>
<td align="left">0x00000000</td>
<td align="left">2 MB</td>
<td>0x200000</td>
</tr>
<tr>
<td align="left">1 (root)</td>
<td align="left">0<br>1<br>2<br>3<br>4</td>
<td align="left">env<br>script<br>kernel<br>dtb<br>rootfs</td>
<td align="left">UBI<br>UBI<br>UBI<br>UBI<br>UBIFS</td>
<td align="left">u-boot.env<br>u-boot.scr<br>kernel.itb<br>kernel.dtb<br>rootfs.ubifs</td>
<td align="left"><br><br>root.ubi</td>
<td align="left"><br><br>0x00200000<br> onwards</td>
<td align="left">256KB<br>128KB<br>24MB<br>256KB<br>272MB</td>
<td>0x40000<br>0x20000<br>0xA00000<br>0x40000<br>0x11000000</td>
</tr>
</tbody>
</table>
<p>Based on the table above, we have 2 partitions. One contains just the U-Boot fit image located at address 0x0 and the other contains the rest of the software components in a ubi file (with UBIFS format) located at address 0x200000. Continue with the following steps to create the NAND boot image.</p>
<ol>
<li>Bring the required files from the GSRD build directory to a NAND boot directory:</li>
</ol>
<!--{"type":"step", "name":"Build NAND Boot Image", "results":["$TOP_FOLDER/nand-bin/nand.img"]}-->
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Gathering the required files</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>rm<span class="w"> </span>-rf<span class="w"> </span>nand-bin<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>nand-bin<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>nand-bin
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga/meta-intel-fpga-refdes/recipes-bsp/u-boot/files/uboot_script.its<span class="w"> </span>uboot_script.its<span class="w"> </span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga/meta-intel-fpga-refdes/recipes-bsp/u-boot/files/uboot.txt<span class="w"> </span>.
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/u-boot-agilex5-socdk-gsrd-atf/u-boot.itb<span class="w"> </span>u-boot.itb
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/kernel.itb<span class="w"> </span>kernel-image
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/socfpga_agilex5_socdk_nand_vanilla.dtb<span class="w"> </span>kernel-dtb
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/console-image-minimal-agilex5_nand.ubifs<span class="w"> </span>rootfs.ubifs
</code></pre></div>
<!--{"type":"/code" }-->

<ol>
<li>The Agilex 5 E-Series Universal virtual virtual returns by default a board_id = 0 when U-Boot reads the <strong>STRATIX_JTAG_USER_CODE</strong> parameter. The board_id is used to select the desired configuration (linux kernel image + device tree + fpga fabric design) as described in <a href="https://www.rocketboards.org/foswiki/Documentation/SingleImageBoot">Single  Image Boot flow</a>. Starting from 24.2 release, the configuration for board_id = 0 defines the device tree for the OOB board in the premium dev kit (SD card daughter card). Since we want to load the configuratio that works for NAND boot, we require to use the device tree specific for the NAND daughter card. In order to address this problem, one solution is to force having a board_id that defines the configuration for NAND (and also without defining a FPGA core fabric since in Simics programming the fabric is not supported). For this, we require to set in U-Boot the  <strong>board_id</strong> environment variable to 7 for which the <strong>socfpga_agilex5_socdk_nand_vanilla.dtb</strong> device tree is used (as can be seen in <strong>fit_kernel_agilex5_devkit.its</strong>). This is achieved with the following code:</li>
</ol>
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># Update boot script to modify board_id so we can boot from nand_vanila device tree</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/nand-bin
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/Trying to boot Linux from device/a setenv board_id 7 &#39;</span><span class="w"> </span>uboot.txt
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>mkimage<span class="w"> </span>-f<span class="w"> </span>uboot_script.its<span class="w"> </span>boot.scr.uimg
</code></pre></div>
<!--{"type":"/code" }-->

<ol>
<li>Create UBI configuration file for the root partition:</li>
</ol>
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># Create the UBI Configuration file</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/nand-bin
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOT &gt;ubinize_nand.cfg </span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="s">[env]</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="s">mode=ubi</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="s">vol_id=0</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="s">vol_name=env</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="s">vol_size=256KiB</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="s">vol_type=dynamic</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="s">[script]</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="s">mode=ubi</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="s">image=boot.scr.uimg</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="s">vol_id=1</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="s">vol_name=script</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="s">vol_size=128KiB</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="s">vol_type=dynamic</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="s">[kernel]</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="s">mode=ubi</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="s">image=kernel-image     </span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="s">vol_id=2</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="s">vol_name=kernel</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="s">vol_size=24MiB</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="s">vol_type=dynamic</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="s">[dtb]</span>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="s">mode=ubi</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="s">image=kernel-dtb</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="s">vol_id=3</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="s">vol_name=dtb</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="s">vol_size=256KiB</span>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="s">vol_type=dynamic</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="s">[rootfs]</span>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="s">mode=ubi</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="s">image=rootfs.ubifs</span>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="s">vol_id=4</span>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="s">vol_name=rootfs</span>
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a><span class="s">vol_type=dynamic</span>
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="s">vol_size=400MiB</span>
<a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="s">vol_flag=autoresize</span>
<a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a>
<a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a><span class="s">EOT</span>
</code></pre></div>
<!--{"type":"/code" }-->

<p><strong>Note:</strong> <strong>kernel-dtb</strong> is not really used since the dtb used is inside the <strong>kernel-image</strong> file.</p>
<ol>
<li>Generate root.ubi file for root partition, using the <strong>ubinize_nand.cfg</strong> file generated in previous step. This file defines the components to be included in the root.ubi file as indicated in the table above. The command used to generate the file is <strong>ubinize</strong> which is available as part of the mtd-tools package. The parameters that <strong>ubinize</strong> command received are listed next:</li>
</ol>
<ul>
<li>-p: physical erase block size of the flash</li>
<li>-m: minimum input/output unit size of the flash</li>
<li>-s: sub-pages and sub-page size, ubinize will take into account and put the VID header to same NAND page as the EC header</li>
</ul>
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Create the UBI file with root partition</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/nand-bin
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>ubinize<span class="w"> </span>-o<span class="w"> </span>root.ubi<span class="w"> </span>-p<span class="w"> </span>1024KiB<span class="w"> </span>-m<span class="w"> </span><span class="m">8192</span><span class="w"> </span>-s<span class="w"> </span><span class="m">8192</span><span class="w"> </span>ubinize_nand.cfg
</code></pre></div>
<!--{"type":"/code" }-->

<p>The following file is created:</p>
<ul>
<li>$TOP_FOLDER/nand-bin/root.ubi</li>
</ul>
<ol>
<li>Generate final NAND image (nand.img) using <strong>dd</strong> command. This file includes the U-Boot built from the GSRD and the root.ubi file generated in the step before. The location in the NAND image is indicated in the table above.</li>
</ol>
<!--{"type":"code" }-->

<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Creating the NAND image</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">COMBINEDFILE</span><span class="o">=</span>nand.img
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/zero<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1024M<span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;\0&#39;</span><span class="w"> </span><span class="s1">$&#39;\xFF&#39;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$COMBINEDFILE</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="c1"># Adding u-boot.itb</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>dd<span class="w"> </span><span class="nv">conv</span><span class="o">=</span>notrunc<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="k">if</span><span class="o">=</span><span class="s1">&#39;u-boot.itb&#39;</span><span class="w"> </span><span class="nv">of</span><span class="o">=</span><span class="nv">$COMBINEDFILE</span><span class="w"> </span><span class="nv">seek</span><span class="o">=</span><span class="k">$((</span><span class="m">0x00000000</span><span class="k">))</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="c1"># Adding root.ubi</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>dd<span class="w"> </span><span class="nv">conv</span><span class="o">=</span>notrunc<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="k">if</span><span class="o">=</span><span class="s1">&#39;root.ubi&#39;</span><span class="w"> </span><span class="nv">of</span><span class="o">=</span><span class="nv">$COMBINEDFILE</span><span class="w"> </span><span class="nv">seek</span><span class="o">=</span><span class="k">$((</span><span class="m">0x00200000</span><span class="k">))</span>
</code></pre></div>
<!--{"type":"/code" }-->
<!--{"type":"/step" }-->

<p>The following file is created:
- $TOP_FOLDER/nand-bin/nand.img</p>
<!--{"type":"/recipe" }-->

<h3 id="known-issues-with-the-release">Known Issues with the Release<a class="headerlink" href="#known-issues-with-the-release" title="Permanent link">&para;</a></h3>
<p>For known issues in this release please refer to the <a href="https://www.rocketboards.org/foswiki/Documentation/SimicsSimulatorForIntelFPGAReleasePage#Known_Issues">Intel Simics Simulator for FPGA Release page</a>.</p>
<h2 id="agilextm-5-e-series-simics-virtual-platform-universal">Agilex™ 5 E-Series Simics Virtual Platform - Universal<a class="headerlink" href="#agilextm-5-e-series-simics-virtual-platform-universal" title="Permanent link">&para;</a></h2>
<p>This virtual platform is associated with the <strong>agilex5e-universal.simics</strong> target script. The following figure shows a high-level block diagram of this virtual platform. In this diagram, you can observe the main components that can be exercised during the execution of the use cases described later on this page. The implementation of this virtual platform allows all the peripherals in the HPS to be enabled at the same time, which is not possible in physical hardware implementations. The pinmux and Combo PHY impose restrictions on the physical hardware. In the case of the pinmux in the physical hardware, you can enable only a subset of peripherals simultaneously because there are not enough pins if all pins are enabled simultaneously. This limitation does not exist in the Agilex™ 5 E-Series Universal Virtual Platform. For the Combo PHY, the physical hardware allows only one flash controller (NAND or SDMMC) to be enabled at a time. However, the virtual platform allows both to be enabled simultaneously.</p>
<p><a class="glightbox" href="../images/agilex5e_vp_block_24p2.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/agilex5e_vp_block_24p2.jpg" /></a></p>
<p>In this block diagram:</p>
<ul>
<li>The architecture of the virtual platform follows a hierarchy that goes from <strong>target script → system → board → fpga → qsys_top → hps_subsystem → agilex_hps,</strong> which is aligned with the Simics virtual platform development philosophy that tries to match with the real golden hardware reference design (GHRD) architecture.</li>
<li>The <strong>target script</strong> instantiates the <strong>system component</strong>, provides the CLI run time commands, and creates the network configuration. This script also defines the parameters that configure other components.</li>
<li>The <strong>system component</strong> represents the complete virtual platform system and instantiates the <strong>board component</strong>. This component is implemented in a Python file.</li>
<li>The <strong>board component</strong> represents the model of a PCB (analogous to a development kit). It includes the instance of the <strong>FPGA component</strong> and all board components connected to the FPGA (for example, flash devices, ethernet PHY). The GPIO loopback connection is implemented here. This component is implemented in a Python file.</li>
<li>The <strong>FPGA component</strong> represents the top-level hardware design model in the Quartus Prime software project design that targets the Agilex™ 5 E-Series SoC FPGA device. It matches the logical hierarchy of the fictitious GHRD that the Agilex™ 5 E-Series Universal Virtual Platform models. This component only instantiates the qsys_top component and is implemented as a Python script.</li>
<li>The <strong>qsys_top</strong> component matches the design's top view being modeled and corresponds to the system seen from the Platform Designer under the GHRD (soc_inst instance). The HPS subsystem component and the components included as part of the FPGA fabric design are instantiated under the qsys_top component. The qsys_top component is modeled as a Python script.</li>
<li>The <strong>FPGA fabric</strong> design corresponds to the logic model implemented in the FPGA fabric.</li>
<li>The <strong>HPS subsystem</strong> component corresponds to the model of the module that integrates all components associated with the HPS in the Agilex™ 5 E-Series device. It includes the HPS models, SDM mailbox, and EMIF model.</li>
<li>The <strong>Agilex™ 5 HPS component</strong> in the virtual platform is an Intel Simics model that corresponds to the Hard Processor System Agilex™ 5 FPGA IP in the  Quartus Prime software.</li>
<li>The embedded software running in the HPS component is expected to be the same that can be run in the real silicon. Exercising the HPS-embedded software in this virtual platform allows you to debug the software using the Simics debug capabilities.</li>
</ul>
<h3 id="main-features-supported-by-the-intel-agilextm-5-e-series-universal-virtual-platform">Main Features Supported by the Intel Agilex™ 5 E-Series Universal Virtual Platform<a class="headerlink" href="#main-features-supported-by-the-intel-agilextm-5-e-series-universal-virtual-platform" title="Permanent link">&para;</a></h3>
<h4 id="boot-an-operative-system">Boot an Operative System<a class="headerlink" href="#boot-an-operative-system" title="Permanent link">&para;</a></h4>
<p>The Agilex™ 5 E-Series Virtual Platform allows exercising the HPS software in all parts of the boot flow for Linux* and Zephyr* operating systems. You can exercise the boot flow from a flash device such as an SD Card, NAND flash, or QSPI flash. Booting from an SD Card is the default boot mode.</p>
<h4 id="basic-ethernet">Basic Ethernet<a class="headerlink" href="#basic-ethernet" title="Permanent link">&para;</a></h4>
<p>The basic ethernet functionality is configured from the <strong>agilex5e-universal.simics target</strong> script. The virtual platform simulates a network switch and a router in the simulated environment using the service node component referred to as <strong>service_node_cmp0</strong>. This provides a TFTP server to transfer files from the host PC to the target system and a DHCP server to assign an IP to the target system dynamically.</p>
<p>The service node acts as a simulated environment router configured with the 10.10.0.1 IP address. The DHCP service is configured to assign an IP in the range of 10.10.0.100 and 10.10.0.199. The service node is also configured to provide Network Address Port Translation (NAPT) for outgoing traffic, allowing it to interact with the host PC enabling TFTP, SCP, and SSH services.</p>
<p>The target device provides ethernet functionality using the XGMAC/TSN devices, enabling an <strong>ethX</strong> ethernet link. This link connects with an ethernet switch instantiated in the target script. Only the TSN0 instance is connected to this switch using the Marvell ethernet Phy instantiated at the <strong>board</strong> level.</p>
<p>Basic ethernet support in the virtual platform allows the target software to set a MAC address locally to allow communication over the network. This supports all key transport layers of a protocol, such as TCP, UDP, and ICMP. Basic ethernet allows communication over IPv4 and IP6 protocols while supporting different hardware offloading features. The virtual platform supports L2, L3, and L4 filtering and can show network statistics.</p>
<h4 id="cpu-power-on-and-boot-core-selection">CPU Power-On and Boot Core Selection<a class="headerlink" href="#cpu-power-on-and-boot-core-selection" title="Permanent link">&para;</a></h4>
<p>The virtual platform supports setting the CPU power-on settings and the CPU boot core selection. This configuration is defined at the target script level (<strong>agilex5e-universal.simics</strong>) for this virtual platform. Based on the configuration, the virtual platform exposes only the appropriate number of cores available to the target software. When multiple CPUs are enabled, the virtual platform is configured to support symmetric multiprocessing (SMP).</p>
<h4 id="reset-flow">Reset Flow<a class="headerlink" href="#reset-flow" title="Permanent link">&para;</a></h4>
<p>The virtual platform is designed to support all key reset flows described in the Agilex™ 5 E-Series Technical Reference Manual. Reset flows initiated by the CPU are simulated through the same mechanism in which the CPU writes to the appropriate addresses (reset manager device). Resets triggered by the external hardware signaling are simulated with Simics' commands.</p>
<table>
<thead>
<tr>
<th align="left">Reset Type</th>
<th align="left">Recipe</th>
<th align="left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Power-on reset</td>
<td align="left">Not supported</td>
<td align="left">The power-on reset is not supported as its effect is equivalent to restarting the simulation in a virtual platform simulation. However, if this is required for some exceptional use cases, you can trigger the cold reset instead, as this resets most domains.</td>
</tr>
<tr>
<td align="left">HPS cold reset</td>
<td align="left"><strong>system.board.hps-cold-reset</strong></td>
<td align="left">Simulates toggling the <strong>HPS_COLD_nRESET</strong> pin using the command registered in the board component.</td>
</tr>
<tr>
<td align="left">HPS warm reset</td>
<td align="left"><strong>system.board.fpga.soc_inst.hps_subsys.agilex_hps.hps-warm-reset</strong></td>
<td align="left">Simulates a warm reset of the HPS without triggering any other event. This type of reset is not enabled through external means in hardware. The command is registered in the HPS component.</td>
</tr>
<tr>
<td align="left">Watchdog reset</td>
<td align="left">Software-based</td>
<td align="left">The watchdog timer peripheral in the HPS can be configured and enabled through software. When the watchdog expires, the HPS resets (only the trigger of warm reset is supported).</td>
</tr>
</tbody>
</table>
<h4 id="gpio-loopback-connection">GPIO Loopback Connection<a class="headerlink" href="#gpio-loopback-connection" title="Permanent link">&para;</a></h4>
<p>The virtual platform supports the feature that allows creating a loopback connection in certain pins in GPIO0 and GPIO1 ports. This is implemented at the <strong>board</strong> component level. The loopback implementation directly connects GPIO <strong>in</strong> and <strong>out</strong> pins of the GPIO ports in both directions to reflect the same state on those pins. In each GPIO port, the pair of pins that are connected are shown in the following table:</p>
<table>
<thead>
<tr>
<th align="left">Pin Source</th>
<th align="left">Pin Destination</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">6</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left">19</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left">21</td>
</tr>
</tbody>
</table>
<p>The Simics command to activate the GPIO loop-back connection is <code>system.board.create-gpio-loopback</code>.</p>
<p><strong>Note:</strong> The loopback connection is activated by default from the target script.</p>
<h4 id="usb-disks-hot-plug-support">USB Disks Hot-Plug Support<a class="headerlink" href="#usb-disks-hot-plug-support" title="Permanent link">&para;</a></h4>
<p>The virtual platform instantiates three USB disks that support hot-plugging by using Simics CLI commands to emulate plugging and unplugging the USB disks.</p>
<p>The current connection of the USB disks in this virtual platform is indicated in the following table:</p>
<table>
<thead>
<tr>
<th align="left">Disk</th>
<th align="left">Type</th>
<th align="left">Slot</th>
<th align="left">USB Controller</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">usb3_disk</td>
<td align="left">SuperSpeed (SS)</td>
<td align="left">usb3</td>
<td align="left">USB 3.1 Gen 1</td>
</tr>
<tr>
<td align="left">usb3_hs_disk</td>
<td align="left">High Speed (HS)</td>
<td align="left">usb2</td>
<td align="left">USB 3.1 Gen 1</td>
</tr>
<tr>
<td align="left">usbotg_disk</td>
<td align="left">High Speed (HS)</td>
<td align="left">otg</td>
<td align="left">USB 2.0 OTG</td>
</tr>
</tbody>
</table>
<h4 id="fpga-fabric-example-design">FPGA Fabric Example Design<a class="headerlink" href="#fpga-fabric-example-design" title="Permanent link">&para;</a></h4>
<p>The FPGA Fabric example design includes one instance of a On-Chip memory design exist in the FGPA fabric model. This is located directly under the qsys_top component. This On-Chip memory instance has a size of 1 MB and is connected to the HPS2FPGA bridge. This On-Chip memory model supports reading and writing to any memory location. You can access the memory designs using direct memory access to the memory locations in which these are mapped under the HPS2FPGA bridge memory space or by accessing the memories example design as a memory space or by accessing the memories example design as a memory space.</p>
<p>The mapping of the memory instance is defined as follows:</p>
<table>
<thead>
<tr>
<th align="left">Example Design Name</th>
<th align="left">Bridge</th>
<th align="left">Size</th>
<th align="left">Start address</th>
<th align="left">End Address</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">example_design</td>
<td align="left">hps2fpga</td>
<td align="left">1 MB</td>
<td align="left">0x0040000000</td>
<td align="left">0x00400FFFFF</td>
</tr>
</tbody>
</table>
<p>The memory instance in the FPGA fabric example design receives a parameter named <strong>base_addr</strong>. The description of this parameter is described as follows:</p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
<th align="left">Range</th>
<th align="left">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">base_addr</td>
<td align="left">An offset value that indicates the mapping of the instance taking as reference the <strong>Start Address</strong> value defined in the previous table.</td>
<td align="left">Integer</td>
<td align="left">0x00000000</td>
</tr>
</tbody>
</table>
<p>The FPGA fabric example design also includes a Peripheral subsystem which is integrated by 3 I/O IP components, each one to access or allow to control a set of LEDs, a Dip switch and a push button. The peripheral subsystem is mapped into the lwhps2pga bridge starting at a base address of 0x20000000. These components includes some internal registers that allow to control the state of the output (for LED component) and also to read state of the input of push button and dip-switch components. The mapping of these components and their registers are shown next:</p>
<table>
<thead>
<tr>
<th align="left">Component</th>
<th align="left">Mapping Address</th>
<th align="left">Range</th>
<th align="left">Register Information</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">button_pio</td>
<td align="left">0x00010060</td>
<td align="left">0x10</td>
<td align="left">[0x0] - DATA[0:0]: Read state of the button. Read Only. [0x8] - INTERRUPTMASK[0:0]- Enable('1’)/Disable('0’) the interrupt trigger. When dsiable, the interrupt is cleared. Read/Write</td>
</tr>
<tr>
<td align="left">dipsw_pio</td>
<td align="left">0x00010070</td>
<td align="left">0x10</td>
<td align="left">[0x0] - DATA[0:0]: Read state of the button. Read Only. [0x8] - INTERRUPTMASK[0:0]- Enable('1’)/Disable('0’) the interrupt trigger. When dsiable, the interrupt is cleared. Read/Write</td>
</tr>
<tr>
<td align="left">led_pio</td>
<td align="left">0x00010080</td>
<td align="left">0x10</td>
<td align="left">[0x0] - DATA[31:0]: Set and read the state of the LEDs. Read/Write</td>
</tr>
</tbody>
</table>
<p>The DIP switch and push button component can trigger an interrupt to the HPS on the assertion of the corresponding input signal.</p>
<table>
<thead>
<tr>
<th align="left">Component</th>
<th align="left">Interrupt</th>
<th align="left">HPS Interrupt Connection</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">button_pio</td>
<td align="left">periph_button_irq</td>
<td align="left">f2s_fpga_irq[0] – SIP 49</td>
</tr>
<tr>
<td align="left">dipsw_pio</td>
<td align="left">periph_dipsw_irq</td>
<td align="left">f2s_fpga_irq[1] – SIP 50</td>
</tr>
</tbody>
</table>
<p><a class="glightbox" href="../images/exampleDesignFpgaFabric_24p1.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/exampleDesignFpgaFabric_24p1.jpg" /></a></p>
<h4 id="fpga-to-hps-bridges">FPGA-to-HPS Bridges<a class="headerlink" href="#fpga-to-hps-bridges" title="Permanent link">&para;</a></h4>
<p>The FPGA-To-HPS bridges provide a way in which the FPGA fabric IPs can interact with the HPS subsystem and the SDRAM. The bridge implementation includes two new memory spaces in the FPGA logic model that are used to send read and write transactions to the HPS or SDRAM component from the FPGA logic passing through the FPGA-to-HPS bridges.</p>
<ul>
<li>FPGA to HPS bridge (FPGA2HPS): Connects the FPGA2HPS memory space with the HPS component.</li>
<li>FPGA to SDRAM bridge (FPGA2SDRAM): Connects the F2SDRAM memory space with the HPS component.</li>
</ul>
<p>You can send read and write transactions through each one of the bridges from the Intel Simics CLI.</p>
<h3 id="configurable-parameters-in-the-intel-agilextm-5-e-series-universal-virtual-platform">Configurable Parameters in the Intel Agilex™ 5 E-Series Universal Virtual Platform<a class="headerlink" href="#configurable-parameters-in-the-intel-agilextm-5-e-series-universal-virtual-platform" title="Permanent link">&para;</a></h3>
<p>The parameters that you can configure are shown in the following table:</p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
<th align="left">Range</th>
<th align="left">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>sd_image_filename</strong></td>
<td align="left">Name of the SD image to load into the SD memory model of the board component. Supported formats are <code>.img</code> and <code>.wic</code>.</td>
<td align="left">Filename string</td>
<td align="left">""</td>
</tr>
<tr>
<td align="left"><strong>fsbl_image_filename</strong></td>
<td align="left">First-stage boot loader file. The supported format is <code>.bin</code>.</td>
<td align="left">Filename string</td>
<td align="left">""</td>
</tr>
<tr>
<td align="left"><strong>hps_boot_core</strong></td>
<td align="left">The CPU to use as the boot core.</td>
<td align="left">Integer [0,2]</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left"><strong>hps_core0_1_power_on</strong></td>
<td align="left">The power-on states of CPU 0/1.</td>
<td align="left">Boolean</td>
<td align="left">True</td>
</tr>
<tr>
<td align="left"><strong>hps_core2_power_on</strong></td>
<td align="left">The power-on states of CPU 2.</td>
<td align="left">Boolean</td>
<td align="left">True</td>
</tr>
<tr>
<td align="left"><strong>hps_core3_power_on</strong></td>
<td align="left">The power-on states of CPU 3.</td>
<td align="left">Boolean</td>
<td align="left">True</td>
</tr>
<tr>
<td align="left"><strong>create_hps_serial0_console</strong></td>
<td align="left">Choose whether to create or not a console component and connect it to the <code>serial0</code> peripheral of the HPS IP.</td>
<td align="left">Boolean</td>
<td align="left">True</td>
</tr>
<tr>
<td align="left"><strong>create_hps_eth0_network</strong></td>
<td align="left">Choose whether to create or not a basic ethernet network and connect the <code>ethX</code> peripheral of the HPS IP to this.</td>
<td align="left">Boolean</td>
<td align="left">True</td>
</tr>
<tr>
<td align="left"><strong>create_hps_sd_card</strong></td>
<td align="left">Create the SD card in the board component and connect it to the SD/eMMC controller. You can set either the create_hps_sd_card or create_hps_mmc parameter to true at a time.</td>
<td align="left">Boolean</td>
<td align="left">True</td>
</tr>
<tr>
<td align="left"><strong>create_hps_mmc</strong></td>
<td align="left">Create the eMMC card in the board component and connect it to the SD/eMMC controller. You can set either the create_hps_sd_card or create_hps_mmc parameter to true at a time.</td>
<td align="left">Boolean</td>
<td align="left">False</td>
</tr>
<tr>
<td align="left"><strong>nand_data_image_filename</strong></td>
<td align="left">Name of the NAND image to load into the NAND memory model of the board component. The supported format is raw binary (.bin or .craff).</td>
<td align="left">Filename string</td>
<td align="left">""</td>
</tr>
<tr>
<td align="left"><strong>nand_spare_image_filename</strong></td>
<td align="left">Name of the NAND spare image to load into the NAND memory model of the board component. The supported format is raw binary (.bin or .craff).</td>
<td align="left">Filename string</td>
<td align="left">""</td>
</tr>
<tr>
<td align="left"><strong>qspi_image_filename</strong></td>
<td align="left">Name of the QSPI image to load into the QSPI memory model of the board component. The supported format is raw binary (.bin or .craff).</td>
<td align="left">Filename string</td>
<td align="left">""</td>
</tr>
<tr>
<td align="left"><strong>usb3_image_filename</strong></td>
<td align="left">Name of the USB disk image corresponding to the SuperSpeed disk in the board component connected to the USB 3.1 controller.</td>
<td align="left">Filename string</td>
<td align="left">""</td>
</tr>
<tr>
<td align="left"><strong>usb3_hs_image_filename</strong></td>
<td align="left">Name of the USB disk image corresponding to the high-speed disk in the board component connected to the USB 3.1 controller.</td>
<td align="left">Filename string</td>
<td align="left">""</td>
</tr>
<tr>
<td align="left"><strong>usb_otg_image_filename</strong></td>
<td align="left">Name of the USB disk image corresponding to the high-speed disk in the board component connected to the USB 2.0 OTG controller.</td>
<td align="left">Filename string</td>
<td align="left">""</td>
</tr>
<tr>
<td align="left"><strong>hps_cpu_freq_mhz</strong></td>
<td align="left">ARM cores frequency in Megahertz (MHz).</td>
<td align="left">Integer [400 - 1500]</td>
<td align="left">400</td>
</tr>
</tbody>
</table>
<h3 id="use-cases-supported-by-the-agilextm-5-e-series-universal-virtual-platform">Use Cases Supported by the Agilex™ 5 E-Series Universal Virtual Platform<a class="headerlink" href="#use-cases-supported-by-the-agilextm-5-e-series-universal-virtual-platform" title="Permanent link">&para;</a></h3>
<p>The following sections explain some supported use cases using the <strong>Agilex™ 5 E-Series Universal</strong> virtual platform. The preconditions required to execute them are listed in the following section:</p>
<h4 id="simulation-setup">Simulation Setup<a class="headerlink" href="#simulation-setup" title="Permanent link">&para;</a></h4>
<p>Consider that the Intel Simics Simulator for Intel FPGAs Simulator has been installed on a Linux System and the output binaries generated from <a href="#build-instructions">Build Instructions</a> section are already available.</p>
<ol>
<li>Create a project directory under the Intel Simics Simulator installation directory (Assuming it is <strong>SimicsInstallDir</strong>):</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>$<span class="w"> </span>mkdir<span class="w"> </span>project-1
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>project-1
</code></pre></div>
<ol>
<li>Under the new project directory created, deploy the <strong>agilex5e-universal</strong> virtual platform:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>$&lt;Simics<span class="w"> </span>installation<span class="w"> </span>dir&gt;/simics/bin/simics_intelfpga_cli<span class="w"> </span>–-deploy<span class="w"> </span>agilex5e-universal
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>Simics<span class="o">(</span>R<span class="o">)</span><span class="w"> </span>Simulator<span class="w"> </span><span class="k">for</span><span class="w"> </span>Intel<span class="o">(</span>R<span class="o">)</span><span class="w"> </span>FPGA<span class="w"> </span>CLI:
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>INFO:<span class="w"> </span>Preparing<span class="w"> </span>to<span class="w"> </span>initialize<span class="w"> </span>/home/simicsUser/SimicsInstallDir/project-1<span class="w"> </span>as<span class="w"> </span>a
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>Simics<span class="w"> </span>workspace
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>Project<span class="w"> </span>created<span class="w"> </span>successfully
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="c1"># Observe that the directory has been initialized and the simics and simics-gui</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="c1"># commands appear in the project directory. Also, the target directory is</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="c1"># created. This includes the target script corresponding to the deployed</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="c1"># platform.</span>
</code></pre></div>
<ol>
<li>Build the virtual platform components:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>$<span class="w"> </span><span class="nv">make</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="o">===</span><span class="w"> </span>Environment<span class="w"> </span><span class="nv">Check</span><span class="w"> </span><span class="o">===</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="s1">&#39;/home/simicsUser/SimicsInstallDir/project-1&#39;</span><span class="w"> </span>is<span class="w"> </span>up-to-date
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>gcc<span class="w"> </span>version<span class="w"> </span><span class="nv">9</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="o">===</span><span class="w"> </span>Building<span class="w"> </span>module<span class="w"> </span>agilex5e-universal-board-comp<span class="w"> </span><span class="o">===</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>:
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="o">===</span><span class="w"> </span>Building<span class="w"> </span>module<span class="w"> </span>agilex5e-universal-fpga-comp<span class="w"> </span><span class="o">===</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>:
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="o">===</span><span class="w"> </span>Building<span class="w"> </span>module<span class="w"> </span>agilex5e-universal-system-comp<span class="w"> </span><span class="o">===</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>:
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>Copying<span class="w"> </span>agilex5_icon_84x84.png
</code></pre></div>
<ol>
<li>Copy the following binaries created in <a href="#build-instructions">Build Instructions</a> section to the Simics project directory:</li>
</ol>
<ul>
<li>gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/gsrd-console-image-agilex5.wic</li>
<li>gsrd-socfpga/agilex5_dk_a5e065bb32aes1-gsrd-images/u-boot-agilex5-socdk-gsrd-atf/u-boot-spl-dtb.bin</li>
<li>qspi-bin/flash_image_jic.rpd</li>
<li>nand-bin/nand.img</li>
</ul>
<ol>
<li>Customize the configuration of the Agilex™ 5 E-Series Universal virtual platform, according to the setup required to exercise any specific use case. Set up the <strong>fsbl_image_filename</strong> parameter with the first-stage bootloader. If the boot implies booting from an SD Card device, configure <strong>sd_image_filename</strong> and <strong>create_hps_sd_card</strong> parameters (this image should include the main bootloader and the OS and/or application images). As part of the configuration, select the core used to boot using the <strong>hps_boot_core</strong> parameter, which could be core 0 (A55) or core 2 (A76).</li>
</ol>
<p>You can configure the virtual platform either by updating the <strong>agilex5e-universal.simics**target script or creating a separate top-level target script (named based on the simulation purpose) that is expected to be run with this (example: **uboot-linux_sdcard.simics</strong> used to boot from U-Boot to Linux from an SD Card device). You become the owner of this new target script, in which, you can set the required parameters and call the original virtual platform target script (<strong>targets/agilex5e-universal/agilex5e-universal.simics</strong> path). An example of the setup required to run a simulation that exercises the boot flow going from U-Boot to Linux, booting from an SD Card is shown in the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1">#uboot-linux_sdcard.simics</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="nv">$sd_image_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gsrd-console-image-agilex5.wic&quot;</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="nv">$fsbl_image_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;u-boot-spl-dtb.bin&quot;</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="nv">$hps_boot_core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="nv">$create_hps_sd_card</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>TRUE
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>run-command-file<span class="w"> </span><span class="s2">&quot;targets/agilex5e-universal/agilex5e-universal.simics&quot;</span>
</code></pre></div>
<p><strong>Note:</strong> The <strong>uboot-linux_sdcard.simics</strong> file must be created under the Intel Simics project directory.</p>
<p><strong>Tip:</strong> Any specific configuration needed for a use case is indicated under the <strong>Setup</strong> section of that use case.</p>
<h4 id="use-case-exercise-sdcard-boot-flow-from-fsbl-to-linux">Use Case: Exercise SDCard Boot Flow from FSBL to Linux<a class="headerlink" href="#use-case-exercise-sdcard-boot-flow-from-fsbl-to-linux" title="Permanent link">&para;</a></h4>
<p>This use case consists of booting from an SDCard device going from U-Boot to Linux prompt passing through <strong>U-Boot SPL → ATF → U-Boot → Linux</strong>.</p>
<h5>Setup</h5>

<p>Complete the procedure described in the <a href="#simulation-setup">Simulation Setup</a> section.</p>
<h5>Procedure</h5>

<p>To exercise this use case, follow the below steps once the Simulation setup is complete:</p>
<ol>
<li>From the project directory, launch the simulation using the <strong>uboot-linux_sdcard.simics</strong> target script. This script launches the simulator and the current terminal becomes the Simics CLI:</li>
</ol>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>$<span class="w"> </span>./simics<span class="w"> </span>uboot-linux_sdcard.simics<span class="w"> </span>
</code></pre></div>
2. From the Simics CLI, start running the simulation with the <strong>run</strong> command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>simics&gt;<span class="w">  </span>run
</code></pre></div>
<ol>
<li>Wait to get to the Linux prompt in the target serial console. 4. Login into the Linux prompt using the <strong>root</strong> user without a password.</li>
</ol>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># Target Serial console </span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>U-Boot<span class="w"> </span>SPL<span class="w"> </span><span class="m">2024</span>.01<span class="w"> </span><span class="o">(</span>Jun<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">2024</span><span class="w"> </span>-<span class="w"> </span><span class="m">09</span>:28:56<span class="w"> </span>+0000<span class="o">)</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>Reset<span class="w"> </span>state:<span class="w"> </span>Cold
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>MPU<span class="w">           </span><span class="m">875000</span><span class="w"> </span>kHz
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>L4<span class="w"> </span>Main<span class="w">       </span><span class="m">400000</span><span class="w"> </span>kHz
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>L4<span class="w"> </span>sys<span class="w"> </span>free<span class="w">   </span><span class="m">100000</span><span class="w"> </span>kHz
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>L4<span class="w"> </span>MP<span class="w">         </span><span class="m">200000</span><span class="w"> </span>kHz
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>L4<span class="w"> </span>SP<span class="w">         </span><span class="m">100000</span><span class="w"> </span>kHz
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>SDMMC<span class="w">          </span><span class="m">50000</span><span class="w"> </span>kHz
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>init_mem_cal:<span class="w"> </span>Initial<span class="w"> </span>DDR<span class="w"> </span>calibration<span class="w"> </span>IO96B_0<span class="w"> </span>succeed
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>io96b_mb_init:<span class="w"> </span>num_instance<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>io96b_mb_init:<span class="w"> </span>get<span class="w"> </span>memory<span class="w"> </span>interface<span class="w"> </span>IO96B<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>:
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>DDR:<span class="w"> </span>size<span class="w"> </span>check<span class="w"> </span>success
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>DDR:<span class="w"> </span>firewall<span class="w"> </span>init<span class="w"> </span>success
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>DDR:<span class="w"> </span>init<span class="w"> </span>success
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>QSPI:<span class="w"> </span>Reference<span class="w"> </span>clock<span class="w"> </span>at<span class="w"> </span><span class="m">400000</span><span class="w"> </span>kHz
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>Trying<span class="w"> </span>to<span class="w"> </span>boot<span class="w"> </span>from<span class="w"> </span>MMC1
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="c1">## Checking hash(es) for config board-0 ... OK</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="c1">## Checking hash(es) for Image atf ... crc32+ OK</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="c1">## Checking hash(es) for Image uboot ... crc32+ OK</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="c1">## Checking hash(es) for Image fdt-0 ... crc32+ OK</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>WARNING:<span class="w"> </span>Data<span class="w"> </span>cache<span class="w"> </span>not<span class="w"> </span>enabled
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>Boot<span class="w"> </span><span class="nv">Core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>CPU<span class="w"> </span><span class="nv">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">81000000</span>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>v2.10.1<span class="w">  </span><span class="o">(</span>release<span class="o">)</span>:rel_socfpga_v2.10.1_24.05.02_pr-4-g483735669
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>Built<span class="w"> </span>:<span class="w"> </span><span class="m">08</span>:56:04,<span class="w"> </span>Jun<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">2024</span>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>U-Boot<span class="w"> </span><span class="m">2024</span>.01<span class="w"> </span><span class="o">(</span>Jun<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">2024</span><span class="w"> </span>-<span class="w"> </span><span class="m">09</span>:28:56<span class="w"> </span>+0000<span class="o">)</span>socfpga_agilex5
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>CPU:<span class="w">   </span>Intel<span class="w"> </span>FPGA<span class="w"> </span>SoCFPGA<span class="w"> </span>Platform<span class="w"> </span><span class="o">(</span>ARMv8<span class="w"> </span>64bit<span class="w"> </span>Cortex-A55/A76<span class="o">)</span>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>Model:<span class="w"> </span>SoCFPGA<span class="w"> </span>Agilex5<span class="w"> </span>SoCDK
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>DRAM:<span class="w">  </span><span class="m">2</span><span class="w"> </span>GiB<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span><span class="m">8</span><span class="w"> </span>GiB<span class="o">)</span>
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a>Core:<span class="w">  </span><span class="m">51</span><span class="w"> </span>devices,<span class="w"> </span><span class="m">26</span><span class="w"> </span>uclasses,<span class="w"> </span>devicetree:<span class="w"> </span>separate
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00200
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00300
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00400
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00500
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00600
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a>NAND:<span class="w">  </span><span class="m">4096</span><span class="w"> </span>MiB
<a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a>MMC:<span class="w">   </span>mmc0@10808000:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a>Loading<span class="w"> </span>Environment<span class="w"> </span>from<span class="w"> </span>FAT...<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="s2">&quot;uboot.env&quot;</span><span class="w"> </span>from<span class="w"> </span>mmc0:1...
<a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a>Loading<span class="w"> </span>Environment<span class="w"> </span>from<span class="w"> </span>UBI...<span class="w"> </span>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">64</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span><span class="m">256</span><span class="w"> </span>MiB
<a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a>:
<a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a>Scanning<span class="w"> </span>mmc<span class="w"> </span><span class="m">0</span>:1...
<a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a>Found<span class="w"> </span>U-Boot<span class="w"> </span>script<span class="w"> </span>/boot.scr.uimg
<a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a><span class="m">2411</span><span class="w"> </span>bytes<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">12</span><span class="w"> </span>ms<span class="w"> </span><span class="o">(</span><span class="m">195</span>.3<span class="w"> </span>KiB/s<span class="o">)</span>
<a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a><span class="c1">## Executing script at 81000000</span>
<a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a>crc32+<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>boot<span class="w"> </span>Linux<span class="w"> </span>from<span class="w"> </span>device<span class="w"> </span>mmc0
<a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a>Found<span class="w"> </span>kernel<span class="w"> </span><span class="k">in</span><span class="w"> </span>mmc0
<a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a><span class="m">17685575</span><span class="w"> </span>bytes<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">33</span><span class="w"> </span>ms<span class="w"> </span><span class="o">(</span><span class="m">511</span>.1<span class="w"> </span>MiB/s<span class="o">)</span>
<a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a><span class="c1">## Loading kernel from FIT Image at 82000000 ...</span>
<a id="__codelineno-26-54" name="__codelineno-26-54" href="#__codelineno-26-54"></a>:
<a id="__codelineno-26-55" name="__codelineno-26-55" href="#__codelineno-26-55"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">64</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span><span class="m">256</span><span class="w"> </span>MiB
<a id="__codelineno-26-56" name="__codelineno-26-56" href="#__codelineno-26-56"></a>Enabling<span class="w"> </span>QSPI<span class="w"> </span>at<span class="w"> </span>Linux<span class="w"> </span>DTB...
<a id="__codelineno-26-57" name="__codelineno-26-57" href="#__codelineno-26-57"></a>Working<span class="w"> </span>FDT<span class="w"> </span><span class="nb">set</span><span class="w"> </span>to<span class="w"> </span>ffad6000
<a id="__codelineno-26-58" name="__codelineno-26-58" href="#__codelineno-26-58"></a>QSPI<span class="w"> </span>clock<span class="w"> </span>frequency<span class="w"> </span>updated
<a id="__codelineno-26-59" name="__codelineno-26-59" href="#__codelineno-26-59"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-26-60" name="__codelineno-26-60" href="#__codelineno-26-60"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-26-61" name="__codelineno-26-61" href="#__codelineno-26-61"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-26-62" name="__codelineno-26-62" href="#__codelineno-26-62"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-26-63" name="__codelineno-26-63" href="#__codelineno-26-63"></a>
<a id="__codelineno-26-64" name="__codelineno-26-64" href="#__codelineno-26-64"></a>Starting<span class="w"> </span>kernel<span class="w"> </span>...
<a id="__codelineno-26-65" name="__codelineno-26-65" href="#__codelineno-26-65"></a>
<a id="__codelineno-26-66" name="__codelineno-26-66" href="#__codelineno-26-66"></a>Deasserting<span class="w"> </span>all<span class="w"> </span>peripheral<span class="w"> </span>resets
<a id="__codelineno-26-67" name="__codelineno-26-67" href="#__codelineno-26-67"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Booting<span class="w"> </span>Linux<span class="w"> </span>on<span class="w"> </span>physical<span class="w"> </span>CPU<span class="w"> </span>0x0000000000<span class="w"> </span><span class="o">[</span>0x412fd050<span class="o">]</span>
<a id="__codelineno-26-68" name="__codelineno-26-68" href="#__codelineno-26-68"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Linux<span class="w"> </span>version<span class="w"> </span><span class="m">6</span>.6.22-altera-g6ad76f9ca568<span class="w"> </span><span class="o">(</span>oe-user@oe-host<span class="o">)</span><span class="w"> </span><span class="o">(</span>aarch64-poky-linux-gcc<span class="w"> </span><span class="o">(</span>GCC<span class="o">)</span><span class="w"> </span><span class="m">13</span>.3.0,<span class="w"> </span>GNU<span class="w"> </span>ld<span class="w"> </span><span class="o">(</span>GNU<span class="w"> </span>Binutils<span class="o">)</span><span class="w"> </span><span class="m">2</span>.42.0.20240620<span class="o">)</span><span class="w"> </span><span class="c1">#1 SMP PREEMPT Fri Jun 21 09:02:27 UTC 2024</span>
<a id="__codelineno-26-69" name="__codelineno-26-69" href="#__codelineno-26-69"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>KASLR<span class="w"> </span>disabled<span class="w"> </span>due<span class="w"> </span>to<span class="w"> </span>lack<span class="w"> </span>of<span class="w"> </span>seed
<a id="__codelineno-26-70" name="__codelineno-26-70" href="#__codelineno-26-70"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Machine<span class="w"> </span>model:<span class="w"> </span>SoCFPGA<span class="w"> </span>Agilex5<span class="w"> </span>SoCDK
<a id="__codelineno-26-71" name="__codelineno-26-71" href="#__codelineno-26-71"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>efi:<span class="w"> </span>UEFI<span class="w"> </span>not<span class="w"> </span>found.
<a id="__codelineno-26-72" name="__codelineno-26-72" href="#__codelineno-26-72"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Reserved<span class="w"> </span>memory:<span class="w"> </span>created<span class="w"> </span>DMA<span class="w"> </span>memory<span class="w"> </span>pool<span class="w"> </span>at<span class="w"> </span>0x0000000080000000,<span class="w"> </span>size<span class="w"> </span><span class="m">32</span><span class="w"> </span>MiB
<a id="__codelineno-26-73" name="__codelineno-26-73" href="#__codelineno-26-73"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>OF:<span class="w"> </span>reserved<span class="w"> </span>mem:<span class="w"> </span>initialized<span class="w"> </span>node<span class="w"> </span>svcbuffer@0,<span class="w"> </span>compatible<span class="w"> </span>id<span class="w"> </span>shared-dma-pool
<a id="__codelineno-26-74" name="__codelineno-26-74" href="#__codelineno-26-74"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>OF:<span class="w"> </span>reserved<span class="w"> </span>mem:<span class="w"> </span>0x0000000080000000..0x0000000081ffffff<span class="w"> </span><span class="o">(</span><span class="m">32768</span><span class="w"> </span>KiB<span class="o">)</span><span class="w"> </span>nomap<span class="w"> </span>non-reusable<span class="w"> </span>svcbuffer@0
<a id="__codelineno-26-75" name="__codelineno-26-75" href="#__codelineno-26-75"></a>:
<a id="__codelineno-26-76" name="__codelineno-26-76" href="#__codelineno-26-76"></a>Poky<span class="w"> </span><span class="o">(</span>Yocto<span class="w"> </span>Project<span class="w"> </span>Reference<span class="w"> </span>Distro<span class="o">)</span><span class="w"> </span><span class="m">5</span>.0.2<span class="w"> </span>agilex5dka5e065bb32aes1<span class="w"> </span>ttyS0
<a id="__codelineno-26-77" name="__codelineno-26-77" href="#__codelineno-26-77"></a>
<a id="__codelineno-26-78" name="__codelineno-26-78" href="#__codelineno-26-78"></a><span class="o">[</span><span class="w">   </span><span class="m">37</span>.547237<span class="o">]</span><span class="w"> </span>kauditd_printk_skb:<span class="w"> </span><span class="m">15</span><span class="w"> </span>callbacks<span class="w"> </span>suppressed
<a id="__codelineno-26-79" name="__codelineno-26-79" href="#__codelineno-26-79"></a><span class="o">[</span><span class="w">   </span><span class="m">37</span>.547244<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054800</span>.368:33<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">27</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>UNLOAD
<a id="__codelineno-26-80" name="__codelineno-26-80" href="#__codelineno-26-80"></a><span class="o">[</span><span class="w">   </span><span class="m">37</span>.548523<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054800</span>.368:34<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">26</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>UNLOAD
<a id="__codelineno-26-81" name="__codelineno-26-81" href="#__codelineno-26-81"></a><span class="o">[</span><span class="w">   </span><span class="m">37</span>.549259<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054800</span>.368:35<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">25</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>UNLOAD
<a id="__codelineno-26-82" name="__codelineno-26-82" href="#__codelineno-26-82"></a>agilex5dka5e065bb32aes1<span class="w"> </span>login:<span class="w"> </span>root
<a id="__codelineno-26-83" name="__codelineno-26-83" href="#__codelineno-26-83"></a>
<a id="__codelineno-26-84" name="__codelineno-26-84" href="#__codelineno-26-84"></a>WARNING:<span class="w"> </span>Poky<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>reference<span class="w"> </span>Yocto<span class="w"> </span>Project<span class="w"> </span>distribution<span class="w"> </span>that<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span><span class="k">for</span>
<a id="__codelineno-26-85" name="__codelineno-26-85" href="#__codelineno-26-85"></a>testing<span class="w"> </span>and<span class="w"> </span>development<span class="w"> </span>purposes<span class="w"> </span>only.<span class="w"> </span>It<span class="w"> </span>is<span class="w"> </span>recommended<span class="w"> </span>that<span class="w"> </span>you<span class="w"> </span>create<span class="w"> </span>your
<a id="__codelineno-26-86" name="__codelineno-26-86" href="#__codelineno-26-86"></a>own<span class="w"> </span>distribution<span class="w"> </span><span class="k">for</span><span class="w"> </span>production<span class="w"> </span>use.
<a id="__codelineno-26-87" name="__codelineno-26-87" href="#__codelineno-26-87"></a>
<a id="__codelineno-26-88" name="__codelineno-26-88" href="#__codelineno-26-88"></a>root@agilex5dka5e065bb32aes1:~#<span class="w"> </span>
</code></pre></div>
This finishes the main scenario of this use case, but there are some extensions that are described next.</p>
<p><strong>Note</strong>: You can speed-up the boot process by skipping the U-Boot autoboot countdown by pressing any key and then typing the <strong>boot</strong> command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>U-Boot<span class="w"> </span><span class="m">2024</span>.01<span class="w"> </span><span class="o">(</span>Jun<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">2024</span><span class="w"> </span>-<span class="w"> </span><span class="m">09</span>:28:56<span class="w"> </span>+0000<span class="o">)</span>socfpga_agilex5
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>CPU:<span class="w">   </span>Intel<span class="w"> </span>FPGA<span class="w"> </span>SoCFPGA<span class="w"> </span>Platform<span class="w"> </span><span class="o">(</span>ARMv8<span class="w"> </span>64bit<span class="w"> </span>Cortex-A55/A76<span class="o">)</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>Model:<span class="w"> </span>SoCFPGA<span class="w"> </span>Agilex5<span class="w"> </span>SoCDK
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>:
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>Net:<span class="w">   </span>No<span class="w"> </span>ethernet<span class="w"> </span>found.
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>Hit<span class="w"> </span>any<span class="w"> </span>key<span class="w"> </span>to<span class="w"> </span>stop<span class="w"> </span>autoboot:<span class="w">  </span><span class="m">0</span><span class="w"> </span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1"># boot</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>switch<span class="w"> </span>to<span class="w"> </span>partitions<span class="w"> </span><span class="c1">#0, OK</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>mmc0<span class="w"> </span>is<span class="w"> </span>current<span class="w"> </span>device
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>Scanning<span class="w"> </span>mmc<span class="w"> </span><span class="m">0</span>:1...
</code></pre></div>
<h4 id="use-case-exercise-hello-application">Use Case: Exercise Hello Application<a class="headerlink" href="#use-case-exercise-hello-application" title="Permanent link">&para;</a></h4>
<p>This is an extension of the <strong>Use Case: Exercise SDCard Boot Flow from FSBL to Linux</strong> and includes executing the <strong>hello</strong> application from the Linux prompt.</p>
<h5>Setup</h5>

<p>Complete the procedure described in the <a href="#simulation-setup">Simulation Setup</a> section.</p>
<h5>Procedure</h5>

<ol>
<li>
<p>Execute the parent use case to get to the Linux prompt and log in.</p>
</li>
<li>
<p>Execute the <strong>hello</strong> application located in the <strong>intelFPGA</strong> directory. After executing this application, the <strong>Hello SoC FPGA!</strong> message is displayed on the command prompt:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Target Serial console </span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>root@dhcp0:~#<span class="w">  </span>./intelFPGA/hello<span class="w"> </span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>Hello<span class="w"> </span>SoC<span class="w"> </span>FPGA!
</code></pre></div>
<h4 id="use-case-exercise-system-check-application-with-hps-led-turn-onoff-control">Use Case: Exercise System Check Application with HPS LED Turn On/Off control<a class="headerlink" href="#use-case-exercise-system-check-application-with-hps-led-turn-onoff-control" title="Permanent link">&para;</a></h4>
<p>This use case is an extension of the <strong>Use Case: Exercise SDCard Boot Flow from FSBL to Linux</strong> and includes executing the System Check Application to observe the state of the HPS LEDs. The execution of this use case works under the assumption that the LEDs are connected to the corresponding GPIOs in the virtual platform.</p>
<h5>Setup</h5>

<p>Same setup as the parent use case.</p>
<h5>Procedure</h5>

<ol>
<li>
<p>Execute the parent use case to get to the Linux prompt and log in.</p>
</li>
<li>
<p>From the target system serial console, execute the System Check application (<strong>syschk</strong>) located under the <strong>intelFPGA</strong> directory. This shows some system information, such as the target system IP address and the state of the HPS LEDs. Observe that the initial state of the three HPS LEDs is <strong>OFF</strong>.</p>
<p><strong>Note:</strong>  When using device tree targeted for OOB card, only <strong>hps_led1</strong> is available, so the System Check application only shows this led.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># Target Serial console </span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>root@dhcp0:~#<span class="w">  </span>./intelFPGA/syschk<span class="w"> </span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="c1"># Target Serial console </span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>Actual<span class="w"> </span>changes:
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">                              </span>ALTERA<span class="w"> </span>SYSTEM<span class="w"> </span>CHECK<span class="w">                              </span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>lo<span class="w">                    </span>:<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w">       </span>usb3<span class="w">                  </span>:<span class="w"> </span>xHCI<span class="w"> </span>Host<span class="w"> </span>Contro
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>eth1<span class="w">                  </span>:<span class="w"> </span><span class="m">10</span>.10.0.100<span class="w">     </span>usb1<span class="w">                  </span>:<span class="w"> </span>DWC<span class="w"> </span>OTG<span class="w"> </span>Controll
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">                                        </span>usb2<span class="w">                  </span>:<span class="w"> </span>xHCI<span class="w"> </span>Host<span class="w"> </span>Contro
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>hps_led2<span class="w">              </span>:<span class="w"> </span>OFF
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>hps_led0<span class="w">              </span>:<span class="w"> </span>OFF<span class="w">             </span>serial@10c02100<span class="w">       </span>:<span class="w"> </span>disabled
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>mmc0::<span class="w">                </span>:<span class="w"> </span>OFF<span class="w">             </span>serial@10c02000<span class="w">       </span>:<span class="w"> </span>okay
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>hps_led1<span class="w">              </span>:<span class="w"> </span>OFF
</code></pre></div>
<ol>
<li>Change the state of any of the HPS LEDs using the <strong>/sys/class/led/hps_ledX/brightness</strong> files writing either a '1' or '0' to these. For this, you need to first close the System Check application by typing <strong>Ctrl+C</strong> in the target serial console. Change the state of the LEDs to 'ON' state as indicated next and reopen the System Check application to observe the new state of the LEDs.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Target Serial console </span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>root@dhcp0:~#<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/class/leds/hps_led0/brightness<span class="w"> </span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>root@dhcp0:~#<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/class/leds/hps_led1/brightness<span class="w"> </span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>root@dhcp0:~#<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/class/leds/hps_led2/brightness<span class="w"> </span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>root@dhcp0:~#<span class="w"> </span>./intelFPGA/syschk<span class="w"> </span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="c1"># Target Serial console </span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>Actual<span class="w"> </span>changes:
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="w">                                    </span>ALTERA<span class="w"> </span>SYSTEM<span class="w"> </span>CHECK
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>lo<span class="w">                    </span>:<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w">       </span>usb3<span class="w">                  </span>:<span class="w"> </span>xHCI<span class="w"> </span>Host<span class="w"> </span>Contro
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>eth1<span class="w">                  </span>:<span class="w"> </span><span class="m">10</span>.10.0.100<span class="w">     </span>usb1<span class="w">                  </span>:<span class="w"> </span>DWC<span class="w"> </span>OTG<span class="w"> </span>Controll
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w">                                        </span>usb2<span class="w">                  </span>:<span class="w"> </span>xHCI<span class="w"> </span>Host<span class="w"> </span>Contro
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>hps_led2<span class="w">              </span>:<span class="w"> </span>ON
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>hps_led0<span class="w">              </span>:<span class="w"> </span>ON<span class="w">              </span>serial@10c02100<span class="w">       </span>:<span class="w"> </span>disabled
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>mmc0::<span class="w">                </span>:<span class="w"> </span>OFF<span class="w">             </span>serial@10c02000<span class="w">       </span>:<span class="w"> </span>okay
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>hps_led1<span class="w">              </span>:<span class="w"> </span>ON
</code></pre></div>
<ol>
<li>Close the System Check application with <strong>Ctrl+C</strong> and return the HPS LEDs to the OFF state. Reconfirm that the state of the LEDs was updated to the new state in the System Check application.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Target Serial console </span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>root@dhcp0:~#<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/class/leds/hps_led0/brightness<span class="w"> </span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>root@dhcp0:~#<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/class/leds/hps_led1/brightness<span class="w"> </span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>root@dhcp0:~#<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/class/leds/hps_led2/brightness<span class="w"> </span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>root@dhcp0:~#<span class="w"> </span>./intelFPGA/syschk<span class="w"> </span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="c1"># Target Serial console </span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>Actual<span class="w"> </span>changes:
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">                              </span>ALTERA<span class="w"> </span>SYSTEM<span class="w"> </span>CHECK<span class="w">                              </span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>lo<span class="w">                    </span>:<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w">       </span>usb3<span class="w">                  </span>:<span class="w"> </span>xHCI<span class="w"> </span>Host<span class="w"> </span>Contro
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>eth1<span class="w">                  </span>:<span class="w"> </span><span class="m">10</span>.10.0.100<span class="w">     </span>usb1<span class="w">                  </span>:<span class="w"> </span>DWC<span class="w"> </span>OTG<span class="w"> </span>Controll
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">                                        </span>usb2<span class="w">                  </span>:<span class="w"> </span>xHCI<span class="w"> </span>Host<span class="w"> </span>Contro
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>hps_led2<span class="w">              </span>:<span class="w"> </span>OFF
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>hps_led0<span class="w">              </span>:<span class="w"> </span>OFF<span class="w">             </span>serial@10c02100<span class="w">       </span>:<span class="w"> </span>disabled
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>mmc0::<span class="w">                </span>:<span class="w"> </span>OFF<span class="w">             </span>serial@10c02000<span class="w">       </span>:<span class="w"> </span>okay
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>hps_led1<span class="w">              </span>:<span class="w"> </span>OFF
</code></pre></div>
<ol>
<li>Close the System Check application with <strong>Ctrl+C</strong>.</li>
</ol>
<h4 id="use-case-access-the-web-server-application-from-host-pc">Use Case: Access the Web Server Application from Host PC<a class="headerlink" href="#use-case-access-the-web-server-application-from-host-pc" title="Permanent link">&para;</a></h4>
<p>This use case is an extension of the <strong>Use Case: Exercise SDCard Boot Flow from FSBL to Linux</strong> and includes accessing from the host PC a web page that is being hosted by the target system, which runs a web server application. This application is launched automatically as part of the Linux boot process.</p>
<h5>Setup</h5>

<p>Using the <strong>uboot-linux_sdcard.simics</strong> Simics script, create an incoming port forwarding shown in the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>connect-real-network-port-in<span class="w"> </span>ethernet-link<span class="w"> </span><span class="o">=</span><span class="w"> </span>ethernet_switch0<span class="w"> </span>target-ip<span class="o">=</span><span class="m">10</span>.10.0.100<span class="w"> </span>target-port<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80</span><span class="w"> </span>host-port<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4080</span><span class="w"> </span>-tcp<span class="w"> </span>
</code></pre></div>
<p>The port forwarding created allows you to access the webpage from the host PC. In the configuration, use the <strong>connect-real-network-port-in</strong> command, port 4080 in the host PC, and the target port in the target system is 80 (HTTP port). You also assign as the target IP, the IP that corresponds to the target system, which is 10.10.0.100. Also, indicate that this port forwarding is related to the TCP protocol. YOu can check the new port forwarding setup using the <strong>list-port-forwarding-setup</strong> command (this setup also could be done from the Simics CLI but in this case, the simulation should be stopped to perform the network configuration).</p>
<h5>Procedure</h5>

<ol>
<li>
<p>Execute the parent use case to get to the Linux prompt and log in.</p>
</li>
<li>
<p>From the host PC, open a web browser and access the webpage running in the target system using the address: http://localhost:4080 . Note that the host machine is referred to as <strong>localhost</strong> and the port is 4080, which is the one visible from the host PC. </p>
<p><a class="glightbox" href="../images/webServerExample.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/webServerExample.jpg" /></a></p>
</li>
</ol>
<p><strong>Note:</strong> The IP address of the host PC could be used as well instead of <strong>localhost</strong>.</p>
<p><strong>Note:</strong> The webpage displays instructions to connect to the target system using SSH. These instructions are valid if you run these binaries in real hardware. If you want to establish the SSH connection with a simulated target system, create a second incoming port forwarding with the following setup:</p>
<p><strong>connect-real-network-port-in ethernet-link = ethernet_switch0 target-ip=10.10.0.100 target-port = 22 host-port = 4022 -tcp</strong></p>
<p>Then, connect to the target system using <strong>ssh -p 4022 root@localhost</strong> from the host PC or <strong>ssh -p 4022 root@<host PC IP address></strong> from any other PC in the same network.</p>
<p>A variation of this use case consists of accessing the web page from another PC under the same network that the host PC (both PCs in a real network). For this, use the IP address of the host PC instead of <strong>localhost</strong> and continue using the same port: <strong>http://&lt;<em>host PC address</em>&gt;:4080</strong>.</p>
<p><strong>Note:</strong> In the Linux Ubuntu system, you can get the IP address using the <strong>ifconfig</strong> command from a terminal. Also, ensure that the firewall in this PC is not blocking port 80.</p>
<h4 id="use-case-access-on-chip-ram-in-fpga-example-design-from-linux-prompt">Use Case: Access ON-Chip RAM in FPGA Example Design from Linux Prompt<a class="headerlink" href="#use-case-access-on-chip-ram-in-fpga-example-design-from-linux-prompt" title="Permanent link">&para;</a></h4>
<p>This use case is an extension of the <strong>Use Case: Exercise SDCard Boot Flow from FSBL to Linux</strong> and includes accessing from Linux the FPGA fabric example design for read and write operations. For this, the <strong>devmem2</strong> Linux application is used. Also, a Simics CLI script is used to write some initial content to the memories in the example design.</p>
<h5>Setup</h5>

<p>Start with the setup as the parent use case. From the Simics CLI or using the <strong>uboot-linux_sdcard.simics</strong> Simics script, add the script branch that adds some content to the memories in the example design. The script branch writes 256 32-bit words in each memory.</p>
<p><a class="glightbox" href="../images/scriptLoadExampleDesignFpgaFabric_24.1.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/scriptLoadExampleDesignFpgaFabric_24.1.jpg" /></a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1"># uboot-linux_sdcard.simics</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>:
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>script-branch<span class="o">{</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">  </span><span class="c1"># Wait until we see any message in the Serial Console to be sure the model has been fully initialized</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">  </span>bp.console_string.wait-for<span class="w"> </span>system.board.fpga.soc_inst.hps_subsys.agilex_hps.console0.con<span class="w"> </span><span class="s2">&quot;U-Boot SPL&quot;</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">  </span><span class="nv">$idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="o">(</span><span class="nv">$idx</span><span class="w"> </span>&lt;<span class="w"> </span><span class="m">256</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w">    </span><span class="nv">$addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span>*<span class="nv">$idx</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w">    </span><span class="nv">$valueMem1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0xcafe0000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">$idx</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Set Values &quot;</span><span class="w"> </span>+<span class="w"> </span><span class="o">(</span>hex<span class="o">(</span><span class="nv">$valueMem1</span><span class="o">))</span><span class="w"> </span>+<span class="w"> </span><span class="s2">&quot; at address &quot;</span><span class="w"> </span>+<span class="w"> </span><span class="o">(</span>hex<span class="o">(</span><span class="nv">$addr</span><span class="o">))</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w">    </span>system.board.fpga.soc_inst.example_design.design_mem.write<span class="w"> </span><span class="nv">$addr</span><span class="w"> </span><span class="nv">$valueMem1</span><span class="w">    </span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">    </span><span class="nv">$idx</span>+<span class="o">=</span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="o">}</span>
</code></pre></div>
<h5>Procedure</h5>

<ol>
<li>
<p>Execute the parent use case to get to the Linux prompt and log in.</p>
</li>
<li>
<p>Read the first and last locations written by the CLI script in the memories in the example design using the <strong>devmem2</strong> application in Linux. This command receives the physical memory that wants to be accessed (in this case, based on the offset where the HPS2FPGA bridges are mapped to):</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>dhcp0<span class="w"> </span>login:<span class="w">  </span>root<span class="w"> </span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>root@dhcp0:~#<span class="w">  </span>devmem2<span class="w"> </span>0x40000000<span class="w"> </span>w<span class="w"> </span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>/dev/mem<span class="w"> </span>opened.
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>Memory<span class="w"> </span>mapped<span class="w"> </span>at<span class="w"> </span>address<span class="w"> </span>0xffffa3940000.
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>Read<span class="w"> </span>at<span class="w"> </span>address<span class="w">  </span>0x40000000<span class="w"> </span><span class="o">(</span>0xffffa3940000<span class="o">)</span>:<span class="w"> </span>0xCAFE0000
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>root@dhcp0:~#<span class="w">  </span>devmem2<span class="w"> </span>0x400003fc<span class="w"> </span>w<span class="w"> </span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>/dev/mem<span class="w"> </span>opened.
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>Memory<span class="w"> </span>mapped<span class="w"> </span>at<span class="w"> </span>address<span class="w"> </span>0xffff91ac1000.
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>Read<span class="w"> </span>at<span class="w"> </span>address<span class="w">  </span>0x400003FC<span class="w"> </span><span class="o">(</span>0xffff91ac13fc<span class="o">)</span>:<span class="w"> </span>0xCAFE00FF
</code></pre></div>
<p>Observe that the values read matches the expected one shown in the figure above.</p>
<p><strong>Note:</strong> The addresses in parenthesis in the capture above correspond to the virtual address in which Linux maps the physical address corresponding to the location in the memory example design that is being accessed. This virtual address may be different than the one shown in the capture.</p>
<ol>
<li>Use the <code>devmem2</code> command to write into the memories in the example design and read back the data. For this, the following addresses are selected:</li>
</ol>
<table>
<thead>
<tr>
<th align="left">Bridge</th>
<th align="left">Address</th>
<th align="left">Memory Design Addr</th>
<th align="left">Index</th>
<th align="left">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">HPS2FPGA</td>
<td align="left">0x40000400</td>
<td align="left">0x400</td>
<td align="left">256</td>
<td align="left">0xcafe0200</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>root@dhcp0:~#<span class="w">  </span>devmem2<span class="w"> </span>0x40000400<span class="w"> </span>w<span class="w"> </span>0xcafe0200<span class="w"> </span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>/dev/mem<span class="w"> </span>opened.
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>Memory<span class="w"> </span>mapped<span class="w"> </span>at<span class="w"> </span>address<span class="w"> </span>0xffffbd034000.
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>Read<span class="w"> </span>at<span class="w"> </span>address<span class="w">  </span>0x40000400<span class="w"> </span><span class="o">(</span>0xffffbd034400<span class="o">)</span>:<span class="w"> </span>0x00000000
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>Write<span class="w"> </span>at<span class="w"> </span>address<span class="w"> </span>0x40000400<span class="w"> </span><span class="o">(</span>0xffffbd034400<span class="o">)</span>:<span class="w"> </span>0xCAFE0200,<span class="w"> </span>readback<span class="w"> </span>0xCAFE0200
</code></pre></div>
<ol>
<li>Read back to the previous memory location written to confirm the operation was performed successfully.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>root@dhcp0:~#  devmem2 0x40000400 w  
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>/dev/mem opened.
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>Memory mapped at address 0xffffa5ab9000.
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>Read at address  0x40000400 (0xffffa5ab9400): 0xCAFE0200
</code></pre></div>
<h4 id="use-case-excercise-peripheral-components-in-fpga-fabric-example-design">Use Case: Excercise Peripheral Components in FPGA Fabric Example Design<a class="headerlink" href="#use-case-excercise-peripheral-components-in-fpga-fabric-example-design" title="Permanent link">&para;</a></h4>
<p>This use case is an extension of the <strong>Use Case: Exercise SDCard Boot Flow from FSBL to Linux</strong> and exercising:</p>
<ul>
<li>LED I/O component to write/and read the state of the LED from Simics CLI and from U-Boot shell</li>
<li>Dip-Swich and Push-Button I/O components to change the state of the input from Simics CLI and read the state of the input from U-Boot shell. Also configure the triggering of an nterrupts from these component to the HPS.</li>
</ul>
<h5>Setup</h5>

<p>Complete the procedure described in the <a href="#simulation-setup">Simulation Setup</a> section.</p>
<h5>Procedure</h5>

<ol>
<li>Start the simulation similar to how it is done in the main use case, but in the serial console stop the U-Boot autoboot by pressing a key on the reception of the message "<strong>Hit any key to stop autoboot:</strong>".</li>
<li>Here you are going to exercise the setting of some LEDs. Read the state of the LEDs I/O pins from the U-Boot shell through memory access using the address in which the DATA register of this component is mapped (0x20010080) and turn-on the 3 LEDs associated with the 3 less significative bits in this register. Then read-back the state of these pins to confirm these has been updated. You can confirm that the state of the LED's was updated reading directly into the DATA register of the LED I/O components from the Simics CLI.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># U-Boot shell</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1"># md 0x20010080 1</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="m">20010080</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">                             </span>….
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1"># mw 0x20010080 0x7 1</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1"># md 0x20010080 1</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="m">20010080</span>:<span class="w"> </span><span class="m">00000007</span><span class="w">  </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># Simics CLI</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>running&gt;<span class="w"> </span>print-device-reg-info<span class="w"> </span>system.board.fpga.soc_inst.periph_subsys.led_pio.bank.regs.DATA<span class="w"> </span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w"> </span><span class="o">[</span>system.board.fpga.soc_inst.periph_subsys.led_pio.bank.regs.DATA<span class="o">]</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">             </span>Bits<span class="w"> </span>:<span class="w"> </span><span class="m">32</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">           </span>Offset<span class="w"> </span>:<span class="w"> </span>0x0
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">            </span>Value<span class="w"> </span>:<span class="w"> </span><span class="m">7</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>Bit<span class="w"> </span>Fields:
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">    </span>Data<span class="w"> </span>@<span class="w"> </span><span class="o">[</span><span class="m">31</span>:0<span class="o">]</span><span class="w"> </span>:<span class="w"> </span><span class="m">00000000000000000000000000000111</span>
</code></pre></div>
<ol>
<li>Next you will exercise the toggling the input pin of the dip-switch component using the Simics CLI through the <strong>signal_raise()</strong> and <strong>signal_lower()</strong> and then reading back the state of the pin using the DATA register in this component using the U-Boot shell through the corresponding memory location of this register (0x20010070).</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># Simics CLI</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>running&gt;<span class="w"> </span>@conf.system.board.fpga.soc_inst.periph_subsys.dipsw_pio.port.input_io<span class="o">[</span><span class="m">0</span><span class="o">]</span>.iface.signal.signal_raise<span class="o">()</span><span class="w"> </span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>None
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># U-Boot shell</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1"># md 0x20010070 1 </span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="m">20010070</span>:<span class="w"> </span><span class="m">00000001</span><span class="w"> </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># Simics CLI</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>running&gt;<span class="w">  </span>@conf.system.board.fpga.soc_inst.periph_subsys.dipsw_pio.port.input_io<span class="o">[</span><span class="m">0</span><span class="o">]</span>.iface.signal.signal_lower<span class="o">()</span><span class="w"> </span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>None
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># U-Boot shell</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1"># md 0x20010070 1 </span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="m">20010070</span>:<span class="w"> </span><span class="m">00000000</span><span class="w">                             </span>….
</code></pre></div>
<ol>
<li>Finally you are going to exercise triggering an interrupt and clearing the interrupt generated from the rising edge of the input in the button I/O component. This will be exercised from the Simics CLI. To observe that the interrupt is triggered, the log level of the interrupt controller is increased. First the interrupt needs to be enabled using the INTERRUPT register in this component. Once the interrupt is enabled, we can assert the input signal and observe that the interrupt is triggered and the DATA register gets also updated with the set value ('1'). Finally, you will clear the interrupt using again the INTERRUPT register.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># Simics CLI</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>running&gt;<span class="w"> </span>log-level<span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>system.board.fpga.soc_inst.hps_subsys.agilex_hps.gic<span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="o">[</span>system.board.fpga.soc_inst.hps_subsys.agilex_hps.gic<span class="o">]</span><span class="w"> </span>Changing<span class="w"> </span>log<span class="w"> </span>level:<span class="w"> </span><span class="m">1</span><span class="w"> </span>→<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>running&gt;<span class="w">  </span>read-device-reg<span class="w"> </span>system.board.fpga.soc_inst.periph_subsys.button_pio.bank.regs.DATA<span class="w"> </span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="m">0</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>running&gt;<span class="w">  </span>write-device-reg<span class="w"> </span>system.board.fpga.soc_inst.periph_subsys.button_pio.bank.regs.INTERRUPTMASK<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="o">[</span>system.board.fpga.soc_inst.hps_subsys.agilex_hps.gic.port.spi<span class="o">[</span><span class="m">49</span><span class="o">]</span><span class="w"> </span>info<span class="o">]</span><span class="w"> </span>SPI49<span class="w"> </span>already<span class="w"> </span>low
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>running&gt;<span class="w">  </span>@conf.system.board.fpga.soc_inst.periph_subsys.button_pio.port.input_io<span class="o">[</span><span class="m">0</span><span class="o">]</span>.iface.signal.signal_raise<span class="o">()</span><span class="w"> </span>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="o">[</span>system.board.fpga.soc_inst.hps_subsys.agilex_hps.gic.port.spi<span class="o">[</span><span class="m">49</span><span class="o">]</span><span class="w"> </span>info<span class="o">]</span><span class="w"> </span>SPI49<span class="w"> </span>raised
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>None
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a>running&gt;<span class="w">  </span>read-device-reg<span class="w"> </span>system.board.fpga.soc_inst.periph_subsys.button_pio.bank.regs.DATA<span class="w"> </span>
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="m">1</span>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>running&gt;<span class="w">  </span>write-device-reg<span class="w"> </span>system.board.fpga.soc_inst.periph_subsys.button_pio.bank.regs.INTERRUPTMASK<span class="w"> </span><span class="m">0</span><span class="w"> </span>
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="o">[</span>system.board.fpga.soc_inst.hps_subsys.agilex_hps.gic.port.spi<span class="o">[</span><span class="m">49</span><span class="o">]</span><span class="w"> </span>info<span class="o">]</span><span class="w"> </span>SPI49<span class="w"> </span>lowered
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a>running&gt;<span class="w">  </span>read-device-reg<span class="w"> </span>system.board.fpga.soc_inst.periph_subsys.button_pio.bank.regs.DATA<span class="w"> </span>
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="m">1</span>
</code></pre></div>
<h4 id="use-case-exercise-usb-disk-hot-plug">Use Case: Exercise USB Disk Hot-Plug<a class="headerlink" href="#use-case-exercise-usb-disk-hot-plug" title="Permanent link">&para;</a></h4>
<p>This use case is an extension of the main use case and includes attaching a USB image to one of the USB disks available in the Agilex™ 5-E Universal virtual platform and exercising the plug-in and plug-out actions as follows:</p>
<ol>
<li>Boot to the Linux prompt and plug in the USB disk (default), mount the disk and access some of the disk content, and add new content. The disk used in this use case is usb3_disk connected to the USB 3.0 Gen 1 controller.</li>
<li>Unmount and plug-out the disk, and verify that this is not seen by Linux anymore.</li>
<li>Plug-in and remount the disk, and verify that the content created is still available.</li>
</ol>
<p>All this is done as part of a single simulation session. The procedure described in the current use case does not allow to keep persistence of the content updated in the USB image after finishing the simulation.</p>
<p>For this use case, we require to create an initial USB disk Image for which some information is provided in the Setup section.</p>
<h5>Setup</h5>

<p>Start with the setup as the parent use case an continue with next steps. 1. Create a 32 MB USB image (<code>usbImage.img</code>) following the instructions . The image has a <code>ext4</code> type file system in the partition created that includes as  initial content the <code>hello1.txt</code> file:</p>
<p>In your Simics project directory, create the <code>usbImage.img</code> image:  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1"># Create a dircetory to create the image</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>mkdir<span class="w"> </span>usbDisk<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>usbDisk
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>wget<span class="w"> </span>https://releases.rocketboards.org/release/2020.11/gsrd/tools/make_sdimage_p3.py
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="c1"># remove mkfs.fat parameter which has some issues on Ubuntu 22.04</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/\&quot;\-F 32\&quot;,//g&#39;</span><span class="w"> </span>make_sdimage_p3.py
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>chmod<span class="w"> </span>+x<span class="w"> </span>make_sdimage_p3.py
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>mkdir<span class="w"> </span>part1<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">  </span><span class="nb">cd</span><span class="w"> </span>part1
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This is my original file in USB image&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>hello1.txt<span class="w"> </span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="nb">cd</span><span class="w"> </span>..
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>sudo<span class="w"> </span>python3<span class="w"> </span>make_sdimage_p3.py<span class="w"> </span>-f<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>-P<span class="w"> </span>part1/*,num<span class="o">=</span><span class="m">1</span>,format<span class="o">=</span>ext4,size<span class="o">=</span>16M<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>-s<span class="w"> </span>32M<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a>-n<span class="w"> </span>usbImage.img
</code></pre></div>
<ol>
<li>Update the target script to attach the image to the USB disk.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1">#uboot-linux_sdcard.simics   </span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="nv">$sd_image_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gsrd-console-image-agilex5.wic&quot;</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="nv">$fsbl_image_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;u-boot-spl-dtb.bin&quot;</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="nv">$usb3_image_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;usbDisk/usbImage.img&quot;</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="nv">$hps_boot_core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="nv">$create_hps_sd_card</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>TRUE
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>run-command-file<span class="w"> </span><span class="s2">&quot;targets/agilex5e-universal/agilex5e-universal.simics&quot;</span>
</code></pre></div>
<h5>Procedure</h5>

<ol>
<li>Execute the parent use case to get to the Linux prompt and log in. By default, the USB disks in the virtual platform are plugged in. These can be detected from the Linux using the <strong>fdisk -l</strong> command and shown next:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>root@dhcp0:~#<span class="w"> </span>fdisk<span class="w"> </span>-l<span class="w"> </span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>Disk<span class="w"> </span>/dev/mmcblk0:<span class="w"> </span><span class="m">16</span><span class="w"> </span>GB,<span class="w"> </span><span class="m">17179869184</span><span class="w"> </span>bytes,<span class="w"> </span><span class="m">33554432</span><span class="w"> </span>sectors
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="m">262144</span><span class="w"> </span>cylinders,<span class="w"> </span><span class="m">4</span><span class="w"> </span>heads,<span class="w"> </span><span class="m">32</span><span class="w"> </span>sectors/track
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>Units:<span class="w"> </span>sectors<span class="w"> </span>of<span class="w"> </span><span class="m">1</span><span class="w"> </span>*<span class="w"> </span><span class="nv">512</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>Device<span class="w">       </span>Boot<span class="w"> </span>StartCHS<span class="w">    </span>EndCHS<span class="w">        </span>StartLBA<span class="w">     </span>EndLBA<span class="w">    </span>Sectors<span class="w">  </span>Size<span class="w"> </span>Id<span class="w"> </span>Type
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>/dev/mmcblk0p1<span class="w"> </span>*<span class="w">  </span><span class="m">16</span>,0,1<span class="w">      </span><span class="m">1023</span>,3,32<span class="w">         </span><span class="m">2048</span><span class="w">    </span><span class="m">1026047</span><span class="w">    </span><span class="m">1024000</span><span class="w">  </span>500M<span class="w">  </span>b<span class="w"> </span>Win95<span class="w"> </span>FAT32
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>/dev/mmcblk0p2<span class="w">    </span><span class="m">1023</span>,3,32<span class="w">   </span><span class="m">1023</span>,3,32<span class="w">      </span><span class="m">1026048</span><span class="w">    </span><span class="m">4098047</span><span class="w">    </span><span class="m">3072000</span><span class="w"> </span>1500M<span class="w"> </span><span class="m">83</span><span class="w"> </span>Linux
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>Disk<span class="w"> </span>/dev/sda:<span class="w"> </span><span class="m">32</span><span class="w"> </span>MB,<span class="w"> </span><span class="m">33554432</span><span class="w"> </span>bytes,<span class="w"> </span><span class="m">65536</span><span class="w"> </span>sectors
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="m">37</span><span class="w"> </span>cylinders,<span class="w"> </span><span class="m">43</span><span class="w"> </span>heads,<span class="w"> </span><span class="m">41</span><span class="w"> </span>sectors/track
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>Units:<span class="w"> </span>sectors<span class="w"> </span>of<span class="w"> </span><span class="m">1</span><span class="w"> </span>*<span class="w"> </span><span class="nv">512</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>Device<span class="w">  </span>Boot<span class="w"> </span>StartCHS<span class="w">    </span>EndCHS<span class="w">        </span>StartLBA<span class="w">     </span>EndLBA<span class="w">    </span>Sectors<span class="w">  </span>Size<span class="w"> </span>Id<span class="w"> </span>Type
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a>/dev/sda1<span class="w">    </span><span class="m">0</span>,32,33<span class="w">     </span><span class="m">2</span>,42,41<span class="w">           </span><span class="m">2048</span><span class="w">      </span><span class="m">34816</span><span class="w">      </span><span class="m">32769</span><span class="w"> </span><span class="m">16</span>.0M<span class="w"> </span><span class="m">83</span><span class="w"> </span>Linux
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a>Partition<span class="w"> </span><span class="m">1</span><span class="w"> </span>has<span class="w"> </span>different<span class="w"> </span>physical/logical<span class="w"> </span>start<span class="w"> </span><span class="o">(</span>non-Linux?<span class="o">)</span>:
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="w">     </span><span class="nv">phys</span><span class="o">=(</span><span class="m">0</span>,32,33<span class="o">)</span><span class="w"> </span><span class="nv">logical</span><span class="o">=(</span><span class="m">1</span>,6,40<span class="o">)</span>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a>Partition<span class="w"> </span><span class="m">1</span><span class="w"> </span>has<span class="w"> </span>different<span class="w"> </span>physical/logical<span class="w"> </span>end:
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="w">     </span><span class="nv">phys</span><span class="o">=(</span><span class="m">2</span>,42,41<span class="o">)</span><span class="w"> </span><span class="nv">logical</span><span class="o">=(</span><span class="m">19</span>,32,8<span class="o">)</span>
</code></pre></div>
<ol>
<li>
<p>Observe that the usb3_disk corresponds to the <strong>/dev/sda</strong> device and <strong>/dev/sda1</strong> corresponds to the partition created in this disk which size of 16 MB.</p>
</li>
<li>
<p>Mount the partition in usb3_disk, observe the content (<strong>hello1.txt</strong> file), add new content (<strong>hello2.txt</strong>), and unmount the disk.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>root@dhcp0:~#<span class="w"> </span>mkdir<span class="w"> </span>/media/usbDrive<span class="w"> </span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>root@dhcp0:~#<span class="w"> </span>mount<span class="w"> </span>/dev/sda1<span class="w"> </span>/media/usbDrive<span class="w"> </span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="o">[</span><span class="w">  </span><span class="m">680</span>.753967<span class="o">]</span><span class="w"> </span>EXT4-fs<span class="w"> </span><span class="o">(</span>sda1<span class="o">)</span>:<span class="w"> </span>mounted<span class="w"> </span>filesystem<span class="w"> </span>with<span class="w"> </span>ordered<span class="w"> </span>data<span class="w"> </span>mode.<span class="w"> </span>Quota<span class="w"> </span>mode:<span class="w"> </span>none.
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>root@dhcp0:~#<span class="w"> </span>ls<span class="w"> </span>/media/usbDrive<span class="w"> </span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>hello1.txt<span class="w"> </span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>root@dhcp0:~#<span class="w"> </span>more<span class="w"> </span>/media/usbDrive/hello1.txt<span class="w"> </span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>This<span class="w"> </span>is<span class="w"> </span>my<span class="w"> </span>original<span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>USB<span class="w"> </span>image
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>root@dhcp0:~#<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This is my new file in the USB image&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/media/usbDrive/hello2.txt<span class="w"> </span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>root@dhcp0:~#<span class="w"> </span>ls<span class="w"> </span>/media/usbDrive<span class="w"> </span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>hello1.txt<span class="w">  </span>hello2.txt<span class="w"> </span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a>root@dhcp0:~#<span class="w"> </span>umount<span class="w"> </span>/media/usbDrive/<span class="w"> </span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="o">[</span><span class="w"> </span><span class="m">2403</span>.043825<span class="o">]</span><span class="w"> </span>EXT4-fs<span class="w"> </span><span class="o">(</span>sda1<span class="o">)</span>:<span class="w"> </span>unmounting<span class="w"> </span>filesystem.
</code></pre></div>
<ol>
<li>Unplug the usb3_disk from the Simics CLI and observe that Linux detects this action.</li>
</ol>
<p>In Simics CLI:
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>running&gt;<span class="w"> </span>system.board.usb3_disk.unplug<span class="w"> </span>
</code></pre></div></p>
<p>In Linux shell:
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>root@dhcp0:~#<span class="w"> </span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="o">[</span><span class="w"> </span><span class="m">1115</span>.122439<span class="o">]</span><span class="w"> </span>usb<span class="w"> </span><span class="m">3</span>-1:<span class="w"> </span>USB<span class="w"> </span>disconnect,<span class="w"> </span>device<span class="w"> </span>number<span class="w"> </span><span class="m">2</span>
</code></pre></div></p>
<p>You can call <strong>fdisk -l</strong> command again to observe that <strong>/dev/sda</strong> device is no longer present.</p>
<ol>
<li>From the Simics CLI plugin, the usb3_disk again provides the <strong>usb3</strong> port. Observe in the Linux shell that the device connection is detected. Remount the device partition and confirm that the new content created before is still present. Finally, unmount the disk.</li>
</ol>
<p>In Simics CLI:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>running&gt;<span class="w"> </span>system.board.usb3_disk.plug<span class="w"> </span><span class="nv">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>usb1_typec
</code></pre></div>
In Linux shell:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>root@dhcp0:~#<span class="w"> </span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="o">[</span><span class="w"> </span><span class="m">1415</span>.994946<span class="o">]</span><span class="w"> </span>usb<span class="w"> </span><span class="m">3</span>-1:<span class="w"> </span>new<span class="w"> </span>SuperSpeed<span class="w"> </span>USB<span class="w"> </span>device<span class="w"> </span>number<span class="w"> </span><span class="m">3</span><span class="w"> </span>using<span class="w"> </span>xhci-hcd
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="o">[</span><span class="w"> </span><span class="m">1416</span>.015078<span class="o">]</span><span class="w"> </span>usb<span class="w"> </span><span class="m">3</span>-1:<span class="w"> </span>LPM<span class="w"> </span><span class="nb">exit</span><span class="w"> </span>latency<span class="w"> </span>is<span class="w"> </span>zeroed,<span class="w"> </span>disabling<span class="w"> </span>LPM.
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="o">[</span><span class="w"> </span><span class="m">1416</span>.016520<span class="o">]</span><span class="w"> </span>usb-storage<span class="w"> </span><span class="m">3</span>-1:1.0:<span class="w"> </span>USB<span class="w"> </span>Mass<span class="w"> </span>Storage<span class="w"> </span>device<span class="w"> </span>detected
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="o">[</span><span class="w"> </span><span class="m">1416</span>.017476<span class="o">]</span><span class="w"> </span>scsi<span class="w"> </span>host0:<span class="w"> </span>usb-storage<span class="w"> </span><span class="m">3</span>-1:1.0
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="o">[</span><span class="w"> </span><span class="m">1417</span>.023153<span class="o">]</span><span class="w"> </span>scsi<span class="w"> </span><span class="m">0</span>:0:0:0:<span class="w"> </span>Direct-Access<span class="w">     </span>Vtech<span class="w">    </span>Turbo_Disk<span class="o">(</span>tm<span class="o">)</span><span class="w">   </span><span class="m">0001</span><span class="w"> </span>PQ:<span class="w"> </span><span class="m">0</span><span class="w"> </span>ANSI:<span class="w"> </span><span class="m">2</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="o">[</span><span class="w"> </span><span class="m">1417</span>.024835<span class="o">]</span><span class="w"> </span>sd<span class="w"> </span><span class="m">0</span>:0:0:0:<span class="w"> </span><span class="o">[</span>sda<span class="o">]</span><span class="w"> </span><span class="m">65536</span><span class="w"> </span><span class="m">512</span>-byte<span class="w"> </span>logical<span class="w"> </span>blocks:<span class="w"> </span><span class="o">(</span><span class="m">33</span>.6<span class="w"> </span>MB/32.0<span class="w"> </span>MiB<span class="o">)</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="o">[</span><span class="w"> </span><span class="m">1417</span>.025818<span class="o">]</span><span class="w"> </span>sd<span class="w"> </span><span class="m">0</span>:0:0:0:<span class="w"> </span><span class="o">[</span>sda<span class="o">]</span><span class="w"> </span>Test<span class="w"> </span>WP<span class="w"> </span>failed,<span class="w"> </span>assume<span class="w"> </span>Write<span class="w"> </span>Enabled
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="o">[</span><span class="w"> </span><span class="m">1417</span>.026685<span class="o">]</span><span class="w"> </span>sd<span class="w"> </span><span class="m">0</span>:0:0:0:<span class="w"> </span><span class="o">[</span>sda<span class="o">]</span><span class="w"> </span>Asking<span class="w"> </span><span class="k">for</span><span class="w"> </span>cache<span class="w"> </span>data<span class="w"> </span>failed
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="o">[</span><span class="w"> </span><span class="m">1417</span>.027290<span class="o">]</span><span class="w"> </span>sd<span class="w"> </span><span class="m">0</span>:0:0:0:<span class="w"> </span><span class="o">[</span>sda<span class="o">]</span><span class="w"> </span>Assuming<span class="w"> </span>drive<span class="w"> </span>cache:<span class="w"> </span>write<span class="w"> </span>through
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="o">[</span><span class="w"> </span><span class="m">1417</span>.029785<span class="o">]</span><span class="w">  </span>sda:<span class="w"> </span>sda1
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="o">[</span><span class="w"> </span><span class="m">1417</span>.030333<span class="o">]</span><span class="w"> </span>sd<span class="w"> </span><span class="m">0</span>:0:0:0:<span class="w"> </span><span class="o">[</span>sda<span class="o">]</span><span class="w"> </span>Attached<span class="w"> </span>SCSI<span class="w"> </span>disk
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a>
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a>root@dhcp0:~#<span class="w"> </span>fdisk<span class="w"> </span>-l
<a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a>Disk<span class="w"> </span>/dev/mmcblk0:<span class="w"> </span><span class="m">16</span><span class="w"> </span>GB,<span class="w"> </span><span class="m">17179869184</span><span class="w"> </span>bytes,<span class="w"> </span><span class="m">33554432</span><span class="w"> </span>sectors
<a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a>:
<a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a>Device<span class="w">  </span>Boot<span class="w"> </span>StartCHS<span class="w">    </span>EndCHS<span class="w">        </span>StartLBA<span class="w">     </span>EndLBA<span class="w">    </span>Sectors<span class="w">  </span>Size<span class="w"> </span>Id<span class="w"> </span>Type
<a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a>/dev/sda1<span class="w">    </span><span class="m">0</span>,32,33<span class="w">     </span><span class="m">2</span>,42,41<span class="w">           </span><span class="m">2048</span><span class="w">      </span><span class="m">34816</span><span class="w">      </span><span class="m">32769</span><span class="w"> </span><span class="m">16</span>.0M<span class="w"> </span><span class="m">83</span><span class="w"> </span>Linux
<a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a>Partition<span class="w"> </span><span class="m">1</span><span class="w"> </span>has<span class="w"> </span>different<span class="w"> </span>physical/logical<span class="w"> </span>start<span class="w"> </span><span class="o">(</span>non-Linux?<span class="o">)</span>:
<a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="w">     </span><span class="nv">phys</span><span class="o">=(</span><span class="m">0</span>,32,33<span class="o">)</span><span class="w"> </span><span class="nv">logical</span><span class="o">=(</span><span class="m">1</span>,6,40<span class="o">)</span>
<a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a>Partition<span class="w"> </span><span class="m">1</span><span class="w"> </span>has<span class="w"> </span>different<span class="w"> </span>physical/logical<span class="w"> </span>end:
<a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a><span class="w">     </span><span class="nv">phys</span><span class="o">=(</span><span class="m">2</span>,42,41<span class="o">)</span><span class="w"> </span><span class="nv">logical</span><span class="o">=(</span><span class="m">19</span>,32,8<span class="o">)</span>
<a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a>
<a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a>root@dhcp0:~#<span class="w"> </span>mount<span class="w"> </span>/dev/sda1<span class="w"> </span>/media/usbDrive<span class="w"> </span>
<a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a><span class="o">[</span><span class="w"> </span><span class="m">5419</span>.362283<span class="o">]</span><span class="w"> </span>EXT4-fs<span class="w"> </span><span class="o">(</span>sda1<span class="o">)</span>:<span class="w"> </span>mounted<span class="w"> </span>filesystem<span class="w"> </span>0fe6c96c-996c-4659-b7e2-e694076e5aef<span class="w"> </span>r/w<span class="w"> </span>with<span class="w"> </span>ordered<span class="w"> </span>data<span class="w"> </span>mode.<span class="w"> </span>Quota<span class="w"> </span>mode:<span class="w"> </span>none.
<a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a>root@dhcp0:~#<span class="w"> </span>ls<span class="w">  </span>/media/usbDrive<span class="w"> </span>
<a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a>hello1.txt<span class="w">  </span>hello2.txt<span class="w">  </span>lost+found
<a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a>root@dhcp0:~#<span class="w"> </span>more<span class="w">  </span>/media/usbDrive<span class="w"> </span>/media/usbDrive/hello2.txt
<a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a>This<span class="w"> </span>is<span class="w"> </span>my<span class="w"> </span>new<span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>USB<span class="w"> </span>image
<a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a>root@dhcp0:~#<span class="w"> </span>umount<span class="w"> </span>/media/usbDrive/<span class="w"> </span>
<a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a><span class="o">[</span><span class="w"> </span><span class="m">7348</span>.324046<span class="o">]</span><span class="w"> </span>EXT4-fs<span class="w"> </span><span class="o">(</span>sda1<span class="o">)</span>:<span class="w"> </span>unmounting<span class="w"> </span>filesystem<span class="w"> </span>0fe6c96c-996c-4659-b7e2-e694076e5aef.
</code></pre></div>
<h4 id="use-case-exercise-ubifs-qspi-boot-flow-from-fsbl-to-linux">Use Case: Exercise UBIFS QSPI Boot Flow from FSBL to Linux<a class="headerlink" href="#use-case-exercise-ubifs-qspi-boot-flow-from-fsbl-to-linux" title="Permanent link">&para;</a></h4>
<p>This use case consists of booting from a QSPI flash device going from U-Boot to Linux prompt passing through <strong>U-Boot SPL → ATF → U-Boot → Linux</strong> using an image with UBIFS format.</p>
<h5>Setup</h5>

<p>Perform steps 1 to 4 described in the [Simulation Setup]#simulation-setup) section.</p>
<ol>
<li>In the Intel Simics environment at the project directory, generate a compressed version of the .rpd file created (.craff) file using the <strong>craff</strong> tool provided under the Simics Base installation directory:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>&lt;SimicsInstallDir&gt;/simics-6.0.191/bin/craff<span class="w"> </span>-o<span class="w"> </span>qspi_image.img.craff<span class="w"> </span>flash_image_jic.rpd
</code></pre></div>
<p>The following file is created under the Simics project directory:</p>
<ul>
<li>qspi_image.img.craff</li>
</ul>
<ol>
<li>In the Intel Simics environment at the project directory, create a customized target script to exercise the FSBL to Linux boot flow from QSPI device with an image with UBIFS format. The file to create is called <strong>uboot-linux_qspi.simics</strong>. This file will look like this:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1">#uboot-linux_qspi.simics</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="nv">$fsbl_image_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;u-boot-spl-dtb.bin&quot;</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="nv">$qspi_image_filename</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;qspi_image.img.craff&quot;</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="nv">$hps_boot_core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="nv">$create_hps_sd_card</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>FALSE
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>run-command-file<span class="w"> </span><span class="s2">&quot;targets/agilex5e-universal/agilex5e-universal.simics&quot;</span>
</code></pre></div>
<h5>Procedure</h5>

<p>To exercise this use case, follow the steps below once the Simulation setup is complete:</p>
<ol>
<li>From the project directory, launch the simulation using the <strong>uboot-linux_qspi.simics</strong> target script. This script launches the simulator and the current terminal becomes the Simics CLI:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>$<span class="w"> </span>./simics<span class="w"> </span>uboot-linux_qspi.simics<span class="w"> </span>
</code></pre></div>
<ol>
<li>
<p>From the Simics CLI, start running the simulation with the <code>run</code> command.
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>simics&gt;<span class="w">  </span>run
</code></pre></div></p>
</li>
<li>
<p>Wait for the simulation to get to the Linux prompt in the target serial console.</p>
</li>
<li>Login into the Linux prompt using the <strong>root</strong> user without a password.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>U-Boot<span class="w"> </span>SPL<span class="w"> </span><span class="m">2024</span>.01<span class="w"> </span><span class="o">(</span>Jun<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">2024</span><span class="w"> </span>-<span class="w"> </span><span class="m">09</span>:28:56<span class="w"> </span>+0000<span class="o">)</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>Reset<span class="w"> </span>state:<span class="w"> </span>Cold
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>MPU<span class="w">           </span><span class="m">875000</span><span class="w"> </span>kHz
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>L4<span class="w"> </span>Main<span class="w">       </span><span class="m">400000</span><span class="w"> </span>kHz
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>L4<span class="w"> </span>sys<span class="w"> </span>free<span class="w">   </span><span class="m">100000</span><span class="w"> </span>kHz
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>L4<span class="w"> </span>MP<span class="w">         </span><span class="m">200000</span><span class="w"> </span>kHz
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>L4<span class="w"> </span>SP<span class="w">         </span><span class="m">100000</span><span class="w"> </span>kHz
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>SDMMC<span class="w">          </span><span class="m">50000</span><span class="w"> </span>kHz
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>init_mem_cal:<span class="w"> </span>Initial<span class="w"> </span>DDR<span class="w"> </span>calibration<span class="w"> </span>IO96B_0<span class="w"> </span>succeed
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>io96b_mb_init:<span class="w"> </span>num_instance<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a>io96b_mb_init:<span class="w"> </span>get<span class="w"> </span>memory<span class="w"> </span>interface<span class="w"> </span>IO96B<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a>:
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a>DDR:<span class="w"> </span>size<span class="w"> </span>check<span class="w"> </span>success
<a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>DDR:<span class="w"> </span>firewall<span class="w"> </span>init<span class="w"> </span>success
<a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a>DDR:<span class="w"> </span>init<span class="w"> </span>success
<a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a>QSPI:<span class="w"> </span>Reference<span class="w"> </span>clock<span class="w"> </span>at<span class="w"> </span><span class="m">400000</span><span class="w"> </span>kHz
<a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a>Trying<span class="w"> </span>to<span class="w"> </span>boot<span class="w"> </span>from<span class="w"> </span>MMC1
<a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a>MMC:<span class="w"> </span>no<span class="w"> </span>card<span class="w"> </span>present
<a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a>spl:<span class="w"> </span>mmc<span class="w"> </span>init<span class="w"> </span>failed<span class="w"> </span>with<span class="w"> </span>error:<span class="w"> </span>-123
<a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a>Trying<span class="w"> </span>to<span class="w"> </span>boot<span class="w"> </span>from<span class="w"> </span>SPI
<a id="__codelineno-56-21" name="__codelineno-56-21" href="#__codelineno-56-21"></a><span class="c1">## Checking hash(es) for config board-0 ... OK</span>
<a id="__codelineno-56-22" name="__codelineno-56-22" href="#__codelineno-56-22"></a><span class="c1">## Checking hash(es) for Image atf ... crc32+ OK</span>
<a id="__codelineno-56-23" name="__codelineno-56-23" href="#__codelineno-56-23"></a><span class="c1">## Checking hash(es) for Image uboot ... crc32+ OK</span>
<a id="__codelineno-56-24" name="__codelineno-56-24" href="#__codelineno-56-24"></a><span class="c1">## Checking hash(es) for Image fdt-0 ... crc32+ OK</span>
<a id="__codelineno-56-25" name="__codelineno-56-25" href="#__codelineno-56-25"></a>WARNING:<span class="w"> </span>Data<span class="w"> </span>cache<span class="w"> </span>not<span class="w"> </span>enabled
<a id="__codelineno-56-26" name="__codelineno-56-26" href="#__codelineno-56-26"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>Boot<span class="w"> </span><span class="nv">Core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-56-27" name="__codelineno-56-27" href="#__codelineno-56-27"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>CPU<span class="w"> </span><span class="nv">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">81000000</span>
<a id="__codelineno-56-28" name="__codelineno-56-28" href="#__codelineno-56-28"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>v2.10.1<span class="w">  </span><span class="o">(</span>release<span class="o">)</span>:rel_socfpga_v2.10.1_24.05.02_pr-4-g483735669
<a id="__codelineno-56-29" name="__codelineno-56-29" href="#__codelineno-56-29"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>Built<span class="w"> </span>:<span class="w"> </span><span class="m">08</span>:56:04,<span class="w"> </span>Jun<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">2024</span>
<a id="__codelineno-56-30" name="__codelineno-56-30" href="#__codelineno-56-30"></a>
<a id="__codelineno-56-31" name="__codelineno-56-31" href="#__codelineno-56-31"></a>
<a id="__codelineno-56-32" name="__codelineno-56-32" href="#__codelineno-56-32"></a>U-Boot<span class="w"> </span><span class="m">2024</span>.01<span class="w"> </span><span class="o">(</span>Jun<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">2024</span><span class="w"> </span>-<span class="w"> </span><span class="m">09</span>:28:56<span class="w"> </span>+0000<span class="o">)</span>socfpga_agilex5
<a id="__codelineno-56-33" name="__codelineno-56-33" href="#__codelineno-56-33"></a>
<a id="__codelineno-56-34" name="__codelineno-56-34" href="#__codelineno-56-34"></a>CPU:<span class="w">   </span>Intel<span class="w"> </span>FPGA<span class="w"> </span>SoCFPGA<span class="w"> </span>Platform<span class="w"> </span><span class="o">(</span>ARMv8<span class="w"> </span>64bit<span class="w"> </span>Cortex-A55/A76<span class="o">)</span>
<a id="__codelineno-56-35" name="__codelineno-56-35" href="#__codelineno-56-35"></a>Model:<span class="w"> </span>SoCFPGA<span class="w"> </span>Agilex5<span class="w"> </span>SoCDK
<a id="__codelineno-56-36" name="__codelineno-56-36" href="#__codelineno-56-36"></a>DRAM:<span class="w">  </span><span class="m">2</span><span class="w"> </span>GiB<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span><span class="m">8</span><span class="w"> </span>GiB<span class="o">)</span>
<a id="__codelineno-56-37" name="__codelineno-56-37" href="#__codelineno-56-37"></a>Core:<span class="w">  </span><span class="m">51</span><span class="w"> </span>devices,<span class="w"> </span><span class="m">26</span><span class="w"> </span>uclasses,<span class="w"> </span>devicetree:<span class="w"> </span>separate
<a id="__codelineno-56-38" name="__codelineno-56-38" href="#__codelineno-56-38"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00200
<a id="__codelineno-56-39" name="__codelineno-56-39" href="#__codelineno-56-39"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00300
<a id="__codelineno-56-40" name="__codelineno-56-40" href="#__codelineno-56-40"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00400
<a id="__codelineno-56-41" name="__codelineno-56-41" href="#__codelineno-56-41"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00500
<a id="__codelineno-56-42" name="__codelineno-56-42" href="#__codelineno-56-42"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00600
<a id="__codelineno-56-43" name="__codelineno-56-43" href="#__codelineno-56-43"></a>NAND:<span class="w">  </span><span class="m">4096</span><span class="w"> </span>MiB
<a id="__codelineno-56-44" name="__codelineno-56-44" href="#__codelineno-56-44"></a>MMC:<span class="w">   </span>mmc0@10808000:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-56-45" name="__codelineno-56-45" href="#__codelineno-56-45"></a>Loading<span class="w"> </span>Environment<span class="w"> </span>from<span class="w"> </span>FAT...<span class="w"> </span>MMC:<span class="w"> </span>no<span class="w"> </span>card<span class="w"> </span>present
<a id="__codelineno-56-46" name="__codelineno-56-46" href="#__codelineno-56-46"></a>:
<a id="__codelineno-56-47" name="__codelineno-56-47" href="#__codelineno-56-47"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">64</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span><span class="m">256</span><span class="w"> </span>MiB
<a id="__codelineno-56-48" name="__codelineno-56-48" href="#__codelineno-56-48"></a>Select<span class="w"> </span>Environment<span class="w"> </span>on<span class="w"> </span>UBI:<span class="w"> </span>OK
<a id="__codelineno-56-49" name="__codelineno-56-49" href="#__codelineno-56-49"></a>Saving<span class="w"> </span>Environment<span class="w"> </span>to<span class="w"> </span>UBI...<span class="w"> </span><span class="k">done</span>
<a id="__codelineno-56-50" name="__codelineno-56-50" href="#__codelineno-56-50"></a>OK
<a id="__codelineno-56-51" name="__codelineno-56-51" href="#__codelineno-56-51"></a>UBI<span class="w"> </span>partition<span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="w"> </span>already<span class="w"> </span>selected
<a id="__codelineno-56-52" name="__codelineno-56-52" href="#__codelineno-56-52"></a>UBI<span class="w"> </span>partition<span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="w"> </span>already<span class="w"> </span>selected
<a id="__codelineno-56-53" name="__codelineno-56-53" href="#__codelineno-56-53"></a>No<span class="w"> </span>size<span class="w"> </span>specified<span class="w"> </span>-&gt;<span class="w"> </span>Using<span class="w"> </span>max<span class="w"> </span>size<span class="w"> </span><span class="o">(</span><span class="m">196224</span><span class="o">)</span>
<a id="__codelineno-56-54" name="__codelineno-56-54" href="#__codelineno-56-54"></a>Read<span class="w"> </span><span class="m">196224</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>volume<span class="w"> </span>script<span class="w"> </span>to<span class="w"> </span><span class="m">0000000081000000</span>
<a id="__codelineno-56-55" name="__codelineno-56-55" href="#__codelineno-56-55"></a>QSPI:<span class="w"> </span>Running<span class="w"> </span>script<span class="w"> </span>from<span class="w"> </span>UBIFS
<a id="__codelineno-56-56" name="__codelineno-56-56" href="#__codelineno-56-56"></a>QSPI:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>boot<span class="w"> </span>script<span class="w"> </span>at<span class="w"> </span>0x81000000
<a id="__codelineno-56-57" name="__codelineno-56-57" href="#__codelineno-56-57"></a><span class="c1">## Executing script at 81000000</span>
<a id="__codelineno-56-58" name="__codelineno-56-58" href="#__codelineno-56-58"></a>crc32+<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>boot<span class="w"> </span>Linux<span class="w"> </span>from<span class="w"> </span>device<span class="w"> </span>qspi
<a id="__codelineno-56-59" name="__codelineno-56-59" href="#__codelineno-56-59"></a>
<a id="__codelineno-56-60" name="__codelineno-56-60" href="#__codelineno-56-60"></a>device<span class="w"> </span>nor0<span class="w"> </span>&lt;nor0&gt;,<span class="w"> </span><span class="c1"># parts = 2</span>
<a id="__codelineno-56-61" name="__codelineno-56-61" href="#__codelineno-56-61"></a><span class="w"> </span><span class="c1">#: name                size            offset          mask_flags</span>
<a id="__codelineno-56-62" name="__codelineno-56-62" href="#__codelineno-56-62"></a><span class="w"> </span><span class="m">0</span>:<span class="w"> </span>u-boot<span class="w">              </span>0x04200000<span class="w">      </span>0x00000000<span class="w">      </span><span class="m">0</span>
<a id="__codelineno-56-63" name="__codelineno-56-63" href="#__codelineno-56-63"></a><span class="w"> </span><span class="m">1</span>:<span class="w"> </span>root<span class="w">                </span>0x0be00000<span class="w">      </span>0x04200000<span class="w">      </span><span class="m">0</span>
<a id="__codelineno-56-64" name="__codelineno-56-64" href="#__codelineno-56-64"></a>
<a id="__codelineno-56-65" name="__codelineno-56-65" href="#__codelineno-56-65"></a>device<span class="w"> </span>nand0<span class="w"> </span>&lt;nand.0&gt;,<span class="w"> </span><span class="c1"># parts = 2</span>
<a id="__codelineno-56-66" name="__codelineno-56-66" href="#__codelineno-56-66"></a><span class="w"> </span><span class="c1">#: name                size            offset          mask_flags</span>
<a id="__codelineno-56-67" name="__codelineno-56-67" href="#__codelineno-56-67"></a><span class="w"> </span><span class="m">0</span>:<span class="w"> </span>nand_uboot<span class="w">          </span>0x00200000<span class="w">      </span>0x00000000<span class="w">      </span><span class="m">0</span>
<a id="__codelineno-56-68" name="__codelineno-56-68" href="#__codelineno-56-68"></a><span class="w"> </span><span class="m">1</span>:<span class="w"> </span>nand_root<span class="w">           </span>0x1f400000<span class="w">      </span>0x00200000<span class="w">      </span><span class="m">0</span>
<a id="__codelineno-56-69" name="__codelineno-56-69" href="#__codelineno-56-69"></a>
<a id="__codelineno-56-70" name="__codelineno-56-70" href="#__codelineno-56-70"></a>active<span class="w"> </span>partition:<span class="w"> </span>nor0,0<span class="w"> </span>-<span class="w"> </span><span class="o">(</span>u-boot<span class="o">)</span><span class="w"> </span>0x04200000<span class="w"> </span>@<span class="w"> </span>0x00000000
<a id="__codelineno-56-71" name="__codelineno-56-71" href="#__codelineno-56-71"></a>
<a id="__codelineno-56-72" name="__codelineno-56-72" href="#__codelineno-56-72"></a>
<a id="__codelineno-56-73" name="__codelineno-56-73" href="#__codelineno-56-73"></a>:
<a id="__codelineno-56-74" name="__codelineno-56-74" href="#__codelineno-56-74"></a>Enabling<span class="w"> </span>QSPI<span class="w"> </span>at<span class="w"> </span>Linux<span class="w"> </span>DTB...
<a id="__codelineno-56-75" name="__codelineno-56-75" href="#__codelineno-56-75"></a>Working<span class="w"> </span>FDT<span class="w"> </span><span class="nb">set</span><span class="w"> </span>to<span class="w"> </span>ffad7000
<a id="__codelineno-56-76" name="__codelineno-56-76" href="#__codelineno-56-76"></a>QSPI<span class="w"> </span>clock<span class="w"> </span>frequency<span class="w"> </span>updated
<a id="__codelineno-56-77" name="__codelineno-56-77" href="#__codelineno-56-77"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-56-78" name="__codelineno-56-78" href="#__codelineno-56-78"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-56-79" name="__codelineno-56-79" href="#__codelineno-56-79"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-56-80" name="__codelineno-56-80" href="#__codelineno-56-80"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-56-81" name="__codelineno-56-81" href="#__codelineno-56-81"></a>
<a id="__codelineno-56-82" name="__codelineno-56-82" href="#__codelineno-56-82"></a>Starting<span class="w"> </span>kernel<span class="w"> </span>...
<a id="__codelineno-56-83" name="__codelineno-56-83" href="#__codelineno-56-83"></a>
<a id="__codelineno-56-84" name="__codelineno-56-84" href="#__codelineno-56-84"></a>Deasserting<span class="w"> </span>all<span class="w"> </span>peripheral<span class="w"> </span>resets
<a id="__codelineno-56-85" name="__codelineno-56-85" href="#__codelineno-56-85"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Booting<span class="w"> </span>Linux<span class="w"> </span>on<span class="w"> </span>physical<span class="w"> </span>CPU<span class="w"> </span>0x0000000000<span class="w"> </span><span class="o">[</span>0x412fd050<span class="o">]</span>
<a id="__codelineno-56-86" name="__codelineno-56-86" href="#__codelineno-56-86"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Linux<span class="w"> </span>version<span class="w"> </span><span class="m">6</span>.6.22-altera-g6ad76f9ca568<span class="w"> </span><span class="o">(</span>oe-user@oe-host<span class="o">)</span><span class="w"> </span><span class="o">(</span>aarch64-poky-linux-gcc<span class="w"> </span><span class="o">(</span>GCC<span class="o">)</span><span class="w"> </span><span class="m">13</span>.3.0,<span class="w"> </span>GNU<span class="w"> </span>ld<span class="w"> </span><span class="o">(</span>GNU<span class="w"> </span>Binutils<span class="o">)</span><span class="w"> </span><span class="m">2</span>.42.0.20240620<span class="o">)</span><span class="w"> </span><span class="c1">#1 SMP PREEMPT Fri Jun 21 09:02:27 UTC 2024</span>
<a id="__codelineno-56-87" name="__codelineno-56-87" href="#__codelineno-56-87"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>KASLR<span class="w"> </span>disabled<span class="w"> </span>due<span class="w"> </span>to<span class="w"> </span>lack<span class="w"> </span>of<span class="w"> </span>seed
<a id="__codelineno-56-88" name="__codelineno-56-88" href="#__codelineno-56-88"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Machine<span class="w"> </span>model:<span class="w"> </span>SoCFPGA<span class="w"> </span>Agilex5<span class="w"> </span>SoCDK
<a id="__codelineno-56-89" name="__codelineno-56-89" href="#__codelineno-56-89"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>efi:<span class="w"> </span>UEFI<span class="w"> </span>not<span class="w"> </span>found.
<a id="__codelineno-56-90" name="__codelineno-56-90" href="#__codelineno-56-90"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Reserved<span class="w"> </span>memory:<span class="w"> </span>created<span class="w"> </span>DMA<span class="w"> </span>memory<span class="w"> </span>pool<span class="w"> </span>at<span class="w"> </span>0x0000000080000000,<span class="w"> </span>size<span class="w"> </span><span class="m">32</span><span class="w"> </span>MiB
<a id="__codelineno-56-91" name="__codelineno-56-91" href="#__codelineno-56-91"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>OF:<span class="w"> </span>reserved<span class="w"> </span>mem:<span class="w"> </span>initialized<span class="w"> </span>node<span class="w"> </span>svcbuffer@0,<span class="w"> </span>compatible<span class="w"> </span>id<span class="w"> </span>shared-dma-pool
<a id="__codelineno-56-92" name="__codelineno-56-92" href="#__codelineno-56-92"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>OF:<span class="w"> </span>reserved<span class="w"> </span>mem:<span class="w"> </span>0x0000000080000000..0x0000000081ffffff<span class="w"> </span><span class="o">(</span><span class="m">32768</span><span class="w"> </span>KiB<span class="o">)</span><span class="w"> </span>nomap<span class="w"> </span>non-reusable<span class="w"> </span>svcbuffer@0
<a id="__codelineno-56-93" name="__codelineno-56-93" href="#__codelineno-56-93"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>earlycon:<span class="w"> </span>uart0<span class="w"> </span>at<span class="w"> </span>MMIO32<span class="w"> </span>0x0000000010c02000<span class="w"> </span><span class="o">(</span>options<span class="w"> </span><span class="s1">&#39;115200n8&#39;</span><span class="o">)</span>
<a id="__codelineno-56-94" name="__codelineno-56-94" href="#__codelineno-56-94"></a><span class="o">[</span>
<a id="__codelineno-56-95" name="__codelineno-56-95" href="#__codelineno-56-95"></a>:
<a id="__codelineno-56-96" name="__codelineno-56-96" href="#__codelineno-56-96"></a>Poky<span class="w"> </span><span class="o">(</span>Yocto<span class="w"> </span>Project<span class="w"> </span>Reference<span class="w"> </span>Distro<span class="o">)</span><span class="w"> </span><span class="m">5</span>.0.2<span class="w"> </span>agilex5dka5e065bb32aes1<span class="w"> </span>ttyS0
<a id="__codelineno-56-97" name="__codelineno-56-97" href="#__codelineno-56-97"></a>
<a id="__codelineno-56-98" name="__codelineno-56-98" href="#__codelineno-56-98"></a>agilex5dka5e065bb32aes1<span class="w"> </span>login:<span class="w"> </span><span class="o">[</span><span class="w">  </span><span class="m">275</span>.419833<span class="o">]</span><span class="w"> </span>socfpga-dwmac<span class="w"> </span><span class="m">10830000</span>.ethernet<span class="w"> </span>eth0:<span class="w"> </span>Register<span class="w"> </span>MEM_TYPE_PAGE_POOL<span class="w"> </span>RxQ-0
<a id="__codelineno-56-99" name="__codelineno-56-99" href="#__codelineno-56-99"></a><span class="o">[</span><span class="w">  </span><span class="m">275</span>.425090<span class="o">]</span><span class="w"> </span>socfpga-dwmac<span class="w"> </span><span class="m">10830000</span>.ethernet<span class="w"> </span>eth0:<span class="w"> </span>Register<span class="w"> </span>MEM_TYPE_PAGE_POOL<span class="w"> </span>RxQ-1
<a id="__codelineno-56-100" name="__codelineno-56-100" href="#__codelineno-56-100"></a><span class="o">[</span><span class="w">  </span><span class="m">275</span>.430446<span class="o">]</span><span class="w"> </span>socfpga-dwmac<span class="w"> </span><span class="m">10830000</span>.ethernet<span class="w"> </span>eth0:<span class="w"> </span>Register<span class="w"> </span>MEM_TYPE_PAGE_POOL<span class="w"> </span>RxQ-2
<a id="__codelineno-56-101" name="__codelineno-56-101" href="#__codelineno-56-101"></a>:
<a id="__codelineno-56-102" name="__codelineno-56-102" href="#__codelineno-56-102"></a><span class="o">[</span><span class="w">  </span><span class="m">285</span>.755775<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054871</span>.096:12<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">16</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>LOAD
<a id="__codelineno-56-103" name="__codelineno-56-103" href="#__codelineno-56-103"></a><span class="o">[</span><span class="w">  </span><span class="m">285</span>.756498<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054871</span>.096:13<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">17</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>LOAD
<a id="__codelineno-56-104" name="__codelineno-56-104" href="#__codelineno-56-104"></a><span class="o">[</span><span class="w">  </span><span class="m">285</span>.757223<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054871</span>.096:14<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">18</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>LOAD
<a id="__codelineno-56-105" name="__codelineno-56-105" href="#__codelineno-56-105"></a><span class="o">[</span><span class="w">  </span><span class="m">316</span>.819432<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054902</span>.160:15<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">18</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>UNLOAD
<a id="__codelineno-56-106" name="__codelineno-56-106" href="#__codelineno-56-106"></a><span class="o">[</span><span class="w">  </span><span class="m">316</span>.820175<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054902</span>.160:16<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">17</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>UNLOAD
<a id="__codelineno-56-107" name="__codelineno-56-107" href="#__codelineno-56-107"></a><span class="o">[</span><span class="w">  </span><span class="m">316</span>.820912<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054902</span>.160:17<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">16</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>UNLOAD
<a id="__codelineno-56-108" name="__codelineno-56-108" href="#__codelineno-56-108"></a>
<a id="__codelineno-56-109" name="__codelineno-56-109" href="#__codelineno-56-109"></a>agilex5dka5e065bb32aes1<span class="w"> </span>login:<span class="w"> </span>root
<a id="__codelineno-56-110" name="__codelineno-56-110" href="#__codelineno-56-110"></a>
<a id="__codelineno-56-111" name="__codelineno-56-111" href="#__codelineno-56-111"></a>WARNING:<span class="w"> </span>Poky<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>reference<span class="w"> </span>Yocto<span class="w"> </span>Project<span class="w"> </span>distribution<span class="w"> </span>that<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span><span class="k">for</span>
<a id="__codelineno-56-112" name="__codelineno-56-112" href="#__codelineno-56-112"></a>testing<span class="w"> </span>and<span class="w"> </span>development<span class="w"> </span>purposes<span class="w"> </span>only.<span class="w"> </span>It<span class="w"> </span>is<span class="w"> </span>recommended<span class="w"> </span>that<span class="w"> </span>you<span class="w"> </span>create<span class="w"> </span>your
<a id="__codelineno-56-113" name="__codelineno-56-113" href="#__codelineno-56-113"></a>own<span class="w"> </span>distribution<span class="w"> </span><span class="k">for</span><span class="w"> </span>production<span class="w"> </span>use.
</code></pre></div>
<h4 id="use-case-exercise-nand-boot-flow-from-fsbl-to-linux">Use Case: Exercise NAND Boot Flow from FSBL to Linux<a class="headerlink" href="#use-case-exercise-nand-boot-flow-from-fsbl-to-linux" title="Permanent link">&para;</a></h4>
<p>This use case consists of booting from a NAND flash device going from U-Boot to Linux prompt passing through <strong>U-Boot SPL → ATF → U-Boot → Linux</strong>.</p>
<h5>Setup</h5>

<p>Perform steps 1 to 4 described in the <a href="#simulation-setup">Simulation Setup</a> section.</p>
<ol>
<li>In the Intel Simics environment at the project directory, create a customized target script to exercise the FSBL to Linux boot flow from NAND device. The file to create is called <strong>uboot-linux_nand.simics</strong>. This file will look like this:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1">#uboot-linux_nand.simics</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="nv">$fsbl_image_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;u-boot-spl-dtb.bin&quot;</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="nv">$nand_data_image_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nand.img&quot;</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="nv">$hps_boot_core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="nv">$create_hps_sd_card</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>FALSE
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>run-command-file<span class="w"> </span><span class="s2">&quot;targets/agilex5e-universal/agilex5e-universal.simics&quot;</span>
</code></pre></div>
<p>Also, in order to have ethernet connectivity, you need to connect the ethernet interface defined in the NAND device tree (eth0). For this,  update the following line in the <strong>targets/agilex5e-universal/agilex5e-universal.simics</strong> file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="k">if</span><span class="w"> </span><span class="nv">$create_hps_eth0_network</span><span class="w"> </span><span class="o">{</span><span class="w">    </span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="w">    </span>:
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">    </span><span class="c1"># Connect HPS eth0 instead of eth2 to Ethernet Switch</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">    </span>connect<span class="w"> </span><span class="o">(</span><span class="nv">$eth_switch</span>.get-free-connector<span class="o">)</span><span class="w"> </span><span class="nv">$system</span>.board.eth0
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="w">    </span>:<span class="w">    </span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="o">}</span>
</code></pre></div>
<h5>Procedure</h5>

<p>To exercise this use case, follow the below steps once the Simulation setup is complete:</p>
<ol>
<li>From the project directory, launch the simulation using the <code>uboot-linux_nand.simics</code> target script. This script launches the simulator and the current terminal becomes the Simics CLI:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>$<span class="w"> </span>./simics<span class="w"> </span>uboot-linux_nand.simics<span class="w"> </span>
</code></pre></div>
<ol>
<li>From the Simics CLI, start running the simulation with the <code>run</code> command.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>simics&gt;<span class="w">  </span>run
</code></pre></div>
<ol>
<li>
<p>Wait for the simulation to get to the Linux prompt in the target serial console.</p>
</li>
<li>
<p>Login into the Linux prompt using the <strong>root</strong> user without a password.</p>
</li>
</ol>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>U-Boot<span class="w"> </span>SPL<span class="w"> </span><span class="m">2024</span>.01<span class="w"> </span><span class="o">(</span>Jun<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">2024</span><span class="w"> </span>-<span class="w"> </span><span class="m">09</span>:28:56<span class="w"> </span>+0000<span class="o">)</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>Reset<span class="w"> </span>state:<span class="w"> </span>Cold
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>MPU<span class="w">           </span><span class="m">875000</span><span class="w"> </span>kHz
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>L4<span class="w"> </span>Main<span class="w">       </span><span class="m">400000</span><span class="w"> </span>kHz
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>L4<span class="w"> </span>sys<span class="w"> </span>free<span class="w">   </span><span class="m">100000</span><span class="w"> </span>kHz
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>L4<span class="w"> </span>MP<span class="w">         </span><span class="m">200000</span><span class="w"> </span>kHz
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>L4<span class="w"> </span>SP<span class="w">         </span><span class="m">100000</span><span class="w"> </span>kHz
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>SDMMC<span class="w">          </span><span class="m">50000</span><span class="w"> </span>kHz
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>init_mem_cal:<span class="w"> </span>Initial<span class="w"> </span>DDR<span class="w"> </span>calibration<span class="w"> </span>IO96B_0<span class="w"> </span>succeed
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a>io96b_mb_init:<span class="w"> </span>num_instance<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a>io96b_mb_init:<span class="w"> </span>get<span class="w"> </span>memory<span class="w"> </span>interface<span class="w"> </span>IO96B<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a>io96b_mb_req:<span class="w"> </span>Write<span class="w"> </span>0x10001<span class="w"> </span>to<span class="w"> </span>IOSSM_CMD_REQ_OFFSET<span class="w"> </span>0x1840043c
<a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a>:
<a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a>MMC:<span class="w"> </span>no<span class="w"> </span>card<span class="w"> </span>present
<a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a>spl:<span class="w"> </span>mmc<span class="w"> </span>init<span class="w"> </span>failed<span class="w"> </span>with<span class="w"> </span>error:<span class="w"> </span>-123
<a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a>Trying<span class="w"> </span>to<span class="w"> </span>boot<span class="w"> </span>from<span class="w"> </span>SPI
<a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a>Trying<span class="w"> </span>to<span class="w"> </span>boot<span class="w"> </span>from<span class="w"> </span>NAND
<a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a><span class="c1">## Checking hash(es) for config board-0 ... OK</span>
<a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a><span class="c1">## Checking hash(es) for Image atf ... crc32+ OK</span>
<a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a><span class="c1">## Checking hash(es) for Image uboot ... crc32+ OK</span>
<a id="__codelineno-61-21" name="__codelineno-61-21" href="#__codelineno-61-21"></a><span class="c1">## Checking hash(es) for Image fdt-0 ... crc32+ OK</span>
<a id="__codelineno-61-22" name="__codelineno-61-22" href="#__codelineno-61-22"></a>WARNING:<span class="w"> </span>Data<span class="w"> </span>cache<span class="w"> </span>not<span class="w"> </span>enabled
<a id="__codelineno-61-23" name="__codelineno-61-23" href="#__codelineno-61-23"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>Boot<span class="w"> </span><span class="nv">Core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-61-24" name="__codelineno-61-24" href="#__codelineno-61-24"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>CPU<span class="w"> </span><span class="nv">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">81000000</span>
<a id="__codelineno-61-25" name="__codelineno-61-25" href="#__codelineno-61-25"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>v2.10.1<span class="w">  </span><span class="o">(</span>release<span class="o">)</span>:rel_socfpga_v2.10.1_24.05.02_pr-4-g483735669
<a id="__codelineno-61-26" name="__codelineno-61-26" href="#__codelineno-61-26"></a>NOTICE:<span class="w">  </span>BL31:<span class="w"> </span>Built<span class="w"> </span>:<span class="w"> </span><span class="m">08</span>:56:04,<span class="w"> </span>Jun<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">2024</span>
<a id="__codelineno-61-27" name="__codelineno-61-27" href="#__codelineno-61-27"></a>
<a id="__codelineno-61-28" name="__codelineno-61-28" href="#__codelineno-61-28"></a>
<a id="__codelineno-61-29" name="__codelineno-61-29" href="#__codelineno-61-29"></a>U-Boot<span class="w"> </span><span class="m">2024</span>.01<span class="w"> </span><span class="o">(</span>Jun<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">2024</span><span class="w"> </span>-<span class="w"> </span><span class="m">09</span>:28:56<span class="w"> </span>+0000<span class="o">)</span>socfpga_agilex5
<a id="__codelineno-61-30" name="__codelineno-61-30" href="#__codelineno-61-30"></a>
<a id="__codelineno-61-31" name="__codelineno-61-31" href="#__codelineno-61-31"></a>CPU:<span class="w">   </span>Intel<span class="w"> </span>FPGA<span class="w"> </span>SoCFPGA<span class="w"> </span>Platform<span class="w"> </span><span class="o">(</span>ARMv8<span class="w"> </span>64bit<span class="w"> </span>Cortex-A55/A76<span class="o">)</span>
<a id="__codelineno-61-32" name="__codelineno-61-32" href="#__codelineno-61-32"></a>Model:<span class="w"> </span>SoCFPGA<span class="w"> </span>Agilex5<span class="w"> </span>SoCDK
<a id="__codelineno-61-33" name="__codelineno-61-33" href="#__codelineno-61-33"></a>DRAM:<span class="w">  </span><span class="m">2</span><span class="w"> </span>GiB<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span><span class="m">8</span><span class="w"> </span>GiB<span class="o">)</span>
<a id="__codelineno-61-34" name="__codelineno-61-34" href="#__codelineno-61-34"></a>Core:<span class="w">  </span><span class="m">51</span><span class="w"> </span>devices,<span class="w"> </span><span class="m">26</span><span class="w"> </span>uclasses,<span class="w"> </span>devicetree:<span class="w"> </span>separate
<a id="__codelineno-61-35" name="__codelineno-61-35" href="#__codelineno-61-35"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00200
<a id="__codelineno-61-36" name="__codelineno-61-36" href="#__codelineno-61-36"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00300
<a id="__codelineno-61-37" name="__codelineno-61-37" href="#__codelineno-61-37"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00400
<a id="__codelineno-61-38" name="__codelineno-61-38" href="#__codelineno-61-38"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00500
<a id="__codelineno-61-39" name="__codelineno-61-39" href="#__codelineno-61-39"></a>WDT:<span class="w">   </span>Not<span class="w"> </span>starting<span class="w"> </span>watchdog@10d00600
<a id="__codelineno-61-40" name="__codelineno-61-40" href="#__codelineno-61-40"></a>NAND:<span class="w">  </span><span class="m">4096</span><span class="w"> </span>MiB
<a id="__codelineno-61-41" name="__codelineno-61-41" href="#__codelineno-61-41"></a>MMC:<span class="w">   </span>mmc0@10808000:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-61-42" name="__codelineno-61-42" href="#__codelineno-61-42"></a>Loading<span class="w"> </span>Environment<span class="w"> </span>from<span class="w"> </span>FAT...<span class="w"> </span>MMC:<span class="w"> </span>no<span class="w"> </span>card<span class="w"> </span>present
<a id="__codelineno-61-43" name="__codelineno-61-43" href="#__codelineno-61-43"></a>**<span class="w"> </span>Bad<span class="w"> </span>device<span class="w"> </span>specification<span class="w"> </span>mmc<span class="w"> </span><span class="m">0</span><span class="w"> </span>**
<a id="__codelineno-61-44" name="__codelineno-61-44" href="#__codelineno-61-44"></a>:
<a id="__codelineno-61-45" name="__codelineno-61-45" href="#__codelineno-61-45"></a>QSPI:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>boot<span class="w"> </span>script<span class="w"> </span>at<span class="w"> </span>0x81000000
<a id="__codelineno-61-46" name="__codelineno-61-46" href="#__codelineno-61-46"></a><span class="c1">## Executing script at 81000000</span>
<a id="__codelineno-61-47" name="__codelineno-61-47" href="#__codelineno-61-47"></a>Wrong<span class="w"> </span>image<span class="w"> </span>format<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s2">&quot;source&quot;</span><span class="w"> </span><span class="nb">command</span>
<a id="__codelineno-61-48" name="__codelineno-61-48" href="#__codelineno-61-48"></a>QSPI:<span class="w"> </span>SCRIPT<span class="w"> </span>FAILED:<span class="w"> </span>continuing...
<a id="__codelineno-61-49" name="__codelineno-61-49" href="#__codelineno-61-49"></a>Select<span class="w"> </span>Environment<span class="w"> </span>on<span class="w"> </span>UBI:<span class="w"> </span>OK
<a id="__codelineno-61-50" name="__codelineno-61-50" href="#__codelineno-61-50"></a>Saving<span class="w"> </span>Environment<span class="w"> </span>to<span class="w"> </span>UBI...<span class="w"> </span><span class="k">done</span>
<a id="__codelineno-61-51" name="__codelineno-61-51" href="#__codelineno-61-51"></a>OK
<a id="__codelineno-61-52" name="__codelineno-61-52" href="#__codelineno-61-52"></a>UBI<span class="w"> </span>partition<span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="w"> </span>already<span class="w"> </span>selected
<a id="__codelineno-61-53" name="__codelineno-61-53" href="#__codelineno-61-53"></a>No<span class="w"> </span>size<span class="w"> </span>specified<span class="w"> </span>-&gt;<span class="w"> </span>Using<span class="w"> </span>max<span class="w"> </span>size<span class="w"> </span><span class="o">(</span><span class="m">1032192</span><span class="o">)</span>
<a id="__codelineno-61-54" name="__codelineno-61-54" href="#__codelineno-61-54"></a>Read<span class="w"> </span><span class="m">1032192</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>volume<span class="w"> </span>script<span class="w"> </span>to<span class="w"> </span><span class="m">0000000081000000</span>
<a id="__codelineno-61-55" name="__codelineno-61-55" href="#__codelineno-61-55"></a>NAND:<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>boot<span class="w"> </span>script<span class="w"> </span>at<span class="w"> </span>0x81000000
<a id="__codelineno-61-56" name="__codelineno-61-56" href="#__codelineno-61-56"></a><span class="c1">## Executing script at 81000000</span>
<a id="__codelineno-61-57" name="__codelineno-61-57" href="#__codelineno-61-57"></a>crc32+<span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>boot<span class="w"> </span>Linux<span class="w"> </span>from<span class="w"> </span>device<span class="w"> </span>nand
<a id="__codelineno-61-58" name="__codelineno-61-58" href="#__codelineno-61-58"></a>Select<span class="w"> </span>Environment<span class="w"> </span>on<span class="w"> </span>UBI:<span class="w"> </span>OK
<a id="__codelineno-61-59" name="__codelineno-61-59" href="#__codelineno-61-59"></a>Saving<span class="w"> </span>Environment<span class="w"> </span>to<span class="w"> </span>UBI...<span class="w"> </span>UBI<span class="w"> </span>partition<span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="w"> </span>already<span class="w"> </span>selected
<a id="__codelineno-61-60" name="__codelineno-61-60" href="#__codelineno-61-60"></a><span class="k">done</span>
<a id="__codelineno-61-61" name="__codelineno-61-61" href="#__codelineno-61-61"></a>OK
<a id="__codelineno-61-62" name="__codelineno-61-62" href="#__codelineno-61-62"></a>
<a id="__codelineno-61-63" name="__codelineno-61-63" href="#__codelineno-61-63"></a>device<span class="w"> </span>nor0<span class="w"> </span>&lt;nor0&gt;,<span class="w"> </span><span class="c1"># parts = 2</span>
<a id="__codelineno-61-64" name="__codelineno-61-64" href="#__codelineno-61-64"></a><span class="w"> </span><span class="c1">#: name                size            offset          mask_flags</span>
<a id="__codelineno-61-65" name="__codelineno-61-65" href="#__codelineno-61-65"></a><span class="w"> </span><span class="m">0</span>:<span class="w"> </span>u-boot<span class="w">              </span>0x04200000<span class="w">      </span>0x00000000<span class="w">      </span><span class="m">0</span>
<a id="__codelineno-61-66" name="__codelineno-61-66" href="#__codelineno-61-66"></a><span class="w"> </span><span class="m">1</span>:<span class="w"> </span>qspi_root<span class="w">           </span>0x0be00000<span class="w">      </span>0x04200000<span class="w">      </span><span class="m">0</span>
<a id="__codelineno-61-67" name="__codelineno-61-67" href="#__codelineno-61-67"></a>
<a id="__codelineno-61-68" name="__codelineno-61-68" href="#__codelineno-61-68"></a>device<span class="w"> </span>nand0<span class="w"> </span>&lt;ffb90000.nand.0&gt;,<span class="w"> </span><span class="c1"># parts = 2</span>
<a id="__codelineno-61-69" name="__codelineno-61-69" href="#__codelineno-61-69"></a><span class="w"> </span><span class="c1">#: name                size            offset          mask_flags</span>
<a id="__codelineno-61-70" name="__codelineno-61-70" href="#__codelineno-61-70"></a><span class="w"> </span><span class="m">0</span>:<span class="w"> </span>u-boot<span class="w">              </span>0x00200000<span class="w">      </span>0x00000000<span class="w">      </span><span class="m">0</span>
<a id="__codelineno-61-71" name="__codelineno-61-71" href="#__codelineno-61-71"></a><span class="w"> </span><span class="m">1</span>:<span class="w"> </span>root<span class="w">                </span>0xffe00000<span class="w">      </span>0x00200000<span class="w">      </span><span class="m">0</span>
<a id="__codelineno-61-72" name="__codelineno-61-72" href="#__codelineno-61-72"></a>
<a id="__codelineno-61-73" name="__codelineno-61-73" href="#__codelineno-61-73"></a>active<span class="w"> </span>partition:<span class="w"> </span>nor0,0<span class="w"> </span>-<span class="w"> </span><span class="o">(</span>u-boot<span class="o">)</span><span class="w"> </span>0x04200000<span class="w"> </span>@<span class="w"> </span>0x00000000
<a id="__codelineno-61-74" name="__codelineno-61-74" href="#__codelineno-61-74"></a>
<a id="__codelineno-61-75" name="__codelineno-61-75" href="#__codelineno-61-75"></a>defaults:
<a id="__codelineno-61-76" name="__codelineno-61-76" href="#__codelineno-61-76"></a>mtdids<span class="w">  </span>:<span class="w"> </span><span class="nv">nand0</span><span class="o">=</span>10b80000.nand.0
<a id="__codelineno-61-77" name="__codelineno-61-77" href="#__codelineno-61-77"></a>mtdparts:<span class="w"> </span><span class="nv">mtdparts</span><span class="o">=</span>10b80000.nand.0:2m<span class="o">(</span>u-boot<span class="o">)</span>,-<span class="o">(</span>root<span class="o">)</span>
<a id="__codelineno-61-78" name="__codelineno-61-78" href="#__codelineno-61-78"></a>UBI<span class="w"> </span>partition<span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="w"> </span>already<span class="w"> </span>selected
<a id="__codelineno-61-79" name="__codelineno-61-79" href="#__codelineno-61-79"></a>No<span class="w"> </span>size<span class="w"> </span>specified<span class="w"> </span>-&gt;<span class="w"> </span>Using<span class="w"> </span>max<span class="w"> </span>size<span class="w"> </span><span class="o">(</span><span class="m">25804800</span><span class="o">)</span>
<a id="__codelineno-61-80" name="__codelineno-61-80" href="#__codelineno-61-80"></a>Read<span class="w"> </span><span class="m">25804800</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>volume<span class="w"> </span>kernel<span class="w"> </span>to<span class="w"> </span><span class="m">0000000082000000</span>
<a id="__codelineno-61-81" name="__codelineno-61-81" href="#__codelineno-61-81"></a><span class="c1">## Loading kernel from FIT Image at 82000000 ...</span>
<a id="__codelineno-61-82" name="__codelineno-61-82" href="#__codelineno-61-82"></a>:
<a id="__codelineno-61-83" name="__codelineno-61-83" href="#__codelineno-61-83"></a>Enabling<span class="w"> </span>QSPI<span class="w"> </span>at<span class="w"> </span>Linux<span class="w"> </span>DTB...
<a id="__codelineno-61-84" name="__codelineno-61-84" href="#__codelineno-61-84"></a>Working<span class="w"> </span>FDT<span class="w"> </span><span class="nb">set</span><span class="w"> </span>to<span class="w"> </span>ffad7000
<a id="__codelineno-61-85" name="__codelineno-61-85" href="#__codelineno-61-85"></a>QSPI<span class="w"> </span>clock<span class="w"> </span>frequency<span class="w"> </span>updated
<a id="__codelineno-61-86" name="__codelineno-61-86" href="#__codelineno-61-86"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-61-87" name="__codelineno-61-87" href="#__codelineno-61-87"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-61-88" name="__codelineno-61-88" href="#__codelineno-61-88"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-61-89" name="__codelineno-61-89" href="#__codelineno-61-89"></a>RSU:<span class="w"> </span>Firmware<span class="w"> </span>or<span class="w"> </span>flash<span class="w"> </span>content<span class="w"> </span>not<span class="w"> </span>supporting<span class="w"> </span>RSU
<a id="__codelineno-61-90" name="__codelineno-61-90" href="#__codelineno-61-90"></a>
<a id="__codelineno-61-91" name="__codelineno-61-91" href="#__codelineno-61-91"></a>Starting<span class="w"> </span>kernel<span class="w"> </span>...
<a id="__codelineno-61-92" name="__codelineno-61-92" href="#__codelineno-61-92"></a>
<a id="__codelineno-61-93" name="__codelineno-61-93" href="#__codelineno-61-93"></a>Deasserting<span class="w"> </span>all<span class="w"> </span>peripheral<span class="w"> </span>resets
<a id="__codelineno-61-94" name="__codelineno-61-94" href="#__codelineno-61-94"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Booting<span class="w"> </span>Linux<span class="w"> </span>on<span class="w"> </span>physical<span class="w"> </span>CPU<span class="w"> </span>0x0000000000<span class="w"> </span><span class="o">[</span>0x412fd050<span class="o">]</span>
<a id="__codelineno-61-95" name="__codelineno-61-95" href="#__codelineno-61-95"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Linux<span class="w"> </span>version<span class="w"> </span><span class="m">6</span>.6.22-altera-g6ad76f9ca568<span class="w"> </span><span class="o">(</span>oe-user@oe-host<span class="o">)</span><span class="w"> </span><span class="o">(</span>aarch64-poky-linux-gcc<span class="w"> </span><span class="o">(</span>GCC<span class="o">)</span><span class="w"> </span><span class="m">13</span>.3.0,<span class="w"> </span>GNU<span class="w"> </span>ld<span class="w"> </span><span class="o">(</span>GNU<span class="w"> </span>Binutils<span class="o">)</span><span class="w"> </span><span class="m">2</span>.42.0.20240620<span class="o">)</span><span class="w"> </span><span class="c1">#1 SMP PREEMPT Fri Jun 21 09:02:27 UTC 2024</span>
<a id="__codelineno-61-96" name="__codelineno-61-96" href="#__codelineno-61-96"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>KASLR<span class="w"> </span>disabled<span class="w"> </span>due<span class="w"> </span>to<span class="w"> </span>lack<span class="w"> </span>of<span class="w"> </span>seed
<a id="__codelineno-61-97" name="__codelineno-61-97" href="#__codelineno-61-97"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Machine<span class="w"> </span>model:<span class="w"> </span>SoCFPGA<span class="w"> </span>Agilex5<span class="w"> </span>SoCDK
<a id="__codelineno-61-98" name="__codelineno-61-98" href="#__codelineno-61-98"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>efi:<span class="w"> </span>UEFI<span class="w"> </span>not<span class="w"> </span>found.
<a id="__codelineno-61-99" name="__codelineno-61-99" href="#__codelineno-61-99"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>Reserved<span class="w"> </span>memory:<span class="w"> </span>created<span class="w"> </span>DMA<span class="w"> </span>memory<span class="w"> </span>pool<span class="w"> </span>at<span class="w"> </span>0x0000000080000000,<span class="w"> </span>size<span class="w"> </span><span class="m">32</span><span class="w"> </span>MiB
<a id="__codelineno-61-100" name="__codelineno-61-100" href="#__codelineno-61-100"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>OF:<span class="w"> </span>reserved<span class="w"> </span>mem:<span class="w"> </span>initialized<span class="w"> </span>node<span class="w"> </span>svcbuffer@0,<span class="w"> </span>compatible<span class="w"> </span>id<span class="w"> </span>shared-dma-pool
<a id="__codelineno-61-101" name="__codelineno-61-101" href="#__codelineno-61-101"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>OF:<span class="w"> </span>reserved<span class="w"> </span>mem:<span class="w"> </span>0x0000000080000000..0x0000000081ffffff<span class="w"> </span><span class="o">(</span><span class="m">32768</span><span class="w"> </span>KiB<span class="o">)</span><span class="w"> </span>nomap<span class="w"> </span>non-reusable<span class="w"> </span>svcbuffer@0
<a id="__codelineno-61-102" name="__codelineno-61-102" href="#__codelineno-61-102"></a><span class="o">[</span><span class="w">    </span><span class="m">0</span>.000000<span class="o">]</span><span class="w"> </span>earlycon:<span class="w"> </span>uart0<span class="w"> </span>at<span class="w"> </span>MMIO32<span class="w"> </span>0x0000000010c02000<span class="w"> </span><span class="o">(</span>options<span class="w"> </span><span class="s1">&#39;115200n8&#39;</span><span class="o">)</span>
<a id="__codelineno-61-103" name="__codelineno-61-103" href="#__codelineno-61-103"></a>:
<a id="__codelineno-61-104" name="__codelineno-61-104" href="#__codelineno-61-104"></a>Poky<span class="w"> </span><span class="o">(</span>Yocto<span class="w"> </span>Project<span class="w"> </span>Reference<span class="w"> </span>Distro<span class="o">)</span><span class="w"> </span><span class="m">5</span>.0.2<span class="w"> </span>dhcp0<span class="w"> </span>ttyS0
<a id="__codelineno-61-105" name="__codelineno-61-105" href="#__codelineno-61-105"></a>
<a id="__codelineno-61-106" name="__codelineno-61-106" href="#__codelineno-61-106"></a><span class="o">[</span><span class="w">   </span><span class="m">15</span>.586539<span class="o">]</span><span class="w"> </span>soc64-hwmon<span class="w"> </span>soc@0:firmware:svc:hwmon:<span class="w"> </span>Initialized<span class="w"> </span><span class="m">4</span><span class="w"> </span>temperature<span class="w"> </span>and<span class="w"> </span><span class="m">6</span><span class="w"> </span>voltage<span class="w"> </span>channels
<a id="__codelineno-61-107" name="__codelineno-61-107" href="#__codelineno-61-107"></a><span class="o">[</span><span class="w">   </span><span class="m">15</span>.587715<span class="o">]</span><span class="w"> </span>soc64-hwmon<span class="w"> </span>soc@0:firmware:svc:hwmon:<span class="w"> </span>couldn<span class="s1">&#39;t get service channel rsu</span>
<a id="__codelineno-61-108" name="__codelineno-61-108" href="#__codelineno-61-108"></a><span class="s1">[   15.594272] Stratix10 SoC FPGA manager soc@0:firmware:svc:fpga-mgr: couldn&#39;</span>t<span class="w"> </span>get<span class="w"> </span>service<span class="w"> </span>channel<span class="w"> </span><span class="o">(</span>fpga<span class="o">)</span>
<a id="__codelineno-61-109" name="__codelineno-61-109" href="#__codelineno-61-109"></a><span class="o">[</span><span class="w">   </span><span class="m">15</span>.595272<span class="o">]</span><span class="w"> </span>platform<span class="w"> </span>soc@0:firmware:svc:hwmon:<span class="w"> </span>deferred<span class="w"> </span>probe<span class="w"> </span>pending
<a id="__codelineno-61-110" name="__codelineno-61-110" href="#__codelineno-61-110"></a><span class="o">[</span><span class="w">   </span><span class="m">15</span>.595948<span class="o">]</span><span class="w"> </span>platform<span class="w"> </span>soc@0:base_fpga_region:<span class="w"> </span>deferred<span class="w"> </span>probe<span class="w"> </span>pending
<a id="__codelineno-61-111" name="__codelineno-61-111" href="#__codelineno-61-111"></a><span class="o">[</span><span class="w">   </span><span class="m">15</span>.596631<span class="o">]</span><span class="w"> </span>platform<span class="w"> </span>soc@0:firmware:svc:fpga-mgr:<span class="w"> </span>deferred<span class="w"> </span>probe<span class="w"> </span>pending
<a id="__codelineno-61-112" name="__codelineno-61-112" href="#__codelineno-61-112"></a><span class="o">[</span><span class="w">   </span><span class="m">36</span>.588749<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054799</span>.316:15<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">18</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>UNLOAD
<a id="__codelineno-61-113" name="__codelineno-61-113" href="#__codelineno-61-113"></a><span class="o">[</span><span class="w">   </span><span class="m">36</span>.589487<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054799</span>.316:16<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">17</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>UNLOAD
<a id="__codelineno-61-114" name="__codelineno-61-114" href="#__codelineno-61-114"></a><span class="o">[</span><span class="w">   </span><span class="m">36</span>.590224<span class="o">]</span><span class="w"> </span>audit:<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="m">1334</span><span class="w"> </span>audit<span class="o">(</span><span class="m">1709054799</span>.316:17<span class="o">)</span>:<span class="w"> </span>prog-id<span class="o">=</span><span class="m">16</span><span class="w"> </span><span class="nv">op</span><span class="o">=</span>UNLOAD
<a id="__codelineno-61-115" name="__codelineno-61-115" href="#__codelineno-61-115"></a>
<a id="__codelineno-61-116" name="__codelineno-61-116" href="#__codelineno-61-116"></a>dhcp0<span class="w"> </span>login:<span class="w"> </span>root
<a id="__codelineno-61-117" name="__codelineno-61-117" href="#__codelineno-61-117"></a>
<a id="__codelineno-61-118" name="__codelineno-61-118" href="#__codelineno-61-118"></a>WARNING:<span class="w"> </span>Poky<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>reference<span class="w"> </span>Yocto<span class="w"> </span>Project<span class="w"> </span>distribution<span class="w"> </span>that<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span><span class="k">for</span>
<a id="__codelineno-61-119" name="__codelineno-61-119" href="#__codelineno-61-119"></a>testing<span class="w"> </span>and<span class="w"> </span>development<span class="w"> </span>purposes<span class="w"> </span>only.<span class="w"> </span>It<span class="w"> </span>is<span class="w"> </span>recommended<span class="w"> </span>that<span class="w"> </span>you<span class="w"> </span>create<span class="w"> </span>your
<a id="__codelineno-61-120" name="__codelineno-61-120" href="#__codelineno-61-120"></a>own<span class="w"> </span>distribution<span class="w"> </span><span class="k">for</span><span class="w"> </span>production<span class="w"> </span>use.
<a id="__codelineno-61-121" name="__codelineno-61-121" href="#__codelineno-61-121"></a>
<a id="__codelineno-61-122" name="__codelineno-61-122" href="#__codelineno-61-122"></a>root@dhcp0:~#<span class="w"> </span>
</code></pre></div>
<strong>Note:</strong> Most of the same use cases that are exercised from the <strong>Exercise SDCard Boot Flow from FSBL to Linux</strong> use case can also be exercised from this use case. There are some exceptions due to the limitation in the size of the file system which does not support the required commands.</p>
<h4 id="use-case-debug-bare-metal-code-using-intel-simics-simulator">Use Case: Debug Bare-Metal Code Using Intel Simics Simulator<a class="headerlink" href="#use-case-debug-bare-metal-code-using-intel-simics-simulator" title="Permanent link">&para;</a></h4>
<p>This use case consists of performing a debug session in a bare-metal environment, which in this case corresponds to a U-Boot application example. In this use case, debugging is performed using only the Simics CLI commands allowing us to navigate on the source code of the application, advance in the execution of this, and observe and modify values of variables. The application is created in the form of a U-Boot command (<strong>helloTestApp</strong>) that should be executed from the U-Boot shell. The application starts by printing a hello message (<strong>Hello Intel SoC FPGA!</strong>) and printing the number of times the command has been executed since the last power-up. After this, the application enters into a loop in which it waits for 100 sec and increases an iteration counter by one. The content on the loop is executed as long as the iterator counter is lower than 100000 and also the value of the <strong>exitVar</strong> variable remains in 0, otherwise, it leaves the loop and continues printing the number of times the content of the loop was executed. After this, the code performs some mathematical operations involving the iterator value and other variables and finally prints the result of the final operation.</p>
<p>The source code of the application is shown next. This is included in the <strong>do_helloTestApp()</strong> function, which then is referenced in the <strong>U_BOOT_CMD</strong> macro, which converts this into a U-Boot command. This source code must be included in a new file under the U-Boot repository as <strong>cmd/socFPGATrainingExamples.c</strong>. Also, to be built as part of the U-Boot binaries, update the <strong>cmd/Makefile</strong> file by adding <strong>obj-y += socFPGATrainingExamples.o</strong>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>/*
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="w">   </span>Training<span class="w"> </span>Examples<span class="w"> </span>called<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span><span class="nb">command</span><span class="w"> </span>from<span class="w"> </span>U-Boot<span class="w"> </span>shell
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>*/
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="c1">#include &lt;stdio.h&gt;</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="c1">#include &lt;command.h&gt;</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="c1">#include &lt;linux/delay.h&gt;</span>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a>
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a>static<span class="w"> </span>char<span class="w"> </span>helloTestCmd_help_text<span class="o">[]</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="w">   </span><span class="s2">&quot;helloTestApp\t\n&quot;</span><span class="p">;</span>
<a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a>
<a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a>static<span class="w"> </span>unsigned<span class="w"> </span>int<span class="w"> </span><span class="nv">execCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a>
<a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a>static<span class="w"> </span>int<span class="w"> </span>do_helloTestApp<span class="o">(</span>struct<span class="w"> </span>cmd_tbl<span class="w"> </span>*cmdtp,<span class="w"> </span>int<span class="w"> </span>flag,<span class="w"> </span>int<span class="w"> </span>argc,<span class="w"> </span>char<span class="w"> </span>*const<span class="w"> </span>argv<span class="o">[])</span>
<a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a><span class="o">{</span>
<a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a><span class="w">   </span>volatile<span class="w"> </span>unsigned<span class="w"> </span>char<span class="w"> </span><span class="nv">exitVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a><span class="w">   </span>unsigned<span class="w"> </span>int<span class="w"> </span><span class="nv">waitIter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a><span class="w">   </span>volatile<span class="w"> </span>unsigned<span class="w"> </span>int<span class="w"> </span><span class="nv">myVarA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a><span class="w">   </span>unsigned<span class="w"> </span>int<span class="w"> </span><span class="nv">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a><span class="w">   </span>unsigned<span class="w"> </span>int<span class="w"> </span>result<span class="p">;</span>
<a id="__codelineno-62-21" name="__codelineno-62-21" href="#__codelineno-62-21"></a>
<a id="__codelineno-62-22" name="__codelineno-62-22" href="#__codelineno-62-22"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>argc<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<a id="__codelineno-62-23" name="__codelineno-62-23" href="#__codelineno-62-23"></a><span class="w">   </span><span class="o">{</span>
<a id="__codelineno-62-24" name="__codelineno-62-24" href="#__codelineno-62-24"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span>CMD_RET_USAGE<span class="p">;</span>
<a id="__codelineno-62-25" name="__codelineno-62-25" href="#__codelineno-62-25"></a><span class="w">   </span><span class="o">}</span>
<a id="__codelineno-62-26" name="__codelineno-62-26" href="#__codelineno-62-26"></a>
<a id="__codelineno-62-27" name="__codelineno-62-27" href="#__codelineno-62-27"></a><span class="w">   </span>printf<span class="o">(</span><span class="s2">&quot;Hello Intel SoC FPGA! \r\n&quot;</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-62-28" name="__codelineno-62-28" href="#__codelineno-62-28"></a><span class="w">   </span>execCount++<span class="p">;</span>
<a id="__codelineno-62-29" name="__codelineno-62-29" href="#__codelineno-62-29"></a><span class="w">   </span>printf<span class="o">(</span><span class="s2">&quot;Executed %d times \r\n&quot;</span>,<span class="w"> </span>execCount<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-62-30" name="__codelineno-62-30" href="#__codelineno-62-30"></a><span class="w">   </span>printf<span class="o">(</span><span class="s2">&quot;Relocated address of do_helloTestApp: %p and execCount: %p \r\n&quot;</span>,<span class="w"> </span><span class="p">&amp;</span>do_helloTestApp,<span class="w"> </span><span class="p">&amp;</span>execCount<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-62-31" name="__codelineno-62-31" href="#__codelineno-62-31"></a>
<a id="__codelineno-62-32" name="__codelineno-62-32" href="#__codelineno-62-32"></a><span class="w">   </span><span class="k">while</span><span class="w"> </span><span class="o">((</span><span class="nv">exitVar</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span>waitIter<span class="w"> </span>&lt;<span class="w"> </span><span class="m">100000</span><span class="o">)){</span>
<a id="__codelineno-62-33" name="__codelineno-62-33" href="#__codelineno-62-33"></a><span class="w">       </span>udelay<span class="o">(</span><span class="m">100</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-62-34" name="__codelineno-62-34" href="#__codelineno-62-34"></a><span class="w">       </span>waitIter++<span class="p">;</span>
<a id="__codelineno-62-35" name="__codelineno-62-35" href="#__codelineno-62-35"></a><span class="w">   </span><span class="o">}</span>
<a id="__codelineno-62-36" name="__codelineno-62-36" href="#__codelineno-62-36"></a>
<a id="__codelineno-62-37" name="__codelineno-62-37" href="#__codelineno-62-37"></a><span class="w">   </span>printf<span class="o">(</span><span class="s2">&quot;Exit from loop at iteration: %d \r\n&quot;</span>,<span class="w"> </span>waitIter<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-62-38" name="__codelineno-62-38" href="#__codelineno-62-38"></a>
<a id="__codelineno-62-39" name="__codelineno-62-39" href="#__codelineno-62-39"></a><span class="w">   </span><span class="nv">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>waitIter<span class="w"> </span>+<span class="w"> </span>myVarA<span class="p">;</span>
<a id="__codelineno-62-40" name="__codelineno-62-40" href="#__codelineno-62-40"></a><span class="w">   </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>temp<span class="w"> </span>%<span class="w"> </span><span class="m">1000</span><span class="p">;</span>
<a id="__codelineno-62-41" name="__codelineno-62-41" href="#__codelineno-62-41"></a>
<a id="__codelineno-62-42" name="__codelineno-62-42" href="#__codelineno-62-42"></a><span class="w">   </span>printf<span class="o">(</span><span class="s2">&quot;Final result: %d \r\n&quot;</span>,<span class="w"> </span>result<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-62-43" name="__codelineno-62-43" href="#__codelineno-62-43"></a>
<a id="__codelineno-62-44" name="__codelineno-62-44" href="#__codelineno-62-44"></a><span class="w">   </span><span class="k">return</span><span class="w"> </span>CMD_RET_SUCCESS<span class="p">;</span>
<a id="__codelineno-62-45" name="__codelineno-62-45" href="#__codelineno-62-45"></a><span class="o">}</span>
<a id="__codelineno-62-46" name="__codelineno-62-46" href="#__codelineno-62-46"></a>
<a id="__codelineno-62-47" name="__codelineno-62-47" href="#__codelineno-62-47"></a>U_BOOT_CMD<span class="o">(</span>
<a id="__codelineno-62-48" name="__codelineno-62-48" href="#__codelineno-62-48"></a><span class="w">   </span>helloTestApp,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>do_helloTestApp,
<a id="__codelineno-62-49" name="__codelineno-62-49" href="#__codelineno-62-49"></a><span class="w">   </span><span class="s2">&quot;Command used to launch hello application&quot;</span>,<span class="w"> </span>helloTestCmd_help_text
<a id="__codelineno-62-50" name="__codelineno-62-50" href="#__codelineno-62-50"></a><span class="o">)</span><span class="p">;</span>
</code></pre></div>
<p>Note: You can perform the build of this application by updating the Yocto recipe. This can be done by creating a patch in which you describe the files that need to be created/updated in the U-Boot repository and then deploy it. This can be done during the Yocto customization stage (Customize the Yocto Build). To create the u-boot patch (<code>myUbootExampleApp.patch</code>), do the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>QPDS24.2_REL_GSRD_PR<span class="w"> </span>https://github.com/altera-opensource/u-boot-socfpga<span class="w"> </span>u-boot-socfpga-patch
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="nb">cd</span><span class="w"> </span>u-boot-socfpga-patch/
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w"> </span>-<span class="w"> </span>Create<span class="w"> </span>cmd/socFPGATrainingExamples.c<span class="w"> </span>file<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span><span class="nb">source</span><span class="w"> </span>code<span class="w"> </span>provided<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>example<span class="w"> </span>application.
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="w"> </span>-<span class="w"> </span>Edit<span class="w"> </span>cmd/Makefile<span class="w"> </span>to<span class="w"> </span>include<span class="w"> </span>the<span class="w"> </span>build<span class="w"> </span>of<span class="w"> </span>socFPGATrainingExamples.c
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="w">    </span>obj-y<span class="w"> </span>+<span class="o">=</span><span class="w"> </span>help.o
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="w">    </span>obj-y<span class="w"> </span>+<span class="o">=</span><span class="w"> </span>panic.o
<a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="w">    </span>obj-y<span class="w"> </span>+<span class="o">=</span><span class="w"> </span>version.o
<a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="w">    </span>obj-y<span class="w"> </span>+<span class="o">=</span><span class="w"> </span>socFPGATrainingExamples.o
<a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a>
<a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a>git<span class="w"> </span>add<span class="w"> </span>cmd/Makefile<span class="w"> </span>cmd/socFPGATrainingExamples.c
<a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a>git<span class="w"> </span>diff<span class="w"> </span>--patch<span class="w"> </span>--staged<span class="w"> </span>&gt;<span class="w"> </span>myUbootExampleApp.patch
</code></pre></div>
<p>To deploy the patch in the Yocto build flow do the following:</p>
<ol>
<li>Copy the <code>myUbootExampleApp.patch</code> file to the <strong>$TOP_FOLDER/gsrd-socfpga/meta-intel-fpga-refdes/recipes-bsp/u-boot/files/</strong> directory.</li>
<li>Request to deploy the path by adding a patch to the <strong>$TOP_FOLDER/gsrd-socfpga/meta-intel-fpga-refdes/recipes-bsp/u-boot/u-boot-socfpga_%.bbappend</strong> file:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>SRC_URI:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; \ </span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="s2">        file://0001-arm-Add-dwarf-4-to-compilation-flag.patch \   </span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="s2">        file://0001-arm-agilex-add-board-configuration.patch \    </span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="s2">        file://0001-arm-stratix10-add-board-configuration.patch \ </span>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="s2">        file://myUbootExampleApp.patch \ </span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="s2">        &quot;</span>
</code></pre></div>
<ol>
<li>Continue with the rest of the Yocto build flow indicated at <a href="#build-yocto">Build Yocto</a> section.</li>
</ol>
<p>After these steps, the application is included in the U-Boot binary file (<strong>uboot.itb</strong>), which is part of the SDCard image created (<strong>gsrd-console-image-agilex5.wic</strong>) and a symbol file corresponding to the U-Boot image, located at <strong>$TOP_FOLDER/gsrd-socfpga/agilex5_devkit-gsrd-images/u-boot-agilex5_devkit-socdk-gsrd-atf/u-boot</strong>. The symbol file is used later during the setup of the debug session.</p>
<h5>Setup</h5>

<p>Start with the setup of the main use case defined at [Simulation Setup]#simulation-setup). Modify the target script to add the created symbol file and set a breakpoint at the entry point of the  <strong>do_helloTestApp</strong> function as indicated in the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="c1"># uboot-linux_sdcard.simics</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>:
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>add-symbol-file<span class="w">  </span>&lt;path<span class="w"> </span>of<span class="w"> </span>symbol<span class="w"> </span>file&gt;/u-boot<span class="w">  </span>0x7FAF2000<span class="w"> </span>-relative
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>bp.source_location.break<span class="w"> </span>do_helloTestApp
</code></pre></div>
<p><strong>Note:</strong> The symbol file is being loaded with an offset relocation of 0x7FAF2000. This is needed because in a late stage of the U-Boot execution, this relocates itself into a different SDRAM memory location and this should be indicated to the debugger, so there is a match between the addresses indicated in the symbol file and the real memory address location of the symbols. You can obtain this relocation offset by subtracting the real address of a specific function (which can be obtained from the application being executed) and the original offset from the same function in the symbols file (provided in the <strong>u-boot.sym</strong> file). This is shown in the following figure:</p>
<p><a class="glightbox" href="../images/ubootApp_relocationOffset2.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="ubootApp relocationOffset2.jpg" src="../images/ubootApp_relocationOffset2.jpg" /></a></p>
<h5>Procedure</h5>

<ol>
<li>
<p>Start the simulation similar to how it is done in the main use case, but in the serial console stop the U-Boot autoboot by pressing a key on the reception of the message "<strong>Hit any key to stop autoboot:</strong>". </p>
</li>
<li>
<p>Start the U-Boot example application by calling the <strong>helloTestApp</strong> command from the U-Boot shell. This will make the breakpoint set in the target script trigger and the simulation will be stopped. In the Simics CLI, you will see the following message:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="w"> </span><span class="o">[</span>tcf<span class="o">]</span><span class="w"> </span>Breakpoint<span class="w"> </span><span class="m">1</span><span class="w"> </span>on<span class="w"> </span>execution<span class="w"> </span><span class="k">in</span><span class="w"> </span>context<span class="w"> </span>board.fpga.soc_inst.hps_subsys.agilex_hps.core<span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span>
</code></pre></div>
3. From Simics CLI, start a debug session by calling the following command:
 <div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>simics&gt;<span class="w"> </span><span class="o">(</span>psel<span class="o">)</span>.debug<span class="w"> </span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="w"> </span>dbg0<span class="w"> </span><span class="o">(</span>the<span class="w"> </span>arm-cortex-a55<span class="w"> </span>system.board.fpga.soc_inst.hps_subsys.agilex_hps.core<span class="o">[</span><span class="m">0</span><span class="o">])</span><span class="w"> </span>Now<span class="w"> </span>debugging<span class="w"> </span>the<span class="w"> </span>arm-cortex-a55<span class="w"> </span>system.board.fpga.soc_inst.hps_subsys.agilex_hps.core<span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="w"> </span>do_helloTestApp<span class="o">(</span><span class="nv">cmdtp</span><span class="o">=(</span>struct<span class="w"> </span>cmd_tbl<span class="w"> </span>*<span class="o">)</span><span class="w"> </span>0xfffc5788,<span class="w"> </span><span class="nv">flag</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">argc</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">argv</span><span class="o">=(</span>char<span class="w"> </span>*<span class="w"> </span>const<span class="w"> </span>*<span class="o">)</span><span class="w"> </span>0xffb09520<span class="o">)</span><span class="w"> </span>at<span class="w"> </span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="w"> </span>/home/tasks/gsrd/agilex5/updateUbootApp/agilex5_gsrd/gsrd-socfpga/agilex5_devkit-gsrd-rootfs/tmp/work/agilex5-poky-linux/u-boot-socfpga/1_v2022.10+gitAUTOINC+59fa161039-r0/git/cmd/socFPGATrainingExamples.c:19<span class="w"> </span><span class="m">19</span><span class="w"> </span>volatile<span class="w"> </span>unsigned<span class="w"> </span>char<span class="w"> </span><span class="nv">exitVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span>
</code></pre></div>
4. Following the program's logic, if the value of <strong>exitVar</strong> stays zero and the program is continued, the loop will continue until it reaches 100,000 and then the program ends with output messages in the serial console. You can check the values of the variable using the <strong>sym-type</strong>  and <strong>sym-value</strong> features:
 <div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>simics&gt;<span class="w"> </span>dbg0.sym-type<span class="w"> </span>exitVar<span class="w"> </span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="w">   </span>volatile<span class="w"> </span>unsigned<span class="w"> </span>char<span class="w"> </span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>simics&gt;<span class="w"> </span>dbg0.sym-value<span class="w"> </span>exitVar<span class="w"> </span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">   </span><span class="m">0</span><span class="w"> </span><span class="s1">&#39;\x00&#39;</span><span class="w"> </span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>simics&gt;<span class="w"> </span>dbg0.sym-type<span class="w"> </span>myVarA<span class="w"> </span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="w">   </span>volatile<span class="w"> </span>unsigned<span class="w"> </span>int-<span class="w"> </span>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a>simics&gt;<span class="w"> </span>dbg0.sym-value<span class="w"> </span>myVarA<span class="w"> </span>
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="w">   </span><span class="m">0</span>
</code></pre></div></p>
</li>
<li>
<p>Control the program by using <em>breakpoint</em> and <em>value modification</em>. In this section, first insert a breakpoint at Line 34, which is in the loop (You may let the program run for a few seconds before inserting this breakpoint). With that, expect the program to pause when the breakpoint is met and modify the value of <strong>exitVar</strong>.
   <div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>//The<span class="w"> </span>loop<span class="w"> </span>conditions<span class="w"> </span>are<span class="w"> </span>exitVar<span class="w"> </span>and<span class="w"> </span>waitIter<span class="w">   </span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="m">32</span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="o">((</span><span class="nv">exitVar</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span>waitIter<span class="w"> </span>&lt;<span class="w"> </span><span class="m">100000</span><span class="o">)){</span><span class="w">   </span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="m">33</span><span class="p">|</span><span class="w">    </span>udelay<span class="o">(</span><span class="m">100</span><span class="o">)</span><span class="p">;</span><span class="w">   </span>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="m">34</span><span class="p">|</span><span class="w">    </span>waitIter++<span class="p">;</span><span class="w">   </span>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="m">35</span><span class="p">|</span><span class="w"> </span><span class="o">}</span>
</code></pre></div></p>
<p>In the Simics Serial Console, enter the following line to insert the breakpoint at Line 34:
 <div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>running&gt;<span class="w"> </span>bp.source_line.break<span class="w"> </span><span class="nv">filename</span><span class="o">=</span>socFPGATrainingExamples.c<span class="w"> </span>line-number<span class="o">=</span><span class="m">34</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>Breakpoint<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>0x2<span class="w"> </span><span class="o">(</span>planted<span class="o">)</span><span class="w"> </span>
</code></pre></div></p>
<p>As the breakpoint is planted, continue the program by entering <strong>run</strong>. The program will stop when the breakpoint is hit. When the program stopped, modify the value of <strong>exitVar</strong> in the Serial Console by using the <strong>sym-write</strong> feature.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>simics&gt;<span class="w"> </span>dbg0.sym-write<span class="w"> </span>exitVar<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="w">   </span><span class="nv">exitVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">&#39;\x01&#39;</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>simics&gt;<span class="w"> </span>run
</code></pre></div>
<p>Next, enter <strong>run</strong> and see the program ends immediately due to <strong>exitVar=1</strong>.
 <div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1"># helloTestApp</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">   </span>Hello<span class="w"> </span>Intel<span class="w"> </span>SoC<span class="w"> </span>FPGA!
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">   </span>Executed<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">times</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="w">   </span>Relocated<span class="w"> </span>address<span class="w"> </span>of<span class="w"> </span>do_helloTestApp:<span class="w"> </span>00000000fff1a7a8<span class="w"> </span>and<span class="w"> </span>execCount:<span class="w"> </span>00000000fffddba0
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="w">   </span>Exit<span class="w"> </span>from<span class="w"> </span>loop<span class="w"> </span>at<span class="w"> </span>iteration:<span class="w"> </span><span class="m">9691</span>
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="w">   </span>Final<span class="w"> </span>result:<span class="w"> </span><span class="m">691</span>
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1">#</span>
</code></pre></div></p>
<p>From the output print, it shows that the program iterated for 9691 loops before hitting the Line-34 breakpoint you planted, this number would be bigger if you waited longer before planting the breakpoint. Lastly, the modification of <strong>exitVar</strong>  ended the program.</p>
</li>
</ol>
<p><em>Note:</em>
    a) You can modify the value of <strong>myVarA</strong> and <strong>exitVar</strong> at any time before the looping ends (the test program ends after 99,999 loops).
    b) If the loop-ending condition (<strong>myVarA</strong> and <strong>exitVar</strong>) changed, the program should exit in the next <strong>run</strong>.
    c) Using the same Simics session, you can enter <strong>helloTestApp</strong> in U-boot Shell to restart the test program again.</p>
<ol>
<li>
<p>For the first time the program is executed, the output shows <strong>“Executed 1 times”</strong>, this value will increase (+1) as you run the program again without ending the Simics session. Meanwhile, in the serial console, the program has ended as soon as it just started because the controlling variable <strong>exitVar</strong>, having a value of 1, already reached the loop-ending condition. Output on a serial console:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1"># helloTestApp</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">   </span>Hello<span class="w"> </span>Intel<span class="w"> </span>SoC<span class="w"> </span>FPGA!
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="w">   </span>Executed<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">times</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="w">   </span>Relocated<span class="w"> </span>address<span class="w"> </span>of<span class="w"> </span>do_helloTestApp:<span class="w"> </span>00000000fff1a7a8<span class="w"> </span>and<span class="w"> </span>execCount:<span class="w"> </span>00000000fffddba0
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="w">   </span>Exit<span class="w"> </span>from<span class="w"> </span>loop<span class="w"> </span>at<span class="w"> </span>iteration:<span class="w"> </span><span class="m">2</span>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="w">   </span>Final<span class="w"> </span>result:<span class="w"> </span><span class="m">2</span>
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1">#</span>
</code></pre></div>
</li>
<li>
<p>If the value <strong>exitVar</strong> remained zero, the loop counter is allowed to run for 99,999 loops. While the program is looping, you may change the value of <strong>myVarA</strong> to ‘345’. The <strong>Final result</strong> will be 345 when the looping ends. Final result is the modulus value where the <code>Final result = ( (waitIter + myVarA) % 1000 )</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1"># helloTestApp</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="w">   </span>Hello<span class="w"> </span>Intel<span class="w"> </span>SoC<span class="w"> </span>FPGA!
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="w">   </span>Executed<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="nb">times</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="w">   </span>Relocated<span class="w"> </span>address<span class="w"> </span>of<span class="w"> </span>do_helloTestApp:<span class="w"> </span>00000000fff1a7a8<span class="w"> </span>and<span class="w"> </span>execCount:<span class="w"> </span>00000000fffddba0
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="w">   </span>Exit<span class="w"> </span>from<span class="w"> </span>loop<span class="w"> </span>at<span class="w"> </span>iteration:<span class="w"> </span><span class="m">100</span>,000
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="w">   </span>Final<span class="w"> </span>result:<span class="w"> </span><span class="m">345</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1">#</span>
</code></pre></div>
</li>
<li>
<p>If both values of <strong>exitVar</strong> and <strong>myVarA</strong> remain unchanged, both being zero respectively, the looping continues until it reaches waitIter = 100,000. When the program ends, the <strong>Final result</strong> would be zero.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1"># helloTestApp</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="w">   </span>Hello<span class="w"> </span>Intel<span class="w"> </span>SoC<span class="w"> </span>FPGA!
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="w">   </span>Executed<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">times</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">   </span>Relocated<span class="w"> </span>address<span class="w"> </span>of<span class="w"> </span>do_helloTestApp:<span class="w"> </span>00000000fff1a7a8<span class="w"> </span>and<span class="w"> </span>execCount:<span class="w"> </span>00000000fffddba0
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="w">   </span>Exit<span class="w"> </span>from<span class="w"> </span>loop<span class="w"> </span>at<span class="w"> </span>iteration:<span class="w"> </span><span class="m">100</span>,000
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">   </span>Final<span class="w"> </span>result:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1">#</span>
</code></pre></div>
</li>
</ol>
<h4 id="use-case-debug-bare-metal-code-using-simics-riscfree">Use Case: Debug Bare-metal Code Using Simics-RiscFree<a class="headerlink" href="#use-case-debug-bare-metal-code-using-simics-riscfree" title="Permanent link">&para;</a></h4>
<p>This use case is an extension to the use case in section <strong>Use Case: Debug Bare-metal Code Using Intel Simics Simulator</strong> above but the debugging steps are performed in the Simics-RiscFree IDE. The test program used here is the same <strong>helloTestApp.c</strong>
<strong>Important:</strong> The offset relocation of 0x7FAF2000 in the symbol file is still required and must be done before the symbol file is used to launch Simics-RiscFree.</p>
<h5>Setup</h5>

<p>This section requires the <strong>simics-riscfree</strong> script. It is included in your Intel Simics Simulator project directory.</p>
<ol>
<li>To launch Simics-RiscFree IDE, use this command:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>$<span class="w">  </span>./simics-riscfree<span class="w"> </span>
</code></pre></div>
<ol>
<li>
<p>Following the command, you must set up a <strong>RiscFree</strong>  workspace. You should use a new directory as a <strong>RiscFree</strong> workspace different from the Simics project directory.
<a class="glightbox" href="../images/riscfreeworkspace.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="riscfreeworkspace.png" src="../images/riscfreeworkspace.png" /></a></p>
</li>
<li>
<p>In the <strong>RiscFree</strong> IDE GUI launched, you should see the current Simics project you selected shown in the Project Explorer window. If this is not shown, you can open it from <strong>"Window &gt; Show View &gt; Project Explorer"</strong> menu.
<a class="glightbox" href="../images/riscfreeworkspace2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="riscfreeworkspace2.png" src="../images/riscfreeworkspace2.png" /></a></p>
</li>
<li>
<p>From the Project Explorer window, right-click on the target script you want to launch (<strong>uboot-linux_sdcard.simics</strong>) and select <strong>“Debug As &gt; Simics Session”</strong>.
<a class="glightbox" href="../images/riscfreeworkspace3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="riscfreeworkspace3.png" src="../images/riscfreeworkspace3.png" /></a></p>
</li>
<li>
<p>When prompted for Switching Perspective, select <strong>Yes</strong>. The interface switches to the RiscFree Debugger, which is more user-friendly for debugging.
<a class="glightbox" href="../images/riscfreeworkspace4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="riscfreeworkspace4.png" src="../images/riscfreeworkspace4.png" /></a></p>
</li>
</ol>
<h5>Procedure</h5>

<ol>
<li>In the RiscFree Debugger window, click on the <strong>Run</strong> button <a class="glightbox" href="../images/runbutton.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="runbutton.png" src="../images/runbutton.png" /></a> to launch the Intel Simics Simulator project.</li>
<li>
<p>As the project is launched, a Simics CLI window appears. When the CLI reaches the <strong>Hit any key to stop autoboot</strong> message, press any key to stop the autoboot to OS, which will then go into the U-boot Shell.
<a class="glightbox" href="../images/riscfreeworkspace5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="riscfreeworkspace5.png" src="../images/riscfreeworkspace5.png" /></a></p>
</li>
<li>
<p>Start the test program by entering <strong>helloTestApp</strong> in the U-boot Shell.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>SOCFPGA_AGILEX5<span class="w"> </span><span class="c1"># helloTestApp</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>simics&gt;<span class="w"> </span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="w">   </span><span class="o">[</span>tcf<span class="o">]</span><span class="w"> </span>Breakpoint<span class="w"> </span><span class="m">1</span><span class="w"> </span>on<span class="w"> </span>execution<span class="w"> </span><span class="k">in</span><span class="w"> </span>context<span class="w"> </span>board.fpga.soc_inst.hps_subsys.agilex_hps.core<span class="o">[</span><span class="m">0</span><span class="o">]</span>
</code></pre></div>
<ol>
<li>As the first breakpoint is met, the program is halted at the entry point of the <strong>do_helloTestApp()</strong> function. Use the <strong>step into/step-over</strong> buttons <a class="glightbox" href="../images/stepsDbg.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="stepsDbg.png" src="../images/stepsDbg.png" /></a> to get to the <strong>while ((exitVar == 0)  &amp;&amp;  (waitIter &lt; 100000))</strong> line and show a capture of this with list command.</li>
</ol>
<p><a class="glightbox" href="../images/helloTestApp1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="helloTestApp1.png" src="../images/helloTestApp1.png" /></a></p>
<ol>
<li>At this point, if you click on the <strong>Run</strong> button, the test program prints <strong>“Hello Intel SoC FPGA!”</strong> and finishes looping after some time.</li>
</ol>
<p><a class="glightbox" href="../images/test1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="test1.png" src="../images/test1.png" /></a></p>
<p><strong>Note:</strong> If the loop already ended, relaunch the test program "helloTestApp" to proceed to the next step.</p>
<ol>
<li>To modify the loop conditions for debugging purposes, you can modify the value of <strong>exitVar</strong> in the Variable window. For example, changing the value of <strong>exitVar</strong> from ‘\377’ (this is a random value assigned by the system) to ‘\001’. As <code>exitVar</code> is no longer zero, the condition of the loop is exceeded, and thus the looping ends.</li>
</ol>
<p>Before modification:</p>
<p><a class="glightbox" href="../images/exitVar0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="exitVar0.png" src="../images/exitVar0.png" /></a></p>
<p>After modification:</p>
<p>[<a class="glightbox" href="../images/exitVar1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="exitVar1.png" src="../images/exitVar1.png" /></a></p>
<ol>
<li>The loop exits depending on two conditions: <strong>exitVar</strong> not equals to zero OR <strong>waitIter</strong> reached 100,000. As the value of exitVar is modified to 1 in the middle of looping, the loop ends with exitVar = 1 and <code>waitIter</code> at any number less than 100,000. In this example, <strong>waitIter</strong> is 82251 when the loop ends. Following the code logic, <strong>Final result</strong> is the modulus value where Final result = ( (waitIter + myVarA) % 1000 ) = 252.
<a class="glightbox" href="../images/loopends.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="loopends.png" src="../images/loopends.png" /></a></li>
</ol>
<h4 id="use-case-remote-debugging-of-a-linux-user-mode-program-using-arm-ds-debugger">Use Case: Remote Debugging of a Linux User Mode Program Using ARM DS Debugger<a class="headerlink" href="#use-case-remote-debugging-of-a-linux-user-mode-program-using-arm-ds-debugger" title="Permanent link">&para;</a></h4>
<p>This use case is an extension of the <strong>Use Case: Exercise SDCard Boot Flow from FSBL to Linux</strong> and consists of performing a debug session in a Linux user mode application using ARM Development Studio. For this, the debugging is done using the GDB server running in the target system. Also, set up the Simics network connectivity with the host PC, which is the one that runs ARM DS through TCP protocol. The application to be debugged is listed next <strong>myArmDSDebugExample.c</strong>. This application determines the core in which this run started and then enters into a loop counting the number of times the loop is executed and continue observing the execution core. It also counts the number of times the application is executed in each one of the four cores. The application exits from the loop when the iterator reaches a limit or the <strong>exitVar</strong> variable has a value of '1', which normally never should occur. After the loop, the application assigns the value in <strong>x</strong> variable to the <strong>a</strong> and <strong>b</strong> variables and then adds these variables and assigns the result value in <strong>c</strong> variable. In the end, the application prints the result of the addition, the number of times the loop was iterated and the final value of <strong>exitVar</strong>, and the number of times each core executed the application.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="c1">#define _GNU_SOURCE</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="c1">#include &lt;stdio.h&gt;</span>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="c1">#define NUM_CORES 4</span>
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>unsigned<span class="w"> </span>int<span class="w"> </span>coreCount<span class="o">[</span>NUM_CORES<span class="o">]</span><span class="p">;</span>
<a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a>
<a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a>unsigned<span class="w"> </span>long<span class="w"> </span>int<span class="w"> </span>read_mpidr<span class="o">(</span>void<span class="o">)</span>
<a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="o">{</span>
<a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">    </span>unsigned<span class="w"> </span>long<span class="w"> </span>int<span class="w"> </span>value<span class="p">;</span>
<a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="w">    </span>asm<span class="w"> </span>volatile<span class="o">(</span><span class="s2">&quot;mrs %[result], mpidr_el1&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">[</span>result<span class="o">]</span><span class="w"> </span><span class="s2">&quot;=r&quot;</span><span class="w"> </span><span class="o">(</span>value<span class="o">))</span><span class="p">;</span>
<a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>value<span class="p">;</span>
<a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a><span class="o">}</span>
<a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a>
<a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a>unsigned<span class="w"> </span>int<span class="w"> </span>getCore<span class="o">(){</span>
<a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a><span class="w">   </span>static<span class="w"> </span>unsigned<span class="w"> </span>int<span class="w"> </span><span class="nv">corePrev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>unsigned<span class="w"> </span>int<span class="o">)(</span>-1<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a><span class="w">   </span>unsigned<span class="w"> </span>long<span class="w"> </span>mpidr<span class="p">;</span>
<a id="__codelineno-78-18" name="__codelineno-78-18" href="#__codelineno-78-18"></a><span class="w">   </span>unsigned<span class="w"> </span>int<span class="w"> </span>core<span class="p">;</span>
<a id="__codelineno-78-19" name="__codelineno-78-19" href="#__codelineno-78-19"></a>
<a id="__codelineno-78-20" name="__codelineno-78-20" href="#__codelineno-78-20"></a><span class="w">    </span><span class="nv">mpidr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>read_mpidr<span class="o">()</span><span class="p">;</span>
<a id="__codelineno-78-21" name="__codelineno-78-21" href="#__codelineno-78-21"></a><span class="w">    </span><span class="nv">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>mpidr<span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="m">8</span><span class="o">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>0xFF<span class="p">;</span><span class="w">    </span>
<a id="__codelineno-78-22" name="__codelineno-78-22" href="#__codelineno-78-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>core<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>corePrev<span class="o">)</span>
<a id="__codelineno-78-23" name="__codelineno-78-23" href="#__codelineno-78-23"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-78-24" name="__codelineno-78-24" href="#__codelineno-78-24"></a><span class="w">       </span>coreCount<span class="o">[</span>core<span class="o">]</span>++<span class="p">;</span><span class="w"> </span>
<a id="__codelineno-78-25" name="__codelineno-78-25" href="#__codelineno-78-25"></a><span class="w">       </span><span class="nv">corePrev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>core<span class="p">;</span>
<a id="__codelineno-78-26" name="__codelineno-78-26" href="#__codelineno-78-26"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-78-27" name="__codelineno-78-27" href="#__codelineno-78-27"></a>
<a id="__codelineno-78-28" name="__codelineno-78-28" href="#__codelineno-78-28"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>core<span class="p">;</span>
<a id="__codelineno-78-29" name="__codelineno-78-29" href="#__codelineno-78-29"></a><span class="o">}</span>
<a id="__codelineno-78-30" name="__codelineno-78-30" href="#__codelineno-78-30"></a>
<a id="__codelineno-78-31" name="__codelineno-78-31" href="#__codelineno-78-31"></a>int<span class="w"> </span>main<span class="o">()</span>
<a id="__codelineno-78-32" name="__codelineno-78-32" href="#__codelineno-78-32"></a><span class="o">{</span>
<a id="__codelineno-78-33" name="__codelineno-78-33" href="#__codelineno-78-33"></a>
<a id="__codelineno-78-34" name="__codelineno-78-34" href="#__codelineno-78-34"></a><span class="w">    </span>int<span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">;</span>
<a id="__codelineno-78-35" name="__codelineno-78-35" href="#__codelineno-78-35"></a><span class="w">    </span>unsigned<span class="w"> </span>int<span class="w"> </span>core<span class="p">;</span><span class="w">    </span>
<a id="__codelineno-78-36" name="__codelineno-78-36" href="#__codelineno-78-36"></a><span class="w">    </span>unsigned<span class="w"> </span>int<span class="w"> </span><span class="nv">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<a id="__codelineno-78-37" name="__codelineno-78-37" href="#__codelineno-78-37"></a><span class="w">    </span>int<span class="w"> </span>a<span class="p">;</span>
<a id="__codelineno-78-38" name="__codelineno-78-38" href="#__codelineno-78-38"></a><span class="w">    </span>int<span class="w"> </span>b<span class="p">;</span>
<a id="__codelineno-78-39" name="__codelineno-78-39" href="#__codelineno-78-39"></a><span class="w">    </span>int<span class="w"> </span>c<span class="p">;</span>
<a id="__codelineno-78-40" name="__codelineno-78-40" href="#__codelineno-78-40"></a><span class="w">    </span>volatile<span class="w"> </span>int<span class="w"> </span><span class="nv">exitVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<a id="__codelineno-78-41" name="__codelineno-78-41" href="#__codelineno-78-41"></a>
<a id="__codelineno-78-42" name="__codelineno-78-42" href="#__codelineno-78-42"></a><span class="w">    </span><span class="nv">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getCore<span class="o">()</span><span class="p">;</span>
<a id="__codelineno-78-43" name="__codelineno-78-43" href="#__codelineno-78-43"></a><span class="w">    </span>printf<span class="o">(</span><span class="s2">&quot;=== My Debug example started on Core %d ===\n&quot;</span>,<span class="w"> </span>core<span class="o">)</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-78-44" name="__codelineno-78-44" href="#__codelineno-78-44"></a>
<a id="__codelineno-78-45" name="__codelineno-78-45" href="#__codelineno-78-45"></a><span class="w">    </span><span class="k">while</span><span class="o">((</span><span class="nv">exitVar</span><span class="o">==</span><span class="m">0</span><span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span>iter<span class="w"> </span>&lt;<span class="w"> </span><span class="m">1000000000</span><span class="o">))</span>
<a id="__codelineno-78-46" name="__codelineno-78-46" href="#__codelineno-78-46"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-78-47" name="__codelineno-78-47" href="#__codelineno-78-47"></a><span class="w">        </span><span class="nv">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getCore<span class="o">()</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-78-48" name="__codelineno-78-48" href="#__codelineno-78-48"></a><span class="w">        </span>iter++<span class="p">;</span>
<a id="__codelineno-78-49" name="__codelineno-78-49" href="#__codelineno-78-49"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-78-50" name="__codelineno-78-50" href="#__codelineno-78-50"></a><span class="w">    </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">;</span>
<a id="__codelineno-78-51" name="__codelineno-78-51" href="#__codelineno-78-51"></a><span class="w">    </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">;</span>
<a id="__codelineno-78-52" name="__codelineno-78-52" href="#__codelineno-78-52"></a><span class="w">    </span><span class="nv">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>a<span class="w"> </span>+<span class="w"> </span>b<span class="p">;</span>
<a id="__codelineno-78-53" name="__codelineno-78-53" href="#__codelineno-78-53"></a><span class="w">    </span>printf<span class="o">(</span><span class="s2">&quot;Count:%d  iter: %d  exitVar:%d \n&quot;</span>,<span class="w"> </span>c,<span class="w"> </span>iter,<span class="w"> </span>exitVar<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-78-54" name="__codelineno-78-54" href="#__codelineno-78-54"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="o">(</span><span class="nv">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span>core<span class="w"> </span>&lt;<span class="w"> </span>NUM_CORES<span class="p">;</span><span class="w"> </span>core++<span class="o">)</span>
<a id="__codelineno-78-55" name="__codelineno-78-55" href="#__codelineno-78-55"></a><span class="w">        </span>printf<span class="o">(</span><span class="s2">&quot;  core[%d]: %d times\r\n&quot;</span>,<span class="w"> </span>core,<span class="w"> </span>coreCount<span class="o">[</span>core<span class="o">])</span><span class="p">;</span>
<a id="__codelineno-78-56" name="__codelineno-78-56" href="#__codelineno-78-56"></a>
<a id="__codelineno-78-57" name="__codelineno-78-57" href="#__codelineno-78-57"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<a id="__codelineno-78-58" name="__codelineno-78-58" href="#__codelineno-78-58"></a><span class="o">}</span>
</code></pre></div>
<h5>Setup</h5>

<ol>
<li>Start with the setup as the parent use case. From the Simics CLI or from the <strong>uboot-linux_sdcard.simics</strong> Simics script, add the network configuration that allows establishing the GDB server connexion between the target system and the host PC. This configuration creates an incoming forwarding port for TCP traffic from a port in the host PC to port <strong>9123</strong> in the target system. The port in the host PC is shown when calling the <strong>list-port-forwarding-setup</strong> command (port <strong>4001</strong> will be used in this example).</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="c1"># uboot-linux_sdcard.simics</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>:
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>connect-real-network-port-in<span class="w"> </span><span class="m">9123</span><span class="w"> </span>ethernet-link<span class="w"> </span><span class="o">=</span><span class="w"> </span>ethernet_switch0<span class="w"> </span>target-ip<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>.10.0.100<span class="w"> </span>-tcp<span class="w"> </span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>list-port-forwarding-setup
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a>running&gt;<span class="w">  </span>list-port-forwarding-setup<span class="w"> </span>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a>NAPT<span class="w"> </span>enabled<span class="w"> </span>with<span class="w"> </span>gateway<span class="w"> </span><span class="m">10</span>.10.0.1/24<span class="w"> </span>on<span class="w"> </span>link<span class="w"> </span>ethernet_switch0.link.
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a>NAPT<span class="w"> </span>enabled<span class="w"> </span>with<span class="w"> </span>gateway<span class="w"> </span>fe80::2220:20ff:fe20:2000/64<span class="w"> </span>on<span class="w"> </span>link<span class="w"> </span>ethernet_switch0.link.
<a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a>
<a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a>Real<span class="w"> </span>DNS<span class="w"> </span>enabled<span class="w"> </span>at<span class="w"> </span><span class="m">10</span>.10.0.1/24<span class="w"> </span>on<span class="w"> </span>link<span class="w"> </span>ethernet_switch0.link.
<a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a>Real<span class="w"> </span>DNS<span class="w"> </span>enabled<span class="w"> </span>at<span class="w"> </span>fe80::2220:20ff:fe20:2000/64<span class="w"> </span>on<span class="w"> </span>link<span class="w"> </span>ethernet_switch0.link.
<a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a>
<a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a>Host<span class="w"> </span>TCP<span class="w"> </span>port<span class="w"> </span><span class="m">4001</span><span class="w"> </span>→<span class="w"> </span><span class="m">10</span>.10.0.100:9123
</code></pre></div>
<ol>
<li>The Linux example application must be compiled so you can have the executable binary available. This binary is generated with a toolchain and should be built to include debug information (i.e. symbol file). ARM DS does not support the DWARF 5.0 format in the symbols files, so the application must be built with a toolchain that creates this with DWARF 4.0 version. The instructions to build the applications are shown next. This generates the <strong>myArmDSDebugExample</strong> binary.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>mkdir<span class="w"> </span>SymDbg<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>SymDbg
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>wget<span class="w"> </span>https://developer.arm.com/-/media/Files/downloads/gnu-a/10.2-2020.11/binrel/gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>tar<span class="w"> </span>xf<span class="w"> </span>gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>rm<span class="w"> </span>gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>./gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-gcc<span class="w"> </span>-g<span class="w"> </span>-o<span class="w">  </span>myArmDSDebugExample<span class="w"> </span>myArmDSDebugExample.c
</code></pre></div>
<h5>Procedure</h5>

<ol>
<li>
<p>Execute parent use case to get to the Linux prompt and log in.</p>
</li>
<li>
<p>Take the Linux application binary to the target system filesystem using tftp. For this, you will need to do the following. The <strong>myArmDSDebugExample</strong> binary should be located in the Simics project directory before calling <strong>tftp</strong> command.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>root@dhcp0:~#<span class="w"> </span>ethtool<span class="w"> </span>-K<span class="w"> </span>eth1<span class="w"> </span>tx<span class="w"> </span>off<span class="w"> </span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>tx-checksum-ipv4:<span class="w"> </span>off
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>tx-checksum-ipv6:<span class="w"> </span>off
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>tx-tcp-segmentation:<span class="w"> </span>off<span class="w"> </span><span class="o">[</span>not<span class="w"> </span>requested<span class="o">]</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>tx-tcp6-segmentation:<span class="w"> </span>off<span class="w"> </span><span class="o">[</span>not<span class="w"> </span>requested<span class="o">]</span>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>root@dhcp0:~#<span class="w"> </span>tftp<span class="w"> </span>-gr<span class="w"> </span>myArmDSDebugExample<span class="w"> </span><span class="m">10</span>.10.0.1<span class="w"> </span>
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>root@dhcp0:~#<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>myArmDSDebugExample<span class="w"> </span>
</code></pre></div>
<ol>
<li>Start a GDB Server debug session over the application from the Linux prompt using the port created in the target system during the port forwarding setup:</li>
</ol>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>root@dhcp0:~#<span class="w"> </span>gdbserver<span class="w"> </span><span class="m">10</span>.10.0.1:9123<span class="w"> </span>myArmDSDebugExample<span class="w"> </span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>Process<span class="w"> </span>/home/root/myArmDSDebugExample<span class="w"> </span>created<span class="p">;</span><span class="w"> </span><span class="nv">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">283</span>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>Listening<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">9123</span>
</code></pre></div>
4. In ARM Development Studio, create a new debug connection following the next steps:</p>
<p>a) Create a New Debug Connection to a <strong>Linux Application Connection</strong>. Press Next.
<a class="glightbox" href="../images/ARMDS_Fig1.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="ARMDS Fig1.jpg" src="../images/ARMDS_Fig1.jpg" /></a> </p>
<p>b) Give a name to the Debug connection: <strong>DebugLinuxAppSimicsGDB</strong> . Press Finish.
<a class="glightbox" href="../images/ARMDS_Fig2.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="ARMDS Fig2.jpg" src="../images/ARMDS_Fig2.jpg" /></a></p>
<p>c) Edit the configuration. In the <strong>Connection</strong> tab, select:
- Linux Application Debug → Application Debug → Connections via AArch64 gdbserver → Connect to already running application
- Address: localhost (or host PC IP if want to be accessed from a different PC in the same network)
- Port: 4001
- Select Terminate gdbserver on disconnect</p>
<p><a class="glightbox" href="../images/ARMDS_Fig3.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="ARMDS Fig3.jpg" src="../images/ARMDS_Fig3.jpg" /></a></p>
<p>d) Edit the configuration. In <strong>Files</strong> tab, select the application binary loaded as symbol file: <a class="glightbox" href="../images/ARMDS_Fig4.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="ARMDS Fig4.jpg" src="../images/ARMDS_Fig4.jpg" /></a></p>
<p>e) Edit the configuration. In <strong>Debugger</strong> tab, select <strong>Debug from symbol: main</strong> 
<a class="glightbox" href="../images/ARMDS_Fig5.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="ARMDS Fig5.jpg" src="../images/ARMDS_Fig5.jpg" /></a></p>
<p>Press <strong>Debug</strong> button to start the debug.</p>
<ol>
<li>The application debug can be performed now. ARM DS shows the source code of the test application stopped at the entry point of the <strong>main()</strong> function and we observe at the left the Debug Control panel with the options to control the execution of the code:</li>
</ol>
<p><a class="glightbox" href="../images/ARMDS_Fig6.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="ARMDS Fig6.jpg" src="../images/ARMDS_Fig6.jpg" /></a></p>
<p>Observe that in the target serial console, the gdb server reports that the connection with the host was achieved showing the message: <strong>Remote debugging from host 10.10.0.1, port 4097</strong></p>
<p>a) Run the code and after a few seconds pause it. Observe that it stops under the while loop (or under the <strong>getCore()</strong> function which is called under the loop). You can observe the value of the variables using the Variables tab. The <strong>iter</strong> variable is increased in every iteration in the loop and the current value of <strong>exitVar</strong> variable is 0. You can also observe that the application is being executed in core 0. The loop will exit whenever the <strong>exitVar</strong> variable has a value of 1 or the iterator reaches gets greater than 1000000000. At this point, the application already printed the <strong>=== My Debug example started on Core 0 ===</strong> message in the serial console. 
<a class="glightbox" href="../images/ARMDS_Fig7.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="ARMDS Fig7.jpg" src="../images/ARMDS_Fig7.jpg" /></a></p>
<p>b) You can change the value of the <strong>exitVar</strong> variable from the <strong>Value</strong> column in the <strong>Variables</strong> tab, use the <strong>step-over</strong> button to advance in the execution of the application, and confirm that this condition makes it exit from the loop. You can continue advancing in the code execution and observe that the variables <strong>a</strong> and <strong>b</strong> gets initialized with the value of <strong>x</strong>. Observe that the <strong>c</strong> variable gets updated with the result of the addition of <strong>a</strong> and <strong>b</strong> variables.</p>
<p><a class="glightbox" href="../images/ARMDS_Fig8.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="ARMDS Fig8.jpg" src="../images/ARMDS_Fig8.jpg" /></a></p>
<p>c) Proceed to continue the code execution and observe that the application gets finished printing the results. Also, you can get disconnected from the gdb server session and after this, the serial console shows again the Linux prompt.</p>
<p><a class="glightbox" href="../images/ARMDS_Fig9.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="ARMDS Fig9.jpg" src="../images/ARMDS_Fig9.jpg" /></a></p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 30, 2024</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 7, 2024</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../../../e-series/modular/boot-examples/ug-linux-boot-agx5e-modular/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Agilex 5 E-Series Modular Development Kit GHRD Linux Boot Examples" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Agilex 5 E-Series Modular Development Kit GHRD Linux Boot Examples
              </div>
            </div>
          </a>
        
        
          
          <a href="../../zephyr-gsrd/ug-zephyr-gsrd-agilex5-virtual-platforms/" class="md-footer__link md-footer__link--next" aria-label="Next: Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Zephyr GSRD" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Zephyr GSRD
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.altera.com" target="_blank" rel="noopener" title="www.altera.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/altera-fpga" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/altera-fpga/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "navigation.indexes", "navigation.footer", "navigation.path", "search.suggest", "search.highlight", "content.code.copy", "navigation.indexes", "toc.integrate", "toc.follow"], "search": "../../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"alias": true, "default": "rel-24.2", "provider": "mike"}}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
        <script src="https://unpkg.com/tablefilter@0.7.3/dist/tablefilter/tablefilter.js"></script>
      
        <script src="../../../../../../assets/tables.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>