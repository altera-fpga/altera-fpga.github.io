
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://altera-fpga.github.io/rel-24.3/embedded-designs/agilex-5/e-series/premium/rsu/ug-rsu-agx5e-soc/">
      
      
        <link rel="prev" href="../../remote-debug/ug-remote-debug-agx5e-premium/">
      
      
        <link rel="next" href="../../../modular/gsrd/ug-gsrd-agx5e-modular/">
      
      <link rel="icon" href="../../../../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>SoC HPS Remote System Update Example - Altera FPGA Developer Site</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intro" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../.." title="Altera FPGA Developer Site" class="md-header__button md-logo" aria-label="Altera FPGA Developer Site" data-md-component="logo">
      
  <img src="../../../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Altera FPGA Developer Site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SoC HPS Remote System Update Example
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/altera-fpga" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    altera-fpga
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../driver-list_linux/" class="md-tabs__link">
        Linux Drivers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../driver-list_zephyr/" class="md-tabs__link">
        Zephyr Drivers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../driver-list_baremetal/" class="md-tabs__link">
        Baremetal Drivers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../sw-tools-list/host-attach-tools/" class="md-tabs__link">
        Host Attach Utilities
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../ed-demo-list/ed-list/" class="md-tabs__link md-tabs__link--active">
        Example Designs
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../ed-demo-list/demo-list/" class="md-tabs__link">
        Demos
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="Altera FPGA Developer Site" class="md-nav__button md-logo" aria-label="Altera FPGA Developer Site" data-md-component="logo">
      
  <img src="../../../../../../assets/logo.png" alt="logo">

    </a>
    Altera FPGA Developer Site
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/altera-fpga" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    altera-fpga
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../../driver-list_linux/">Linux Drivers</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Linux Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          HPS Host Drivers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          HPS Host Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/hwmon/hwmon/" class="md-nav__link">
        Altera Hardware Monitor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/clock_manager/clock_manager/" class="md-nav__link">
        Clock Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/dma/dma/" class="md-nav__link">
        DMA Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/edac/edac/" class="md-nav__link">
        Error Detection & Correction (EDAC)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/ptp_tod/ptp_emb_tod/" class="md-nav__link">
        Ethernet 1588 PTP Time of Day Clock
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/emac/emac/" class="md-nav__link">
        Ethernet Media Access Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/hssi/hssi/" class="md-nav__link">
        Ethernet Subsystem FPGA IP MAC Specific Ctrl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/hssi_xtile/hssi_xtile/" class="md-nav__link">
        Ethernet Subsystem FPGA IP Tile Specific Ctrl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/apb_timers/apb_timers/" class="md-nav__link">
        General Purpose Timers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/gpio/gpio/" class="md-nav__link">
        General Purpose I/O (GPIO)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/i2c/i2c/" class="md-nav__link">
        I2C
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/i3c/i3c/" class="md-nav__link">
        I3C
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/interrupt_controller_GICv3/irq_gic_v3/" class="md-nav__link">
        Interrupt Controller (GICv3)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/msgdma/msgdma/" class="md-nav__link">
        MSGDMA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/nand/nand/" class="md-nav__link">
        NAND Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/qsfp/qsfp/" class="md-nav__link">
        QSFP Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/qspi/qspi/" class="md-nav__link">
        QSPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/reset_manager/reset_manager/" class="md-nav__link">
        Reset Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/sd-emmc/sd-emmc/" class="md-nav__link">
        SD/eMMC Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/spi/spi/" class="md-nav__link">
        SPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/system_manager/system_manager/" class="md-nav__link">
        System Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/smmu/smmu/" class="md-nav__link">
        System Memory Management Unit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/uart/uart/" class="md-nav__link">
        UART
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/usb2_0_otg/usb_2_0_otg/" class="md-nav__link">
        USB 2.0 OTG
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/watchdog_timers/watchdog_timers/" class="md-nav__link">
        Watchdog Timers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/zarlink_clock_synchronizer/zarlink_clock_synchronizer/" class="md-nav__link">
        Zarlink Clock Synchronizer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          PCIe Host Drivers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          PCIe Host Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/uart_16550/uart_16550/" class="md-nav__link">
        Altera 16550 Compatible UART
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_afu/dfl_afu/" class="md-nav__link">
        Accelerator Functional Unit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/intel_m10_bmc_core/intel_m10_bmc_core/" class="md-nav__link">
        Board Management Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl/dfl/" class="md-nav__link">
        Device Feature List
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/s10hssi/s10hssi/" class="md-nav__link">
        Ethernet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/ptp_dfl_tod/ptp_dfl_tod/" class="md-nav__link">
        Ethernet 1588 PTP Time of Day Clock
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_fme/dfl_fme/" class="md-nav__link">
        FPGA Management Engine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_pci/dfl_pci/" class="md-nav__link">
        PCIe Subsystem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_emif/dfl_emif/" class="md-nav__link">
        Memory Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/intel_m10_bmc_core/intel_m10_bmc_core/" class="md-nav__link">
        MAX 10 Board Management Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/spi_altera_dfl/spi_altera_dfl/" class="md-nav__link">
        SPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/uio_dfl/uio_dfl/" class="md-nav__link">
        User space I/O (UIO)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../../driver-list_zephyr/">Zephyr Drivers</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Zephyr Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          HPS Zephyr Drivers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          HPS Zephyr Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/clock_manager/clock_manager/" class="md-nav__link">
        Clock Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/dma/dma/" class="md-nav__link">
        DMA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/gpio/gpio/" class="md-nav__link">
        GPIO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/qspi/qspi/" class="md-nav__link">
        Quad SPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/reset_manager/reset_manager/" class="md-nav__link">
        Reset Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/seu/seu/" class="md-nav__link">
        Single Error Upset (SEU)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/uart/uart/" class="md-nav__link">
        UART
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/watchdog/watchdog/" class="md-nav__link">
        Watchdog Timer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../../driver-list_baremetal/">Baremetal Drivers</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Baremetal Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Host Attach Utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Host Attach Utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw-tools-list/host-attach-tools/" class="md-nav__link">
        Host Attach Utilities Summary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgaconf/fpgaconf/" class="md-nav__link">
        fpgaconf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgaport/fpgaport/" class="md-nav__link">
        fpgaport
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet loopback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/ofs_uio/ofs_uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/opae_io/opae_io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/pac_hssi_config/pac_hssi_config/" class="md-nav__link">
        pac_hssi_config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Example Designs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Example Designs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../ed-demo-list/ed-list/" class="md-nav__link">
        Summary
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" checked>
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          Agilex™ 5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Agilex™ 5
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_1" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2_1" id="__nav_6_2_1_label" tabindex="0">
          E-Series Premium Development Kit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6_2_1">
          <span class="md-nav__icon md-icon"></span>
          E-Series Premium Development Kit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gsrd/ug-gsrd-agx5e-premium/" class="md-nav__link">
        GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gsrd_zephyr/ug-zgsrd-agx5e-premium/" class="md-nav__link">
        Zephyr GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../boot-examples/ug-linux-boot-agx5e-premium/" class="md-nav__link">
        GHRD Linux Boot Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_1_4" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2_1_4" id="__nav_6_2_1_4_label" tabindex="0">
          TSN Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_2_1_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2_1_4">
          <span class="md-nav__icon md-icon"></span>
          TSN Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tsn/rgmii-hps/ug-tsncfg1-agx5e-premium/" class="md-nav__link">
        TSN - HPS RGMII System
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tsn/sgmii_xcvr/ug-tsn-sgmii-xcvr-agilex5/" class="md-nav__link">
        TSN - SGMII XCVR System
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../remote-debug/ug-remote-debug-agx5e-premium/" class="md-nav__link">
        FPGA Remote Debug Example
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          SoC HPS Remote System Update Example
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        SoC HPS Remote System Update Example
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    Intro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component-versions" class="md-nav__link">
    Component Versions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-binaries" class="md-nav__link">
    Building Binaries
  </a>
  
    <nav class="md-nav" aria-label="Building Binaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-cmake" class="md-nav__link">
    Installing cmake
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-the-environment" class="md-nav__link">
    Setting up the Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-hardware-projects" class="md-nav__link">
    Building the Hardware Projects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-arm-trusted-firmware" class="md-nav__link">
    Building Arm Trusted Firmware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-u-boot" class="md-nav__link">
    Building U-Boot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-linux" class="md-nav__link">
    Building Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-initial-flash-image" class="md-nav__link">
    Creating the Initial Flash Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-application-image" class="md-nav__link">
    Creating the Application Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-factory-update-image" class="md-nav__link">
    Creating the Factory Update Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-decision-firmware-update-image" class="md-nav__link">
    Creating the Decision Firmware Update Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-combined-application-image" class="md-nav__link">
    Creating the Combined Application Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-root-file-system" class="md-nav__link">
    Building the Root File System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-zlib" class="md-nav__link">
    Building ZLIB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-librsu-and-rsu-client" class="md-nav__link">
    Building LIBRSU and RSU Client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-sd-card" class="md-nav__link">
    Building the SD Card
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flashing-binaries" class="md-nav__link">
    Flashing Binaries
  </a>
  
    <nav class="md-nav" aria-label="Flashing Binaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-initial-rsu-image-to-qspi" class="md-nav__link">
    Writing Initial RSU Image to QSPI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-the-sd-card-image" class="md-nav__link">
    Writing the SD Card Image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercising-u-boot-rsu-commands" class="md-nav__link">
    Exercising U-Boot RSU Commands
  </a>
  
    <nav class="md-nav" aria-label="Exercising U-Boot RSU Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-rsu-operations" class="md-nav__link">
    Basic RSU Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#watchdog-and-max-retry-operation" class="md-nav__link">
    Watchdog and Max Retry Operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-the-factory-image" class="md-nav__link">
    Updating the Factory Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-on-flash-corruption-of-application-images" class="md-nav__link">
    Fallback on Flash Corruption of Application Images
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-flash-corruption-detection-and-recovery" class="md-nav__link">
    Additional Flash Corruption Detection and Recovery
  </a>
  
    <nav class="md-nav" aria-label="Additional Flash Corruption Detection and Recovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corrupted-decision-firmware" class="md-nav__link">
    Corrupted Decision Firmware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-decision-firmware-data" class="md-nav__link">
    Corrupted Decision Firmware Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-configuration-pointer-block" class="md-nav__link">
    Corrupted Configuration Pointer Block
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-sub-partition-table" class="md-nav__link">
    Corrupted Sub-Partition Table
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-combined-application-image" class="md-nav__link">
    Using the Combined Application Image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercising-rsu-client" class="md-nav__link">
    Exercising RSU Client
  </a>
  
    <nav class="md-nav" aria-label="Exercising RSU Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-rsu-operations_1" class="md-nav__link">
    Basic RSU Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#watchdog-and-max-retry-operation_1" class="md-nav__link">
    Watchdog and Max Retry Operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-the-factory-image_1" class="md-nav__link">
    Updating the Factory Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-on-flash-corruption-of-application-images_1" class="md-nav__link">
    Fallback on Flash Corruption of Application Images
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-flash-corruption-detection-and-recovery_1" class="md-nav__link">
    Additional Flash Corruption Detection and Recovery
  </a>
  
    <nav class="md-nav" aria-label="Additional Flash Corruption Detection and Recovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corrupted-decision-firmware_1" class="md-nav__link">
    Corrupted Decision Firmware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-decision-firmware-data_1" class="md-nav__link">
    Corrupted Decision Firmware Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-configuration-pointer-block_1" class="md-nav__link">
    Corrupted Configuration Pointer Block
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-sub-partition-table_1" class="md-nav__link">
    Corrupted Sub-Partition Table
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-separate-ssbl-per-bitstream" class="md-nav__link">
    Using Separate SSBL Per Bitstream
  </a>
  
    <nav class="md-nav" aria-label="Using Separate SSBL Per Bitstream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-u-boot-for-separate-u-boot-images" class="md-nav__link">
    Configuring U-Boot for Separate U-Boot Images
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storing-u-boot-images-on-sd-card" class="md-nav__link">
    Storing U-Boot Images on SD Card
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storing-u-boot-images-in-qspi" class="md-nav__link">
    Storing U-Boot Images in QSPI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2_2" id="__nav_6_2_2_label" tabindex="0">
          E-Series Modular Development Kit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2_2">
          <span class="md-nav__icon md-icon"></span>
          E-Series Modular Development Kit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../modular/gsrd/ug-gsrd-agx5e-modular/" class="md-nav__link">
        GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../modular/boot-examples/ug-linux-boot-agx5e-modular/" class="md-nav__link">
        GHRD Linux Boot Examples
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_3" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2_3" id="__nav_6_2_3_label" tabindex="0">
          Intel Simics Virtual Platform Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2_3">
          <span class="md-nav__icon md-icon"></span>
          Intel Simics Virtual Platform Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/virtual-platforms/linux-gsrd/ug-linux-gsrd-agilex5-virtual-platforms/" class="md-nav__link">
        Linux GSRD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/virtual-platforms/zephyr-gsrd/ug-zephyr-gsrd-agilex5-virtual-platforms/" class="md-nav__link">
        Zephyr GSRD
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
          Agilex™ 7
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Agilex™ 7
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_3_1" id="__nav_6_3_1_label" tabindex="0">
          F-Series SoC Development Kit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3_1">
          <span class="md-nav__icon md-icon"></span>
          F-Series SoC Development Kit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/gsrd/ug-gsrd-agx7f-soc/" class="md-nav__link">
        GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/rsu/ug-rsu-agx7f-soc/" class="md-nav__link">
        SoC HPS Remote System Update Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/rsu/ug-rsu-multiqspi-agx7f-soc/" class="md-nav__link">
        SoC HPS Multi-QSPI Remote System Update Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/remote-debug/ug-remote-debug-agx7f-soc/" class="md-nav__link">
        SoC FPGA Remote Debug Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/emmc/ug-emmc-agx7f-soc/" class="md-nav__link">
        HPS eMMC Boot Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/fabric-config/ug-linux-fabric-config-agx7f-soc/" class="md-nav__link">
        SoC Fabric Configuration from Linux Example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_2" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_3_2" id="__nav_6_3_2_label" tabindex="0">
          I-Series FPGA Development Kit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3_2">
          <span class="md-nav__icon md-icon"></span>
          I-Series FPGA Development Kit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/i-series/soc/gsrd/ug-gsrd-agx7i-soc/" class="md-nav__link">
        GSRD User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_3" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_3_3" id="__nav_6_3_3_label" tabindex="0">
          M-Series HBM2e Development Kit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3_3">
          <span class="md-nav__icon md-icon"></span>
          M-Series HBM2e Development Kit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/m-series/hbm2e/ug-gsrd-agx7m-hbm2e/" class="md-nav__link">
        GSRD User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
          Stratix® 10
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          Stratix® 10
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_4_1" id="__nav_6_4_1_label" tabindex="0">
          SX SoC Development Kit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_1">
          <span class="md-nav__icon md-icon"></span>
          SX SoC Development Kit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stratix-10/sx/soc/gsrd/ug-gsrd-s10sx-soc/" class="md-nav__link">
        GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stratix-10/sx/soc/rsu/ug-rsu-s10sx-soc/" class="md-nav__link">
        SoC HPS Remote System Update Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stratix-10/sx/soc/remote-debug/ug-remote-debug-s10sx-soc/" class="md-nav__link">
        SoC FPGA Remote Debug Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stratix-10/sx/soc/emmc/ug-emmc-s10sx-soc/" class="md-nav__link">
        HPS eMMC Boot Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stratix-10/sx/soc/fabric-config/ug-linux-fabric-config-s10sx-soc/" class="md-nav__link">
        SoC Fabric Configuration from Linux Example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Demos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Demos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../ed-demo-list/demo-list/" class="md-nav__link">
        Summary
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
          Agilex™ 5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Agilex™ 5
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_2_1" id="__nav_7_2_1_label" tabindex="0">
          E-Series Premium Development Kit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2_1">
          <span class="md-nav__icon md-icon"></span>
          E-Series Premium Development Kit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../baremetal-embedded/agilex-5/e-series/premium/ug-baremetal-agx5e-premium/" class="md-nav__link">
        Baremetal Hello World Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/altera-fpga/agilex5-demo-hps2fpga-interfaces/blob/main/documentation/01_index.md" class="md-nav__link">
        Third Party Boards - HPS-FPGA Interfaces Demos User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    Intro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#component-versions" class="md-nav__link">
    Component Versions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-binaries" class="md-nav__link">
    Building Binaries
  </a>
  
    <nav class="md-nav" aria-label="Building Binaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-cmake" class="md-nav__link">
    Installing cmake
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-the-environment" class="md-nav__link">
    Setting up the Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-hardware-projects" class="md-nav__link">
    Building the Hardware Projects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-arm-trusted-firmware" class="md-nav__link">
    Building Arm Trusted Firmware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-u-boot" class="md-nav__link">
    Building U-Boot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-linux" class="md-nav__link">
    Building Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-initial-flash-image" class="md-nav__link">
    Creating the Initial Flash Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-application-image" class="md-nav__link">
    Creating the Application Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-factory-update-image" class="md-nav__link">
    Creating the Factory Update Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-decision-firmware-update-image" class="md-nav__link">
    Creating the Decision Firmware Update Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-combined-application-image" class="md-nav__link">
    Creating the Combined Application Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-root-file-system" class="md-nav__link">
    Building the Root File System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-zlib" class="md-nav__link">
    Building ZLIB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-librsu-and-rsu-client" class="md-nav__link">
    Building LIBRSU and RSU Client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-sd-card" class="md-nav__link">
    Building the SD Card
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flashing-binaries" class="md-nav__link">
    Flashing Binaries
  </a>
  
    <nav class="md-nav" aria-label="Flashing Binaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-initial-rsu-image-to-qspi" class="md-nav__link">
    Writing Initial RSU Image to QSPI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-the-sd-card-image" class="md-nav__link">
    Writing the SD Card Image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercising-u-boot-rsu-commands" class="md-nav__link">
    Exercising U-Boot RSU Commands
  </a>
  
    <nav class="md-nav" aria-label="Exercising U-Boot RSU Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-rsu-operations" class="md-nav__link">
    Basic RSU Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#watchdog-and-max-retry-operation" class="md-nav__link">
    Watchdog and Max Retry Operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-the-factory-image" class="md-nav__link">
    Updating the Factory Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-on-flash-corruption-of-application-images" class="md-nav__link">
    Fallback on Flash Corruption of Application Images
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-flash-corruption-detection-and-recovery" class="md-nav__link">
    Additional Flash Corruption Detection and Recovery
  </a>
  
    <nav class="md-nav" aria-label="Additional Flash Corruption Detection and Recovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corrupted-decision-firmware" class="md-nav__link">
    Corrupted Decision Firmware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-decision-firmware-data" class="md-nav__link">
    Corrupted Decision Firmware Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-configuration-pointer-block" class="md-nav__link">
    Corrupted Configuration Pointer Block
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-sub-partition-table" class="md-nav__link">
    Corrupted Sub-Partition Table
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-combined-application-image" class="md-nav__link">
    Using the Combined Application Image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercising-rsu-client" class="md-nav__link">
    Exercising RSU Client
  </a>
  
    <nav class="md-nav" aria-label="Exercising RSU Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-rsu-operations_1" class="md-nav__link">
    Basic RSU Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#watchdog-and-max-retry-operation_1" class="md-nav__link">
    Watchdog and Max Retry Operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-the-factory-image_1" class="md-nav__link">
    Updating the Factory Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-on-flash-corruption-of-application-images_1" class="md-nav__link">
    Fallback on Flash Corruption of Application Images
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-flash-corruption-detection-and-recovery_1" class="md-nav__link">
    Additional Flash Corruption Detection and Recovery
  </a>
  
    <nav class="md-nav" aria-label="Additional Flash Corruption Detection and Recovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corrupted-decision-firmware_1" class="md-nav__link">
    Corrupted Decision Firmware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-decision-firmware-data_1" class="md-nav__link">
    Corrupted Decision Firmware Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-configuration-pointer-block_1" class="md-nav__link">
    Corrupted Configuration Pointer Block
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corrupted-sub-partition-table_1" class="md-nav__link">
    Corrupted Sub-Partition Table
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-separate-ssbl-per-bitstream" class="md-nav__link">
    Using Separate SSBL Per Bitstream
  </a>
  
    <nav class="md-nav" aria-label="Using Separate SSBL Per Bitstream">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-u-boot-for-separate-u-boot-images" class="md-nav__link">
    Configuring U-Boot for Separate U-Boot Images
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storing-u-boot-images-on-sd-card" class="md-nav__link">
    Storing U-Boot Images on SD Card
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storing-u-boot-images-in-qspi" class="md-nav__link">
    Storing U-Boot Images in QSPI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>SoC HPS Remote System Update Example</h1>

<h2 id="intro">Intro<a class="headerlink" href="#intro" title="Permanent link">&para;</a></h2>
<p>This page presents a complete Remote System Update example, running on the Agilex™ 5 E-Series Premium Development Kit (DK-A5E065BB32AES1), including the following.</p>
<ul>
<li>Creating the initial flash image containing the following components.<ul>
<li>Bitstreams for a factory image </li>
<li>One application image </li>
<li>Two empty slots to contain additional application images </li>
</ul>
</li>
<li>Creating an SD card with the following components.<ul>
<li>U-Boot </li>
<li>Arm* Trusted Firmware </li>
<li>Linux </li>
<li>LIBRSU </li>
<li>RSU client </li>
<li>Application image </li>
<li>Factory update image </li>
<li>Decision firmware update image </li>
<li>Combined application image </li>
</ul>
</li>
<li>Exercising the Linux RSU client application. </li>
<li>Exercising the U-Boot RSU commands. </li>
</ul>
<p>At the moment, the Agilex™ 5 Hard Processor System Remote System Update User Guide is not availabe but you can refer to the  <a href="https://www.intel.com/content/www/us/en/docs/programmable/683184/current/overview-s10-fm.html">Agilex™ 7 Hard Processor System Remote System Update User Guide</a> for details about the Remote System Update. </p>
<h2 id="component-versions">Component Versions<a class="headerlink" href="#component-versions" title="Permanent link">&para;</a></h2>
<p><strong>Note:</strong> RSU functionality is first fully enabled in U-Boot in 24.3 release, while Linux functionality is enabled starting on 24.2 release.</p>
<p>This example was created with Quartus<sup>&reg;</sup> Prime Pro Edition Version 24.3 and the following component versions.</p>
<table>
<thead>
<tr>
<th align="left">Repository</th>
<th align="left">Branch/Tag</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a href="https://github.com/altera-opensource/ghrd-socfpga">ghrd-socfpga</a></td>
<td align="left">QPDS24.3_REL_GSRD_PR</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/altera-opensource/linux-socfpga">linux-socfpga</a></td>
<td align="left">socfpga-6.6.37-lts/QPDS24.3_REL_GSRD_PR</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/altera-opensource/arm-trusted-firmware">arm-trusted-firmware</a></td>
<td align="left">socfpga_v2.11.0/QPDS24.3_REL_GSRD_PR</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/altera-opensource/u-boot-socfpga">u-boot-socfpga</a></td>
<td align="left">socfpga_v2024.04/QPDS24.3_REL_GSRD_PR</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/altera-opensource/librsu/">librsu</a></td>
<td align="left">master</td>
</tr>
</tbody>
</table>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>The following items are required to run the RSU example.</p>
<ul>
<li>Host PC running Ubuntu 22.04 LTS (other Linux versions may work too) </li>
<li>Minimum 48 GB of RAM, required for compiling the hardware designs </li>
<li>Quartus<sup>&reg;</sup> Prime Pro Edition Version 24.3  for compiling the hardware projects, generating the flash images and writing to flash </li>
<li>cmake/3.24.0  (build configuration tool) or or above to build LibRSU library.</li>
<li>Access to Internet to download the hardware project archive, clone the git trees for U-Boot, Arm Trusted Firmware, Linux, zlib and LIBRSU and to build the Linux rootfs using Yocto. </li>
<li><a href="https://www.intel.com/content/www/us/en/products/details/fpga/development-kits/agilex/a5e065b-premium.html">Agilex™ 5 E-Series Premium Development Kit (DK-A5E065BB32AES1)</a>  for running the example. </li>
</ul>
<h2 id="building-binaries">Building Binaries<a class="headerlink" href="#building-binaries" title="Permanent link">&para;</a></h2>
<p>The diagram below illustrates the build flow used for this example.</p>
<p><a class="glightbox" href="../images/rsu-build-flow.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/rsu-build-flow.svg" /></a> </p>
<p>The end results of the build flow are these.</p>
<ul>
<li>Initial flash image: contains the factory image, an application image and two empty application image partitions aka slots. </li>
<li>SD card image: contains SSBL (U-Boot), ATF (Arm Trusted Firmware), Linux device tree, Linux kernel, Linux rootfs with the Intel RSU driver, LIBRSU, RSU Client, an application image, a factory update image and a decision firmware update image. </li>
</ul>
<p><strong>Note:</strong> To build binaries for a different development kit than the one used in this page, please refer to the <a href="#building-the-hardware-projects">Building the Hardware Projects</a> section in the corresponding  GSRD page for that development kit, which is the section that may differ from the instructions presented here.</p>
<h3 id="installing-cmake">Installing cmake<a class="headerlink" href="#installing-cmake" title="Permanent link">&para;</a></h3>
<p>In case that you have installed a cmake version earlier than 3.24.0, you need to unistall this and install a new version. Here are the steps to achieve that. Note that this only need to performed once in your PC:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>remove<span class="w"> </span>cmake
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>Download<span class="w"> </span>cmake-x.y.z-linux-x86_64.sh<span class="w"> </span>from<span class="w"> </span>https://cmake.org/download
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>sudo<span class="w"> </span>cp<span class="w"> </span>~/Downloads/cmake-x.y.z-linux-x86_64.sh<span class="w"> </span>/opt/
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>sudo<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>/opt/cmake-x.y.z-linux-x86_64.sh
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>mkdir<span class="w"> </span>~/cmake_install/<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/cmake_install/
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>sudo<span class="w"> </span>bash<span class="w"> </span>/opt/cmake-x.y.z-linux-x86_64.sh
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>~/cmake_install/cmake-x.y.z-linux-x86_64/bin/*<span class="w"> </span>/usr/local/bin/
</code></pre></div>
<h3 id="setting-up-the-environment">Setting up the Environment<a class="headerlink" href="#setting-up-the-environment" title="Permanent link">&para;</a></h3>
<p>Create a top folder to store the example files.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>agilex5-rsu<span class="w"> </span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>mkdir<span class="w"> </span>agilex5-rsu<span class="w"> </span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nb">cd</span><span class="w"> </span>agilex5-rsu<span class="w"> </span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="nb">export</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">TOP_FOLDER</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span><span class="w"> </span>
</code></pre></div>
<p>Download the compiler toolchain, add it to the PATH variable, to be used by the GHRD makefile to build the HPS Debug FSBL:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>wget<span class="w"> </span>https://developer.arm.com/-/media/Files/downloads/gnu/11.2-2022.02/binrel/<span class="se">\</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>gcc-arm-11.2-2022.02-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>tar<span class="w"> </span>xf<span class="w"> </span>gcc-arm-11.2-2022.02-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>rm<span class="w"> </span>-f<span class="w"> </span>gcc-arm-11.2-2022.02-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/gcc-arm-11.2-2022.02-x86_64-aarch64-none-linux-gnu/bin:<span class="nv">$PATH</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ARCH</span><span class="o">=</span>arm64
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CROSS_COMPILE</span><span class="o">=</span>aarch64-none-linux-gnu-
</code></pre></div>
<p>Enable Quartus tools to be called from command line:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_ROOTDIR</span><span class="o">=</span>~/intelFPGA_pro/24.3/quartus/
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/bin:<span class="nv">$QUARTUS_ROOTDIR</span>/linux64:<span class="nv">$QUARTUS_ROOTDIR</span>/../qsys/bin:<span class="nv">$PATH</span>
</code></pre></div>
<h3 id="building-the-hardware-projects">Building the Hardware Projects<a class="headerlink" href="#building-the-hardware-projects" title="Permanent link">&para;</a></h3>
<p>Create four different hardware projects, based on the GHRD from GitHub with a few changes listed next.</p>
<ul>
<li>Change the boot mode to FPGA first </li>
<li>Use a different ID in the SystemID component, to make the binaries for each project slightly different. </li>
<li>Change the behavior of watchdog timeout, to trigger an RSU event. </li>
<li>Set the max retry parameter to 3, so that each application image and the factory image are tried up to three time when configuration failures occur. </li>
</ul>
<p>The commands to create and compile the projects are listed below.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1"># compile hardware designs: 0-factory, 1,2-applications, 3-factory update </span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>rm<span class="w"> </span>-rf<span class="w"> </span>hw<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>hw<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>hw<span class="w"> </span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>QPDS24.3_REL_GSRD_PR<span class="w"> </span>https://github.com/altera-opensource/ghrd-socfpga<span class="w"> </span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>mv<span class="w"> </span>ghrd-socfpga/agilex5_soc_devkit_ghrd<span class="w"> </span>.<span class="w"> </span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>rm<span class="w"> </span>-rf<span class="w"> </span>ghrd-socfpga<span class="w"> </span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="k">for</span><span class="w"> </span>version<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">0</span>..3<span class="o">}</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="k">do</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>rm<span class="w"> </span>-rf<span class="w"> </span>ghrd.<span class="nv">$version</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>cp<span class="w"> </span>-r<span class="w"> </span>agilex5_soc_devkit_ghrd<span class="w"> </span>ghrd.<span class="nv">$version</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="nb">cd</span><span class="w"> </span>ghrd.<span class="nv">$version</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="c1"># update sysid to make binaries slightly different</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/0xACD5CAFE/0xABAB000&#39;</span><span class="nv">$version</span><span class="s1">&#39;/g&#39;</span><span class="w"> </span>construct_subsys_peripheral.tcl
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>make<span class="w"> </span>config
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="c1"># Select FPGA Boot first, Enable WDT, Configure WDT to trigger cold reset + RSU on expiration</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>make<span class="w"> </span><span class="nv">DEVICE</span><span class="o">=</span>A5ED065BB32AE6SR0<span class="w"> </span><span class="nv">HPS_EMIF_MEM_CLK_FREQ_MHZ</span><span class="o">=</span><span class="m">800</span><span class="w"> </span><span class="nv">HPS_EMIF_REF_CLK_FREQ_MHZ</span><span class="o">=</span><span class="m">100</span><span class="w"> </span><span class="nv">INITIALIZATION_FIRST</span><span class="o">=</span>fpga<span class="w"> </span><span class="nv">RESET_WATCHDOG_EN</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">RESET_SDM_WATCHDOG_CFG</span><span class="o">=</span><span class="m">2</span><span class="w"> </span>generate_from_tcl
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="c1"># Set to 3 the WDT retry counter to trigger a RSU</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;set_global_assignment -name RSU_MAX_RETRY_COUNT 3&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>ghrd_a5ed065bb32ae6sr0.qsf
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>make<span class="w"> </span>sof
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="nb">cd</span><span class="w"> </span>..<span class="w"> </span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="k">done</span><span class="w"> </span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>rm<span class="w"> </span>-rf<span class="w"> </span>agilex5_soc_devkit_ghrd<span class="w"> </span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="nb">cd</span><span class="w"> </span>..<span class="w"> </span>
</code></pre></div>
<p>After completing the above steps, the following SOF files are created.</p>
<ul>
<li>$TOP_FOLDER/hw/ghrd.0/output_files/ghrd_a5ed065bb32ae6sr0.sof </li>
<li>$TOP_FOLDER/hw/ghrd.1/output_files/ghrd_a5ed065bb32ae6sr0.sof </li>
<li>$TOP_FOLDER/hw/ghrd.2/output_files/ghrd_a5ed065bb32ae6sr0.sof </li>
<li>$TOP_FOLDER/hw/ghrd.3/output_files/ghrd_a5ed065bb32ae6sr0.sof </li>
</ul>
<h3 id="building-arm-trusted-firmware">Building Arm Trusted Firmware<a class="headerlink" href="#building-arm-trusted-firmware" title="Permanent link">&para;</a></h3>
<p>The following commands are used to retrieve the Arm Trusted Firmware (ATF) and compile it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>arm-trusted-firmware
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/altera-opensource/arm-trusted-firmware
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nb">cd</span><span class="w"> </span>arm-trusted-firmware
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="c1"># checkout the branch used for this document, comment out to use default</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-t<span class="w"> </span>origin/socfpga_v2.11.0
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>make<span class="w"> </span>-j<span class="w"> </span><span class="m">48</span><span class="w"> </span><span class="nv">PLAT</span><span class="o">=</span>agilex5<span class="w"> </span>bl31
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>
<p>After completing the above steps, the Arm Trusted Firmware binary file is created and is located here.</p>
<ul>
<li>$TOP_FOLDER/arm-trusted-firmware/build/agilex5/release/bl31.bin </li>
</ul>
<h3 id="building-u-boot">Building U-Boot<a class="headerlink" href="#building-u-boot" title="Permanent link">&para;</a></h3>
<p>The following commands can be used to get the U-Boot source code and compile it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>u-boot-socfpga<span class="w"> </span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/altera-opensource/u-boot-socfpga<span class="w"> </span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nb">cd</span><span class="w"> </span>u-boot-socfpga<span class="w"> </span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1"># comment out next line to use the latest default branch </span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-t<span class="w"> </span>origin/socfpga_v2024.04<span class="w"> </span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="c1"># enable dwarf4 debug info, for compatibility with arm ds</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/PLATFORM_CPPFLAGS += -D__ARM__/PLATFORM_CPPFLAGS += -D__ARM__ -gdwarf-4/g&#39;</span><span class="w"> </span>arch/arm/config.mk
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="c1"># only boot from SD, do not try QSPI and NAND</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/u-boot,spl-boot-order.*/u-boot\,spl-boot-order = \&amp;mmc;/g&#39;</span><span class="w"> </span>arch/arm/dts/socfpga_agilex5_socdk-u-boot.dtsi
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="c1"># disable NAND in the device tree</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/&amp;nand {/!b;n;c\\tstatus = &quot;disabled&quot;;&#39;</span><span class="w"> </span>arch/arm/dts/socfpga_agilex5_socdk-u-boot.dtsi
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="c1"># use &#39;Image&#39; for kernel image instead of &#39;kernel.itb&#39; </span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/kernel\.itb/Image/g&#39;</span><span class="w"> </span>arch/arm/Kconfig
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="c1">## Fix to report FSBL state to SDM HSD: 14023897270</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/mbox_init();/d&#39;</span><span class="w"> </span>arch/arm/mach-socfpga/spl_agilex5.c
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/timer_init();/a\\tmbox_init();\n\tmbox_hps_stage_notify(HPS_EXECUTION_STATE_FSBL);&#39;</span><span class="w"> </span>arch/arm/mach-socfpga/spl_agilex5.c
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="c1"># Need fix in arch/arm/mach-socfpga/smc_api.c from HSD:14023661564  </span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/flush_dcache_range/s/arg + len/(arg + len)/g&#39;</span><span class="w"> </span>arch/arm/mach-socfpga/smc_api.c
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/flush_dcache_range/s/resp_buf + \*resp_buf_len/(resp_buf + \*resp_buf_len)/g&#39;</span><span class="w"> </span>arch/arm/mach-socfpga/smc_api.c
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/flush_dcache_range/s/(u64)/(uintptr_t)/g&#39;</span><span class="w"> </span>arch/arm/mach-socfpga/smc_api.c
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/if (ret == INTEL_SIP_SMC_STATUS_OK &amp;&amp;/a \\t\tinvalidate_dcache_range((uintptr_t)resp_buf, (uintptr_t)(resp_buf + \*resp_buf_len));&#39;</span><span class="w"> </span>arch/arm/mach-socfpga/smc_api.c<span class="w"> </span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="c1"># link to atf</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>ln<span class="w"> </span>-s<span class="w"> </span>../arm-trusted-firmware/build/agilex5/release/bl31.bin<span class="w"> </span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="c1"># create configuration custom file. </span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; config-fragment</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="s"># disable NAND/UBI related settings from defconfig. </span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="s">CONFIG_NAND_BOOT=n</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="s">CONFIG_SPL_NAND_SUPPORT=n</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="s">CONFIG_CMD_NAND_TRIMFFS=n</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="s">CONFIG_CMD_NAND_LOCK_UNLOCK=n</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="s">CONFIG_NAND_DENALI_DT=n</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="s">CONFIG_SYS_NAND_U_BOOT_LOCATIONS=n</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="s">CONFIG_SPL_NAND_FRAMEWORK=n</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="s">CONFIG_CMD_NAND=n</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="s">CONFIG_MTD_RAW_NAND=n</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="s">CONFIG_CMD_UBI=n</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="s">CONFIG_CMD_UBIFS=n</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="s">CONFIG_MTD_UBI=n</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="s">CONFIG_ENV_IS_IN_UBI=n</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="s">CONFIG_UBI_SILENCE_MSG=n</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="s">CONFIG_UBIFS_SILENCE_MSG=n</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="s"># disable distroboot and use specific boot command. </span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="s">CONFIG_DISTRO_DEFAULTS=n</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="s">CONFIG_HUSH_PARSER=y</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="s">CONFIG_SYS_PROMPT_HUSH_PS2=&quot;&gt; &quot;</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="s"># Enabling Watchdog automatically if it&#39;s not done already</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="s">CONFIG_WATCHDOG_AUTOSTART=y</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="s">CONFIG_USE_BOOTCOMMAND=y</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="s">CONFIG_BOOTCOMMAND=&quot;bridge enable; mmc rescan; run mmcload; run linux_qspi_enable; run rsu_status; setenv bootargs console=ttyS0,115200 root=${mmcroot} rw rootwait;run mmcboot&quot;</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="s">CONFIG_CMD_FAT=y</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="s">CONFIG_CMD_FS_GENERIC=y</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="s">CONFIG_DOS_PARTITION=y</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="s">CONFIG_SPL_DOS_PARTITION=y</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="s">CONFIG_CMD_PART=y</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="s">CONFIG_SPL_CRC32=y</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="s">CONFIG_LZO=y</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="s">CONFIG_CMD_DHCP=y</span>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="s"># enable more QSPI flash manufacturers</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a><span class="s">CONFIG_SPI_FLASH_MACRONIX=y</span>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a><span class="s">CONFIG_SPI_FLASH_GIGADEVICE=y</span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a><span class="s">CONFIG_SPI_FLASH_WINBOND=y</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="s">CONFIG_SPI_FLASH_ISSI=y</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a><span class="s">CONFIG_SYS_PROMPT=&quot;SOCFPGA # &quot;</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="s">EOF</span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="c1"># build U-Boot</span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a>make<span class="w"> </span>clean<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>mrproper
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a>make<span class="w"> </span>socfpga_agilex5_defconfig<span class="w"> </span>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a><span class="c1"># use created custom configuration file to merge with the default configuration obtained in .config file. </span>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a>./scripts/kconfig/merge_config.sh<span class="w"> </span>-O<span class="w"> </span>.<span class="w"> </span>-m<span class="w"> </span>.config<span class="w"> </span>config-fragment
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a>make<span class="w"> </span>-j<span class="w"> </span><span class="m">64</span>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a><span class="nb">cd</span><span class="w"> </span>..<span class="w"> </span>
</code></pre></div>
<p>After completing the above steps, the following files are created.</p>
<ul>
<li>$TOP_FOLDER/u-boot-socfpga/spl/u-boot-spl-dtb.hex - FSBL (U-boot SPL) hex file </li>
<li>$TOP_FOLDER/u-boot-socfpga/u-boot.itb - FIT image file containing SSBL (U-Boot) and ATF (Arm Trusted Firmware) binaries </li>
</ul>
<h3 id="building-linux">Building Linux<a class="headerlink" href="#building-linux" title="Permanent link">&para;</a></h3>
<p>The following commands can be used to obtain the Linux source code and build Linux.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>linux-socfpga<span class="w"> </span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/altera-opensource/linux-socfpga<span class="w"> </span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="nb">cd</span><span class="w"> </span>linux-socfpga<span class="w"> </span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="c1"># checkout the branch used for this document, comment out to use default </span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-t<span class="w"> </span>origin/socfpga-6.6.37-lts<span class="w"> </span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="c1"># configure the RSU driver to be built into the kernel </span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>make<span class="w"> </span>clean<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>mrproper<span class="w"> </span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>make<span class="w"> </span>defconfig<span class="w"> </span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>./scripts/config<span class="w"> </span>--set-val<span class="w"> </span>CONFIG_INTEL_STRATIX10_RSU<span class="w"> </span>y<span class="w"> </span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>make<span class="w"> </span>oldconfig<span class="w"> </span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>make<span class="w"> </span>-j<span class="w"> </span><span class="m">64</span><span class="w"> </span>Image<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>intel/socfpga_agilex5_socdk.dtb<span class="w"> </span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="nb">cd</span><span class="w"> </span>..<span class="w"> </span>
</code></pre></div>
<p>After completing the above steps, the following files are created.</p>
<ul>
<li>$TOP_FOLDER/linux-socfpga/arch/arm64/boot/Image - kernel image </li>
<li>$TOP_FOLDER/linux-socfpga/arch/arm64/boot/dts/intel/socfpga_agilex5_socdk.dtb - kernel device tree </li>
</ul>
<h3 id="creating-the-initial-flash-image">Creating the Initial Flash Image<a class="headerlink" href="#creating-the-initial-flash-image" title="Permanent link">&para;</a></h3>
<p>This section presents detailed instructions on how to create the initial flash image, by using the Programming File Generator. </p>
<p>For reference, an example of the  Programming File Generator configuration file is being included in this page. You can see it below. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">&lt;pfg</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="nt">&lt;settings</span><span class="w"> </span><span class="na">custom_db_dir=</span><span class="s">&quot;./&quot;</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;ASX4&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="nt">&lt;output_files&gt;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">        </span><span class="nt">&lt;output_file</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;initial_image&quot;</span><span class="w"> </span><span class="na">directory=</span><span class="s">&quot;./&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;JIC&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">            </span><span class="nt">&lt;file_options/&gt;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">            </span><span class="nt">&lt;secondary_file</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;MAP&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;initial_image_jic&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">                </span><span class="nt">&lt;file_options/&gt;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">            </span><span class="nt">&lt;/secondary_file&gt;</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">            </span><span class="nt">&lt;secondary_file</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;SEC_RPD&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;initial_image_jic&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">                </span><span class="nt">&lt;file_options/&gt;</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">            </span><span class="nt">&lt;/secondary_file&gt;</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">            </span><span class="nt">&lt;flash_device_id&gt;</span>Flash_Device_1<span class="nt">&lt;/flash_device_id&gt;</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">        </span><span class="nt">&lt;/output_file&gt;</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">    </span><span class="nt">&lt;/output_files&gt;</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">    </span><span class="nt">&lt;bitstreams&gt;</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">        </span><span class="nt">&lt;bitstream</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;Bitstream_1&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">            </span><span class="nt">&lt;path</span><span class="w"> </span><span class="na">signing=</span><span class="s">&quot;OFF&quot;</span><span class="w"> </span><span class="na">finalize_encryption=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">hps_path=</span><span class="s">&quot;./u-boot-socfpga/spl/u-boot-spl-dtb.hex&quot;</span><span class="nt">&gt;</span>./hw/ghrd.0/output_files/ghrd_a5ed065bb32ae6sr0.sof<span class="nt">&lt;/path&gt;</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">        </span><span class="nt">&lt;/bitstream&gt;</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">        </span><span class="nt">&lt;bitstream</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;Bitstream_2&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">            </span><span class="nt">&lt;path</span><span class="w"> </span><span class="na">signing=</span><span class="s">&quot;OFF&quot;</span><span class="w"> </span><span class="na">finalize_encryption=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">hps_path=</span><span class="s">&quot;./u-boot-socfpga/spl/u-boot-spl-dtb.hex&quot;</span><span class="nt">&gt;</span>./hw/ghrd.1/output_files/ghrd_a5ed065bb32ae6sr0.sof<span class="nt">&lt;/path&gt;</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">        </span><span class="nt">&lt;/bitstream&gt;</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">    </span><span class="nt">&lt;/bitstreams&gt;</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">    </span><span class="nt">&lt;flash_devices&gt;</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">        </span><span class="nt">&lt;flash_loader&gt;</span>A5ED065BB32AR0<span class="nt">&lt;/flash_loader&gt;</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">        </span><span class="nt">&lt;flash_device</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;QSPI02G&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;Flash_Device_1&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">            </span><span class="nt">&lt;partition</span><span class="w"> </span><span class="na">reserved=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">fixed_s_addr=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">s_addr=</span><span class="s">&quot;0x00000000&quot;</span><span class="w"> </span><span class="na">e_addr=</span><span class="s">&quot;0x0020FFFF&quot;</span><span class="w"> </span><span class="na">fixed_e_addr=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;BOOT_INFO&quot;</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">            </span><span class="nt">&lt;partition</span><span class="w"> </span><span class="na">reserved=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">extra_space=</span><span class="s">&quot;262144&quot;</span><span class="w"> </span><span class="na">fixed_s_addr=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">s_addr=</span><span class="s">&quot;0x00210000&quot;</span><span class="w"> </span><span class="na">e_addr=</span><span class="s">&quot;0x0090FFFF&quot;</span><span class="w"> </span><span class="na">fixed_e_addr=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;FACTORY_IMAGE&quot;</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">            </span><span class="nt">&lt;partition</span><span class="w"> </span><span class="na">reserved=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">fixed_s_addr=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">s_addr=</span><span class="s">&quot;auto&quot;</span><span class="w"> </span><span class="na">e_addr=</span><span class="s">&quot;auto&quot;</span><span class="w"> </span><span class="na">fixed_e_addr=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;SPT0&quot;</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;65536&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">            </span><span class="nt">&lt;partition</span><span class="w"> </span><span class="na">reserved=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">fixed_s_addr=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">s_addr=</span><span class="s">&quot;auto&quot;</span><span class="w"> </span><span class="na">e_addr=</span><span class="s">&quot;auto&quot;</span><span class="w"> </span><span class="na">fixed_e_addr=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;SPT1&quot;</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;65536&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">            </span><span class="nt">&lt;partition</span><span class="w"> </span><span class="na">reserved=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">fixed_s_addr=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">s_addr=</span><span class="s">&quot;auto&quot;</span><span class="w"> </span><span class="na">e_addr=</span><span class="s">&quot;auto&quot;</span><span class="w"> </span><span class="na">fixed_e_addr=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CPB0&quot;</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;65536&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">            </span><span class="nt">&lt;partition</span><span class="w"> </span><span class="na">reserved=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">fixed_s_addr=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">s_addr=</span><span class="s">&quot;auto&quot;</span><span class="w"> </span><span class="na">e_addr=</span><span class="s">&quot;auto&quot;</span><span class="w"> </span><span class="na">fixed_e_addr=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;CPB1&quot;</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;65536&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">            </span><span class="nt">&lt;partition</span><span class="w"> </span><span class="na">reserved=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">fixed_s_addr=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">s_addr=</span><span class="s">&quot;0x01000000&quot;</span><span class="w"> </span><span class="na">e_addr=</span><span class="s">&quot;0x01FFFFFF&quot;</span><span class="w"> </span><span class="na">fixed_e_addr=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;P1&quot;</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">            </span><span class="nt">&lt;partition</span><span class="w"> </span><span class="na">reserved=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">fixed_s_addr=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">s_addr=</span><span class="s">&quot;0x02000000&quot;</span><span class="w"> </span><span class="na">e_addr=</span><span class="s">&quot;0x02FFFFFF&quot;</span><span class="w"> </span><span class="na">fixed_e_addr=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;P2&quot;</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">            </span><span class="nt">&lt;partition</span><span class="w"> </span><span class="na">reserved=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">fixed_s_addr=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">s_addr=</span><span class="s">&quot;0x03000000&quot;</span><span class="w"> </span><span class="na">e_addr=</span><span class="s">&quot;0x03FFFFFF&quot;</span><span class="w"> </span><span class="na">fixed_e_addr=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;P3&quot;</span><span class="w"> </span><span class="na">size=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">        </span><span class="nt">&lt;/flash_device&gt;</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">    </span><span class="nt">&lt;/flash_devices&gt;</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">    </span><span class="nt">&lt;assignments&gt;</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">        </span><span class="nt">&lt;assignment</span><span class="w"> </span><span class="na">page=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">partition_id=</span><span class="s">&quot;FACTORY_IMAGE&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">            </span><span class="nt">&lt;bitstream_id&gt;</span>Bitstream_1<span class="nt">&lt;/bitstream_id&gt;</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w">        </span><span class="nt">&lt;/assignment&gt;</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">        </span><span class="nt">&lt;assignment</span><span class="w"> </span><span class="na">page=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">partition_id=</span><span class="s">&quot;P1&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">            </span><span class="nt">&lt;bitstream_id&gt;</span>Bitstream_2<span class="nt">&lt;/bitstream_id&gt;</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="w">        </span><span class="nt">&lt;/assignment&gt;</span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="w">    </span><span class="nt">&lt;/assignments&gt;</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="nt">&lt;/pfg&gt;</span>
</code></pre></div>
<p>You can also downloaded and use it to generate the flash image by passing it to the Programming File Generator as shown below.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="c1"># Get the .pfg file</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>wget<span class="w"> </span>https://altera-fpga.github.io/rel-24.3/embedded-designs/agilex-5/e-series/premium/rsu/collateral/initial_image.pfg
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="c1"># Create Initial Image for previous release (in case needed to test  combined application)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>~/intelFPGA_pro/24.2/quartus/bin/quartus_pfg<span class="w"> </span>-c<span class="w"> </span>initial_image.pfg
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>mv<span class="w"> </span>initial_image.jic<span class="w"> </span>initial_image_prev.jic
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>mv<span class="w"> </span>initial_image_jic.rpd<span class="w"> </span>initial_image_jic_prev.rpd
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>mv<span class="w"> </span>initial_image_jic.map<span class="w"> </span>initial_image_jic_prev.map
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="c1"># Create Initial Image for this release</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>quartus_pfg<span class="w"> </span>-c<span class="w"> </span>initial_image.pfg<span class="w"> </span>
</code></pre></div>
<p>Here are the complete instructions on how to manually create the initial flash image, without relying on the provided Programming File Generator configuration file.</p>
<ol>
<li>
<p>Start the <strong>Programming File Generator</strong> tool by running the qpfgw command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>qpfgw<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Select the <strong>Device family</strong> as <strong>Agilex 5</strong>, and <strong>Configuration mode</strong> as <strong>Active Serial x4</strong>. </p>
</li>
<li>
<p>Change the <strong>Name</strong> to initial_image. </p>
</li>
<li>
<p>Select the output file type as <strong>JTAG Indirect Configuration File (. jic )</strong>, which is the format used by the Quartus Prime Programmer tool for writing to the QSPI flash. </p>
</li>
<li>
<p>Select the optional <strong>Memory Map File (.map )</strong> file so that it is also generated. The .map file contains information about the resulted flash layout. </p>
</li>
<li>
<p>Select the optional <strong>Raw Programming Data File (.rpd )</strong> file so that it is also generated. This file contains the binary flash content, without anything else added. </p>
<p>The window looks similar to this.</p>
<p><a class="glightbox" href="../images/create_pfg_1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/create_pfg_1.png" /></a> </p>
</li>
<li>
<p>Click the <strong>Raw Programming Data File (.rpd )</strong> file to select it. Then click the <strong>Edit ...</strong> button and select the <strong>Bitswap</strong> option to be "On". This enables the RPD file to be usable by HPS software like U-Boot and Linux if needed. </p>
</li>
<li>
<p>Once the output type was selected, click the <strong>Input Files</strong> tab. </p>
</li>
<li>
<p>In the <strong>Input Files</strong> tab click the <strong>Add Bitstream</strong> button, then browse to <strong>$TOP_FOLDER/hw/ghrd.0/output_files</strong>, select the file <strong>ghrd_a5ed065bb32ae6sr0.sof</strong>, and then click <strong>Open</strong>. This is the initial factory image. Do the same for the <strong>$TOP_FOLDER/hw/ghrd.1/output_files/ghrd_a5ed065bb32ae6sr0.sof</strong> image. This is the initial application image. The tab now looks like below.</p>
<p><a class="glightbox" href="../images/create_pfg_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/create_pfg_2.png" /></a> </p>
</li>
<li>
<p>Click the first .sof file, then click the <strong>Properties</strong> button on the right side. This opens the window to browse for the FSBL and select authentication and encryption settings. </p>
<p><a class="glightbox" href="../images/create_pfg_3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/create_pfg_3.png" /></a> </p>
</li>
<li>
<p>Click the <strong>Bootloader  (Browse)</strong> button and select the file <strong>$TOP_FOLDER/uboot-socfpga/spl/u-boot-spl-dtb.hex</strong>, then click <strong>OK</strong>. </p>
</li>
<li>
<p>Click the second .sof file and add the same FSBL file to it. The <strong>Input Files</strong> tab now looks like shown below.</p>
<p><a class="glightbox" href="../images/create_pfg_4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/create_pfg_4.png" /></a> </p>
</li>
<li>
<p>Click the <strong>Configuration Device</strong> tab. Note that the tab is only enabled once at least one input file was added in the <strong>Input Files</strong> tab. </p>
</li>
<li>
<p>Because more than one input file was added in the <strong>Input Files</strong> tab, it displays the options for remote system update. Otherwise, it only enables the standard configuration flow. </p>
</li>
<li>
<p>In the <strong>Configuration Device</strong> tab, click <strong>Add Device</strong>, select the <strong>QSPI02G</strong> in the dialog box window, then click <strong>OK</strong>. Once that is done, the window displays the default initial partitioning for RSU.</p>
<p><a class="glightbox" href="../images/create_pfg_5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/create_pfg_5.png" /></a> </p>
</li>
<li>
<p>Select the <strong>FACTORY_IMAGE</strong> entry, and click the <strong>Edit</strong> button. The <strong>Edit Partition</strong> window pops up. Select the <strong>Input file</strong> as <strong>Bitstream_1 (ghrd_a5ed065bb32ae6sr0.sof)</strong>. Change <strong>Address Mode</strong> to <strong>Block</strong> because you want to make sure you are leaving enough space for the biggest factory image you anticipate using. Set the <strong>End Address</strong> to <strong>0x0090FFFF</strong> in order to reserve 7MB for the factory image. This end address was calculated by adding 8MB to the end of the <strong>BOOT_INFO</strong> partition. Click <strong>OK</strong>. </p>
<p><a class="glightbox" href="../images/create_pfg_6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/create_pfg_6.png" /></a> </p>
<p><strong>Note</strong>: The Page property for <strong>FACTORY_IMAGE</strong> partition must always be set to 0. This means that the <strong>FACTORY_IMAGE</strong> will be trieed after all the application images failed. </p>
</li>
<li>
<p>Select the <strong>QSPI02G</strong> flash device in the Configuration Device tab by clicking it, then click the <strong>Add Partition</strong> button to open the <strong>Add Partition</strong> window. Leave the <strong>Name</strong> as <strong>P1</strong> and select the <strong>Input file</strong> as <strong>Bitstream_2(ghrd_agfb014r24b2e2v.sof)</strong>. This becomes the initial application image. Select the <strong>Page</strong> as <strong>1</strong>. Select the <strong>Address Mode</strong> as <strong>Block</strong> and allocate 16MB of data by setting <strong>Start Address</strong> = <strong>0x01000000</strong> and <strong>End Address</strong> = <strong>0x01FFFFFF</strong>. Since this is the first partition defined, this becomes the initial application image to be loaded and has the highest priority of all application images that may be defined later.</p>
<p>The actual priority in which an application in a partition is loaded is defined based on the order in which the partition is defined when creating the initial flash image as shown above in this step.
  The Programming File Generator issues an error if there are multiple partitions with the same page number, or if there are any “gaps” as in having a Page=1 then a Page=3, without a Page=2 for example.</p>
<p>Only up to seven partitions can contain application images at initial flash image creation time. This limitation does not have adverse effects, as typically at creation time it is expected to have just a factory image and one application image</p>
</li>
<li>
<p>Create two more partitions <strong>P2</strong> and <strong>P3</strong> using the same procedure as for the previous step, except set the <strong>Input file</strong> to <strong>None</strong>, leave <strong>Page</strong> unchanged (it does not matter for empty partitions) and set the start and end addresses as follows. </p>
<p>* <strong>P2</strong>: <strong>Start Address</strong> = <strong>0x02000000</strong> and <strong>End Address</strong> = <strong>0x02FFFFFF</strong>. 
  * <strong>P3</strong>: <strong>Start Address</strong> = <strong>0x03000000</strong> and <strong>End Address</strong> = <strong>0x03FFFFFF</strong>. </p>
</li>
<li>
<p>Click <strong>Select</strong> to select the <strong>Flash loader</strong>. The flash loader becomes part of the JIC file and is used by the Flash Programmer tool. Select the desired <strong>Device family</strong> and <strong>Device name</strong> as shown below.</p>
<p><a class="glightbox" href="../images/create_pfg_7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/create_pfg_7.png" /></a> </p>
<p>The Configuration Device tab now looks like as shown below.</p>
<p><a class="glightbox" href="../images/create_pfg_8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/create_pfg_8.png" /></a> </p>
</li>
<li>
<p>You require to change the size of the SPTs and CPBs to 64 KB hence the HPS software uses now this size. This is done by selecting any of the components and pressing the <strong>Edit</strong> button. Expect to see a menu where you can select the option desired. Select the 64 KB size. You only need to update the size of one of these components and can expect to see the rest updated automatically with the same value chosen. </p>
<p><a class="glightbox" href="../images/create_pfg_9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/create_pfg_9.png" /></a> </p>
</li>
<li>
<p>Click <strong>File &gt; Save As ..</strong> and save the file as <strong>$TOP_FOLDER/initial_image.pfg</strong>. This file can be useful later, if you wanted to re-generate the initial image by using the command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>quartus_pfg<span class="w"> </span>-c<span class="w"> </span>initial_image.pfg<span class="w"> </span>
</code></pre></div>
<p><strong>Note</strong>: The created pfg file is actually an XML file which can be manually edited to replace the absolute file paths with relative file paths. You cannot directly edit the .pfg file for other purposes. The .pfg file can be opened from Programming File Generator, if changes are needed. </p>
</li>
<li>
<p>Click the <strong>Generate</strong> button to generate the initial flash image as <strong>$TOP_FOLDER/initial_image.jic</strong> and the map file as <strong>$TOP_FOLDER/initial_image_jic.map</strong>. A dialog box opens indicating the files were generated successfully. </p>
</li>
</ol>
<h3 id="creating-the-application-image">Creating the Application Image<a class="headerlink" href="#creating-the-application-image" title="Permanent link">&para;</a></h3>
<p>The following commands are used to create the application image used in this example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>images<span class="w"> </span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>rm<span class="w"> </span>-rf<span class="w"> </span>images/application2.rpd
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>quartus_pfg<span class="w"> </span>-c<span class="w"> </span>hw/ghrd.2/output_files/ghrd_a5ed065bb32ae6sr0.sof<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>images/application2.rpd<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>-o<span class="w"> </span><span class="nv">hps_path</span><span class="o">=</span>u-boot-socfpga/spl/u-boot-spl-dtb.hex<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>-o<span class="w"> </span><span class="nv">mode</span><span class="o">=</span>ASX4<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>-o<span class="w"> </span><span class="nv">bitswap</span><span class="o">=</span>ON
</code></pre></div>
<p>The following application image is created.</p>
<ul>
<li>$TOP_FOLDER/images/application2.rpd. </li>
</ul>
<h3 id="creating-the-factory-update-image">Creating the Factory Update Image<a class="headerlink" href="#creating-the-factory-update-image" title="Permanent link">&para;</a></h3>
<p>The following commands are used to create the factory update image used in this example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>images<span class="w"> </span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>rm<span class="w"> </span>-f<span class="w"> </span>images/factory_update.rpd
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>quartus_pfg<span class="w"> </span>-c<span class="w"> </span>hw/ghrd.3/output_files/ghrd_a5ed065bb32ae6sr0.sof<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>images/factory_update.rpd<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>-o<span class="w"> </span><span class="nv">hps_path</span><span class="o">=</span>u-boot-socfpga/spl/u-boot-spl-dtb.hex<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>-o<span class="w"> </span><span class="nv">mode</span><span class="o">=</span>ASX4<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>-o<span class="w"> </span><span class="nv">bitswap</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>-o<span class="w"> </span><span class="nv">rsu_upgrade</span><span class="o">=</span>ON
</code></pre></div>
<p>The following factory update image is created. </p>
<ul>
<li>$TOP_FOLDER/images/factory_update.rpd </li>
</ul>
<h3 id="creating-the-decision-firmware-update-image">Creating the Decision Firmware Update Image<a class="headerlink" href="#creating-the-decision-firmware-update-image" title="Permanent link">&para;</a></h3>
<p>The following commands are used to create the decision firmware update image used in this example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>images<span class="w"> </span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>rm<span class="w"> </span>-f<span class="w"> </span>images/decision_firmware_update.rpd
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>quartus_pfg<span class="w"> </span>-c<span class="w"> </span>hw/ghrd.3/output_files/ghrd_a5ed065bb32ae6sr0.sof<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>images/decision_firmware_update.rpd<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>-o<span class="w"> </span><span class="nv">hps_path</span><span class="o">=</span>u-boot-socfpga/spl/u-boot-spl-dtb.hex<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>-o<span class="w"> </span><span class="nv">mode</span><span class="o">=</span>ASX4<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>-o<span class="w"> </span><span class="nv">bitswap</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>-o<span class="w"> </span><span class="nv">rsu_upgrade</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>-o<span class="w"> </span><span class="nv">firmware_only</span><span class="o">=</span>ON
</code></pre></div>
<p>The following decision firmware update image is created. </p>
<ul>
<li>$TOP_FOLDER/images/decision_firmware_update.rpd </li>
</ul>
<p><strong>Note</strong>: The provided SOF file is used by the quartus_pfg to determine the parameters that are writen to the decision firmware data structure. This includes QSPI clock and pin settings, the value of max_retry parameter, and the selected behavior of the HPS watchdog. The actual configuration data from the SOF file is not used. </p>
<h3 id="creating-the-combined-application-image">Creating the Combined Application Image<a class="headerlink" href="#creating-the-combined-application-image" title="Permanent link">&para;</a></h3>
<p>The following commands are used to create the combined application image used in this example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>images
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>rm<span class="w"> </span>-f<span class="w"> </span>images/combined_application.rpd
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>quartus_pfg<span class="w"> </span>-c<span class="w"> </span>hw/ghrd.3/output_files/ghrd_a5ed065bb32ae6sr0.sof<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>images/combined_application.rpd<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>-o<span class="w"> </span><span class="nv">app_image</span><span class="o">=</span>hw/ghrd.2/output_files/ghrd_a5ed065bb32ae6sr0.sof<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>-o<span class="w"> </span><span class="nv">hps_path</span><span class="o">=</span>u-boot-socfpga/spl/u-boot-spl-dtb.hex<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>-o<span class="w"> </span><span class="nv">app_image_hps_path</span><span class="o">=</span>u-boot-socfpga/spl/u-boot-spl-dtb.hex<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>-o<span class="w"> </span><span class="nv">mode</span><span class="o">=</span>ASX4<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>-o<span class="w"> </span><span class="nv">bitswap</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>-o<span class="w"> </span><span class="nv">rsu_upgrade</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>-o<span class="w"> </span><span class="nv">app_image_only</span><span class="o">=</span>ON
</code></pre></div>
<p>The following file is created.</p>
<ul>
<li>$TOP_FOLDER/images/combined_application.rpd </li>
</ul>
<p><strong>Notes:</strong></p>
<ul>
<li>The first SOF file contains the factory image, from which data is taken to fill out the new decision firmware data structure. This includes QSPI clock and pin settings, the value of max_retry parameter, and the selected behavior of the HPS watchdog. The actual configuration data from this SOF file is not used.</li>
<li>The <strong>app_image</strong> parameter contains the SOF that is used for the application image section of the combined image.</li>
<li>The <strong>hps_path</strong> parameter is unused, and may be removed in the future.</li>
<li>The <strong>app_image_hps_path</strong> parameter contains the HPS FSBL hex file to be used for the application imge section of the combined image.</li>
<li>When using HPS first, the additional parameter <strong>"-o hps=1"</strong> needs to be added, and
the following files are created <strong>combined_application.hps.rpd</strong> (combined application image)  and <strong>combined_application.core.rbf</strong> (corresponding fabric configuration file).</li>
</ul>
<h3 id="building-the-root-file-system">Building the Root File System<a class="headerlink" href="#building-the-root-file-system" title="Permanent link">&para;</a></h3>
<p>A root file system is required to boot Linux. There are a lot of ways to build a root file system, depending on your specific needs. This section shows how to build a small root file system using Yocto. </p>
<p>1. Make sure you have Yocto system requirements met: https://docs.yoctoproject.org/5.0.1/ref-manual/system-requirements.html#supported-linux-distributions.</p>
<p>The command to install the required packages on Ubuntu 22.04 is:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>upgrade
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>openssh-server<span class="w"> </span>mc<span class="w"> </span>libgmp3-dev<span class="w"> </span>libmpc-dev<span class="w"> </span>gawk<span class="w"> </span>wget<span class="w"> </span>git<span class="w"> </span>diffstat<span class="w"> </span>unzip<span class="w"> </span>texinfo<span class="w"> </span>gcc<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>build-essential<span class="w"> </span>chrpath<span class="w"> </span>socat<span class="w"> </span>cpio<span class="w"> </span>python3<span class="w"> </span>python3-pip<span class="w"> </span>python3-pexpect<span class="w"> </span>xz-utils<span class="w"> </span>debianutils<span class="w"> </span>iputils-ping<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>python3-git<span class="w"> </span>python3-jinja2<span class="w"> </span>libegl1-mesa<span class="w"> </span>libsdl1.2-dev<span class="w"> </span>pylint<span class="w"> </span>xterm<span class="w"> </span>python3-subunit<span class="w"> </span>mesa-common-dev<span class="w"> </span>zstd<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>liblz4-tool<span class="w"> </span>git<span class="w"> </span>fakeroot<span class="w"> </span>build-essential<span class="w"> </span>ncurses-dev<span class="w"> </span>xz-utils<span class="w"> </span>libssl-dev<span class="w"> </span>bc<span class="w"> </span>flex<span class="w"> </span>libelf-dev<span class="w"> </span>bison<span class="w"> </span>xinetd<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>tftpd<span class="w"> </span>tftp<span class="w"> </span>nfs-kernel-server<span class="w"> </span>libncurses5<span class="w"> </span>libc6-i386<span class="w"> </span>libstdc++6:i386<span class="w"> </span>libgcc++1:i386<span class="w"> </span>lib32z1<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>device-tree-compiler<span class="w"> </span>curl<span class="w"> </span>mtd-utils<span class="w"> </span>u-boot-tools<span class="w"> </span>net-tools<span class="w"> </span>swig<span class="w"> </span>-y
</code></pre></div>
<p>On Ubuntu 22.04 you will also need to point the /bin/sh to /bin/bash, as the default is a link to /bin/dash:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="w"> </span>sudo<span class="w"> </span>ln<span class="w"> </span>-sf<span class="w"> </span>/bin/bash<span class="w"> </span>/bin/sh
</code></pre></div>
<p><strong>Note</strong>: You can also use a Docker container to build the Yocto recipes, refer to https://rocketboards.org/foswiki/Documentation/DockerYoctoBuild for details. When using a Docker container, it does not matter what Linux distribution or packages you have installed on your host, as all dependencies are provided by the Docker container.</p>
<p>2. Run the following commands to build the root file system.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>yocto<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>yocto<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>yocto<span class="w"> </span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>scarthgap<span class="w"> </span>https://git.yoctoproject.org/poky<span class="w"> </span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>scarthgap<span class="w"> </span>https://git.yoctoproject.org/meta-intel-fpga<span class="w"> </span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>scarthgap<span class="w">   </span>https://github.com/openembedded/meta-openembedded<span class="w"> </span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="nb">source</span><span class="w"> </span>poky/oe-init-build-env<span class="w"> </span>./build<span class="w"> </span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;MACHINE = &quot;agilex5_dk_a5e065bb32aes1&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>conf/local.conf<span class="w"> </span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;BBLAYERS += &quot; ${TOPDIR}/../meta-intel-fpga &quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>conf/bblayers.conf<span class="w"> </span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;BBLAYERS += &quot; ${TOPDIR}/../meta-openembedded/meta-oe &quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>conf/bblayers.conf<span class="w"> </span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;IMAGE_FSTYPES = &quot;tar.gz&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>conf/local.conf
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;CORE_IMAGE_EXTRA_INSTALL += &quot;openssh gdbserver&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>conf/local.conf
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>bitbake<span class="w"> </span>core-image-minimal<span class="w"> </span>
</code></pre></div>
<p>After the build completes, which can take a few hours depending on your host system processing power and Internet connection speed, the following root file system archive is created.</p>
<ul>
<li>TOP_FOLDER/yocto/build/tmp/deploy/images/agilex5_dk_a5e065bb32aes1/core-image-minimal-agilex5_dk_a5e065bb32aes1.rootfs.tar.gz </li>
</ul>
<h3 id="building-zlib">Building ZLIB<a class="headerlink" href="#building-zlib" title="Permanent link">&para;</a></h3>
<p>The ZLIB is required by LIBRSU. The following steps can be used to compile it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>zlib-1.3.1<span class="w"> </span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>wget<span class="w"> </span>http://zlib.net/zlib-1.3.1.tar.gz<span class="w"> </span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>tar<span class="w"> </span>xf<span class="w"> </span>zlib-1.3.1.tar.gz<span class="w"> </span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>rm<span class="w"> </span>zlib-1.3.1.tar.gz<span class="w"> </span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="nb">cd</span><span class="w"> </span>zlib-1.3.1/<span class="w"> </span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CROSS_PREFIX</span><span class="o">=</span><span class="si">${</span><span class="nv">CROSS_COMPILE</span><span class="si">}</span><span class="w"> </span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>./configure<span class="w"> </span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>make<span class="w"> </span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ZLIB_PATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span><span class="w"> </span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="nb">cd</span><span class="w"> </span>..<span class="w"> </span>
</code></pre></div>
<p>After the above steps are completed, the following items are available.</p>
<ul>
<li>$TOP_FOLDER/zlib-1.3.1/zlib.h - header file, used to compile files using zlib services </li>
<li>$TOP_FOLDER/zlib-1.3.1/libz.so* - shared objects, used to run executables linked against zlib APIs </li>
</ul>
<p><strong>Note</strong>: The version of zlib mentioned above is the one that was tested with this release. You may want to use the latest zlib version, as it may contain updates and bug fixes. </p>
<h3 id="building-librsu-and-rsu-client">Building LIBRSU and RSU Client<a class="headerlink" href="#building-librsu-and-rsu-client" title="Permanent link">&para;</a></h3>
<p>The following commands can be used to build the LIBRSU and the example client application. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>librsu<span class="w"> </span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/altera-opensource/librsu<span class="w"> </span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="nb">cd</span><span class="w"> </span>librsu<span class="w"> </span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="c1"># checkout the branch used for this document, comment out to use default </span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="c1"># git checkout -b test -t origin/master </span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>cmake<span class="w"> </span>-S<span class="w"> </span>.<span class="w"> </span>-B<span class="w"> </span>build<span class="w"> </span>-G<span class="s2">&quot;Ninja&quot;</span><span class="w"> </span>-DPLATFORM<span class="o">=</span>linux-aarch64<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cmake<span class="w"> </span>--build<span class="w"> </span>build
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="nb">cd</span><span class="w"> </span>..<span class="w"> </span>
</code></pre></div>
<p>The following files are created.</p>
<ul>
<li>$TOP_FOLDER/librsu/build/lib/libuniLibRSU.so.1 - shared object required at runtime for running applications using librsu </li>
<li>$TOP_FOLDER/librsu/etc/qspi.rc - resource file for librsu configuration </li>
<li>$TOP_FOLDER/librsu/build/bin/rsu_client - example client application using librsu </li>
</ul>
<h3 id="building-the-sd-card">Building the SD Card<a class="headerlink" href="#building-the-sd-card" title="Permanent link">&para;</a></h3>
<p>The following commands can be used to create the SD card image used in this example. The <strong>rsu_client</strong> application requires to be linked with the libuniLibRSU.so.1 library. This can be performed from Linux running in the Agilex 5 device using the <strong>ldconfig</strong> command. In this example, we are accomplishing this by adding the <strong>S99linkRSULib.sh</strong> script into the <strong>/etc/rcS.d/ directoyy</strong> in the file system. This script will be executed automatically at boot time. Notice that this only needs to be done once, after the SD card gets programmed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>sd_card<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>sd_card<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>sd_card<span class="w"> </span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>wget<span class="w"> </span>https://releases.rocketboards.org/release/2021.04/gsrd/<span class="se">\</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>tools/make_sdimage_p3.py
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>chmod<span class="w"> </span>+x<span class="w"> </span>make_sdimage_p3.py
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="c1"># Creating  initial script to execute it during Linux boot up so we can link rsu_client with </span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; S99linkRSULib.sh</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="s">#!/bin/sh</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="s"># SPDX-License-Identifier: GPL-2.0-only</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="s">### BEGIN INIT INFO</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="s"># Provides: banner</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="s"># Required-Start:</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="s"># Required-Stop:</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="s"># Default-Start:     S</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="s"># Default-Stop:</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="s">### END INIT INFO</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="s">echo &quot;Calling ldconfig to Lin rsu_client with libuniLibRSU.so.1&quot;</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="s">ldconfig</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="s">EOF</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="c1"># prepare the fat contents </span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>mkdir<span class="w"> </span>fat<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>fat
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/u-boot-socfpga/u-boot.itb<span class="w"> </span>.
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/linux-socfpga/arch/arm64/boot/Image<span class="w"> </span>.
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/linux-socfpga/arch/arm64/boot/dts/intel/socfpga_agilex5_socdk.dtb<span class="w"> </span>.
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/images/*.rpd<span class="w"> </span>.
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="nb">cd</span><span class="w"> </span>..
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="c1"># prepare the rootfs partition contents</span>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>mkdir<span class="w"> </span>rootfs<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>rootfs
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>sudo<span class="w"> </span>tar<span class="w"> </span>xf<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/yocto/build/tmp/deploy/images/agilex5_dk_a5e065bb32aes1/core-image-minimal-agilex5_dk_a5e065bb32aes1.rootfs.tar.gz
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a>sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/agilex5_dk_a5e065bb32aes1/linux/g&#39;</span><span class="w"> </span>etc/hostname
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>lib/modules/*
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a>sudo<span class="w"> </span>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/images/*.rpd<span class="w"> </span>home/root
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a><span class="c1"># This also could be copy to /usr/bin/ so it can be accessed from anywhere</span>
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a>sudo<span class="w"> </span>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/librsu/build/bin/rsu_client<span class="w"> </span>home/root/
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>sudo<span class="w"> </span>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/librsu/build/lib/libuniLibRSU.so.1<span class="w"> </span>usr/lib/
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a>sudo<span class="w"> </span>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/librsu/etc/qspi.rc<span class="w"> </span>etc/librsu.rc
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>sudo<span class="w"> </span>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zlib-1.3.1/libz.so*<span class="w"> </span>lib/
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="c1"># We need to link rsu_client with libuniLibRSU.so.1. So we do it during Linux bootup</span>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a>sudo<span class="w"> </span>cp<span class="w"> </span>../S99linkRSULib.sh<span class="w"> </span>etc/rcS.d/
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a>sudo<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>etc/rcS.d/S99linkRSULib.sh
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a><span class="nb">cd</span><span class="w"> </span>..
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="c1"># create sd card image </span>
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a>sudo<span class="w"> </span>python3<span class="w"> </span>./make_sdimage_p3.py<span class="w"> </span>-f<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a>-P<span class="w"> </span>fat/*,num<span class="o">=</span><span class="m">1</span>,format<span class="o">=</span>vfat,size<span class="o">=</span>100M<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a>-P<span class="w"> </span>rootfs/*,num<span class="o">=</span><span class="m">2</span>,format<span class="o">=</span>ext3,size<span class="o">=</span>100M<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a>-s<span class="w"> </span>256M<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a>-n<span class="w"> </span>sdcard_agilex5_rsu.img
<a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a><span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>
<p>This creates the SD card image as </p>
<ul>
<li>$TOP_FOLDER/sd_card/sdcard_agilex5_rsu.img. </li>
</ul>
<p>The following items are included in the rootfs on the SD card. </p>
<ul>
<li>U-Boot </li>
<li>ATF </li>
<li>Linux kernel, including RSU driver </li>
<li>ZLIB shared objects </li>
<li>LIBRSU shared objects and resource files </li>
<li>RSU client application </li>
<li>Application image </li>
<li>Factory update image </li>
<li>Decision firmware update image </li>
<li>Combined application image </li>
</ul>
<h2 id="flashing-binaries">Flashing Binaries<a class="headerlink" href="#flashing-binaries" title="Permanent link">&para;</a></h2>
<h3 id="writing-initial-rsu-image-to-qspi">Writing Initial RSU Image to QSPI<a class="headerlink" href="#writing-initial-rsu-image-to-qspi" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Make sure to install the QSPI SDM bootcard on the Agilex SoC Development Kit </p>
</li>
<li>
<p>Power down the board if powered up </p>
</li>
<li>
<p>Configure the Agilex SoC Development Kit switches to have MSEL set to JTAG. </p>
</li>
<li>
<p>Run the following command to write the image to SDM QSPI by using the command line version of the Quartus Prime Programmer.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>quartus_pgm<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>-m<span class="w"> </span>jtag<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;pvi;./initial_image.jic&quot;</span><span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Configure the Agilex SoC Development Kit switches to have MSEL set to QSPI. </p>
</li>
</ol>
<h3 id="writing-the-sd-card-image">Writing the SD Card Image<a class="headerlink" href="#writing-the-sd-card-image" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Write the SD card image $TOP_FOLDER/sd_card/sdcard_agilex5_rsu.img to a microSD card. You can use an USB micro SD card writer and the Linux dd command on your host PC to achieve this. Exercise caution when using the dd command, as incorrect usage can lead to your host Linux system becoming corrupted and non-bootable. </p>
</li>
<li>
<p>Insert the micro SD card in the slot on the Agilex SoC Development kit HPS daughtercard. </p>
</li>
</ol>
<h2 id="exercising-u-boot-rsu-commands">Exercising U-Boot RSU Commands<a class="headerlink" href="#exercising-u-boot-rsu-commands" title="Permanent link">&para;</a></h2>
<h3 id="basic-rsu-operations">Basic RSU Operations<a class="headerlink" href="#basic-rsu-operations" title="Permanent link">&para;</a></h3>
<p>This section demonstrates how to use U-Boot to perform the following basic operations.</p>
<ul>
<li>Querying the RSU status. </li>
<li>Querying the number of slots and the information about them. </li>
<li>Adding a new application image. </li>
<li>Verifying that an application image was written correctly. </li>
<li>Requesting a specific application image to be loaded. </li>
</ul>
<p><strong>Note</strong>: This section assumes that the flash contains the initial RSU image. If that is not true, you need to re-flash the initial image, as shown in the Flashing the Initial RSU Image to QSPI . </p>
<p><strong>Note:</strong> RSU functionality in U-Boot is enabled starting on 24.3 release.</p>
<ol>
<li>
<p>Power up the board and press any key when prompted, to get to the U-Boot command prompt.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>U-Boot SPL 2024.04-35102-g135e53726d-dirty (Nov 23 2024 - 13:23:54 -0600)
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>Reset state: Cold
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>MPU           800000 kHz
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>L4 Main       400000 kHz
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>L4 sys free   100000 kHz
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>L4 MP         200000 kHz
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>L4 SP         100000 kHz
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>SDMMC          50000 kHz
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>is_ddr_csr_clkgen_locked: ddr csr io96b_0 clkgenA is successfully locked
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>io96b_cal_status: Calibration for IO96B instance 0x18400400 done at 0 msec!
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>init_mem_cal: Initial DDR calibration IO96B_0 succeed
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>:
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>Trying to boot from MMC1
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>## Checking hash(es) for config board-0 ... OK
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>## Checking hash(es) for Image atf ... crc32+ OK
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>## Checking hash(es) for Image uboot ... crc32+ OK
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>## Checking hash(es) for Image fdt-0 ... crc32+ OK
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>WARNING: Data cache not enabled
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>NOTICE:  BL31: Boot Core = 0
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>NOTICE:  BL31: CPU ID = 0
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>NOTICE:  BL31: v2.11.0(release):QPDS24.3_REL_GSRD_PR
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>NOTICE:  BL31: Built : 13:23:25, Nov 23 2024
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>U-Boot 2024.04-35102-g135e53726d-dirty (Nov 23 2024 - 13:23:54 -0600)socfpga_agilex5
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>CPU:   Intel FPGA SoCFPGA Platform (ARMv8 64bit Cortex-A55/A76)
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>Model: SoCFPGA Agilex5 SoCDK
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>DRAM:  2 GiB (effective 8 GiB)
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>Core:  50 devices, 25 uclasses, devicetree: separate
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>WDT:   Started watchdog@10d00200 with servicing every 1000ms (10s timeout)
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>WDT:   Started watchdog@10d00300 with servicing every 1000ms (10s timeout)
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>WDT:   Started watchdog@10d00400 with servicing every 1000ms (10s timeout)
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>WDT:   Started watchdog@10d00500 with servicing every 1000ms (10s timeout)
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>WDT:   Started watchdog@10d00600 with servicing every 1000ms (10s timeout)
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>MMC:   mmc0@10808000: 0
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>Loading Environment from FAT... Unable to read &quot;uboot.env&quot; from mmc0:1...
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>In:    serial0@10c02000
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a>Out:   serial0@10c02000
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a>Err:   serial0@10c02000
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a>:
<a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a>Hit any key to stop autoboot:  0 
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a>SOCFPGA # 
</code></pre></div>
</li>
<li>
<p>Run the rsu command without parameters, to display its help message, and usage options. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu </span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>rsu<span class="w"> </span>-<span class="w"> </span>Agilex<span class="w"> </span>SoC<span class="w"> </span>Remote<span class="w"> </span>System<span class="w"> </span>Update<span class="w"> </span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>Usage:<span class="w"> </span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>rsu<span class="w"> </span>dtb<span class="w"> </span>-<span class="w"> </span>Update<span class="w"> </span>Linux<span class="w"> </span>DTB<span class="w"> </span>qspi-boot<span class="w"> </span>parition<span class="w"> </span>offset<span class="w"> </span>with<span class="w"> </span>spt0<span class="w"> </span>value<span class="w"> </span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>list<span class="w"> </span>-<span class="w"> </span>List<span class="w"> </span>down<span class="w"> </span>the<span class="w"> </span>available<span class="w"> </span>bitstreams<span class="w"> </span><span class="k">in</span><span class="w"> </span>flash<span class="w"> </span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>slot_by_name<span class="w"> </span>&lt;name&gt;<span class="w"> </span>-<span class="w"> </span>find<span class="w"> </span>slot<span class="w"> </span>by<span class="w"> </span>name<span class="w"> </span>and<span class="w"> </span>display<span class="w"> </span>the<span class="w"> </span>slot<span class="w"> </span>number<span class="w"> </span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>slot_count<span class="w"> </span>-<span class="w"> </span>display<span class="w"> </span>the<span class="w"> </span>slot<span class="w"> </span>count<span class="w"> </span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>slot_disable<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>-<span class="w"> </span>remove<span class="w"> </span>slot<span class="w"> </span>from<span class="w"> </span>CPB<span class="w"> </span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>slot_enable<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>-<span class="w"> </span>make<span class="w"> </span>slot<span class="w"> </span>the<span class="w"> </span>highest<span class="w"> </span>priority<span class="w"> </span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>slot_erase<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>-<span class="w"> </span>erase<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>slot_get_info<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>-<span class="w"> </span>display<span class="w"> </span>slot<span class="w"> </span>information<span class="w"> </span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>slot_load<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>-<span class="w"> </span>load<span class="w"> </span>slot<span class="w"> </span>immediately<span class="w"> </span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>slot_load_factory<span class="w"> </span>-<span class="w"> </span>load<span class="w"> </span>factory<span class="w"> </span>immediately<span class="w"> </span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>slot_priority<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>-<span class="w"> </span>display<span class="w"> </span>slot<span class="w"> </span>priority<span class="w"> </span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>slot_program_buf<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>&lt;buffer&gt;<span class="w"> </span>&lt;size&gt;<span class="w"> </span>-<span class="w"> </span>program<span class="w"> </span>buffer<span class="w"> </span>into<span class="w"> </span>slot,<span class="w"> </span>and<span class="w"> </span>make<span class="w"> </span>it<span class="w"> </span>highest<span class="w"> </span>priority<span class="w"> </span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>slot_program_buf_raw<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>&lt;buffer&gt;<span class="w"> </span>&lt;size&gt;<span class="w"> </span>-<span class="w"> </span>program<span class="w"> </span>raw<span class="w"> </span>buffer<span class="w"> </span>into<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>slot_program_factory_update_buf<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>&lt;buffer&gt;<span class="w"> </span>&lt;size&gt;<span class="w"> </span>-<span class="w"> </span>program<span class="w"> </span>factory<span class="w"> </span>update<span class="w"> </span>buffer<span class="w"> </span>into<span class="w"> </span>slot,<span class="w"> </span>and<span class="w"> </span>make<span class="w"> </span>it<span class="w"> </span>highest<span class="w"> </span>priority<span class="w"> </span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>slot_rename<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>&lt;name&gt;<span class="w"> </span>-<span class="w"> </span>rename<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>slot_delete<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>-<span class="w"> </span>delete<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>slot_create<span class="w"> </span>&lt;name&gt;<span class="w"> </span>&lt;address&gt;<span class="w"> </span>&lt;size&gt;<span class="w"> </span>-<span class="w"> </span>create<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>slot_size<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>-<span class="w"> </span>display<span class="w"> </span>slot<span class="w"> </span>size<span class="w"> </span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>slot_verify_buf<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>&lt;buffer&gt;<span class="w"> </span>&lt;size&gt;<span class="w"> </span>-<span class="w"> </span>verify<span class="w"> </span>slot<span class="w"> </span>contents<span class="w"> </span>against<span class="w"> </span>buffer<span class="w"> </span>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>slot_verify_buf_raw<span class="w"> </span>&lt;slot&gt;<span class="w"> </span>&lt;buffer&gt;<span class="w"> </span>&lt;size&gt;<span class="w"> </span>-<span class="w"> </span>verify<span class="w"> </span>slot<span class="w"> </span>contents<span class="w"> </span>against<span class="w"> </span>raw<span class="w"> </span>buffer<span class="w"> </span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>status_log<span class="w"> </span>-<span class="w"> </span>display<span class="w"> </span>RSU<span class="w"> </span>status<span class="w"> </span>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>update<span class="w"> </span>&lt;flash_offset&gt;<span class="w"> </span>-<span class="w"> </span>Initiate<span class="w"> </span>firmware<span class="w"> </span>to<span class="w"> </span>load<span class="w"> </span>bitstream<span class="w"> </span>as<span class="w"> </span>specified<span class="w"> </span>by<span class="w"> </span>flash_offset<span class="w"> </span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>notify<span class="w"> </span>&lt;value&gt;<span class="w"> </span>-<span class="w"> </span>Let<span class="w"> </span>SDM<span class="w"> </span>know<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>state<span class="w"> </span>of<span class="w"> </span>HPS<span class="w"> </span>software<span class="w"> </span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>clear_error_status<span class="w"> </span>-<span class="w"> </span>clear<span class="w"> </span>the<span class="w"> </span>RSU<span class="w"> </span>error<span class="w"> </span>status<span class="w"> </span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>reset_retry_counter<span class="w"> </span>-<span class="w"> </span>reset<span class="w"> </span>the<span class="w"> </span>RSU<span class="w"> </span>retry<span class="w"> </span>counter<span class="w"> </span>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>display_dcmf_version<span class="w"> </span>-<span class="w"> </span>display<span class="w"> </span>DCMF<span class="w"> </span>versions<span class="w"> </span>and<span class="w"> </span>store<span class="w"> </span>them<span class="w"> </span><span class="k">for</span><span class="w"> </span>SMC<span class="w"> </span>handler<span class="w"> </span>usage<span class="w"> </span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>display_dcmf_status<span class="w"> </span>-<span class="w"> </span>display<span class="w"> </span>DCMF<span class="w"> </span>status<span class="w"> </span>and<span class="w"> </span>store<span class="w"> </span>it<span class="w"> </span><span class="k">for</span><span class="w"> </span>SMC<span class="w"> </span>handler<span class="w"> </span>usage<span class="w"> </span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>display_max_retry<span class="w"> </span>-<span class="w"> </span>display<span class="w"> </span>max_retry<span class="w"> </span>parameter,<span class="w"> </span>and<span class="w"> </span>store<span class="w"> </span>it<span class="w"> </span><span class="k">for</span><span class="w"> </span>SMC<span class="w"> </span>handler<span class="w"> </span>usage<span class="w"> </span>
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>restore_spt<span class="w"> </span>&lt;address&gt;<span class="w"> </span>-<span class="w"> </span>restore<span class="w"> </span>SPT<span class="w"> </span>from<span class="w"> </span>an<span class="w"> </span>address<span class="w"> </span>
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>save_spt<span class="w"> </span>&lt;address&gt;<span class="w"> </span>-<span class="w"> </span>save<span class="w"> </span>SPT<span class="w"> </span>to<span class="w"> </span>an<span class="w"> </span>address<span class="w"> </span>
<a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a>create_empty_cpb<span class="w"> </span>-<span class="w"> </span>create<span class="w"> </span>a<span class="w"> </span>empty<span class="w"> </span>CPB<span class="w"> </span>
<a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a>restore_cpb<span class="w"> </span>&lt;address&gt;<span class="w"> </span>-<span class="w"> </span>restore<span class="w"> </span>CPB<span class="w"> </span>from<span class="w"> </span>an<span class="w"> </span>address<span class="w"> </span>
<a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>save_cpb<span class="w"> </span>&lt;address&gt;<span class="w"> </span>-<span class="w"> </span>save<span class="w"> </span>CPB<span class="w"> </span>to<span class="w"> </span>an<span class="w"> </span>address<span class="w"> </span>
<a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>check_running_factory<span class="w"> </span>-<span class="w"> </span>check<span class="w"> </span><span class="k">if</span><span class="w"> </span>currently<span class="w"> </span>running<span class="w"> </span>the<span class="w"> </span>factory<span class="w"> </span>image<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Run the rsu list command to display the RSU partitions, CPBs, the currently running image and the status. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu list </span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>RSU:<span class="w"> </span>Remote<span class="w"> </span>System<span class="w"> </span>Update<span class="w"> </span>Status<span class="w"> </span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>RSU:<span class="w"> </span>Sub-partition<span class="w"> </span>table<span class="w"> </span><span class="m">0</span><span class="w"> </span>offset<span class="w"> </span>0x00910000<span class="w"> </span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>RSU:<span class="w"> </span>Sub-partition<span class="w"> </span>table<span class="w"> </span><span class="m">1</span><span class="w"> </span>offset<span class="w"> </span>0x00920000<span class="w"> </span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>RSU:<span class="w"> </span>Sub-partition<span class="w"> </span>table<span class="w"> </span>content<span class="w"> </span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>BOOT_INFO<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000000000<span class="w"> </span>Length:<span class="w"> </span>0x00210000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000003<span class="w"> </span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>FACTORY_IMAGE<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000210000<span class="w"> </span>Length:<span class="w"> </span>0x00700000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000003<span class="w"> </span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>P1<span class="w"> </span>Offset:<span class="w"> </span>0x0000000001000000<span class="w"> </span>Length:<span class="w"> </span>0x01000000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>SPT0<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000910000<span class="w"> </span>Length:<span class="w"> </span>0x00010000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000001<span class="w"> </span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>SPT1<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000920000<span class="w"> </span>Length:<span class="w"> </span>0x00010000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000001<span class="w"> </span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>CPB0<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000930000<span class="w"> </span>Length:<span class="w"> </span>0x00010000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000001<span class="w"> </span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>CPB1<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000940000<span class="w"> </span>Length:<span class="w"> </span>0x00010000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000001<span class="w"> </span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>P2<span class="w"> </span>Offset:<span class="w"> </span>0x0000000002000000<span class="w"> </span>Length:<span class="w"> </span>0x01000000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>P3<span class="w"> </span>Offset:<span class="w"> </span>0x0000000003000000<span class="w"> </span>Length:<span class="w"> </span>0x01000000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>RSU:<span class="w"> </span>CMF<span class="w"> </span>pointer<span class="w"> </span>block<span class="w"> </span>offset<span class="w"> </span>0x00930000<span class="w"> </span>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>RSU:<span class="w"> </span>CMF<span class="w"> </span>pointer<span class="w"> </span>block<span class="err">&#39;</span>s<span class="w"> </span>image<span class="w"> </span>pointer<span class="w"> </span>list<span class="w"> </span>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>Priority<span class="w"> </span><span class="m">1</span><span class="w"> </span>Offset:<span class="w"> </span>0x0000000001000000<span class="w"> </span>nslot:<span class="w"> </span><span class="m">0</span><span class="w"> </span>
</code></pre></div>
<p><strong>Note</strong>: The rsu list U-Boot command does not have a RSU client equivalent. Instead, the same information can be retrieved using other commands, as shown next. </p>
</li>
<li>
<p>Run the rsu status_log command to display the RSU status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="w"> </span>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w"> </span>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w"> </span>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w"> </span>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w"> </span>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w"> </span>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w"> </span>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w"> </span>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>Application image P1 is loaded, as it is the highest priority in the CPB. There are no errors. </p>
</li>
<li>
<p>Run the rsu display_dcmf_version to query and display the decision firmware versions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu display_dcmf_version </span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>DCMF0<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0<span class="w"> </span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>DCMF1<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0<span class="w">  </span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>DCMF2<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0<span class="w">  </span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>DCMF3<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0<span class="w">  </span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_count </span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>Number<span class="w"> </span>of<span class="w"> </span><span class="nv">slots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>.<span class="w"> </span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 0 </span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>NAME:<span class="w"> </span>P1<span class="w"> </span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>OFFSET:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 1 </span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>NAME:<span class="w"> </span>P2<span class="w"> </span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>OFFSET:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 2 </span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_size 0 </span>
<a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>Slot<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16777216</span>.<span class="w"> </span>
<a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_size 1 </span>
<a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a>Slot<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16777216</span>.<span class="w"> </span>
<a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_size 2 </span>
<a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a>Slot<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16777216</span>.<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Erase slot 1 and add the application2.rpd image to slot 1.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_erase 1 </span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>Slot<span class="w"> </span><span class="m">1</span><span class="w"> </span>erased.<span class="w"> </span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>SOCFPGA<span class="w"> </span><span class="c1"># load mmc 0:1 $loadaddr application2.rpd </span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="m">2248704</span><span class="w"> </span>bytes<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">103</span><span class="w"> </span>ms<span class="w"> </span><span class="o">(</span><span class="m">20</span>.8<span class="w"> </span>MiB/s<span class="o">)</span><span class="w"> </span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_program_buf 1 $loadaddr $filesize </span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>Slot<span class="w"> </span><span class="m">1</span><span class="w"> </span>was<span class="w"> </span>programmed<span class="w"> </span>with<span class="w"> </span><span class="nv">buffer</span><span class="o">=</span>0x0000000002000000<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">2248704</span>.<span class="w"> </span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_verify_buf 1 $loadaddr $filesize </span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>Slot<span class="w"> </span><span class="m">1</span><span class="w"> </span>was<span class="w"> </span>verified<span class="w"> </span>with<span class="w"> </span><span class="nv">buffer</span><span class="o">=</span>0x0000000002000000<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">2248704</span>.<span class="w"> </span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 1 </span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>NAME:<span class="w"> </span>P2<span class="w"> </span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>OFFSET:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, stop U-Boot and check the RSU status log. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>The application image from slot 1 (partition P2) was loaded, because it is marked as the highest priority in the CPB. </p>
<p><strong>Important Note</strong>: Causing the newly written application image to be loaded can also be done without a power cycle, by requesting the specific image to be loaded, in this case using the following command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_load 1 </span>
</code></pre></div>
</li>
<li>
<p>Load the application image from slot 0 (partition P1) by running any of the following two commands. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu update 0x01000000 </span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>RSU:<span class="w"> </span>RSU<span class="w"> </span>update<span class="w"> </span>to<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>or<span class="w"> </span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_load 0 </span>
</code></pre></div>
</li>
<li>
<p>Load the newly requested image. Stop at U-Boot prompt and check the status log to confirm it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p><strong>Note</strong>: In U-Boot, the effect of requesting a specific image is immediate. On Linux, it only takes effect on the next reboot command. </p>
</li>
</ol>
<h3 id="watchdog-and-max-retry-operation">Watchdog and Max Retry Operation<a class="headerlink" href="#watchdog-and-max-retry-operation" title="Permanent link">&para;</a></h3>
<p>This section uses U-Boot to demonstrate the following. </p>
<ul>
<li>RSU handling of watchdog timeouts. </li>
<li>max retry feature, which allows each image to be tried to be loaded up to three times. </li>
<li>RSU notify, which allows the HPS software state to be reported before and retrieved after a watchdog timeout. </li>
<li>Clearing the RSU status error fields. </li>
<li>Resetting the current retry counter value. </li>
</ul>
<p><strong>Note</strong>: The commands listed in this section rely on the commands from the Basic Operation section running first, specifically adding an application image to the P2 flash partition. </p>
<ol>
<li>
<p>Power up the board, stop U-Boot and check the RSU status log. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>The application image from slot 1 (partition P2) was loaded, since it is marked as the highest priority in the CPB. What do the fields mean is described next. </p>
<p>- Version field is 0x00000202:  both decision firmware and application firmware RSU interface versions are 2, and the system supports the max retry feature. <br>
  - Retry counter is 0x00000000: first attempt to load this image. <br>
  - State is 0x00000000: No errors to report.<br></p>
</li>
<li>
<p>Query and display the max_retry value.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu display_max_retry </span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="nv">max_retry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Cause a watchdog timeout by setting the timeout value to lowest possible. This prevents U-Boot from being able to service it in time.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># mw.l 10D00204 0 </span>
</code></pre></div>
</li>
<li>
<p>The watchdog immediately times out, and SDM reloads the same application image, since the max retry parameter is set to three. Look at the U-Boot console and check the status log.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>State<span class="w"> </span>:<span class="w"> </span>0xf0060001<span class="w"> </span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x0acf0202<span class="w"> </span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000001<span class="w"> </span>
</code></pre></div>
<p>The same P2 image is loaded, but the retry counter value is now one, which means this is the second retry for this image to be loaded. The version field shows the last failure was by an application image (0xACF). The state field shows the last error was a watchdog timeout (0xF006) and that the latest notify value from HPS software was from SPL loading U-Boot (0x0001). </p>
</li>
<li>
<p>Clear the error status so we can see the next errors. Query the status to show the errors were cleared.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu clear_error_status </span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000001<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Cause another watchdog timeout. At the U-Boot prompt, query the RSU log and observe that the retry counter is now two.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>State<span class="w"> </span>:<span class="w"> </span>0xf0060001<span class="w"> </span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x0acf0202<span class="w"> </span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000002<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Clear the error status so we can see the next errors. </p>
</li>
<li>
<p>Use the notify command to let SDM know the state of HPS software as a 16bit value. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>SOCFPGA0<span class="w"> </span><span class="c1"># rsu notify 0x1234 </span>
</code></pre></div>
</li>
<li>
<p>Cause a watchdog timeout one more time and display the RSU status log after the restart.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>State<span class="w"> </span>:<span class="w"> </span>0xf0061234<span class="w"> </span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x0acf0202<span class="w"> </span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>The SDM loaded the next application image in the CPB (P1), and it reports that the image P2 failed. The state indicates that a watchdog timeout occurred (upper 16 bits = 0xF006) and that the notify value reported by HPS software was 0x1234. The upper 16 bits of version are set to 0x0ACF which means the previous error was reported by the application image firmware. </p>
</li>
<li>
<p>Clear the errors and display the status - it shows no errors. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu clear_error_status </span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Cause a watchdog timeout, boot to U-Boot, and display the status - it shows the retry counter is one.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>State<span class="w"> </span>:<span class="w"> </span>0xf0060001<span class="w"> </span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x0acf0202<span class="w"> </span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000001<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Reset the current retry counter value to zero and query the status again to confirm it. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu reset_retry_counter </span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>State<span class="w"> </span>:<span class="w"> </span>0xf0060001<span class="w"> </span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>Version<span class="w"> </span>:<span class="w"> </span>0x0acf0202<span class="w"> </span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h3 id="updating-the-factory-image">Updating the Factory Image<a class="headerlink" href="#updating-the-factory-image" title="Permanent link">&para;</a></h3>
<p>This section demonstrates how to use U-Boot to update the factory image. </p>
<p><strong>Note</strong>: The commands listed in this section rely on the commands from the Basic Operation section running first, specifically adding an application image to the P2 flash partition. </p>
<ol>
<li>
<p>Power up the board, stop U-Boot and check the RSU status log. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>The application image from slot 1 (partition P2) was loaded, because it is marked as the highest priority in the CPB. </p>
</li>
<li>
<p>Confirm that slot 2 is not used, erase slot 2, write the factory update image to it, and verify it was written correctly.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 2 </span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_erase 2 </span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>Slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>erased.<span class="w"> </span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>SOCFPGA<span class="w"> </span><span class="c1"># load mmc 0:1 $loadaddr factory_update.rpd </span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="m">2478080</span><span class="w"> </span>bytes<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">113</span><span class="w"> </span>ms<span class="w"> </span><span class="o">(</span><span class="m">20</span>.9<span class="w"> </span>MiB/s<span class="o">)</span><span class="w"> </span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_program_factory_update_buf 2 $loadaddr $filesize </span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a>Slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>was<span class="w"> </span>programmed<span class="w"> </span>with<span class="w"> </span><span class="nv">buffer</span><span class="o">=</span>0x0000000002000000<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">2478080</span>.<span class="w"> </span>
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_verify_buf 2 $loadaddr $filesize </span>
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a>Slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>was<span class="w"> </span>verified<span class="w"> </span>with<span class="w"> </span><span class="nv">buffer</span><span class="o">=</span>0x0000000002000000<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">2478080</span>.<span class="w"> </span>
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 2 </span>
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Instruct the SDM to load the factory update image from slot 2. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_load 2 </span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>Slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>loading.<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>The factory update image runs for a few seconds, and updates the decision firmware, decision firmware data and factory image in flash. Then it removes itself from the CPB and loads the now highest priority image in the CPB. At the U-Boot prompt, confirm that P2 is now loaded and P3 is disabled. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 2 </span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h3 id="fallback-on-flash-corruption-of-application-images">Fallback on Flash Corruption of Application Images<a class="headerlink" href="#fallback-on-flash-corruption-of-application-images" title="Permanent link">&para;</a></h3>
<p>This section uses U-Boot to demonstrate falling back in case of configuration errors caused by flash corruption of application images. </p>
<p><strong>Note</strong>: The commands listed in this section rely on the commands from the Basic Operation section running first, specifically adding an application image to the P2 flash partition. </p>
<ol>
<li>
<p>Power up the board, stop U-Boot and check the RSU status log. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>The application image from slot 1 (partition P2) was loaded, because it is marked as the highest priority in the CPB. What do the fields mean is described next. </p>
<p>- Version field is 0x00000202: both decision firmware and application firmware RSU interface versions are 2, and the system supports the max retry feature. <br>
  - Retry counter is 0x00000000: first attempt to load this image. <br>
  - State is 0x00000000: No errors to report <br></p>
</li>
<li>
<p>Corrupt the image in the slot 1 by erasing some of it. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x02000000 0x10000 </span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>SF:<span class="w"> </span><span class="m">16384</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x2000000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, stop at U-Boot prompt, and query the RSU log.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000<span class="w"> </span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>State<span class="w"> </span>:<span class="w"> </span>0xf004d003<span class="w"> </span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x0dcf0202<span class="w"> </span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>The current image is P1, and the P2 shows as a failure. Note that SDM tried to load the image three times from flash, as specified by the max retry option. The top 16 bits of the version field are set as 0x0DCF which means the error was caused reported by the decision firmware, as it was not able to load the image. The top 16 bits of the state field are set to 0xF004, which indicate an internal error. </p>
</li>
<li>
<p>Clear the error status and display the log again to confirm it was cleared. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu clear_error_status </span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h3 id="additional-flash-corruption-detection-and-recovery">Additional Flash Corruption Detection and Recovery<a class="headerlink" href="#additional-flash-corruption-detection-and-recovery" title="Permanent link">&para;</a></h3>
<p>This section presents examples of detecting and recovering corrupted decision firmware, decision firmware data, configuration pointer blocks and sub-partition tables with the aid of the U-Boot RSU commands. </p>
<h4 id="corrupted-decision-firmware">Corrupted Decision Firmware<a class="headerlink" href="#corrupted-decision-firmware" title="Permanent link">&para;</a></h4>
<p>This example uses U-Boot commands to demonstrate detecting that a decision firmware copy is corrupted, and recovering it by running a decision firmware update image. </p>
<p><strong>Note</strong>: The commands listed in this example assume the initial flash image (JIC) was written to flash, with no other changes. </p>
<ol>
<li>
<p>Power up the board, boot to U-Boot prompt. </p>
</li>
<li>
<p>Display the RSU status. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>The top four bits of the state field are 0x0 which means the currently used decision firmware index is zero. There are no errors. </p>
</li>
<li>
<p>Display the decision firmware status. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu display_dcmf_status </span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>DCMF0:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>DCMF1:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>DCMF2:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>DCMF3:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
<p>The command compares the currently used decision firmware copy 0 with the other copies, and displays that all decision firmware copies are fine. </p>
</li>
<li>
<p>Corrupt decision firmware copies 0 and 2 (each copy is 512 KB). </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0 0x10000 </span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x0<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x100000 0x10000 </span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x100000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, boot to U-Boot prompt, display the RSU status and decision firmware status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x10000202<span class="w"> </span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu display_dcmf_status </span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a>DCMF0:<span class="w"> </span>Corrupted<span class="w"> </span>
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>DCMF1:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a>DCMF2:<span class="w"> </span>Corrupted<span class="w"> </span>
<a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a>DCMF3:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
<p>The currently used copy of the decision firmware is 1, as indicated by top four bits of the version field. The decision firmware copies 0 and 2 are detected as corrupted. </p>
</li>
<li>
<p>Erase an unused slot, add the decision firmware update image to the slot, verify it was written fine, and confirm it is now the highest priority slot.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_erase 2 </span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>Slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>erased.<span class="w"> </span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>SOCFPGA<span class="w"> </span><span class="c1"># fatload mmc 0:1 ${loadaddr} decision_firmware_update.rpd </span>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="m">151552</span><span class="w"> </span>bytes<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">9</span><span class="w"> </span>ms<span class="w"> </span><span class="o">(</span><span class="m">16</span>.1<span class="w"> </span>MiB/s<span class="o">)</span><span class="w"> </span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_program_factory_update_buf 2 ${loadaddr} ${filesize} </span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>Slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>was<span class="w"> </span>programmed<span class="w"> </span>with<span class="w"> </span><span class="nv">buffer</span><span class="o">=</span>0x0000000002000000<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">151552</span>.<span class="w"> </span>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_verify_buf 2 ${loadaddr} ${filesize} </span>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>Slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>was<span class="w"> </span>verified<span class="w"> </span>with<span class="w"> </span><span class="nv">buffer</span><span class="o">=</span>0x0000000002000000<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">151552</span>.<span class="w"> </span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 2 </span>
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Pass control to the decision firmware update image. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_load 2 </span>
</code></pre></div>
</li>
<li>
<p>The decision firmware update image writes new decision firmware copies and new decision firmware data to flash, remove itself from CPB, then pass control to the highest priority image. </p>
</li>
<li>
<p>Stop at U-Boot prompt and confirm the decision firmware copies are all good, the decision firmware update image was removed from CPB, and the highest priority image is running. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu display_dcmf_status </span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>DCMF0:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a>DCMF1:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a>DCMF2:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a>DCMF3:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 2 </span>
<a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h4 id="corrupted-decision-firmware-data">Corrupted Decision Firmware Data<a class="headerlink" href="#corrupted-decision-firmware-data" title="Permanent link">&para;</a></h4>
<p>This example uses U-Boot commands to demonstrate detecting that the decision firmware data is corrupted, and recovering it by running a decision firmware update image. </p>
<p><strong>Note</strong>: The commands listed in this example assume the initial flash image (JIC) was written to flash, with no other changes. </p>
<ol>
<li>
<p>Power up the board, boot to U-Boot prompt. </p>
</li>
<li>
<p>Display the RSU status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>There are no errors. </p>
</li>
<li>
<p>Corrupt decision firmware data. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x200000 0x10000 </span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x200000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, boot to U-Boot prompt, display the RSU status. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00110000<span class="w"> </span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00100000<span class="w"> </span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>State<span class="w"> </span>:<span class="w"> </span>0xf004d00f<span class="w"> </span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x0dcf0202<span class="w"> </span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>The State contains the special error code 0xf004d00f indictating that the decision firmware data was corrupted. The current image is listed as the factory image. The error source is listed as 0xdcf, meaning the error was reported by the decision firmware. The Last Fail Image is set to 0x00100000, which is a special value indicating an error was reported by the decision firmware. </p>
</li>
<li>
<p>Erase an unused slot, add the decision firmware update image to the slot, verify it was written fine, and confirm it is now the highest priority running slot. </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_erase 2 </span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>Slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>erased.<span class="w"> </span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>SOCFPGA<span class="w"> </span><span class="c1"># fatload mmc 0:1 ${loadaddr} decision_firmware_update.rpd </span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="m">151552</span><span class="w"> </span>bytes<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">9</span><span class="w"> </span>ms<span class="w"> </span><span class="o">(</span><span class="m">16</span>.1<span class="w"> </span>MiB/s<span class="o">)</span><span class="w"> </span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_program_factory_update_buf 2 ${loadaddr} ${filesize} </span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a>Slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>was<span class="w"> </span>programmed<span class="w"> </span>with<span class="w"> </span><span class="nv">buffer</span><span class="o">=</span>0x0000000002000000<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">151552</span>.<span class="w"> </span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_verify_buf 2 ${loadaddr} ${filesize} </span>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a>Slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>was<span class="w"> </span>verified<span class="w"> </span>with<span class="w"> </span><span class="nv">buffer</span><span class="o">=</span>0x0000000002000000<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">151552</span>.<span class="w"> </span>
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 2 </span>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
</code></pre></div>
6. Pass control to the decision firmware update image. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_load 2 </span>
</code></pre></div>
</li>
<li>
<p>The decision firmware update image writes new decision firmware copies and new decision firmware data to flash, remve itself from CPB, then pass control to the highest priority image. </p>
</li>
<li>
<p>Stop at U-Boot prompt and confirm the decision firmware data is fine, the decision firmware update image was removed from CPB, and the highest priority image is running. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 2 </span>
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h4 id="corrupted-configuration-pointer-block">Corrupted Configuration Pointer Block<a class="headerlink" href="#corrupted-configuration-pointer-block" title="Permanent link">&para;</a></h4>
<p>This section uses U-Boot commands to demonstrate how configuration pointer block corruptions can be detected and recovered. </p>
<p><strong>Note</strong>: The commands listed in this example assume the initial flash image (JIC) was writtento flash, with no other changes. </p>
<ol>
<li>
<p>Power up board, stop at U-Boot prompt. </p>
</li>
<li>
<p>Run the rsu list command to display a detailed status, including all the partitions, to determine the location of the SPTs. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu list </span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>RSU:<span class="w"> </span>Remote<span class="w"> </span>System<span class="w"> </span>Update<span class="w"> </span>Status<span class="w"> </span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>RSU:<span class="w"> </span>Sub-partition<span class="w"> </span>table<span class="w"> </span><span class="m">0</span><span class="w"> </span>offset<span class="w"> </span>0x00910000<span class="w"> </span>
<a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a>RSU:<span class="w"> </span>Sub-partition<span class="w"> </span>table<span class="w"> </span><span class="m">1</span><span class="w"> </span>offset<span class="w"> </span>0x00918000<span class="w"> </span>
<a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a>RSU:<span class="w"> </span>Sub-partition<span class="w"> </span>table<span class="w"> </span>content<span class="w"> </span>
<a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a><span class="w"> </span>BOOT_INFO<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000000000<span class="w"> </span>Length:<span class="w"> </span>0x00110000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000003<span class="w"> </span>
<a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="w"> </span>FACTORY_IMAGE<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000110000<span class="w"> </span>Length:<span class="w"> </span>0x00800000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000003<span class="w"> </span>
<a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="w"> </span>P1<span class="w"> </span>Offset:<span class="w"> </span>0x0000000001000000<span class="w"> </span>Length:<span class="w"> </span>0x01000000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a><span class="w"> </span>SPT0<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000910000<span class="w"> </span>Length:<span class="w"> </span>0x00010000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000001<span class="w"> </span>
<a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a><span class="w"> </span>SPT1<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000920000<span class="w"> </span>Length:<span class="w"> </span>0x00010000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000001<span class="w"> </span>
<a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a><span class="w"> </span>CPB0<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000930000<span class="w"> </span>Length:<span class="w"> </span>0x00010000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000001<span class="w"> </span>
<a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a><span class="w"> </span>CPB1<span class="w"> </span>Offset:<span class="w"> </span>0x0000000000940000<span class="w"> </span>Length:<span class="w"> </span>0x00010000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000001<span class="w"> </span>
<a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a><span class="w"> </span>P2<span class="w"> </span>Offset:<span class="w"> </span>0x0000000002000000<span class="w"> </span>Length:<span class="w"> </span>0x01000000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a><span class="w"> </span>P3<span class="w"> </span>Offset:<span class="w"> </span>0x0000000003000000<span class="w"> </span>Length:<span class="w"> </span>0x01000000<span class="w"> </span>Flag<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a><span class="w"> </span>RSU:<span class="w"> </span>CMF<span class="w"> </span>pointer<span class="w"> </span>block<span class="w"> </span>offset<span class="w"> </span>0x00930000<span class="w"> </span>
<a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a><span class="w"> </span>RSU:<span class="w"> </span>CMF<span class="w"> </span>pointer<span class="w"> </span>block<span class="err">&#39;</span>s<span class="w"> </span>image<span class="w"> </span>pointer<span class="w"> </span>list<span class="w"> </span>
<a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a><span class="w"> </span>Priority<span class="w"> </span><span class="m">1</span><span class="w"> </span>Offset:<span class="w"> </span>0x0000000001000000<span class="w"> </span>nslot:<span class="w"> </span><span class="m">0</span><span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Corrupt CPB0 by erasing the corresponding flash area.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x0930000 0x10000 </span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x930000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, the stop to U-Boot prompt and query the RSU status.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>FW<span class="w"> </span>detects<span class="w"> </span>corrupted<span class="w"> </span>CPB0<span class="w"> </span>but<span class="w"> </span>CPB1<span class="w"> </span>is<span class="w"> </span>fine<span class="w"> </span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>Restoring<span class="w"> </span>CPB0<span class="w"> </span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00100000<span class="w"> </span>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>State<span class="w"> </span>:<span class="w"> </span>0xf004d010<span class="w"> </span>
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>Version<span class="w"> </span>:<span class="w"> </span>0x0dcf0202<span class="w"> </span>
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
  The State field has the special error code 0xf004d010 which indicates that CPB0 was corrupted. The Last Fail Image has the special value 0x00100000 which is used in this case. The Version field indicates that the eror was reported by the decision firmware (0xDCF). The rsu_init function which is called first time an UBoot RSU command is executed detected the CPB corruption and recovered CPB0 from CPB1. </p>
</li>
<li>
<p>Save the CPB contents to a file, to be used later for recovery. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu save_cpb ${loadaddr} </span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="m">4100</span><span class="w"> </span>bytes<span class="w"> </span>CPB<span class="w"> </span>data<span class="w"> </span>saved<span class="w"> </span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>SOCFPGA<span class="w"> </span><span class="c1"># fatwrite mmc 0:1 ${loadaddr} cpb-backup.bin ${filesize} </span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="m">4100</span><span class="w"> </span>bytes<span class="w"> </span>written<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Corrupt both CPBs by erasing the flash at their location: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x0930000 0x10000 </span>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x930000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x0940000 0x10000 </span>
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x940000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, boot to U-Boot prompt and query RSU status.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>FW<span class="w"> </span>detects<span class="w"> </span>both<span class="w"> </span>CPBs<span class="w"> </span>corrupted<span class="w"> </span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00110000<span class="w"> </span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00100000<span class="w"> </span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>State<span class="w"> </span>:<span class="w"> </span>0xf004d011<span class="w"> </span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a>Version<span class="w"> </span>:<span class="w"> </span>0x0dcf0202<span class="w"> </span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
  The Current Image is reported as being the factory image, as expected. The State field has the special error code 0xf004d011 which indicates that both CPBs were corrupted. The Last Fail Image has the special value 0x00100000 which is used in this case. The Version field indicates that the eror was reported by the decision firmware (0xDCF). The rsu_init function which is called first time an U-Boot RSU command is executed detected and reported that both CPBs are corrupted. </p>
</li>
<li>
<p>Try to run a command which requires a valid CPB - it is rejected. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 0 </span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>corrupted<span class="w"> </span>CPB<span class="w"> </span>--run<span class="w"> </span>rsu<span class="w"> </span>create_empty_cpb<span class="w"> </span>or<span class="w"> </span>rsu<span class="w"> </span>restore_cpb<span class="w"> </span>&lt;address&gt;<span class="w"> </span>first<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Restore the saved CPB from the backup file that we created. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># fatload mmc 0:1 ${loadaddr} cpb-backup.bin </span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="m">4100</span><span class="w"> </span>bytes<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>ms<span class="w"> </span><span class="o">(</span><span class="m">1</span>.3<span class="w"> </span>MiB/s<span class="o">)</span><span class="w"> </span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu restore_cpb ${loadaddr} </span>
</code></pre></div>
</li>
<li>
<p>Clear the errors reported by firmware, as the CPB was restored. </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu clear_error_status </span>
</code></pre></div>
  Alternatively you can also power cycle or assert nCONFIG to clear the errors reported by firmware. </p>
</li>
<li>
<p>Try again to run a command which require a valid CPB - it succeeds. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 1 </span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>NAME:<span class="w"> </span>P2<span class="w"> </span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>OFFSET:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h4 id="corrupted-sub-partition-table">Corrupted Sub-Partition Table<a class="headerlink" href="#corrupted-sub-partition-table" title="Permanent link">&para;</a></h4>
<p>This example uses U-Boot commands to demonstrate how sub-partition table corruptions can be detected and recovered. </p>
<p><strong>Note</strong>: The commands listed in this example assume the initial flash image (JIC) was written to flash, with no other changes. </p>
<ol>
<li>
<p>Power up the board, boot up to the U-Boot prompt and query the RSU status. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>The highest priority image is running, and there are no errors. </p>
</li>
<li>
<p>Corrupt SPT0 file by erasing the flash at its location. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x0910000 0x10000 </span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x910000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, stop to U-Boot prompt and query RSU status. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>Bad<span class="w"> </span>SPT0<span class="w"> </span>magic<span class="w"> </span>number<span class="w"> </span>0xFFFFFFFF<span class="w"> </span>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>Restoring<span class="w"> </span>SPT0<span class="w"> </span>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>The decision firmware loads the higest priority image, and it does not look at the SPTs. The rsu_init function is called when the first RSU U-Boot command is executed, it detects that the SPT0 is corrupted, and it recovers it from SPT1. </p>
</li>
<li>
<p>Save the currently used SPT to a file for backup purposes. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu save_spt ${loadaddr} </span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="m">4100</span><span class="w"> </span>bytes<span class="w"> </span>SPT<span class="w"> </span>data<span class="w"> </span>saved<span class="w"> </span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>SOCFPGA<span class="w"> </span><span class="c1"># fatwrite mmc 0:1 ${loadaddr} spt-backup.bin ${filesize} </span>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="m">4100</span><span class="w"> </span>bytes<span class="w"> </span>written<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Corrupt both SPTs by erasing the flash at their locations. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x910000 0x10000 </span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x910000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x920000 0x10000 </span>
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x918000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, stop to U-Boot prompt and query RSU status. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log </span>
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>Bad<span class="w"> </span>SPT1<span class="w"> </span>magic<span class="w"> </span>number<span class="w"> </span>0xFFFFFFFF<span class="w"> </span>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>Bad<span class="w"> </span>SPT0<span class="w"> </span>magic<span class="w"> </span>number<span class="w"> </span>0xFFFFFFFF<span class="w"> </span>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>no<span class="w"> </span>valid<span class="w"> </span>SPT0<span class="w"> </span>and<span class="w"> </span>SPT1<span class="w"> </span>found<span class="w"> </span>
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
<p>The decision firmware loads the highest priority image, and it does not look at the SPTs. The rsu_init function is called when the first RSU U-Boot command is executed and it detects that both SPTs are corrupted. </p>
<p><strong>Note:</strong> In the case of having multiple SSBLs, corrupting both SPTs will make that U-Boot fail to be launched since without SPTs there is no way to identify the partitions available so it's not possible to determine which SSBL needs to be launched. </p>
</li>
<li>
<p>Try to run an RSU command which requires a valid SPT - it fails. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_count </span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>corrupted<span class="w"> </span>SPT<span class="w"> </span>--run<span class="w"> </span>rsu<span class="w"> </span>restore_spt<span class="w"> </span>&lt;address&gt;<span class="w"> </span>first<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Restore the SPT from the backup copy that we have created.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># fatload mmc 0:1 ${loadaddr} spt-backup.bin </span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="m">4100</span><span class="w"> </span>bytes<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>ms<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="w"> </span>MiB/s<span class="o">)</span><span class="w"> </span>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu restore_spt ${loadaddr} </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, the highest priority image loads, and all functionality is available. This power cycle is needed to cause the rsu_init function to be called in U-Boot, as it is only called once when the first RSU command is called. </p>
</li>
</ol>
<h3 id="using-the-combined-application-image">Using the Combined Application Image<a class="headerlink" href="#using-the-combined-application-image" title="Permanent link">&para;</a></h3>
<p>This section shows an example of using a combined application image, from U-Boot.
Similar commands can be used from Linux.</p>
<p>The combined application images are used the exact same way as regular application
images, just that they first update the decision firmware and decision firmware data if
necessary, before the device is configured with the functionality from the application
SOF.</p>
<p><strong>Note:</strong> The combined application images do not have absolute pointers inside like the regular application images, the factory update images, or the decision firmware update images. Because of this, they can be written to flash with any of the U-Boot and LibRSU APIs that write to slots.</p>
<ol>
<li>
<p>Program the RSU initial image created with the previous version (<strong>$TOP_FOLDER/initial_image_prev.jic</strong>).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>quartus_pgm<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>-m<span class="w"> </span>jtag<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;pvi;./initial_image_prev.jic&quot;</span>
</code></pre></div>
</li>
<li>
<p>Power cyle the board, stop to U-Boot prompt and query the decision firmware
information from U-Boot, this should be a previous version.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu display_dcmf_version</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>DCMF0<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.2.0<span class="w"> </span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>DCMF1<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.2.0<span class="w"> </span>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a>DCMF2<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.2.0<span class="w"> </span>
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a>DCMF3<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.2.0<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Find an unused slot (slot 1, P2), erase it, write the combined application image to it, verify that it was programmed successfully  and check it is now the highest priority.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_erase 1</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a>Slot<span class="w"> </span><span class="m">1</span><span class="w"> </span>erased.
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a>SOCFPGA<span class="w"> </span><span class="c1"># fatload mmc 0:1 ${loadaddr} combined_application.rpd</span>
<a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="m">151552</span><span class="w"> </span>bytes<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">9</span><span class="w"> </span>ms<span class="w"> </span><span class="o">(</span><span class="m">16</span>.1<span class="w"> </span>MiB/s<span class="o">)</span>
<a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_program_buf 1 ${loadaddr} ${filesize}</span>
<a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a>Slot<span class="w"> </span><span class="m">1</span><span class="w"> </span>was<span class="w"> </span>programmed<span class="w"> </span>with<span class="w"> </span><span class="nv">buffer</span><span class="o">=</span>0x0000000002000000<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">3510272</span>.
<a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_verify_buf 1 ${loadaddr} ${filesize}</span>
<a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a>Slot<span class="w"> </span><span class="m">1</span><span class="w"> </span>was<span class="w"> </span>verified<span class="w"> </span>with<span class="w"> </span><span class="nv">buffer</span><span class="o">=</span>0x0000000002000000<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">3510272</span>.
<a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_get_info 1</span>
<a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a>NAME:<span class="w"> </span>P2
<a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a>OFFSET:<span class="w"> </span>0x0000000002000000
<a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a>SIZE:<span class="w"> </span>0x01000000
<a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a>PRIORITY:<span class="w"> </span><span class="m">1</span>
</code></pre></div>
</li>
<li>
<p>Pass control to the combined application update image.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu slot_load 1</span>
</code></pre></div>
</li>
<li>
<p>The combined application image checks the currently used decision firmware copy, it sees that it is older, then it updates the decision firmware and decision firmware data, then it loads the actual application image section. Everything takes a few seconds.</p>
</li>
<li>
<p>Stop at U-Boot prompt and confirm the decision firmware is updated, and the
application image is running fine.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu status_log</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>Current<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x02000000
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>Last<span class="w"> </span>Fail<span class="w"> </span>Image<span class="w"> </span>:<span class="w"> </span>0x00000000
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>State<span class="w"> </span>:<span class="w"> </span>0x00000000
<a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a>Version<span class="w"> </span>:<span class="w"> </span>0x00000202
<a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a>Error<span class="w"> </span>location<span class="w"> </span>:<span class="w"> </span>0x00000000
<a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a>Error<span class="w"> </span>details<span class="w"> </span>:<span class="w"> </span>0x00000000
<a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a>Retry<span class="w"> </span>counter<span class="w"> </span>:<span class="w"> </span>0x00000000
<a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a>SOCFPGA<span class="w"> </span><span class="c1"># rsu display_dcmf_version</span>
<a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a>DCMF0<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0<span class="w"> </span>
<a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a>DCMF1<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0<span class="w"> </span>
<a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a>DCMF2<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0<span class="w"> </span>
<a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a>DCMF3<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0
</code></pre></div>
</li>
<li>
<p>Power cycle the board, the same combined application image is loaded, as it is the highest priority. But it takes a couple of seconds less, as the decision firmware does not need to be updated.</p>
</li>
</ol>
<h2 id="exercising-rsu-client">Exercising RSU Client<a class="headerlink" href="#exercising-rsu-client" title="Permanent link">&para;</a></h2>
<h3 id="basic-rsu-operations_1">Basic RSU Operations<a class="headerlink" href="#basic-rsu-operations_1" title="Permanent link">&para;</a></h3>
<p>This section demonstrates how to use the RSU client to perform the following basic operations.</p>
<ul>
<li>Querying the RSU status. </li>
<li>Querying the number of slots and the information about them. </li>
<li>Adding a new application image. </li>
<li>Verifying that the application image was written correctly. </li>
<li>Requesting a specific application image to be loaded. </li>
</ul>
<p><strong>Note</strong>: This section assumes that the flash contains the initial RSU image. If that is not true, you need to re-flash the initial image, as shown in the Flashing the Initial RSU Image to QSPI section. </p>
<p><strong>Note:</strong> RSU functionality in Linux is enabled starting on 24.2 release.</p>
<ol>
<li>
<p>Power up the board and let Linux boot. </p>
</li>
<li>
<p>Log in using <strong>root</strong> as user name, no password is required. </p>
</li>
<li>
<p>Run the rsu_client without parameters, to display its help message. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>--<span class="w"> </span>RSU<span class="w"> </span>app<span class="w"> </span>usage<span class="w"> </span>--<span class="w"> </span>
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>-c<span class="p">|</span>--count<span class="w"> </span>get<span class="w"> </span>the<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>slots<span class="w"> </span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>-l<span class="p">|</span>--list<span class="w"> </span>slot_num<span class="w"> </span>list<span class="w"> </span>the<span class="w"> </span>attribute<span class="w"> </span>info<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>-z<span class="p">|</span>--size<span class="w"> </span>slot_num<span class="w"> </span>get<span class="w"> </span>the<span class="w"> </span>slot<span class="w"> </span>size<span class="w"> </span><span class="k">in</span><span class="w"> </span>bytes<span class="w"> </span>
<a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>-p<span class="p">|</span>--priority<span class="w"> </span>slot_num<span class="w"> </span>get<span class="w"> </span>the<span class="w"> </span>priority<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a>-E<span class="p">|</span>--enable<span class="w"> </span>slot_num<span class="w"> </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span>as<span class="w"> </span>the<span class="w"> </span>highest<span class="w"> </span>priority<span class="w"> </span>
<a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a>-D<span class="p">|</span>--disable<span class="w"> </span>slot_num<span class="w"> </span>disable<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span>but<span class="w"> </span>to<span class="w"> </span>not<span class="w"> </span>erase<span class="w"> </span>it<span class="w"> </span>
<a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>-r<span class="p">|</span>--request<span class="w"> </span>slot_num<span class="w"> </span>request<span class="w"> </span>the<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>loaded<span class="w"> </span>after<span class="w"> </span>the<span class="w"> </span>next<span class="w"> </span>reboot<span class="w"> </span>
<a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a>-R<span class="p">|</span>--request-factory<span class="w"> </span>request<span class="w"> </span>the<span class="w"> </span>factory<span class="w"> </span>image<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>loaded<span class="w"> </span>after<span class="w"> </span>the<span class="w"> </span>next<span class="w"> </span>reboot<span class="w"> </span>
<a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a>-e<span class="p">|</span>--erase<span class="w"> </span>slot_num<span class="w"> </span>erase<span class="w"> </span>app<span class="w"> </span>image<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a>-a<span class="p">|</span>--add<span class="w"> </span>file_name<span class="w"> </span>-s<span class="p">|</span>--slot<span class="w"> </span>slot_num<span class="w"> </span>add<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>app<span class="w"> </span>image<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a>-u<span class="p">|</span>--add-factory-update<span class="w"> </span>file_name<span class="w"> </span>-s<span class="p">|</span>--slot<span class="w"> </span>slot_num<span class="w"> </span>add<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>factory<span class="w"> </span>update<span class="w"> </span>image<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a>-A<span class="p">|</span>--add-raw<span class="w"> </span>file_name<span class="w"> </span>-s<span class="p">|</span>--slot<span class="w"> </span>slot_num<span class="w"> </span>add<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>raw<span class="w"> </span>image<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a>-v<span class="p">|</span>--verify<span class="w"> </span>file_name<span class="w"> </span>-s<span class="p">|</span>--slot<span class="w"> </span>slot_num<span class="w"> </span>verify<span class="w"> </span>app<span class="w"> </span>image<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a>-V<span class="p">|</span>--verify-raw<span class="w"> </span>file_name<span class="w"> </span>-s<span class="p">|</span>--slot<span class="w"> </span>slot_num<span class="w"> </span>verify<span class="w"> </span>raw<span class="w"> </span>image<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span>
<a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a>-f<span class="p">|</span>--copy<span class="w"> </span>file_name<span class="w"> </span>-s<span class="p">|</span>--slot<span class="w"> </span>slot_num<span class="w"> </span><span class="nb">read</span><span class="w"> </span>the<span class="w"> </span>data<span class="w"> </span><span class="k">in</span><span class="w"> </span>a<span class="w"> </span>selected<span class="w"> </span>slot<span class="w"> </span><span class="k">then</span><span class="w"> </span>write<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>file<span class="w"> </span>
<a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a>-g<span class="p">|</span>--log<span class="w"> </span>print<span class="w"> </span>the<span class="w"> </span>status<span class="w"> </span>log<span class="w"> </span>
<a id="__codelineno-88-19" name="__codelineno-88-19" href="#__codelineno-88-19"></a>-n<span class="p">|</span>--notify<span class="w"> </span>value<span class="w"> </span>report<span class="w"> </span>software<span class="w"> </span>state<span class="w"> </span>
<a id="__codelineno-88-20" name="__codelineno-88-20" href="#__codelineno-88-20"></a>-C<span class="p">|</span>--clear-error-status<span class="w"> </span>clear<span class="w"> </span>errors<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>log<span class="w"> </span>
<a id="__codelineno-88-21" name="__codelineno-88-21" href="#__codelineno-88-21"></a>-Z<span class="p">|</span>--reset-retry-counter<span class="w"> </span>reset<span class="w"> </span>current<span class="w"> </span>retry<span class="w"> </span>counter<span class="w"> </span>
<a id="__codelineno-88-22" name="__codelineno-88-22" href="#__codelineno-88-22"></a>-m<span class="p">|</span>--display-dcmf-version<span class="w"> </span>print<span class="w"> </span>DCMF<span class="w"> </span>version<span class="w"> </span>
<a id="__codelineno-88-23" name="__codelineno-88-23" href="#__codelineno-88-23"></a>-y<span class="p">|</span>--display-dcmf-status<span class="w"> </span>print<span class="w"> </span>DCMF<span class="w"> </span>status<span class="w"> </span>
<a id="__codelineno-88-24" name="__codelineno-88-24" href="#__codelineno-88-24"></a>-x<span class="p">|</span>--display-max-retry<span class="w"> </span>print<span class="w"> </span>max_retry<span class="w"> </span>parameter<span class="w"> </span>
<a id="__codelineno-88-25" name="__codelineno-88-25" href="#__codelineno-88-25"></a>-t<span class="p">|</span>--create-slot<span class="w"> </span>slot_name<span class="w"> </span>-S<span class="p">|</span>--address<span class="w"> </span>slot_address<span class="w"> </span>-L<span class="p">|</span>--length<span class="w"> </span>slot_size<span class="w"> </span>create<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>slot<span class="w"> </span>using<span class="w"> </span>unallocated<span class="w"> </span>space<span class="w"> </span>
<a id="__codelineno-88-26" name="__codelineno-88-26" href="#__codelineno-88-26"></a>-d<span class="p">|</span>--delete-slot<span class="w"> </span>slot_num<span class="w"> </span>delete<span class="w"> </span>selected<span class="w"> </span>slot,<span class="w"> </span>freeing<span class="w"> </span>up<span class="w"> </span>allocated<span class="w"> </span>space<span class="w"> </span>
<a id="__codelineno-88-27" name="__codelineno-88-27" href="#__codelineno-88-27"></a>-W<span class="p">|</span>--restore-spt<span class="w"> </span>file_name<span class="w"> </span>restore<span class="w"> </span>spt<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>file<span class="w"> </span>
<a id="__codelineno-88-28" name="__codelineno-88-28" href="#__codelineno-88-28"></a>-X<span class="p">|</span>--save-spt<span class="w"> </span>file_name<span class="w"> </span>save<span class="w"> </span>spt<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>file<span class="w"> </span>
<a id="__codelineno-88-29" name="__codelineno-88-29" href="#__codelineno-88-29"></a>-b<span class="p">|</span>--create-empty-cpb<span class="w"> </span>create<span class="w"> </span>a<span class="w"> </span>empty<span class="w"> </span>cpb<span class="w"> </span>
<a id="__codelineno-88-30" name="__codelineno-88-30" href="#__codelineno-88-30"></a>-B<span class="p">|</span>--restore-cpb<span class="w"> </span>file_name<span class="w"> </span>restore<span class="w"> </span>cpb<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>file<span class="w"> </span>
<a id="__codelineno-88-31" name="__codelineno-88-31" href="#__codelineno-88-31"></a>-P<span class="p">|</span>--save-cpb<span class="w"> </span>file_name<span class="w"> </span>save<span class="w"> </span>cpb<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>file<span class="w"> </span>
<a id="__codelineno-88-32" name="__codelineno-88-32" href="#__codelineno-88-32"></a>-k<span class="p">|</span>--check-running-factory<span class="w"> </span>check<span class="w"> </span><span class="k">if</span><span class="w"> </span>currently<span class="w"> </span>running<span class="w"> </span>the<span class="w"> </span>factory<span class="w"> </span>image<span class="w"> </span>
<a id="__codelineno-88-33" name="__codelineno-88-33" href="#__codelineno-88-33"></a>-h<span class="p">|</span>--help<span class="w"> </span>show<span class="w"> </span>usage<span class="w"> </span>message<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Exercise the rsu_client command that displays the current status, it shows the application image from slot 0 (partition P1) is loaded with no errors.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Run the RSU client commands that display information about the slots.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--count<span class="w"> </span>
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>number<span class="w"> </span>of<span class="w"> </span>slots<span class="w"> </span>is<span class="w"> </span><span class="m">3</span><span class="w"> </span>
<a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">0</span><span class="w"> </span>
<a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a>NAME:<span class="w"> </span>P1<span class="w"> </span>
<a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a>OFFSET:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a>NAME:<span class="w"> </span>P2<span class="w"> </span>
<a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a>OFFSET:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-90-16" name="__codelineno-90-16" href="#__codelineno-90-16"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-90-17" name="__codelineno-90-17" href="#__codelineno-90-17"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-90-18" name="__codelineno-90-18" href="#__codelineno-90-18"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-90-19" name="__codelineno-90-19" href="#__codelineno-90-19"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-90-20" name="__codelineno-90-20" href="#__codelineno-90-20"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-90-21" name="__codelineno-90-21" href="#__codelineno-90-21"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Display the decision firmware version information.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--display-dcmf-version<span class="w"> </span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a>DCMF0<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0<span class="w"> </span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>DCMF1<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a>DCMF2<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0
<a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a>DCMF3<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span>.3.0
<a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Erase slot 1 and add the application2.rpd application image to slot 1 (partition P2).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--erase<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--add<span class="w"> </span>application2.rpd<span class="w"> </span>--slot<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Verify that the application image was written correctly to flash.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--verify<span class="w"> </span>application2.rpd<span class="w"> </span>--slot<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>List again the slots, it shows the most recently written partition P2 image having the highest priority (lowest priority number that is).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">0</span><span class="w"> </span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>NAME:<span class="w"> </span>P1<span class="w"> </span>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>OFFSET:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>PRIORITY:<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>NAME:<span class="w"> </span>P2<span class="w"> </span>
<a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>OFFSET:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-94-17" name="__codelineno-94-17" href="#__codelineno-94-17"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-94-18" name="__codelineno-94-18" href="#__codelineno-94-18"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, boot Linux, and display the status.  It shows the image from partition P2 running.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p><strong>Important Note</strong>: Causing the newly written application image to be loaded can also be done without a power cycle, by requesting a specific image to be loaded, using the following commands.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>./rsu_client<span class="w"> </span>--request<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a>reboot<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Instruct the RSU client to request slot 0 (partition P1) from SDM on next reboot command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--request<span class="w"> </span><span class="m">0</span><span class="w"> </span>
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Restart Linux by running the reboot command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>root@linux:~#<span class="w"> </span>reboot<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Log into Linux and display the RSU status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>The status shows that the image from partition P1 was loaded, as requested. </p>
</li>
</ol>
<h3 id="watchdog-and-max-retry-operation_1">Watchdog and Max Retry Operation<a class="headerlink" href="#watchdog-and-max-retry-operation_1" title="Permanent link">&para;</a></h3>
<p>This section uses the RSU client to demonstrate the following. </p>
<ul>
<li>RSU handling of watchdog timeouts. </li>
<li>max retry feature, which allows each image up to three times to load. </li>
<li>RSU notify, which allows the HPS software state to be reported and retrieved after a watchdog timeout. </li>
<li>Clearing the RSU status error fields. </li>
<li>Resetting the current retry counter value. </li>
</ul>
<p><strong>Note</strong>: The commands listed in this section rely on the commands from the Basic Operation section running first, specifically adding image P2 to the flash. </p>
<ol>
<li>
<p>Power up the board, boot Linux, and display the status. It shows the P2 image running, as it is the highest priority.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>What do the version fields mean is described next.</p>
<p>- Version field is 0x00000202:both decision firmware and application firmware RSU interface versions are 2, and the system supports the max retry feature. <br>
  - Retry counter is 0x00000000: first attempt to load this image. <br>
  - State is 0x00000000: No errors to report .<br></p>
</li>
<li>
<p>Query and display the max_retry value.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--display-max-retry<span class="w"> </span>
<a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="nv">max_retry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>
<a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p><strong>Note</strong>: The max_retry option must be queried from U-Boot first, in order for it to be available on Linux. </p>
</li>
<li>
<p>Enable the watchdog but do not service it, as this produces a timeout, and restarts Linux.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>root@linux:~#<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;something&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/watchdog<span class="w"> </span>
<a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="o">[</span><span class="w"> </span><span class="m">603</span>.649746<span class="o">]</span><span class="w"> </span>watchdog:<span class="w"> </span>watchdog0:<span class="w"> </span>watchdog<span class="w"> </span>did<span class="w"> </span>not<span class="w"> </span>stop!<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Wait for Linux to restart after the watchdog timeout, then display the log.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a>VERSION:<span class="w"> </span>0x0ACF0202<span class="w"> </span>
<a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a>STATE:<span class="w"> </span>0xF0060002<span class="w"> </span>
<a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000001<span class="w"> </span>
<a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>The same P2 image is loaded, but the retry counter value is now one, which means this is the second retry for this image to be loaded. The version field shows the last failure was by an application image (0xACF). The state field shows the last error was a watchdog timeout (0xF006) and that the latest notify value from HPS software was from U-Boot loading Linux (0x0002). </p>
</li>
<li>
<p>Clear the error status so we can see the next errors. Query the status to show the errors were cleared. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--clear-error-status<span class="w"> </span>
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000001<span class="w"> </span>
<a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Cause another watchdog timeout and wait for Linux to restart. After the restart, query the RSU log and observe that the retry counter is now two.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a>VERSION:<span class="w"> </span>0x0ACF0202<span class="w"> </span>
<a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a>STATE:<span class="w"> </span>0xF0060002<span class="w"> </span>
<a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-105-7" name="__codelineno-105-7" href="#__codelineno-105-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-105-8" name="__codelineno-105-8" href="#__codelineno-105-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000002<span class="w"> </span>
<a id="__codelineno-105-9" name="__codelineno-105-9" href="#__codelineno-105-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Clear the error status so we can see the next errors. </p>
</li>
<li>
<p>Notify the SDM of the HPS execution stage as a 16bit number. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--notify<span class="w"> </span>0x1234<span class="w"> </span>
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Cause another watchdog timeout and watch for Linux to restart. After the restart, query the RSU log. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a>VERSION:<span class="w"> </span>0x0ACF0202<span class="w"> </span>
<a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a>STATE:<span class="w"> </span>0xF0061234<span class="w"> </span>
<a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>The SDM loaded the next application image in the CPB (P1), and it reports that the image P2 failed. The state indicates that a watchdog timeout occurred (upper 16 bits = 0xF006) and that the notify value reported by HPS software was 0x1234. The upper 16 bits of the version are set to 0x0ACF which means the previous error was reported by the application image firmware. </p>
</li>
<li>
<p>Clear the error status so we can see the next errors. </p>
</li>
<li>
<p>Cause a watchdog timeout and display the status - it shows a retry counter value of one.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a>VERSION:<span class="w"> </span>0x0ACF0202<span class="w"> </span>
<a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a>STATE:<span class="w"> </span>0xF0060002<span class="w"> </span>
<a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000001<span class="w"> </span>
<a id="__codelineno-108-9" name="__codelineno-108-9" href="#__codelineno-108-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Use the RSU client to reset the current retry counter value to zero, and query the status again to confirm it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--reset-retry-counter<span class="w"> </span>
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a>VERSION:<span class="w"> </span>0x0ACF0202<span class="w"> </span>
<a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a>STATE:<span class="w"> </span>0xF0060002<span class="w"> </span>
<a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-109-11" name="__codelineno-109-11" href="#__codelineno-109-11"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h3 id="updating-the-factory-image_1">Updating the Factory Image<a class="headerlink" href="#updating-the-factory-image_1" title="Permanent link">&para;</a></h3>
<p>This section demonstrates how to use the RSU client to update the factory image. </p>
<p><strong>Note</strong>: The commands listed in this section rely on the commands from the Basic Operation section running first, specifically adding an application image to the P2 flash partition. </p>
<ol>
<li>
<p>Power up the board, boot Linux and display the status. It shows the P2 image running, as it is the highest priority.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Confirm that slot 2 (partition P3) is not used, erase slot 2, write the factory update image to it, and verify it was written correctly.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--erase<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--add-factory-update<span class="w"> </span>factory_update.rpd<span class="w"> </span>--slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-111-10" name="__codelineno-111-10" href="#__codelineno-111-10"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-111-11" name="__codelineno-111-11" href="#__codelineno-111-11"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--verify<span class="w"> </span>factory_update.rpd<span class="w"> </span>--slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-111-12" name="__codelineno-111-12" href="#__codelineno-111-12"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Confirm that slot 2 is now the highest priority in the CPB.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Instruct the RSU client to request slot 2 (partition P3) to be loaded on next reboot command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--request<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Restart Linux by running the reboot command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>root@linux:~#<span class="w"> </span>reboot<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Linux shuts down, then the factory update image updates the decision firmware, decision firmware data and factory image in flash. This takes a few seconds, and there is no activity on the serial console during this time. Then it removes itself from the CPB and loads the now highest priority image in the CPB. Confirm that P2 is now loaded and P3 is disabled.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-115-13" name="__codelineno-115-13" href="#__codelineno-115-13"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-115-14" name="__codelineno-115-14" href="#__codelineno-115-14"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-115-15" name="__codelineno-115-15" href="#__codelineno-115-15"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h3 id="fallback-on-flash-corruption-of-application-images_1">Fallback on Flash Corruption of Application Images<a class="headerlink" href="#fallback-on-flash-corruption-of-application-images_1" title="Permanent link">&para;</a></h3>
<p>This section uses the RSU client to demonstrate falling back in case of configuration errors caused by flash corruption of application images. </p>
<p><strong>Note</strong>: The commands listed in this section rely on the commands from the Basic Operation section running first, specifically adding image P2 to the flash. </p>
<ol>
<li>
<p>Power up the board, boot Linux and display the status:  It shows the P2 image running, as it is the highest priority.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-116-9" name="__codelineno-116-9" href="#__codelineno-116-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>What do the version fields mean is indicated next.</p>
<p>- Version field is 0x00000202: both decision firmware and application firmware RSU interface versions are 2, and the system supports the max retry feature. <br>
  - Retry counter is 0x00000000: first attempt to load this image. <br>
  - State is 0x00000000: No errors to report <br></p>
</li>
<li>
<p>Erase slot 1, which also takes it out of CPB. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--erase<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Create a file with random data, and write it to the P2 slot.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>root@linux:~#<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/urandom<span class="w"> </span><span class="nv">of</span><span class="o">=</span>corrupt.rpd<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M<span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="m">1</span>+0<span class="w"> </span>records<span class="w"> </span><span class="k">in</span><span class="w"> </span>
<a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="m">1</span>+0<span class="w"> </span>records<span class="w"> </span>out<span class="w"> </span>
<a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--add-raw<span class="w"> </span>corrupt.rpd<span class="w"> </span>--slot<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Enable the P2 slot, which puts it as the highest priority in the CPB. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--enable<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Confirm that P2 is now the highest priority in the CPB.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a>NAME:<span class="w"> </span>P2<span class="w"> </span>
<a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a>OFFSET:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, boot Linux and query the RSU log.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a>VERSION:<span class="w"> </span>0x0DCF0202<span class="w"> </span>
<a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a>STATE:<span class="w"> </span>0xF004D003<span class="w"> </span>
<a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>The current image is P1, and the P2 shows as failed. The top 4 bits of the version field are set to 0x0which means the currently used DCMF index is zero. Th next 12bit of the version field are set as 0xDCF which means the error was caused by the decision firmware, because it was not able to load the image. The top 16 bits of the state field are set to 0xF004, which indicates an internal error. For more information, refer to RSU Status and Error Codes on the RSU User Guide. </p>
</li>
<li>
<p>Clear the error status and display the log again to confirm it was cleared.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--clear-error-status<span class="w"> </span>
<a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h3 id="additional-flash-corruption-detection-and-recovery_1">Additional Flash Corruption Detection and Recovery<a class="headerlink" href="#additional-flash-corruption-detection-and-recovery_1" title="Permanent link">&para;</a></h3>
<p>This section presents examples of detecting and recovering corrupted decision firmware, decision firmware data, configuration pointer blocks and sub-partition tables with the aid of the RSU client. </p>
<h4 id="corrupted-decision-firmware_1">Corrupted Decision Firmware<a class="headerlink" href="#corrupted-decision-firmware_1" title="Permanent link">&para;</a></h4>
<p>This example uses the RSU client to demonstrate detecting that some decision firmware copies are corrupted, and recovering them by running a decision firmware update image. The task uses U-Boot to corrupt flash, as it is the only component which has direct access to decision firmware. </p>
<p><strong>Note</strong>: The commands listed in this example assume the initial flash image (JIC) was written to flash, with no other changes. </p>
<p><strong>Note</strong>: The rsu display_dcmf_version command is called automatically by current U-Boot before booting Linux. This is required to have the status available in Linux. </p>
<ol>
<li>
<p>Power up the board, boot up to Linux. </p>
</li>
<li>
<p>Query RSU status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-123-6" name="__codelineno-123-6" href="#__codelineno-123-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-123-7" name="__codelineno-123-7" href="#__codelineno-123-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-123-8" name="__codelineno-123-8" href="#__codelineno-123-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-123-9" name="__codelineno-123-9" href="#__codelineno-123-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>The top four bits of the state field are 0x0 which means the currently used decision firmware index is zero. There are no errors. </p>
</li>
<li>
<p>Display decision firmware status, it shows no corruptions. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--display-dcmf-status<span class="w"> </span>
<a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a>DCMF0:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a>DCMF1:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a>DCMF2:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a>DCMF3:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle board, stop to U-Boot, corrupt decision firmware copies 0 and 2.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0 0x10000 </span>
<a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x0<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x100000 0x10000 </span>
<a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x100000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, boot to Linux, query the RSU status and decision firmware status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a>VERSION:<span class="w"> </span>0x10000202<span class="w"> </span>
<a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-126-7" name="__codelineno-126-7" href="#__codelineno-126-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-126-8" name="__codelineno-126-8" href="#__codelineno-126-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-126-9" name="__codelineno-126-9" href="#__codelineno-126-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-126-10" name="__codelineno-126-10" href="#__codelineno-126-10"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--display-dcmf-status<span class="w"> </span>
<a id="__codelineno-126-11" name="__codelineno-126-11" href="#__codelineno-126-11"></a>DCMF0:<span class="w"> </span>Corrupted<span class="w"> </span>
<a id="__codelineno-126-12" name="__codelineno-126-12" href="#__codelineno-126-12"></a>DCMF1:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-126-13" name="__codelineno-126-13" href="#__codelineno-126-13"></a>DCMF2:<span class="w"> </span>Corrupted<span class="w"> </span>
<a id="__codelineno-126-14" name="__codelineno-126-14" href="#__codelineno-126-14"></a>DCMF3:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-126-15" name="__codelineno-126-15" href="#__codelineno-126-15"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>The currently used copy of the decision firmware is 1, as indicated by top four bits of the version field. There are no errors reported by firmware. The decision firmware copies 0 and 2 are detected as corrupted. </p>
</li>
<li>
<p>Erase an unused slot, add the decision firmware update image to the slot, verify it was written fine, and confirm it is now the highest priority running slot.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--erase<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--add-factory-update<span class="w"> </span>
<a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a>decision_firmware_update.rpd<span class="w"> </span>--slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--verify<span class="w"> </span>decision_firmware_update.rpd<span class="w"> </span>--slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-127-7" name="__codelineno-127-7" href="#__codelineno-127-7"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-127-8" name="__codelineno-127-8" href="#__codelineno-127-8"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-127-9" name="__codelineno-127-9" href="#__codelineno-127-9"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-127-10" name="__codelineno-127-10" href="#__codelineno-127-10"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-127-11" name="__codelineno-127-11" href="#__codelineno-127-11"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-127-12" name="__codelineno-127-12" href="#__codelineno-127-12"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-127-13" name="__codelineno-127-13" href="#__codelineno-127-13"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Pass control to the decision firmware update image.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--request<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a>root@linux:~#<span class="w"> </span>reboot<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Linux shuts down, then the decision firmware update image writes new decision firmware copies and new decision firmware data to flash, remove itself from CPB, then pass control to the highest priority image. Let it boot to Linux. </p>
</li>
<li>
<p>In Linux, query the RSU status and display the DCMF status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-129-10" name="__codelineno-129-10" href="#__codelineno-129-10"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--display-dcmf-status<span class="w"> </span>
<a id="__codelineno-129-11" name="__codelineno-129-11" href="#__codelineno-129-11"></a>DCMF0:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-129-12" name="__codelineno-129-12" href="#__codelineno-129-12"></a>DCMF1:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-129-13" name="__codelineno-129-13" href="#__codelineno-129-13"></a>DCMF2:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-129-14" name="__codelineno-129-14" href="#__codelineno-129-14"></a>DCMF3:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-129-15" name="__codelineno-129-15" href="#__codelineno-129-15"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>All decision firmware copies are reported as fine, and copy 0 is the one currently used, as expected. </p>
</li>
</ol>
<h4 id="corrupted-decision-firmware-data_1">Corrupted Decision Firmware Data<a class="headerlink" href="#corrupted-decision-firmware-data_1" title="Permanent link">&para;</a></h4>
<p>This example uses the RSU client to demonstrate detecting that the decision firmware data is corrupted, and recovering it by running a decision firmware update image. </p>
<p><strong>Note</strong>: The commands listed in this example assume the initial flash image (JIC) was written to flash, with no other changes. </p>
<ol>
<li>
<p>Power up the board, boot to Linux, and query RSU status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-130-8" name="__codelineno-130-8" href="#__codelineno-130-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-130-9" name="__codelineno-130-9" href="#__codelineno-130-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-130-10" name="__codelineno-130-10" href="#__codelineno-130-10"></a>There<span class="w"> </span>are<span class="w"> </span>no<span class="w"> </span>errors.<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Reboot power cycle the board, stop at U-Boot prompt, and corrupt decision firmware data. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x200000 0x10000 </span>
<a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x200000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, boot to Linux and query the status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a>VERSION:<span class="w"> </span>0x0DCF0202<span class="w"> </span>
<a id="__codelineno-132-3" name="__codelineno-132-3" href="#__codelineno-132-3"></a>STATE:<span class="w"> </span>0xF004D00F<span class="w"> </span>
<a id="__codelineno-132-4" name="__codelineno-132-4" href="#__codelineno-132-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000110000<span class="w"> </span>
<a id="__codelineno-132-5" name="__codelineno-132-5" href="#__codelineno-132-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000100000<span class="w"> </span>
<a id="__codelineno-132-6" name="__codelineno-132-6" href="#__codelineno-132-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-132-7" name="__codelineno-132-7" href="#__codelineno-132-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-132-8" name="__codelineno-132-8" href="#__codelineno-132-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-132-9" name="__codelineno-132-9" href="#__codelineno-132-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>The State contains the special error code 0xF004D00F indicating that the decision firmware data was corrupted. The current image is listed as the factory image. The error source is listed as 0xDCF, meaning the error was reported by the decision firmware. The Last Fail Image is set to 0x00100000, which is a special value indicating an error was reported by the decision firmware. </p>
</li>
<li>
<p>Erase an unused slot, add the decision firmware update image to the slot, verify it was written fine, and confirm it is now the highest priority running slot.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--erase<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--add-factory-update<span class="w"> </span>
<a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a>decision_firmware_update.rpd<span class="w"> </span>--slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--verify<span class="w"> </span>decision_firmware_update.rpd<span class="w"> </span>--<span class="w">    </span>slot<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-133-8" name="__codelineno-133-8" href="#__codelineno-133-8"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-133-9" name="__codelineno-133-9" href="#__codelineno-133-9"></a>NAME:<span class="w"> </span>P3<span class="w"> </span>
<a id="__codelineno-133-10" name="__codelineno-133-10" href="#__codelineno-133-10"></a>OFFSET:<span class="w"> </span>0x0000000003000000<span class="w"> </span>
<a id="__codelineno-133-11" name="__codelineno-133-11" href="#__codelineno-133-11"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-133-12" name="__codelineno-133-12" href="#__codelineno-133-12"></a>PRIORITY:<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-133-13" name="__codelineno-133-13" href="#__codelineno-133-13"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Pass control to the decision firmware update image. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--request<span class="w"> </span><span class="m">2</span><span class="w"> </span>
<a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a>root@linux:~#<span class="w"> </span>reboot<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Linux shuts down, then the decision firmware update image writes new decision firmware copies and new decision firmware data to flash, remove itself from CPB, then pass control to the highest priority image. </p>
</li>
<li>
<p>In Linux, query the RSU status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-135-5" name="__codelineno-135-5" href="#__codelineno-135-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-135-6" name="__codelineno-135-6" href="#__codelineno-135-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-135-7" name="__codelineno-135-7" href="#__codelineno-135-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-135-8" name="__codelineno-135-8" href="#__codelineno-135-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-135-9" name="__codelineno-135-9" href="#__codelineno-135-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>The highest priority image is loaded, and there are no errors. The decision firmware data was restored. </p>
</li>
</ol>
<h4 id="corrupted-configuration-pointer-block_1">Corrupted Configuration Pointer Block<a class="headerlink" href="#corrupted-configuration-pointer-block_1" title="Permanent link">&para;</a></h4>
<p>This section uses the RSU client to demonstrate how configuration pointer block corruptions can be detected and recovered. It also uses U-Boot to corrupt the CPB, as it's more conveniently done there. </p>
<p><strong>Note</strong>: The commands listed in this example assume the initial flash image (JIC) was written to flash, with no other changes. </p>
<ol>
<li>
<p>Power cycle the board, boot to Linux, and query RSU status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-136-6" name="__codelineno-136-6" href="#__codelineno-136-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-136-7" name="__codelineno-136-7" href="#__codelineno-136-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-136-8" name="__codelineno-136-8" href="#__codelineno-136-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-136-9" name="__codelineno-136-9" href="#__codelineno-136-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>There are no errors. </p>
</li>
<li>
<p>Reboot or power cycle the board, stop at U-Boot prompt, and corrupt CPB0 by erasing the corresponding flash area. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x0930000 0x10000 </span>
<a id="__codelineno-137-5" name="__codelineno-137-5" href="#__codelineno-137-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x920000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board. U-Boot runs, and before starting Linux, it executes a few RSU commands, which causes rsu_init to be called, and that restores CPB0 from the CPB1 copy.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a>FW<span class="w"> </span>detects<span class="w"> </span>corrupted<span class="w"> </span>CPB0<span class="w"> </span>but<span class="w"> </span>CPB1<span class="w"> </span>is<span class="w"> </span>fine<span class="w"> </span>
<a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a>Restoring<span class="w"> </span>CPB0<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Once Linux has booted, query the RSU status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>FW<span class="w"> </span>detects<span class="w"> </span>corrupted<span class="w"> </span>CPB0,<span class="w"> </span>fine<span class="w"> </span>CPB1<span class="w"> </span>
<a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>warning:<span class="w"> </span>Restoring<span class="w"> </span>CPB0<span class="w"> </span><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a>VERSION:<span class="w"> </span>0x0DCF0202<span class="w"> </span>
<a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a>STATE:<span class="w"> </span>0xF004D010<span class="w"> </span>
<a id="__codelineno-139-7" name="__codelineno-139-7" href="#__codelineno-139-7"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-139-8" name="__codelineno-139-8" href="#__codelineno-139-8"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000100000<span class="w"> </span>
<a id="__codelineno-139-9" name="__codelineno-139-9" href="#__codelineno-139-9"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-139-10" name="__codelineno-139-10" href="#__codelineno-139-10"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-139-11" name="__codelineno-139-11" href="#__codelineno-139-11"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-139-12" name="__codelineno-139-12" href="#__codelineno-139-12"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>The State field has the special error code 0xF004D010 which indicates that CPB0 was corrupted. The Last Fail Image has the special value 0x00100000 which is used in this case. The Version field indicates that the eror was reported by the decision firmware (0xDCF). Although the U-Boot already recovered CPB0 from CPB1, the firmware still reports CPB0 as corrupted, and LibRSU recovers it again. </p>
</li>
<li>
<p>Clear the error status, so that the firmware stops reporting CPB0 corrupted, and query RSU status again to verify there are no errors.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--clear-error-status<span class="w"> </span>
<a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>FW<span class="w"> </span>detects<span class="w"> </span>corrupted<span class="w"> </span>CPB0,<span class="w"> </span>fine<span class="w"> </span>CPB1<span class="w"> </span>
<a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>warning:<span class="w"> </span>Restoring<span class="w"> </span>CPB0<span class="w"> </span><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-140-8" name="__codelineno-140-8" href="#__codelineno-140-8"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-140-9" name="__codelineno-140-9" href="#__codelineno-140-9"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-140-10" name="__codelineno-140-10" href="#__codelineno-140-10"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-140-11" name="__codelineno-140-11" href="#__codelineno-140-11"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-140-12" name="__codelineno-140-12" href="#__codelineno-140-12"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-140-13" name="__codelineno-140-13" href="#__codelineno-140-13"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-140-14" name="__codelineno-140-14" href="#__codelineno-140-14"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, boot to Linux and query RSU status. Verify there are no errors.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-141-6" name="__codelineno-141-6" href="#__codelineno-141-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-141-7" name="__codelineno-141-7" href="#__codelineno-141-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-141-8" name="__codelineno-141-8" href="#__codelineno-141-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-141-9" name="__codelineno-141-9" href="#__codelineno-141-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Save the CPB contents to a file, to be used later for recovery. Also call sync command to make sure the file is saved to storage.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--save-cpb<span class="w"> </span>cpb-backup.bin<span class="w"> </span>
<a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a>root@linux:~#<span class="w"> </span>sync<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Reboot or power cycle, stop in U-Boot and corrupt both CPBs by erasing the flash at their location.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x0930000 0x10000 </span>
<a id="__codelineno-143-5" name="__codelineno-143-5" href="#__codelineno-143-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x930000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-143-6" name="__codelineno-143-6" href="#__codelineno-143-6"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x0940000 0x10000 </span>
<a id="__codelineno-143-7" name="__codelineno-143-7" href="#__codelineno-143-7"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x940000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, boot to Linux and query RSU status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>FW<span class="w"> </span>detects<span class="w"> </span>both<span class="w"> </span>CPBs<span class="w"> </span>corrupted<span class="w"> </span>
<a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a>VERSION:<span class="w"> </span>0x0DCF0202<span class="w"> </span>
<a id="__codelineno-144-5" name="__codelineno-144-5" href="#__codelineno-144-5"></a>STATE:<span class="w"> </span>0xF004D011<span class="w"> </span>
<a id="__codelineno-144-6" name="__codelineno-144-6" href="#__codelineno-144-6"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000110000<span class="w"> </span>
<a id="__codelineno-144-7" name="__codelineno-144-7" href="#__codelineno-144-7"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000100000<span class="w"> </span>
<a id="__codelineno-144-8" name="__codelineno-144-8" href="#__codelineno-144-8"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-144-9" name="__codelineno-144-9" href="#__codelineno-144-9"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-144-10" name="__codelineno-144-10" href="#__codelineno-144-10"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-144-11" name="__codelineno-144-11" href="#__codelineno-144-11"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>The Current Image is reported as being the factory image, as expected. The State field has the special error code 0xF004D011 which indicates that both CPBs were corrupted. The Last Fail Image has the special value 0x00100000 which is used in this case. The Version field indicates that the eror was reported by the decision firmware (0xDCF). The LibRSU reported that both CPBs are corrupted. </p>
</li>
<li>
<p>Try to run a command which requires a valid CPB - verify it is rejected.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>FW<span class="w"> </span>detects<span class="w"> </span>both<span class="w"> </span>CPBs<span class="w"> </span>corrupted<span class="w"> </span>
<a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-145-4" name="__codelineno-145-4" href="#__codelineno-145-4"></a>librsu:<span class="w"> </span>rsu_cpb_corrupted_info<span class="o">()</span>:<span class="w"> </span>corrupted<span class="w"> </span>CPB<span class="w"> </span>--<span class="w"> </span><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-145-5" name="__codelineno-145-5" href="#__codelineno-145-5"></a>librsu:<span class="w"> </span>rsu_cpb_corrupted_info<span class="o">()</span>:<span class="w"> </span>run<span class="w"> </span>rsu_client<span class="w"> </span>create-empty-cpb<span class="w"> </span>or<span class="w">     </span><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-145-6" name="__codelineno-145-6" href="#__codelineno-145-6"></a>librsu:<span class="w"> </span>rsu_cpb_corrupted_info<span class="o">()</span>:<span class="w"> </span>rsu_client<span class="w"> </span>restore_cpb<span class="w"> </span>first<span class="w"> </span>
<a id="__codelineno-145-7" name="__codelineno-145-7" href="#__codelineno-145-7"></a><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-145-8" name="__codelineno-145-8" href="#__codelineno-145-8"></a>ERROR:<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>slot<span class="w"> </span>attributes<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Clear errors, so that the CPBs are not reported as corrupted by the firmware anymore. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--clear-error-status<span class="w"> </span>
<a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>FW<span class="w"> </span>detects<span class="w"> </span>both<span class="w"> </span>CPBs<span class="w"> </span>corrupted<span class="w"> </span>
<a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-146-5" name="__codelineno-146-5" href="#__codelineno-146-5"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-146-6" name="__codelineno-146-6" href="#__codelineno-146-6"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>Bad<span class="w"> </span>CPB1<span class="w"> </span>is<span class="w"> </span>bad<span class="w"> </span><span class="o">[</span>MED<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-146-7" name="__codelineno-146-7" href="#__codelineno-146-7"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>Bad<span class="w"> </span>CPB0<span class="w"> </span>is<span class="w"> </span>bad<span class="w"> </span><span class="o">[</span>MED<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-146-8" name="__codelineno-146-8" href="#__codelineno-146-8"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>error:<span class="w"> </span>found<span class="w"> </span>both<span class="w"> </span>corrupted<span class="w"> </span>CPBs<span class="w"> </span><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-146-9" name="__codelineno-146-9" href="#__codelineno-146-9"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-146-10" name="__codelineno-146-10" href="#__codelineno-146-10"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-146-11" name="__codelineno-146-11" href="#__codelineno-146-11"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000110000<span class="w"> </span>
<a id="__codelineno-146-12" name="__codelineno-146-12" href="#__codelineno-146-12"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-146-13" name="__codelineno-146-13" href="#__codelineno-146-13"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-146-14" name="__codelineno-146-14" href="#__codelineno-146-14"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-146-15" name="__codelineno-146-15" href="#__codelineno-146-15"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-146-16" name="__codelineno-146-16" href="#__codelineno-146-16"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Restore the saved CPB from the backup file that we created.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--restore-cpb<span class="w"> </span>cpb-backup.bin<span class="w"> </span>
<a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>Bad<span class="w"> </span>CPB1<span class="w"> </span>is<span class="w"> </span>bad<span class="w"> </span><span class="o">[</span>MED<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-147-3" name="__codelineno-147-3" href="#__codelineno-147-3"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>Bad<span class="w"> </span>CPB0<span class="w"> </span>is<span class="w"> </span>bad<span class="w"> </span><span class="o">[</span>MED<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-147-4" name="__codelineno-147-4" href="#__codelineno-147-4"></a>librsu:<span class="w"> </span>load_cpb<span class="o">()</span>:<span class="w"> </span>error:<span class="w"> </span>found<span class="w"> </span>both<span class="w"> </span>corrupted<span class="w"> </span>CPBs<span class="w"> </span><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-147-5" name="__codelineno-147-5" href="#__codelineno-147-5"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Query again RSU status, there should be no errors signaled now.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-148-3" name="__codelineno-148-3" href="#__codelineno-148-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-148-4" name="__codelineno-148-4" href="#__codelineno-148-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000110000<span class="w"> </span>
<a id="__codelineno-148-5" name="__codelineno-148-5" href="#__codelineno-148-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-148-6" name="__codelineno-148-6" href="#__codelineno-148-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-148-7" name="__codelineno-148-7" href="#__codelineno-148-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-148-8" name="__codelineno-148-8" href="#__codelineno-148-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-148-9" name="__codelineno-148-9" href="#__codelineno-148-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Try to run a command which requires a valid CPB - verify it is not rejected.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--list<span class="w"> </span><span class="m">1</span><span class="w"> </span>
<a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a>NAME:<span class="w"> </span>P2<span class="w"> </span>
<a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a>OFFSET:<span class="w"> </span>0x0000000002000000<span class="w"> </span>
<a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a>SIZE:<span class="w"> </span>0x01000000<span class="w"> </span>
<a id="__codelineno-149-5" name="__codelineno-149-5" href="#__codelineno-149-5"></a>PRIORITY:<span class="w"> </span><span class="o">[</span>disabled<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-149-6" name="__codelineno-149-6" href="#__codelineno-149-6"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h4 id="corrupted-sub-partition-table_1">Corrupted Sub-Partition Table<a class="headerlink" href="#corrupted-sub-partition-table_1" title="Permanent link">&para;</a></h4>
<p>This example uses the RSU client to demonstrate how sub-partition table corruptions can be detected and recovered. It also uses U-Boot to corrupt the SPT, as it's more conveniently done there. </p>
<p><strong>Note</strong>: The commands listed in this example assume the initial flash image (JIC) was written to flash, with no other changes. </p>
<ol>
<li>
<p>Power cycle the board, boot to Linux, and query RSU status.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-150-5" name="__codelineno-150-5" href="#__codelineno-150-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-150-6" name="__codelineno-150-6" href="#__codelineno-150-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-150-7" name="__codelineno-150-7" href="#__codelineno-150-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-150-8" name="__codelineno-150-8" href="#__codelineno-150-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-150-9" name="__codelineno-150-9" href="#__codelineno-150-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>There are no errors. </p>
</li>
<li>
<p>Reboot or power cycle the board, stop at U-Boot prompt, and corrupt SPT0 by erasing the corresponding flash area.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-151-4" name="__codelineno-151-4" href="#__codelineno-151-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x0910000 0x10000 </span>
<a id="__codelineno-151-5" name="__codelineno-151-5" href="#__codelineno-151-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x910000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board. U-Boot runs, and before booting Linux it runs a few RSU commands. Running the first one causes rsu_init to be called, which detects corrupted SPT0 and recovers it from SPT1.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a>Bad<span class="w"> </span>SPT0<span class="w"> </span>magic<span class="w"> </span>number<span class="w"> </span>0xFFFFFFFF<span class="w"> </span>
<a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a>Restoring<span class="w"> </span>SPT0<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Boot to Linux and query RSU status: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-153-5" name="__codelineno-153-5" href="#__codelineno-153-5"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-153-6" name="__codelineno-153-6" href="#__codelineno-153-6"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-153-7" name="__codelineno-153-7" href="#__codelineno-153-7"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-153-8" name="__codelineno-153-8" href="#__codelineno-153-8"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-153-9" name="__codelineno-153-9" href="#__codelineno-153-9"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
<p>There are no errors </p>
</li>
<li>
<p>Save the currently used SPT to a file for backup purposes. Also call sync command to make sure the file is committed to flash.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--save-spt<span class="w"> </span>spt-backup.bin<span class="w"> </span>
<a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
<a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a>root@linux:~#<span class="w"> </span>sync<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Reboot or power cycle, stop to U-Boot and corrupt both SPTs by erasing the flash at their locations.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf probe </span>
<a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a>SF:<span class="w"> </span>Detected<span class="w"> </span>mt25qu02g<span class="w"> </span>with<span class="w"> </span>page<span class="w"> </span>size<span class="w"> </span><span class="m">256</span><span class="w"> </span>Bytes,<span class="w"> </span>erase<span class="w"> </span>size<span class="w"> </span><span class="m">4</span><span class="w"> </span>KiB,<span class="w"> </span>total<span class="w"> </span>
<a id="__codelineno-155-3" name="__codelineno-155-3" href="#__codelineno-155-3"></a><span class="m">256</span><span class="w"> </span>MiB<span class="w"> </span>
<a id="__codelineno-155-4" name="__codelineno-155-4" href="#__codelineno-155-4"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x910000 0x10000 </span>
<a id="__codelineno-155-5" name="__codelineno-155-5" href="#__codelineno-155-5"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x910000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
<a id="__codelineno-155-6" name="__codelineno-155-6" href="#__codelineno-155-6"></a>SOCFPGA<span class="w"> </span><span class="c1"># sf erase 0x920000 0x10000 </span>
<a id="__codelineno-155-7" name="__codelineno-155-7" href="#__codelineno-155-7"></a>SF:<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bytes<span class="w"> </span>@<span class="w"> </span>0x920000<span class="w"> </span>Erased:<span class="w"> </span>OK<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Power cycle the board, boot to Linux, and query RSU status. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--log<span class="w"> </span>
<a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a>librsu:<span class="w"> </span>load_spt<span class="o">()</span>:<span class="w"> </span>Bad<span class="w"> </span>SPT1<span class="w"> </span>magic<span class="w"> </span>number<span class="w"> </span>0xFFFFFFFF<span class="w"> </span><span class="o">[</span>MED<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a>librsu:<span class="w"> </span>load_spt<span class="o">()</span>:<span class="w"> </span>Bad<span class="w"> </span>SPT0<span class="w"> </span>magic<span class="w"> </span>number<span class="w"> </span>0xFFFFFFFF<span class="w"> </span><span class="o">[</span>MED<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a>librsu:<span class="w"> </span>load_spt<span class="o">()</span>:<span class="w"> </span>error:<span class="w"> </span>No<span class="w"> </span>valid<span class="w"> </span>SPT0<span class="w"> </span>or<span class="w"> </span>SPT1<span class="w"> </span>found<span class="w"> </span><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-156-5" name="__codelineno-156-5" href="#__codelineno-156-5"></a>VERSION:<span class="w"> </span>0x00000202<span class="w"> </span>
<a id="__codelineno-156-6" name="__codelineno-156-6" href="#__codelineno-156-6"></a>STATE:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-156-7" name="__codelineno-156-7" href="#__codelineno-156-7"></a>CURRENT<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000001000000<span class="w"> </span>
<a id="__codelineno-156-8" name="__codelineno-156-8" href="#__codelineno-156-8"></a>FAIL<span class="w"> </span>IMAGE:<span class="w"> </span>0x0000000000000000<span class="w"> </span>
<a id="__codelineno-156-9" name="__codelineno-156-9" href="#__codelineno-156-9"></a>ERROR<span class="w"> </span>LOC:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-156-10" name="__codelineno-156-10" href="#__codelineno-156-10"></a>ERROR<span class="w"> </span>DETAILS:<span class="w"> </span>0x00000000<span class="w"> </span>
<a id="__codelineno-156-11" name="__codelineno-156-11" href="#__codelineno-156-11"></a>RETRY<span class="w"> </span>COUNTER:<span class="w"> </span>0x00000000<span class="w"> </span>
</code></pre></div>
</li>
</ol>
<p>The decision firmware loads the higest priority image, and it does not look at the SPTs. The LibRSU detects that both SPTs are corrupted. 
<strong>Note:</strong> In the case of having multiple SSBLs, corrupting both SPTs will make that U-Boot fail to be launched since without SPTs there is no way to identify the partitions available so it's not possible to determine which SSBL needs to be launched. </p>
<ol>
<li>
<p>Try to run an RSU client command which requires a valid SPT - it fails. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--count<span class="w"> </span>
<a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a>librsu:<span class="w"> </span>load_spt<span class="o">()</span>:<span class="w"> </span>Bad<span class="w"> </span>SPT1<span class="w"> </span>magic<span class="w"> </span>number<span class="w"> </span>0xFFFFFFFF<span class="w"> </span><span class="o">[</span>MED<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-157-3" name="__codelineno-157-3" href="#__codelineno-157-3"></a>librsu:<span class="w"> </span>load_spt<span class="o">()</span>:<span class="w"> </span>Bad<span class="w"> </span>SPT0<span class="w"> </span>magic<span class="w"> </span>number<span class="w"> </span>0xFFFFFFFF<span class="w"> </span><span class="o">[</span>MED<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-157-4" name="__codelineno-157-4" href="#__codelineno-157-4"></a>librsu:<span class="w"> </span>load_spt<span class="o">()</span>:<span class="w"> </span>error:<span class="w"> </span>No<span class="w"> </span>valid<span class="w"> </span>SPT0<span class="w"> </span>or<span class="w"> </span>SPT1<span class="w"> </span>found<span class="w"> </span><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-157-5" name="__codelineno-157-5" href="#__codelineno-157-5"></a>librsu:<span class="w"> </span>rsu_spt_corrupted_info<span class="o">()</span>:<span class="w"> </span>corrupted<span class="w"> </span>SPT<span class="w"> </span>--<span class="w"> </span><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-157-6" name="__codelineno-157-6" href="#__codelineno-157-6"></a>librsu:<span class="w"> </span>rsu_spt_corrupted_info<span class="o">()</span>:<span class="w"> </span>run<span class="w"> </span>rsu_client<span class="w"> </span>restore-spt<span class="w"> </span>&lt;file_name&gt;<span class="w"> </span>
<a id="__codelineno-157-7" name="__codelineno-157-7" href="#__codelineno-157-7"></a>first<span class="w"> </span>
<a id="__codelineno-157-8" name="__codelineno-157-8" href="#__codelineno-157-8"></a><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-157-9" name="__codelineno-157-9" href="#__codelineno-157-9"></a>ERROR:<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>slots<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Restore the SPT from the backup copy that we have created. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--restore-spt<span class="w"> </span>spt-backup.bin<span class="w"> </span>
<a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a>librsu:<span class="w"> </span>load_spt<span class="o">()</span>:<span class="w"> </span>Bad<span class="w"> </span>SPT1<span class="w"> </span>magic<span class="w"> </span>number<span class="w"> </span>0xFFFFFFFF<span class="w"> </span><span class="o">[</span>MED<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a>librsu:<span class="w"> </span>load_spt<span class="o">()</span>:<span class="w"> </span>Bad<span class="w"> </span>SPT0<span class="w"> </span>magic<span class="w"> </span>number<span class="w"> </span>0xFFFFFFFF<span class="w"> </span><span class="o">[</span>MED<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-158-4" name="__codelineno-158-4" href="#__codelineno-158-4"></a>librsu:<span class="w"> </span>load_spt<span class="o">()</span>:<span class="w"> </span>error:<span class="w"> </span>No<span class="w"> </span>valid<span class="w"> </span>SPT0<span class="w"> </span>or<span class="w"> </span>SPT1<span class="w"> </span>found<span class="w"> </span><span class="o">[</span>LOW<span class="o">]</span><span class="w"> </span>
<a id="__codelineno-158-5" name="__codelineno-158-5" href="#__codelineno-158-5"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Try again running RSU client commands which require a valid SPT - the commands work fine. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a>root@linux:~#<span class="w"> </span>./rsu_client<span class="w"> </span>--count<span class="w"> </span>
<a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a>number<span class="w"> </span>of<span class="w"> </span>slots<span class="w"> </span>is<span class="w"> </span><span class="m">3</span><span class="w"> </span>
<a id="__codelineno-159-3" name="__codelineno-159-3" href="#__codelineno-159-3"></a>Operation<span class="w"> </span>completed<span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h2 id="using-separate-ssbl-per-bitstream">Using Separate SSBL Per Bitstream<a class="headerlink" href="#using-separate-ssbl-per-bitstream" title="Permanent link">&para;</a></h2>
<p>When using Remote System Update on Stratix® 10, Agilex™ 7, Agilex™ 5 and N5X™ devices, each configuration bitstream from QSPI contains the HPS FSBL (First Stage Bootloader), specifically U-Boot SPL. In order to allow the most flexibility and compatibility, you must design your system so that each bitstream loads its own copy of the HPS SSBL, specifically U-Boot image.</p>
<p>This page presents details on how to achieve this for both the cases when U-Boot images are stored in QSPI flash, and when they are stored in SD card. </p>
<p>Refer to the following documents for details about the Remote System Update.</p>
<ul>
<li><a href="https://www.intel.com/content/www/us/en/docs/programmable/683021/current/overview-s10-fm.html">Stratix® 10 Hard Processor System Remote System Update User Guide</a></li>
<li><a href="https://www.intel.com/content/www/us/en/docs/programmable/683184/current/overview-s10-fm.html">Agilex™ Hard Processor System Remote System Update User Guide</a> </li>
<li><a href="">Agilex™ 5 Hard Processor System Remote System Update User Guide</a> </li>
</ul>
<p><strong>Note:</strong> In the scenario in which both SPTs tables are corrupted, U-Boot will fail to be launched because the FSBL won't be able to identify which SSBL needs to be launched since the partition information is kept in SPT tables.</p>
<h3 id="configuring-u-boot-for-separate-u-boot-images">Configuring U-Boot for Separate U-Boot Images<a class="headerlink" href="#configuring-u-boot-for-separate-u-boot-images" title="Permanent link">&para;</a></h3>
<p>In order to configure U-Boot to support one U-Boot image per bitstream, the following configuration option must be enabled.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="nv">CONFIG_SOCFPGA_RSU_MULTIBOOT</span><span class="o">=</span>y
</code></pre></div>
<p>This configuration option is defined in https://github.com/altera-opensource/u-boot-socfpga/blob/socfpga_v2023.04/arch/arm/mach-socfpga/Kconfig as follows.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a>config<span class="w"> </span>SOCFPGA_RSU_MULTIBOOT
<a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a><span class="w">    </span>bool<span class="w"> </span><span class="s2">&quot;Enable RSU Multiboot Selection Feature&quot;</span>
<a id="__codelineno-161-3" name="__codelineno-161-3" href="#__codelineno-161-3"></a><span class="w">    </span>depends<span class="w"> </span>on<span class="w"> </span>TARGET_SOCFPGA_SOC64<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>SPI_FLASH
<a id="__codelineno-161-4" name="__codelineno-161-4" href="#__codelineno-161-4"></a><span class="w">    </span>default<span class="w"> </span>n
<a id="__codelineno-161-5" name="__codelineno-161-5" href="#__codelineno-161-5"></a><span class="w">    </span><span class="nb">help</span>
<a id="__codelineno-161-6" name="__codelineno-161-6" href="#__codelineno-161-6"></a><span class="w">     </span>Multiboot<span class="w"> </span>u-boot<span class="w"> </span>proper<span class="w"> </span>image<span class="w"> </span><span class="o">(</span>SSBL<span class="o">)</span><span class="w"> </span>selection<span class="w"> </span>feature<span class="w"> </span><span class="k">for</span><span class="w"> </span>RSU.
<a id="__codelineno-161-7" name="__codelineno-161-7" href="#__codelineno-161-7"></a><span class="w">     </span>SPL<span class="w"> </span>will<span class="w"> </span><span class="k">select</span><span class="w"> </span>the<span class="w"> </span>respective<span class="w"> </span>SSBL<span class="w"> </span>based<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>partition<span class="w"> </span>it<span class="w"> </span>resides
<a id="__codelineno-161-8" name="__codelineno-161-8" href="#__codelineno-161-8"></a><span class="w">     </span>inside<span class="w"> </span>RSU<span class="w"> </span>QSPI<span class="w"> </span>flash<span class="w"> </span>layout.
</code></pre></div>
<h3 id="storing-u-boot-images-on-sd-card">Storing U-Boot Images on SD Card<a class="headerlink" href="#storing-u-boot-images-on-sd-card" title="Permanent link">&para;</a></h3>
<p>When booting U-Boot from SD card, the effects of enabling <strong>CONFIG_SOCFPGA_RSU_MULTIBOOT=y</strong> are these.</p>
<ul>
<li>Instead of SPL loading the <strong>u-boot.itb</strong> or <strong>u-boot.img</strong> image, it loads the <strong>u-boot_&lt;partition_name&gt;.itb</strong> or <strong>u-boot_&lt;partition_name&gt;.img</strong> file.</li>
<li>Instead of U-Boot using the environment stored in one location on SD card, it loads it from <strong>uboot_&lt;partition_name&gt;.env</strong> file</li>
</ul>
<p>The <strong>&lt;partition_name&gt;</strong> is the partition name as defined in the Quartus Programming File Generator PFG file (using the <strong>id</strong> for the corresponding partition). For the factory image that is "<strong>FACTORY_IMAGE</strong>".</p>
<p>On the SD card, the following files will need to be stored, for each bitstream and the factory image.</p>
<ul>
<li><strong>u-boot_&lt;partition_name&gt;.itb</strong> or <strong>u-boot_&lt;partition_name&gt;.img</strong> </li>
<li><strong>uboot_&lt;partition_name&gt;.env</strong> </li>
</ul>
<p>Application image update procedure needs to be updated as follows.</p>
<ol>
<li>Use LIBRSU or U-Boot to erase the application image partition. This also disables it, removing it from the CPB.</li>
<li>Replace the corresponding U-Boot image file on the FAT partition with the new version.</li>
<li>Replace the corresponding U-Boot environment file on the FAT partition with the new version</li>
<li>Use LIBRSU or U-Boot to write the new application image. This also enables it, putting it as the highest priority in the CPB.</li>
</ol>
<p><strong>Notes:</strong></p>
<ul>
<li>If you do not need to have a modifiable environment, you will not need the <strong>uboot_&lt;partition_name&gt;.env</strong> files.</li>
<li>You can ommit explicitly creating the <strong>uboot_&lt;partition_name&gt;.env</strong>  files. They will be created when  you run the <strong>'saveenv'</strong> command. If they are not present U-Boot will just use its default environment.</li>
</ul>
<p><strong>Steps to Rebuild Binaries compared with regular RSU build flow</strong></p>
<ol>
<li>GHRD, ATF, Linux, File System are built in the same way.</li>
<li>U-Boot is build adding <strong>CONFIG_SOCFPGA_RSU_MULTIBOOT=y</strong> to the <strong>config-fragment-&lt;device&gt;</strong> file. An independent U-Boot build is performed for each application. Name corresponding <strong>u-boot.itb</strong> as <strong>u-boot_FACTORY_IMAGE.itb</strong>, <strong>u-boot_P1.itb</strong>, <strong>u-boot_P2.itb</strong> and <strong>u-boot_P3.itb</strong>.</li>
<li>Modify <strong>initial_image.pfg</strong> to include the proper new FSBLs for Bitstream 1 (FACTORY_IMAGE application) and Bitstream 2 (P1 application). </li>
<li>Generate the new <strong>initial_image.jic</strong> using the modified <strong>initial_image.pfg</strong> file.</li>
<li>Generate new <em>.rpd</em> applications using the new FSBLs created (application2, decision_firmware_update, factory_update and combined_application).</li>
<li>Generate the SD Card image copying to the <strong>fat</strong> partition the new <strong>.itb</strong> and <strong>.rpd</strong> files created. Also copy the new <strong>.rpd</strong> files to the <strong>rootfs</strong> partition at <strong>home/root</strong> directory. Adjust the size of the image to match the new size of the <strong>fat</strong> directory (<strong>fat</strong> partition will be larger as this includes now the SSBLs for each application).</li>
</ol>
<h3 id="storing-u-boot-images-in-qspi">Storing U-Boot Images in QSPI<a class="headerlink" href="#storing-u-boot-images-in-qspi" title="Permanent link">&para;</a></h3>
<p>When booting U-Boot from QSPI, the effects of enabling <strong>CONFIG_SOCFPGA_RSU_MULTIBOOT=y</strong> are these.</p>
<ul>
<li>Instead of SPL loading the U-Boot from a fixed address as defined by the <strong>CONFIG_SYS_SPI_U_BOOT_OFFS</strong> configuration option, it loads U-Boot from a partition called <strong>SSBL.&lt;partition_name&gt;</strong>.</li>
<li>Instead of U-Boot loading the environment from a fixed location as defined by the <strong>CONFIG_ENV_OFFSET</strong> configuration option, it loads it from the last <strong>CONFIG_ENV_SIZE</strong> of the same partition called <strong>SSBL.&lt;partition_name&gt;</strong>.</li>
</ul>
<p>On the QSPI PFG file, the following additional partition will need to be defined, for each bitstream and the factory image.</p>
<ul>
<li><strong>SSBL.&lt;partition_name&gt;</strong>: containing the U-Boot image, and the environment at the end.</li>
</ul>
<p>Application image update procedure needs to be updated as follows.</p>
<ol>
<li>Use LIBRSU or U-Boot to erase the application image partition. This also disables it, removing it from the CPB.</li>
<li>Use LIBRSU or U-Boot to erase SSBL partition.</li>
<li>Use LIBRSU or U-Boot to write the new contents of the SSBL partition.</li>
<li>Use LIBRSU or U-Boot to write the new application image. This also enables it, putting it as highest priority in the CPB.</li>
</ol>
<p><strong>Notes:</strong></p>
<ul>
<li>The total lenght of a partition name cannot exceed 15 characters, not including the zero line terminator. Because of that the SSBL partition names will have to be truncated to 15 characters. For example for factory image you will need to define it as "SSBL.FACTORY_IM".</li>
<li>By default both U-Boot and Linux uses 64KB QSPI erase sectors. Make sure to configure your initial RSU QSPI flash image with SPT/CPB sizes=64KB, unless you change the default to 4KB for example, in which case you can leave the default of 32KB for SPT/CBP sizes</li>
<li>The U-Boot environment must be stored in an individually erasable QSPI area. You need to define CONFIG_ENV_OFFSET=CONFIG_ENV_SECT_SIZE=qspi_erase_size, where that is either 64KB or 4KB depending on the above selection</li>
<li>The partition will have to be large enough to contain both the U-Boot image (currently ~900KB) and the U-Boot environment (64KB or 4KB). It is reccomended it to set to at least 1.5MB to allow room for expansion in the future.</li>
<li>Initially the environment part of the partition can be left empty, as the default U-Boot environment will be used by U-Boot. Then when you run 'saveenv' command, the updated environment will be saved and used.</li>
</ul>
<p><strong>Steps to Rebuild Binaries compared with regular RSU build flow</strong></p>
<ol>
<li>GHRD, ATF, Linux, File System are built in the same way.</li>
<li>
<p>U-Boot is build adding the following setting to the <strong>config-fragment-&lt;device&gt;</strong> file.
<div class="highlight"><pre><span></span><code><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="nv">CONFIG_SOCFPGA_RSU_MULTIBOOT</span><span class="o">=</span>y
<a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a><span class="nv">CONFIG_ENV_OFFSET</span><span class="o">=</span>0x10000
<a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a><span class="nv">CONFIG_ENV_SECT_SIZE</span><span class="o">=</span>0x10000
</code></pre></div>
and updating <strong>arch/arm/dts/socfpga_agilex_socdk-u-boot.dtsi</strong> file to find the U-Boot FSBL in QSPI as indicated next.
<div class="highlight"><pre><span></span><code><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/u-boot,spl-boot-order.*/u-boot\,spl-boot-order = \&amp;flash0;/g&#39;</span><span class="w"> </span>arch/arm/dts/socfpga_agilex_socdk-u-boot.dtsi
</code></pre></div>
For each application, a specific U-Boot is required to be built. Name corresponding <strong>u-boot.itb</strong> as <strong>u-boot_FACTORY_IMAGE.bin</strong>, <strong>u-boot_P1.bin</strong>, <strong>u-boot_P2.bin</strong> and <strong>u-boot_P3.bin</strong>.</p>
</li>
<li>
<p>Modify <strong>initial_image.pfg</strong> to create new partitions for each one of the SSBLs and loading the corresponding binary into this. An example of the new sections created in the file is shown next.
<div class="highlight"><pre><span></span><code><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a>&lt;pfg<span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;
<a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a><span class="w">   </span>:
<a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a><span class="w">    </span>&lt;raw_files&gt;
<a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a><span class="w">       </span>&lt;raw_file<span class="w"> </span><span class="nv">bitswap</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;RBF&quot;</span><span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="s2">&quot;Raw_File_1&quot;</span>&gt;u-boot_FACTORY_IMAGE.bin&lt;/raw_file&gt;
<a id="__codelineno-164-5" name="__codelineno-164-5" href="#__codelineno-164-5"></a><span class="w">       </span>&lt;raw_file<span class="w"> </span><span class="nv">bitswap</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;RBF&quot;</span><span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="s2">&quot;Raw_File_2&quot;</span>&gt;u-boot_P1.bin<span class="w"> </span>&lt;/raw_file&gt;
<a id="__codelineno-164-6" name="__codelineno-164-6" href="#__codelineno-164-6"></a><span class="w">       </span>&lt;raw_file<span class="w"> </span><span class="nv">bitswap</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;RBF&quot;</span><span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="s2">&quot;Raw_File_3&quot;</span>&gt;u-boot_P2.bin<span class="w"> </span>&lt;/raw_file&gt;
<a id="__codelineno-164-7" name="__codelineno-164-7" href="#__codelineno-164-7"></a><span class="w">       </span>&lt;raw_file<span class="w"> </span><span class="nv">bitswap</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;RBF&quot;</span><span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="s2">&quot;Raw_File_4&quot;</span>&gt;u-boot_P3.bin&lt;/raw_file&gt;
<a id="__codelineno-164-8" name="__codelineno-164-8" href="#__codelineno-164-8"></a><span class="w">    </span>&lt;/raw_files&gt;
<a id="__codelineno-164-9" name="__codelineno-164-9" href="#__codelineno-164-9"></a><span class="w">    </span>&lt;flash_devices&gt;
<a id="__codelineno-164-10" name="__codelineno-164-10" href="#__codelineno-164-10"></a><span class="w">     </span>:
<a id="__codelineno-164-11" name="__codelineno-164-11" href="#__codelineno-164-11"></a><span class="w">       </span>&lt;partition<span class="w"> </span><span class="nv">reserved</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">fixed_s_addr</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">s_addr</span><span class="o">=</span><span class="s2">&quot;0x04000000&quot;</span><span class="w"> </span><span class="nv">e_addr</span><span class="o">=</span><span class="s2">&quot;0x041FFFFF&quot;</span><span class="w"> </span><span class="nv">fixed_e_addr</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="s2">&quot;SSBL.FACTORY_IM&quot;</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>/&gt;
<a id="__codelineno-164-12" name="__codelineno-164-12" href="#__codelineno-164-12"></a><span class="w">       </span>&lt;partition<span class="w"> </span><span class="nv">reserved</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">fixed_s_addr</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">s_addr</span><span class="o">=</span><span class="s2">&quot;0x04200000&quot;</span><span class="w"> </span><span class="nv">e_addr</span><span class="o">=</span><span class="s2">&quot;0x043FFFFF&quot;</span><span class="w"> </span><span class="nv">fixed_e_addr</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="s2">&quot;SSBL.P1&quot;</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>/&gt;
<a id="__codelineno-164-13" name="__codelineno-164-13" href="#__codelineno-164-13"></a><span class="w">       </span>&lt;partition<span class="w"> </span><span class="nv">reserved</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">fixed_s_addr</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">s_addr</span><span class="o">=</span><span class="s2">&quot;0x04400000&quot;</span><span class="w"> </span><span class="nv">e_addr</span><span class="o">=</span><span class="s2">&quot;0x045FFFFF&quot;</span><span class="w"> </span><span class="nv">fixed_e_addr</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="s2">&quot;SSBL.P2&quot;</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>/&gt;
<a id="__codelineno-164-14" name="__codelineno-164-14" href="#__codelineno-164-14"></a><span class="w">       </span>&lt;partition<span class="w"> </span><span class="nv">reserved</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">fixed_s_addr</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">s_addr</span><span class="o">=</span><span class="s2">&quot;0x04600000&quot;</span><span class="w"> </span><span class="nv">e_addr</span><span class="o">=</span><span class="s2">&quot;0x047FFFFF&quot;</span><span class="w"> </span><span class="nv">fixed_e_addr</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="s2">&quot;SSBL.P3&quot;</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>/&gt;
<a id="__codelineno-164-15" name="__codelineno-164-15" href="#__codelineno-164-15"></a><span class="w">    </span>&lt;/flash_device&gt;
<a id="__codelineno-164-16" name="__codelineno-164-16" href="#__codelineno-164-16"></a><span class="w">    </span>&lt;assignments&gt;
<a id="__codelineno-164-17" name="__codelineno-164-17" href="#__codelineno-164-17"></a><span class="w">       </span>&lt;assignment<span class="w"> </span><span class="nv">partition_id</span><span class="o">=</span><span class="s2">&quot;SSBL.FACTORY_IM&quot;</span>&gt;
<a id="__codelineno-164-18" name="__codelineno-164-18" href="#__codelineno-164-18"></a><span class="w">             </span>&lt;raw_file_id&gt;Raw_File_1<span class="w"> </span>&lt;/raw_file_id&gt;
<a id="__codelineno-164-19" name="__codelineno-164-19" href="#__codelineno-164-19"></a><span class="w">       </span>&lt;/assignment&gt;
<a id="__codelineno-164-20" name="__codelineno-164-20" href="#__codelineno-164-20"></a><span class="w">       </span>&lt;assignment<span class="w"> </span><span class="nv">partition_id</span><span class="o">=</span><span class="s2">&quot;SSBL.P1&quot;</span>&gt;
<a id="__codelineno-164-21" name="__codelineno-164-21" href="#__codelineno-164-21"></a><span class="w">             </span>&lt;raw_file_id&gt;Raw_File_2<span class="w"> </span>&lt;/raw_file_id&gt;
<a id="__codelineno-164-22" name="__codelineno-164-22" href="#__codelineno-164-22"></a><span class="w">       </span>&lt;/assignment&gt;
<a id="__codelineno-164-23" name="__codelineno-164-23" href="#__codelineno-164-23"></a><span class="w">       </span>&lt;assignment<span class="w"> </span><span class="nv">partition_id</span><span class="o">=</span><span class="s2">&quot;SSBL.P2&quot;</span>&gt;
<a id="__codelineno-164-24" name="__codelineno-164-24" href="#__codelineno-164-24"></a><span class="w">             </span>&lt;raw_file_id&gt;Raw_File_3<span class="w"> </span>&lt;/raw_file_id&gt;
<a id="__codelineno-164-25" name="__codelineno-164-25" href="#__codelineno-164-25"></a><span class="w">       </span>&lt;/assignment&gt;
<a id="__codelineno-164-26" name="__codelineno-164-26" href="#__codelineno-164-26"></a><span class="w">       </span>&lt;assignment<span class="w"> </span><span class="nv">partition_id</span><span class="o">=</span><span class="s2">&quot;SSBL.P3&quot;</span>&gt;
<a id="__codelineno-164-27" name="__codelineno-164-27" href="#__codelineno-164-27"></a><span class="w">             </span>&lt;raw_file_id&gt;Raw_File_4<span class="w"> </span>&lt;/raw_file_id&gt;
<a id="__codelineno-164-28" name="__codelineno-164-28" href="#__codelineno-164-28"></a><span class="w">       </span>&lt;/assignment&gt;
<a id="__codelineno-164-29" name="__codelineno-164-29" href="#__codelineno-164-29"></a><span class="w">    </span>&lt;/assignments&gt;
<a id="__codelineno-164-30" name="__codelineno-164-30" href="#__codelineno-164-30"></a><span class="w"> </span>&lt;/pfg&gt;
</code></pre></div></p>
</li>
<li>
<p>Generate the new <strong>initial_image.jic</strong> using the modified <strong>initial_image.pfg</strong> file.</p>
</li>
<li>Generate new <strong>.rpd</strong> applications using the new FSBLs created (application2, decision_firmware_update, factory_update and combined_application). </li>
<li>Generate the SD Card image copying to the <strong>fat</strong> partition the new <strong>.rpd</strong> files created. The <strong>.itb</strong> in <strong>fat</strong> partition are not required anymore. Also, copy the new <strong>.rpd</strong> files to the <strong>rootfs</strong> partition at <strong>home/root</strong> directory.</li>
</ol>
<h2 id="notices-disclaimers">Notices &amp; Disclaimers<a class="headerlink" href="#notices-disclaimers" title="Permanent link">&para;</a></h2>
<p>Altera<sup>&reg;</sup> Corporation technologies may require enabled hardware, software or service activation.
No product or component can be absolutely secure. 
Performance varies by use, configuration and other factors.
Your costs and results may vary. 
You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Altera or Intel products described herein. You agree to grant Altera Corporation a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.
No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Altera or Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document.
The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications.  Current characterized errata are available on request.
Altera disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.
You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. 
<sup>&copy;</sup> Altera Corporation.  Altera, the Altera logo, and other Altera marks are trademarks of Altera Corporation.  Other names and brands may be claimed as the property of others. </p>
<p>OpenCL* and the OpenCL* logo are trademarks of Apple Inc. used by permission of the Khronos Group™. </p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 11, 2024</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 30, 2024</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../remote-debug/ug-remote-debug-agx5e-premium/" class="md-footer__link md-footer__link--prev" aria-label="Previous: FPGA Remote Debug Example" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                FPGA Remote Debug Example
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../modular/gsrd/ug-gsrd-agx5e-modular/" class="md-footer__link md-footer__link--next" aria-label="Next: GSRD User Guide" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                GSRD User Guide
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.altera.com" target="_blank" rel="noopener" title="www.altera.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/altera-fpga" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/altera-fpga/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "navigation.indexes", "navigation.footer", "navigation.path", "navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "content.code.copy", "navigation.indexes", "toc.follow"], "search": "../../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
        <script src="https://unpkg.com/tablefilter@0.7.3/dist/tablefilter/tablefilter.js"></script>
      
        <script src="../../../../../../assets/tables.js"></script>
      
        <script src="../../../../../../assets/extra.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>