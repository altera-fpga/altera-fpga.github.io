
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://altera-fpga.github.io/rel-24.3/embedded-designs/agilex-5/common/virtual-platforms/zephyr-gsrd/ug-zephyr-gsrd-agilex5-virtual-platforms/">
      
      
        <link rel="prev" href="../../linux-gsrd/ug-linux-gsrd-agilex5-virtual-platforms/">
      
      
        <link rel="next" href="../../../../e-series/premium/remote-debug/ug-remote-debug-agx5e-premium/">
      
      <link rel="icon" href="../../../../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Zephyr GSRD - Altera FPGA Developer Site</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../.." title="Altera FPGA Developer Site" class="md-header__button md-logo" aria-label="Altera FPGA Developer Site" data-md-component="logo">
      
  <img src="../../../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Altera FPGA Developer Site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Zephyr GSRD
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/altera-fpga" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    altera-fpga
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="Altera FPGA Developer Site" class="md-nav__button md-logo" aria-label="Altera FPGA Developer Site" data-md-component="logo">
      
  <img src="../../../../../../assets/logo.png" alt="logo">

    </a>
    Altera FPGA Developer Site
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/altera-fpga" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    altera-fpga
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../../driver-list_linux/">Linux Drivers</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Linux Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          HPS Host Drivers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          HPS Host Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/hwmon/hwmon/" class="md-nav__link">
        Altera Hardware Monitor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/clock_manager/clock_manager/" class="md-nav__link">
        Clock Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/dma/dma/" class="md-nav__link">
        DMA Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/edac/edac/" class="md-nav__link">
        Error Detection & Correction (EDAC)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/ptp_tod/ptp_emb_tod/" class="md-nav__link">
        Ethernet 1588 PTP Time of Day Clock
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/emac/emac/" class="md-nav__link">
        Ethernet Media Access Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/hssi/hssi/" class="md-nav__link">
        Ethernet Subsystem FPGA IP MAC Specific Ctrl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/hssi_xtile/hssi_xtile/" class="md-nav__link">
        Ethernet Subsystem FPGA IP Tile Specific Ctrl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/apb_timers/apb_timers/" class="md-nav__link">
        General Purpose Timers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/gpio/gpio/" class="md-nav__link">
        General Purpose I/O (GPIO)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/i2c/i2c/" class="md-nav__link">
        I2C
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/i3c/i3c/" class="md-nav__link">
        I3C
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/interrupt_controller_GICv3/irq_gic_v3/" class="md-nav__link">
        Interrupt Controller (GICv3)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/msgdma/msgdma/" class="md-nav__link">
        MSGDMA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/nand/nand/" class="md-nav__link">
        NAND Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/qsfp/qsfp/" class="md-nav__link">
        QSFP Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/qspi/qspi/" class="md-nav__link">
        QSPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/reset_manager/reset_manager/" class="md-nav__link">
        Reset Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/sd-emmc/sd-emmc/" class="md-nav__link">
        SD/eMMC Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/spi/spi/" class="md-nav__link">
        SPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/system_manager/system_manager/" class="md-nav__link">
        System Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/smmu/smmu/" class="md-nav__link">
        System Memory Management Unit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/uart/uart/" class="md-nav__link">
        UART
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/usb2_0_otg/usb_2_0_otg/" class="md-nav__link">
        USB 2.0 OTG
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/watchdog_timers/watchdog_timers/" class="md-nav__link">
        Watchdog Timers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-embedded/zarlink_clock_synchronizer/zarlink_clock_synchronizer/" class="md-nav__link">
        Zarlink Clock Synchronizer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          PCIe Host Drivers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          PCIe Host Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/uart_16550/uart_16550/" class="md-nav__link">
        Altera 16550 Compatible UART
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_afu/dfl_afu/" class="md-nav__link">
        Accelerator Functional Unit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/intel_m10_bmc_core/intel_m10_bmc_core/" class="md-nav__link">
        Board Management Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl/dfl/" class="md-nav__link">
        Device Feature List
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/s10hssi/s10hssi/" class="md-nav__link">
        Ethernet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/ptp_dfl_tod/ptp_dfl_tod/" class="md-nav__link">
        Ethernet 1588 PTP Time of Day Clock
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_fme/dfl_fme/" class="md-nav__link">
        FPGA Management Engine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_pci/dfl_pci/" class="md-nav__link">
        PCIe Subsystem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/dfl_emif/dfl_emif/" class="md-nav__link">
        Memory Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/intel_m10_bmc_core/intel_m10_bmc_core/" class="md-nav__link">
        MAX 10 Board Management Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/spi_altera_dfl/spi_altera_dfl/" class="md-nav__link">
        SPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux-dfl/uio_dfl/uio_dfl/" class="md-nav__link">
        User space I/O (UIO)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../../driver-list_zephyr/">Zephyr Drivers</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Zephyr Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          HPS Zephyr Drivers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          HPS Zephyr Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/clock_manager/clock_manager/" class="md-nav__link">
        Clock Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/dma/dma/" class="md-nav__link">
        DMA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/gpio/gpio/" class="md-nav__link">
        GPIO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/qspi/qspi/" class="md-nav__link">
        Quad SPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/reset_manager/reset_manager/" class="md-nav__link">
        Reset Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/seu/seu/" class="md-nav__link">
        Single Error Upset (SEU)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/uart/uart/" class="md-nav__link">
        UART
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../zephyr-embedded/watchdog/watchdog/" class="md-nav__link">
        Watchdog Timer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../../driver-list_baremetal/">Baremetal Drivers</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Baremetal Drivers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Host Attach Utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Host Attach Utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw-tools-list/host-attach-tools/" class="md-nav__link">
        Host Attach Utilities Summary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgaconf/fpgaconf/" class="md-nav__link">
        fpgaconf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgaport/fpgaport/" class="md-nav__link">
        fpgaport
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet loopback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/ofs_uio/ofs_uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/opae_io/opae_io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/pac_hssi_config/pac_hssi_config/" class="md-nav__link">
        pac_hssi_config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../host-attach-util/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Example Designs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Example Designs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../ed-demo-list/ed-list/" class="md-nav__link">
        Example Designs Summary
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          Agilex™ 5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Agilex™ 5
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/premium/gsrd/ug-gsrd-agx5e-premium/" class="md-nav__link">
        Agilex™ 5 E-Series Premium Development Kit GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/premium/boot-examples/ug-linux-boot-agx5e-premium/" class="md-nav__link">
        Agilex™ 5 E-Series Premium Development Kit GHRD Linux Boot Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/premium/tsn/rgmii-hps/ug-tsncfg1-agx5e-premium/" class="md-nav__link">
        Agilex™ 5 E-Series Premium Development Kit Time Sensitive Network (TSN) - HPS RGMII System Example Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/premium/tsn/sgmii_xcvr/ug-tsn-sgmii-xcvr-agilex5/" class="md-nav__link">
        Agilex™ 5 E-Series Premium Development Kit Time Sensitive Network (TSN) - SGMII XCVR System Example Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/modular/gsrd/ug-gsrd-agx5e-modular/" class="md-nav__link">
        Agilex™ 5 E-Series Modular Development Kit GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/modular/boot-examples/ug-linux-boot-agx5e-modular/" class="md-nav__link">
        Agilex™ 5 E-Series Modular Development Kit GHRD Linux Boot Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/premium/gsrd_zephyr/ug-zgsrd-agx5e-premium/" class="md-nav__link">
        Agilex™ 5 E-Series Premium Development Kit Zephyr GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux-gsrd/ug-linux-gsrd-agilex5-virtual-platforms/" class="md-nav__link">
        Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Linux GSRD
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Zephyr GSRD
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Zephyr GSRD
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#release-contents" class="md-nav__link">
    Release Contents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-code" class="md-nav__link">
    Source Code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prebuilt-binaries" class="md-nav__link">
    Prebuilt Binaries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedded-software-peripheral-zephyr-drivers-availability" class="md-nav__link">
    Embedded Software Peripheral Zephyr Drivers Availability
  </a>
  
    <nav class="md-nav" aria-label="Embedded Software Peripheral Zephyr Drivers Availability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#boot-flow" class="md-nav__link">
    Boot Flow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agilextm-5-simics-virtual-platform" class="md-nav__link">
    Agilex™ 5 Simics Virtual Platform
  </a>
  
    <nav class="md-nav" aria-label="Agilex™ 5 Simics Virtual Platform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-points-for-zephyr" class="md-nav__link">
    Key points for Zephyr
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-prebuilt-binaries-with-simics" class="md-nav__link">
    Using Prebuilt Binaries With Simics
  </a>
  
    <nav class="md-nav" aria-label="Using Prebuilt Binaries With Simics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-to-use-prebuilt-binaries" class="md-nav__link">
    Setting Up to Use Prebuilt Binaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#organizing-the-prebuilt-binaries" class="md-nav__link">
    Organizing the Prebuilt Binaries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-instructions" class="md-nav__link">
    Build Instructions
  </a>
  
    <nav class="md-nav" aria-label="Build Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-environment" class="md-nav__link">
    Setting up Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-sof-file-from-hardware-design" class="md-nav__link">
    Get SOF file from Hardware Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-arm-trusted-firmware" class="md-nav__link">
    Building Arm Trusted Firmware
  </a>
  
    <nav class="md-nav" aria-label="Building Arm Trusted Firmware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-atf-sdcard" class="md-nav__link">
    Build ATF SDCard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-atf-nand" class="md-nav__link">
    Build ATF NAND
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-atf-qspi" class="md-nav__link">
    Build ATF QSPI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zephyr-build-environment-setup" class="md-nav__link">
    Zephyr Build Environment Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-zephyr-application" class="md-nav__link">
    Building Zephyr Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-boot-images" class="md-nav__link">
    Creating Boot Images
  </a>
  
    <nav class="md-nav" aria-label="Creating Boot Images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sd-card-image-binaries" class="md-nav__link">
    SD Card Image binaries
  </a>
  
    <nav class="md-nav" aria-label="SD Card Image binaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resulted-files" class="md-nav__link">
    Resulted Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nand-binaries" class="md-nav__link">
    NAND binaries
  </a>
  
    <nav class="md-nav" aria-label="NAND binaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resulted-files_1" class="md-nav__link">
    Resulted Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qspi-binaries" class="md-nav__link">
    QSPI binaries
  </a>
  
    <nav class="md-nav" aria-label="QSPI binaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resulted-files_2" class="md-nav__link">
    Resulted Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation-setup" class="md-nav__link">
    Simulation Setup
  </a>
  
    <nav class="md-nav" aria-label="Simulation Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#booting-on-simics-virtual-platform-for-agilex-5" class="md-nav__link">
    Booting On Simics Virtual Platform for Agilex 5
  </a>
  
    <nav class="md-nav" aria-label="Booting On Simics Virtual Platform for Agilex 5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#booting-from-sd-card-image-binaries" class="md-nav__link">
    Booting from SD Card Image binaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#booting-from-nand-binaries" class="md-nav__link">
    Booting from NAND binaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#booting-from-qspi-binaries" class="md-nav__link">
    Booting from QSPI binaries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-hello-world" class="md-nav__link">
    Running Hello World!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    Use Cases
  </a>
  
    <nav class="md-nav" aria-label="Use Cases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-zephyr-command-line-application" class="md-nav__link">
    Running Zephyr Command Line Application
  </a>
  
    <nav class="md-nav" aria-label="Running Zephyr Command Line Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cli-application-prebuilt-binaries" class="md-nav__link">
    CLI application - Prebuilt binaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli-application-build-from-source" class="md-nav__link">
    CLI application - Build-from-source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli-application-run" class="md-nav__link">
    CLI application - Run
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-i3c" class="md-nav__link">
    Using I3C
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-usb-20" class="md-nav__link">
    Using USB 2.0
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercising-zephyr-on-a-single-core" class="md-nav__link">
    Exercising Zephyr on a single core.
  </a>
  
    <nav class="md-nav" aria-label="Exercising Zephyr on a single core.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prebuilt-binaries-for-a55-and-a76" class="md-nav__link">
    Prebuilt Binaries for A55 and A76
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-zephyr-application" class="md-nav__link">
    Build the Zephyr Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation-setup_1" class="md-nav__link">
    Simulation Setup
  </a>
  
    <nav class="md-nav" aria-label="Simulation Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-hello-world_1" class="md-nav__link">
    Running Hello World
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-reference" class="md-nav__link">
    Configuration Reference
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/premium/remote-debug/ug-remote-debug-agx5e-premium/" class="md-nav__link">
        Agilex™ 5 FPGA Remote Debug Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../e-series/premium/rsu/ug-rsu-agx5e-soc/" class="md-nav__link">
        Agilex™ 5 SoC HPS Remote System Update Example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
          Agilex™ 7
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Agilex™ 7
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/gsrd/ug-gsrd-agx7f-soc/" class="md-nav__link">
        Agilex™ 7 F-Series SoC Development Kit GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/i-series/soc/gsrd/ug-gsrd-agx7i-soc/" class="md-nav__link">
        Agilex™ 7 I-Series FPGA Development Kit GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/m-series/hbm2e/ug-gsrd-agx7m-hbm2e/" class="md-nav__link">
        Agilex™ 7 M-Series HBM2e Development Kit GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/rsu/ug-rsu-agx7f-soc/" class="md-nav__link">
        Agilex™ 7 SoC HPS Remote System Update Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/rsu/ug-rsu-multiqspi-agx7f-soc/" class="md-nav__link">
        Agilex™ 7 SoC HPS Multi-QSPI Remote System Update Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/remote-debug/ug-remote-debug-agx7f-soc/" class="md-nav__link">
        Agilex™ 7 SoC FPGA Remote Debug Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/emmc/ug-emmc-agx7f-soc/" class="md-nav__link">
        Agilex™ 7 HPS eMMC Boot Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../agilex-7/f-series/soc/fabric-config/ug-linux-fabric-config-agx7f-soc/" class="md-nav__link">
        Agilex™ 7 SoC Fabric Configuration from Linux Example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
          Stratix® 10
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          Stratix® 10
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stratix-10/sx/soc/gsrd/ug-gsrd-s10sx-soc/" class="md-nav__link">
        Stratix® 10 SX SoC Development Kit GSRD User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stratix-10/sx/soc/rsu/ug-rsu-s10sx-soc/" class="md-nav__link">
        Stratix® 10 SoC HPS Remote System Update Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stratix-10/sx/soc/remote-debug/ug-remote-debug-s10sx-soc/" class="md-nav__link">
        Stratix® 10 SoC FPGA Remote Debug Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stratix-10/sx/soc/emmc/ug-emmc-s10sx-soc/" class="md-nav__link">
        Stratix® 10 HPS eMMC Boot Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stratix-10/sx/soc/fabric-config/ug-linux-fabric-config-s10sx-soc/" class="md-nav__link">
        Stratix® 10 SoC Fabric Configuration from Linux Example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Demos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Demos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../ed-demo-list/demo-list/" class="md-nav__link">
        Demos Summary
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
          Agilex™ 5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Agilex™ 5
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../baremetal-embedded/agilex-5/e-series/premium/ug-baremetal-agx5e-premium/" class="md-nav__link">
        Agilex™ 5 E-Series Premium Development Kit Baremetal Hello World Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/altera-fpga/agilex5-demo-hps2fpga-interfaces/blob/main/documentation/01_index.md" class="md-nav__link">
        Agilex™ 5 E-Series Premium Development Kit and Third Party Boards - HPS-FPGA Interfaces Demos User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Zephyr GSRD</h1>

<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Agilex™ 5 E-Series devices provide the next generation HPS after those provided with the Agilex™® 7 and Stratix 10® SoC FPGA devices.
The Agilex™ 5 E-Series HPS application processors can run Zephyr RTOS and Linux with scalable performance using from one to four Arm <strong>Cortex</strong> -A cores that allow for a wide range of applications.
The Agilex™ 5 E-Series Simics virtual platform models the HPS processor with two Arm Cortex-A55 cores and two Arm Cortex-A76 cores along with the hard processor system (HPS) peripherals. The Agilex™ 5 E-Series HPS virtual platform is released as part of the Simics® Simulator for Agilex™ FPGAs software, which also includes several virtual platforms where the Agilex™ 5 E-Series device is instantiated, emulating the concept of having different versions of a development kit or daughter cards.
The Agilex™ 5 E-Series has the following supported virtual platforms:</p>
<ul>
<li>Agilex™ 5 E-Series Virtual Platform - Universal</li>
</ul>
<p>The following sections describe the prerequisites for the Simics simulator for Altera FPGA and the available virtual platforms including prebuilt Zephyr binaries. Instructions about how to build these binaries and run the Software stack are provided as well.
Additionally, some common use cases that you can exercise with this Zephyr release are discussed.</p>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h3>
<p>To exercise the instructions presented on this page, the following prerequisites need to be satisfied:</p>
<ul>
<li>Host PC with Linux. The instructions on this page use Ubuntu 20.04 LTS.  </li>
<li>The following package versions are needed to build Zephyr binaries:<ul>
<li>cmake - 3.20.5</li>
<li>python3 - 3.8</li>
<li>dtc - 1.4.6</li>
</ul>
</li>
<li>The following packages are needed to be able to deploy the Simics project: GCC 6.3 compiler or higher, g++ 9.4 or higher, GNU make 4.1 or higher.</li>
<li>Agilex™ 5 Simics Virtual Platform components are available to be deployed.</li>
<li>Quartus® Prime Pro Edition Programmer and Tools 24.3 or later.</li>
</ul>
<p><strong>Note</strong>: For installation instructions for the Simics Simulator for Altera® FPGAs and the Agilex™ 5 E-Series virtual platforms, refer to the following documents:</p>
<ul>
<li><a href="https://www.intel.com/content/www/us/en/docs/programmable/784383/">Intel® Simics® Simulator for Intel® FPGAs User Guide</a></li>
<li><a href="https://www.intel.com/content/www/us/en/docs/programmable/786901/">Agilex™ 5 E-Series Virtual Platform User Guide</a></li>
</ul>
<h4 id="release-contents">Release Contents<a class="headerlink" href="#release-contents" title="Permanent link">&para;</a></h4>
<h4 id="source-code">Source Code<a class="headerlink" href="#source-code" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>SW Component</th>
<th>Repository</th>
<th>Branch/tag</th>
</tr>
</thead>
<tbody>
<tr>
<td>ATF</td>
<td><a href="https://github.com/altera-opensource/arm-trusted-firmware/">https://github.com/altera-opensource/arm-trusted-firmware/</a></td>
<td>socfpga_v2.11.0/QPDS24.3_REL_GSRD_PR</td>
</tr>
<tr>
<td>Zephyr</td>
<td><a href="https://github.com/altera-opensource/zephyr-socfpga/">https://github.com/altera-opensource/zephyr-socfpga/</a></td>
<td>socfpga_rel_24.3/QPDS24.3_REL_GSRD_PR</td>
</tr>
</tbody>
</table>
<p><span style="color: red;">NOTE:  For 24.3 release only QSPI Boot is supported. Regardless of this, we are providing instructions on how the binaries for SDCard and NAND boot are generated, but these has not been validated.  </span></p>
<h4 id="prebuilt-binaries">Prebuilt Binaries<a class="headerlink" href="#prebuilt-binaries" title="Permanent link">&para;</a></h4>
<p>Prebuilt binaries can be found at the following URL: <a href="https://releases.rocketboards.org/2024.11/zephyr/agilex5/hps_zephyr/">https://releases.rocketboards.org/2024.11/zephyr/agilex5/hps_zephyr/</a>.
The prebuilt binaries consist of application programs built to run on the MPU cores in multicore configuration.
There are binary files designed for boot devices such as SD cards, NAND flash, and QSPI.
Additionally, files used by the recipes to create the binaries to boot from QSPI and NAND are provided in their respective folders.
The sample applications provided are:</p>
<table>
<thead>
<tr>
<th>Directory</th>
<th>Application Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>cli</td>
<td>Application to demonstrate Command Line Interface</td>
</tr>
<tr>
<td>hello_world</td>
<td>Application that displays a Hello World! message</td>
</tr>
</tbody>
</table>
<p><span style="color: red;">NOTE:  For 24.3 release only binaries for QSPI Boot are supported, so files for SDMMC and NAND are not provided. </span></p>
<h2 id="embedded-software-peripheral-zephyr-drivers-availability">Embedded Software Peripheral Zephyr Drivers Availability<a class="headerlink" href="#embedded-software-peripheral-zephyr-drivers-availability" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>HPS Peripheral</th>
<th>Supported</th>
</tr>
</thead>
<tbody>
<tr>
<td>SD Card driver</td>
<td>Partially</td>
</tr>
<tr>
<td>GPIO Driver</td>
<td>Yes</td>
</tr>
<tr>
<td>I2C Driver</td>
<td>Partially</td>
</tr>
<tr>
<td>UART Driver</td>
<td>Yes</td>
</tr>
<tr>
<td>Timer Driver</td>
<td>Yes</td>
</tr>
<tr>
<td>WatchDog Driver</td>
<td>Yes</td>
</tr>
<tr>
<td>SMP Driver</td>
<td>No</td>
</tr>
<tr>
<td>QSPI Driver</td>
<td>Yes</td>
</tr>
<tr>
<td>NAND Driver</td>
<td>Partially</td>
</tr>
<tr>
<td>SDRAM Driver</td>
<td>Yes</td>
</tr>
<tr>
<td>Ethernet Driver</td>
<td>Partially</td>
</tr>
<tr>
<td>SPI Driver</td>
<td>Partially</td>
</tr>
<tr>
<td>SDM Mailbox Driver</td>
<td>Yes</td>
</tr>
<tr>
<td>USB 2.0 Driver</td>
<td>Partially</td>
</tr>
<tr>
<td>HPS DMA Driver</td>
<td>Partially</td>
</tr>
<tr>
<td>I3C driver</td>
<td>Partially</td>
</tr>
<tr>
<td>EDAC/RAS drivers</td>
<td>No</td>
</tr>
</tbody>
</table>
<h3 id="boot-flow">Boot Flow<a class="headerlink" href="#boot-flow" title="Permanent link">&para;</a></h3>
<p>Starting with this release the Arm Trusted Firmware will act as the FSBL and SSBL bootloader for  Zephyr as described in the following diagram: </p>
<p><a class="glightbox" href="../images/Boot-flow-atf-zephyr.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Boot-flow-atf-zephyr" src="../images/Boot-flow-atf-zephyr.png" /></a> </p>
<h2 id="agilextm-5-simics-virtual-platform">Agilex™ 5 Simics Virtual Platform<a class="headerlink" href="#agilextm-5-simics-virtual-platform" title="Permanent link">&para;</a></h2>
<p>This virtual platform is associated with the <em>agilex5e-universal.simics</em> target script. The following figure shows a high-level block diagram of this virtual platform. In this diagram, we can observe the main components that can be exercised during the execution of the use cases described later on this page. The implementation of this virtual platform allows all the peripherals in the HPS to be enabled at the same time, which is not possible in physical hardware implementations. The pinmux and Combo PHY impose restrictions in physical hardware. In the case of the pinmux in physical hardware, only a subset of peripherals can be enabled at the same time because there are not enough pins if all pins are enabled simultaneously. This limitation does not exist in the Agilex 5 E-Series Universal Virtual Platform. For the Combo PHY, the physical hardware allows only one flash controller (NAND or SDMMC) to be enabled at one time. However, the virtual platform allows both to be enabled simultaneously. </p>
<p><a class="glightbox" href="../images/simics.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="simics" src="../images/simics.jpg" /></a> </p>
<p>The architecture of the virtual platform follows a hierarchy that goes from <em>system -&gt; board -&gt; fpga -&gt; hps,</em> which is aligned with the Agilex™ 5 Simics virtual platform development philosophy that tries to match with the real hardware system architecture.</p>
<p>The <strong>target script</strong> instantiates the <em>system component</em>, provides the CLI run time commands and creates the network configuration. This script also defines the parameters that configure other components.</p>
<p>The <strong>system component</strong> represents the complete system of the virtual platform and instantiates the <strong>board component</strong>. This component is implemented in a Python file.</p>
<p>The <strong>board component</strong> represents the model of a PCB (analogous to a development kit). It includes the instance of the <strong>FPGA component</strong> and all board components connected to the FPGA (for example, flash device, ethernet PHY). The GPIO loopback connection is implemented here. This component is implemented in a Python file.</p>
<p>The <strong>FPGA component</strong> represents a model of the top-level FPGA design. The hierarchy matches the logical hierarchy of a hypothetical GHRD that the virtual platform models. This instantiates the HPS, the external memory interface IP, and the FPGA example design.</p>
<p>The embedded software running in this virtual platform is expected to be the same that could be run in the real silicon. Additionally, the ability to exercise the HPS embedded software in this virtual platform allows you to debug the software using the Simics® Simulator debug capabilities.</p>
<p>For more details about Intel Simics® Simulator please refer to: <a href="../../linux-gsrd/ug-linux-gsrd-agilex5-virtual-platforms/">Linux Simics GSRD</a></p>
<h3 id="key-points-for-zephyr">Key points for Zephyr<a class="headerlink" href="#key-points-for-zephyr" title="Permanent link">&para;</a></h3>
<p>The Zephyr GSRD requires a top-level target script that wraps the agilex5e-universal.simics and execute Simics commands to run Zephyr.  The example of the file contents is shown below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>#Universal Zephyr simics Script. 
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>local $board_name = &quot;system.board.fpga&quot; 
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a># TOP-LEVEL CONFIG Script TO BOOT ZEPHYR.
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a># Ensure the sdimage.img &amp; bl2.bin paths are relative to the simics executable#
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a># Enable Console
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>$create_hps_serial0_console=TRUE
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a># Boot from SD Card
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>$create_hps_sd_card=TRUE
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>$create_hps_mmc=FALSE
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a># SD Card boot Image file path
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>$sd_image_filename = ../sdcard_bin/sdimage.img
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a># First stage boot loader, ATF BL2 path
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>$fsbl_image_filename = ../sdcard_bin/bl2.bin
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>run-command-file &quot;targets/agilex5e-universal/agilex5e-universal.simics&quot;  
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>run
</code></pre></div>
<p>In this script, the most relevant parameters to run Zephyr  are the following:</p>
<table>
<thead>
<tr>
<th><em>Parameter</em></th>
<th><em>Description</em></th>
<th><em>Range</em></th>
<th><em>Default Value</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>$sd_image_filename</td>
<td>Sdcard image path</td>
<td>Filename string</td>
<td>""</td>
</tr>
<tr>
<td>$fsbl_image_filename</td>
<td>Fsbl image path</td>
<td>Filename string</td>
<td>""</td>
</tr>
</tbody>
</table>
<h2 id="using-prebuilt-binaries-with-simics">Using Prebuilt Binaries With Simics<a class="headerlink" href="#using-prebuilt-binaries-with-simics" title="Permanent link">&para;</a></h2>
<p>The Zephyr GSRD requires a top-level target script that wraps the agilex5e-universal.simics and execute Simics commands to run Zephyr. The example of the file contents is shown below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>#Universal Zephyr simics Script. 
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>local $board_name = &quot;system.board.fpga&quot; 
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a># TOP-LEVEL CONFIG Script TO BOOT ZEPHYR.
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a># Ensure the sdimage.img &amp; bl2.bin paths are relative to the simics executable#
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a># Enable Console
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>$create_hps_serial0_console=TRUE
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a># Boot from SD Card
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>$create_hps_sd_card=TRUE
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>$create_hps_mmc=FALSE
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a># SD Card boot Image file path
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>$sd_image_filename = ../sdcard_bin/sdimage.img
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a># First stage boot loader, ATF BL2 path
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>$fsbl_image_filename = ../sdcard_bin/bl2.bin
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>run-command-file &quot;targets/agilex5e-universal/agilex5e-universal.simics&quot;  run
</code></pre></div>
<p>In this script, the most relevant parameters to run Zephyr  are the following:</p>
<table>
<thead>
<tr>
<th><em>Parameter</em></th>
<th><em>Description</em></th>
<th><em>Range</em></th>
<th><em>Default Value</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>$sd_image_filename</td>
<td>Sdcard image path</td>
<td>Filename string</td>
<td>""</td>
</tr>
<tr>
<td>$fsbl_image_filename</td>
<td>Fsbl image path</td>
<td>Filename string</td>
<td>""</td>
</tr>
</tbody>
</table>
<h3 id="setting-up-to-use-prebuilt-binaries">Setting Up to Use Prebuilt Binaries<a class="headerlink" href="#setting-up-to-use-prebuilt-binaries" title="Permanent link">&para;</a></h3>
<p>You will need both the boot image as well the firmware(ATF) binaries. The links below go directly to the directory with binaries corresponding to the application and boot device:</p>
<ul>
<li>Hello World:<ol>
<li><a href="https://releases.rocketboards.org/2024.11/zephyr/agilex5/hps_zephyr/hello_world/qspi_boot/">QSPI Flash</a></li>
</ol>
</li>
</ul>
<ul>
<li>CLI:<ol>
<li><a href="https://releases.rocketboards.org/2024.11/zephyr/agilex5/hps_zephyr/cli/qspi_boot/">QSPI Flash</a> </li>
</ol>
</li>
</ul>
<p>The following are the helper instructions to download the prebuilt binaries according to the application and boot device:</p>
<ol>
<li>
<p>This step assumes you have not created the folders as mentioned in <a href="#build-instructions">Build Instructions</a> or that you want to start afresh. It will remove any prior work! Skip to the next step to retain prior work.
Create the !ZephyrGSRD directory.
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>rm<span class="w"> </span>-rf<span class="w"> </span>agilex5_zgsrd
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>mkdir<span class="w"> </span>agilex5_zgsrd
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nb">cd</span><span class="w"> </span>agilex5_zgsrd
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TOP_FOLDER</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
</code></pre></div></p>
</li>
<li>
<p>Create a folder to contain the prebuilt binaries.
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>mkdir<span class="w"> </span>prebuilt
</code></pre></div></p>
</li>
<li>
<p>Specify sample application and boot device</p>
<ul>
<li>App<table>
<thead>
<tr>
<th>Application</th>
<th>Environment Variable</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hello World</td>
<td>export app=hello_world</td>
</tr>
<tr>
<td>CLI</td>
<td>export app=cli</td>
</tr>
</tbody>
</table>
</li>
</ul>
<ul>
<li>Boot Device<table>
<thead>
<tr>
<th>Boot Device</th>
<th>Environment Variable</th>
</tr>
</thead>
<tbody>
<tr>
<td>QSPI</td>
<td>export bootdev=qspi_boot bin_dir=qspi_bin bootimg=flash_image_jic.rpd</td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
<li>
<p>Get the prebuilt binaries into the prebuilt folder.</p>
</li>
</ol>
<p><span style="color: red;"> NOTE:  At the moment of creating this page, the .jic file for the prebuild applications was not included in the officila binaries release page, so in the example below we are using an alternate location in the meantime these binaries are uploaded. The temporary location of the page is https://www.rocketboards.org/foswiki/Projects/ZephyrPrebuildBinaries </span>. The .rpd files were generated from the current available binaries from the official page following the instuctions at <a href="#Creating Boot Images">Creating Boot Images</a> section.
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/prebuilt
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>wget<span class="w"> </span>https://www.rocketboards.org/foswiki/pub/Projects/ZephyrPrebuildBinaries/ZephyrPrebuildBinaries24p3.tar
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>tar<span class="w"> </span>xf<span class="w"> </span>ZephyrPrebuildBinaries24p3.tar
</code></pre></div></p>
<p>The prebuilt samples for Agilex™ 5 would have the following structure:
   * prebuilt/hello_world
   * prebuilt/cli</p>
<h3 id="organizing-the-prebuilt-binaries">Organizing the Prebuilt Binaries<a class="headerlink" href="#organizing-the-prebuilt-binaries" title="Permanent link">&para;</a></h3>
<p>If you've downloaded the prebuilt binaries manually, please place them in the following structure, then refer below to the step "To boot on Simics"...</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>agilex5_zgsrd
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>└── qspi_bin
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    └── bl2.bin
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    └── flash_image_jic.rpd
</code></pre></div>
<p>If you've followed the helper steps above, follow the next instructions:</p>
<ol>
<li>Prepare the binaries to run on Simics® Simulator.</li>
</ol>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span><span class="w"> </span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span><span class="nv">$bin_dir</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$bin_dir</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/prebuilt/ZephyrPrebuildBinaries24p3/<span class="nv">$app</span>/<span class="nv">$bootdev</span>/<span class="nv">$bootimg</span><span class="w"> </span><span class="nv">$bin_dir</span>/<span class="nv">$bootimg</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/prebuilt/ZephyrPrebuildBinaries24p3/<span class="nv">$app</span>/<span class="nv">$bootdev</span>/bl2.bin<span class="w"> </span><span class="nv">$bin_dir</span>/bl2.bin
</code></pre></div>
2. For the first time run, set up the Agilex™ 5 virtual platform. Refer to <a href="#simulation-setup">Simulation Setup</a>.</p>
<ul>
<li>To boot on Simics, based on the boot device refer to the corresponding sections :  <a href="#booting-from-sd-card-image-binaries">Booting from SD Card Image binaries</a>,  <a href="#booting-from-nand-binaries">Booting from NAND binaries</a> and <a href="#booting-from-qspi-binaries">Booting from QSPI binaries</a>.</li>
</ul>
<h2 id="build-instructions">Build Instructions<a class="headerlink" href="#build-instructions" title="Permanent link">&para;</a></h2>
<h3 id="setting-up-environment">Setting up Environment<a class="headerlink" href="#setting-up-environment" title="Permanent link">&para;</a></h3>
<ul>
<li>Update your system</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>upgrade
</code></pre></div>
<ul>
<li>Install all the required dependencies:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>--no-install-recommends<span class="w"> </span>git<span class="w"> </span>cmake<span class="w"> </span>ninja-build<span class="w"> </span>gperf<span class="w"> </span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>ccache<span class="w"> </span>dfu-util<span class="w"> </span>device-tree-compiler<span class="w"> </span>wget<span class="w"> </span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>python3-dev<span class="w"> </span>python3-pip<span class="w"> </span>python3-setuptools<span class="w"> </span>python3-tk<span class="w"> </span>python3-wheel<span class="w"> </span>python3-venv<span class="w"> </span>xz-utils<span class="w"> </span>file<span class="w"> </span>libpython3-dev<span class="w"> </span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>make<span class="w"> </span>gcc<span class="w"> </span>gcc-multilib<span class="w"> </span>g++-multilib<span class="w"> </span>libsdl2-dev<span class="w"> </span>libmagic1<span class="w"> </span>libguestfs-tools<span class="w">  </span>libssl-dev
</code></pre></div>
<table>
<thead>
<tr>
<th>Package</th>
<th>Zephyr Requirement</th>
<th>Ubuntu 22.04 (default versions)</th>
<th>command</th>
</tr>
</thead>
<tbody>
<tr>
<td>cmake</td>
<td>3.20.5</td>
<td>3.16.3 (upgrade required)</td>
<td>cmake --version</td>
</tr>
<tr>
<td>python</td>
<td>3.8</td>
<td>3.8.10</td>
<td>python3 --version</td>
</tr>
<tr>
<td>dtc</td>
<td>1.4.6</td>
<td>1.5.0</td>
<td>dtc --version</td>
</tr>
</tbody>
</table>
<ul>
<li>As a minimum CMake version 3.20.0 is required, if you have an older version, then execute the following commands to add a non-intrusive CMake binary:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nv">CURR_FOLDER</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$HOME</span>/bin/cmake<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/bin/cmake
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>wget<span class="w"> </span>https://github.com/Kitware/CMake/releases/download/v3.21.1/cmake-3.21.1-Linux-x86_64.sh
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>yes<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>cmake-3.21.1-Linux-x86_64.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>cat
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export PATH=</span><span class="nv">$PWD</span><span class="s2">/cmake-3.21.1-linux-x86_64/bin:\$PATH&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/.zephyrrc
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$CURR_FOLDER</span>
</code></pre></div>
<ul>
<li>Load the profile that was created to use the newer cmake (<em>this should be done for every session when</em> <a href="#zephyr-build-environment-setup">Building Zephyr</a>:</li>
</ul>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nb">source</span><span class="w">  </span><span class="nv">$HOME</span>/.zephyrrc
</code></pre></div>
- Create the ZephyrGSRD directories:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>rm<span class="w"> </span>-rf<span class="w"> </span>agilex5_zgsrd
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>mkdir<span class="w"> </span>agilex5_zgsrd
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nb">cd</span><span class="w"> </span>agilex5_zgsrd
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TOP_FOLDER</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
</code></pre></div>
<ul>
<li>Download the compiler toolchain. Define environment variables and append the toolchain path in the environment PATH variable. so the toolchain can be used to build the binaries:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>wget<span class="w"> </span>https://developer.arm.com/-/media/Files/downloads/gnu/11.3.rel1/binrel/arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>tar<span class="w"> </span>xf<span class="w"> </span>arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>rm<span class="w"> </span>-f<span class="w"> </span>arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu/bin:<span class="nv">$PATH</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export PATH=`pwd`/arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu/bin:\$PATH&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/.zephyrrc
</code></pre></div>
<ul>
<li>Enable Quartus Toot lo be called from command line:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_ROOTDIR</span><span class="o">=</span>~/intelFPGA_pro/24.3/quartus/
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/bin:<span class="nv">$QUARTUS_ROOTDIR</span>/linux64:<span class="nv">$QUARTUS_ROOTDIR</span>/../qsys/bin:<span class="nv">$PATH</span>
</code></pre></div>
<h3 id="get-sof-file-from-hardware-design">Get SOF file from Hardware Design<a class="headerlink" href="#get-sof-file-from-hardware-design" title="Permanent link">&para;</a></h3>
<p>In Simics, the SOF file generated as result of the build of the hardware design is not used at all in the simulation, but this is needed to create the RPD file to exercise the QSPI boot. This is the reason why we provide the steps to build the hardware desgin here.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>rm<span class="w"> </span>ghrd_a5ed065bb32ae6sr0_hps.sof
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>wget<span class="w"> </span>https://releases.rocketboards.org/2024.11/gsrd/agilex5_dk_a5e065bb32aes1_gsrd/ghrd_a5ed065bb32ae6sr0_hps.sof<span class="w"> </span>
</code></pre></div>
<p>The following file is created:</p>
<ul>
<li>$TOP_FOLDER/agilex5_soc_devkit_ghrd/output_files/ghrd_a5ed065bb32ae6sr0_hps.sof</li>
</ul>
<h3 id="building-arm-trusted-firmware">Building Arm Trusted Firmware<a class="headerlink" href="#building-arm-trusted-firmware" title="Permanent link">&para;</a></h3>
<p>We will build 3 ATF sets of binaries: One for SDCard boot, other for NAND boot and other for QSPI boot.</p>
<h4 id="build-atf-sdcard">Build ATF SDCard<a class="headerlink" href="#build-atf-sdcard" title="Permanent link">&para;</a></h4>
<ul>
<li>Clone the ATF repository from GitHub and build it</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>QPDS24.3_REL_GSRD_PR<span class="w">  </span>https://github.com/altera-opensource/arm-trusted-firmware<span class="w"> </span>arm-trusted-firmware-sdcard
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="nb">cd</span><span class="w"> </span>arm-trusted-firmware-sdcard
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>git<span class="w"> </span>switch<span class="w"> </span>-c<span class="w"> </span><span class="nb">test</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>make<span class="w"> </span>realclean
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="nv">ARCH</span><span class="o">=</span>arm64<span class="w"> </span><span class="nv">CROSS_COMPILE</span><span class="o">=</span>aarch64-none-linux-gnu-<span class="w"> </span>make<span class="w"> </span><span class="nv">PLAT</span><span class="o">=</span>agilex5<span class="w"> </span><span class="nv">SOCFPGA_BOOT_SOURCE_SDMMC</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>bl2<span class="w"> </span>bl31<span class="w"> </span><span class="nv">PRELOADED_BL33_BASE</span><span class="o">=</span>0x80100000<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span><span class="w"> </span>
</code></pre></div>
<ul>
<li>Build Fiptool to be able to create the sdimage in later steps.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>make<span class="w"> </span>fiptool
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>cp<span class="w"> </span>tools/fiptool/fiptool<span class="w"> </span><span class="nv">$TOP_FOLDER</span>
</code></pre></div>
<p>The previous instructions will produce (in the $TOP_FOLDER/arm-trusted-firmware directory):
- $TOP_FOLDER/arm-trusted-firmware-sdcard/build/agilex5/release/bl2.bin
- $TOP_FOLDER/arm-trusted-firmware-sdcard/build/agilex5/release/bl31.bin
- $TOP_FOLDER/fiptool</p>
<h4 id="build-atf-nand">Build ATF NAND<a class="headerlink" href="#build-atf-nand" title="Permanent link">&para;</a></h4>
<ul>
<li>Clone the ATF repository from GitHub and build it</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>QPDS24.3_REL_GSRD_PR<span class="w">  </span>https://github.com/altera-opensource/arm-trusted-firmware<span class="w"> </span>arm-trusted-firmware-nand
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="nb">cd</span><span class="w"> </span>arm-trusted-firmware-nand
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>wget<span class="w"> </span>https://releases.rocketboards.org/2023.12/zephyr/gsrd_zephyr/agilex5/cli/nand_boot/0001-plat-intel-soc-agilex5-enable-NAND-boot.patch
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>git<span class="w"> </span>apply<span class="w"> </span><span class="m">0001</span>-plat-intel-soc-agilex5-enable-NAND-boot.patch
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>make<span class="w"> </span>realclean
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="nv">ARCH</span><span class="o">=</span>arm64<span class="w"> </span><span class="nv">CROSS_COMPILE</span><span class="o">=</span>aarch64-none-linux-gnu-<span class="w"> </span>make<span class="w"> </span><span class="nv">PLAT</span><span class="o">=</span>agilex5<span class="w"> </span><span class="nv">SOCFPGA_BOOT_SOURCE_NAND</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>bl2<span class="w"> </span>bl31<span class="w"> </span><span class="nv">PRELOADED_BL33_BASE</span><span class="o">=</span>0x80100000<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
</code></pre></div>
<p>The previous instructions will produce (in the $TOP_FOLDER/arm-trusted-firmware directory):
- $TOP_FOLDER/arm-trusted-firmware-nand/build/agilex5/release/bl2.bin
- $TOP_FOLDER/arm-trusted-firmware-nand/build/agilex5/release/bl31.bin</p>
<h4 id="build-atf-qspi">Build ATF QSPI<a class="headerlink" href="#build-atf-qspi" title="Permanent link">&para;</a></h4>
<ul>
<li>Clone the ATF repository from GitHub and build it</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>QPDS24.3_REL_GSRD_PR<span class="w">  </span>https://github.com/altera-opensource/arm-trusted-firmware<span class="w"> </span>arm-trusted-firmware-qspi
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nb">cd</span><span class="w"> </span>arm-trusted-firmware-qspi
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>git<span class="w"> </span>switch<span class="w"> </span>-c<span class="w"> </span><span class="nb">test</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>make<span class="w"> </span>realclean
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="nv">ARCH</span><span class="o">=</span>arm64<span class="w"> </span><span class="nv">CROSS_COMPILE</span><span class="o">=</span>aarch64-none-linux-gnu-<span class="w"> </span>make<span class="w"> </span><span class="nv">PLAT</span><span class="o">=</span>agilex5<span class="w"> </span><span class="nv">SOCFPGA_BOOT_SOURCE_QSPI</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>bl2<span class="w"> </span>bl31<span class="w"> </span><span class="nv">PRELOADED_BL33_BASE</span><span class="o">=</span>0x80100000<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
</code></pre></div>
<p>The previous instructions will produce (in the $TOP_FOLDER/arm-trusted-firmware directory):
- $TOP_FOLDER/arm-trusted-firmware-qspi/build/agilex5/release/bl2.bin
- $TOP_FOLDER/arm-trusted-firmware-qspi/build/agilex5/release/bl31.bin</p>
<h3 id="zephyr-build-environment-setup">Zephyr Build Environment Setup<a class="headerlink" href="#zephyr-build-environment-setup" title="Permanent link">&para;</a></h3>
<ul>
<li>Create a new virtual environment and activate it</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>~/.zephyrproject/.venv
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="c1">#Environment Activation</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="nb">source</span><span class="w"> </span>~/.zephyrproject/.venv/bin/activate
</code></pre></div>
<ul>
<li>Install west, pull the official Zephyr repository and other Zephyr dependencies:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>pip3<span class="w"> </span>install<span class="w"> </span>wheel
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>pip3<span class="w"> </span>install<span class="w"> </span>west
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>west<span class="w"> </span>init<span class="w"> </span>-m<span class="w"> </span>https://github.com/zephyrproject-rtos/zephyr<span class="w"> </span>--mr<span class="w"> </span>v3.6-branch<span class="w"> </span>zephyrproject
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zephyrproject
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>west<span class="w"> </span>update
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>west<span class="w"> </span>zephyr-export
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zephyrproject/zephyr/scripts/requirements.txt
</code></pre></div>
<p>Note: If you get a similar error like:
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>ERROR: sphinx-tabs 3.4.1 has requirement docutils~=0.18.0, but you&#39;ll have docutils 0.19 which is incompatible.
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>ERROR: sphinx-rtd-theme 1.2.2 has requirement docutils&lt;0.19, but you&#39;ll have docutils 0.19 which is incompatible
</code></pre></div></p>
<p>Run:
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>pip<span class="w"> </span>install<span class="w"> </span>sphinx-rtd-theme<span class="w"> </span>sphinx
</code></pre></div></p>
<ul>
<li>Install Zephyr SDK in home folder so it can be used on many Zephyr projects:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>wget<span class="w"> </span>https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.16.4/zephyr-sdk-0.16.4_linux-x86_64.tar.xz
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>wget<span class="w"> </span>-O<span class="w"> </span>-<span class="w"> </span>https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.16.4/sha256.sum<span class="w"> </span><span class="p">|</span><span class="w"> </span>shasum<span class="w"> </span>--check<span class="w"> </span>--ignore-missing
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>wget<span class="w"> </span>https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.16.1/zephyr-sdk-0.16.1_linux-x86_64.tar.xz
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>wget<span class="w"> </span>-O<span class="w"> </span>-<span class="w"> </span>https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.16.1/sha256.sum<span class="w"> </span><span class="p">|</span><span class="w"> </span>shasum<span class="w"> </span>--check<span class="w"> </span>--ignore-missing<span class="w"> </span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>tar<span class="w"> </span>xf<span class="w"> </span>zephyr-sdk*.tar.xz<span class="w"> </span>-C<span class="w"> </span>~/
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>rm<span class="w"> </span>zephyr-sdk*.tar.xz
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="nv">$HOME</span>/zephyr-sdk*/setup.sh<span class="w"> </span>-t<span class="w"> </span>aarch64-zephyr-elf<span class="w"> </span>-h<span class="w"> </span>-c
</code></pre></div>
<ul>
<li>Substitute the official "Zephyr" folder for zephyr-socfpga repository:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zephyrproject
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>zephyr<span class="w"> </span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>QPDS24.3_REL_GSRD_PR<span class="w"> </span>--single-branch<span class="w"> </span>https://github.com/altera-opensource/zephyr-socfpga<span class="w"> </span>zephyr
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>west<span class="w"> </span>update
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>west<span class="w"> </span>zephyr-export
</code></pre></div>
<h3 id="building-zephyr-application">Building Zephyr Application<a class="headerlink" href="#building-zephyr-application" title="Permanent link">&para;</a></h3>
<p>Every Zephyr application is composed of several configurable key components that work together in the same executable:</p>
<ul>
<li>Zephyr Kernel: Manages system resources and task scheduling.</li>
<li>Device Drivers: Enable interaction with hardware peripherals.</li>
<li>Libraries: Provide additional functionality and utilities.</li>
<li>Application Code: Written in C to define application behavior</li>
</ul>
<p>The following Zephyr sample applications are available to test:</p>
<ul>
<li>HelloWorld: samples/hello_world/</li>
<li>GPIO: samples/basic/blinky/</li>
<li>I2C: samples/drivers/i2c_fujitsu_fram/</li>
<li>Timer/Counter: samples/drivers/counter/alarm/</li>
<li>Watchdog: samples/drivers/watchdog/</li>
<li>SD: samples/subsys/fs/fat_fs/</li>
<li>UART: samples/drivers/uart/echo_bot/</li>
<li>Ethernet: samples/net/sockets/echo_client and samples/net/sockets/ echo_server</li>
<li>NAND: samples/drivers/soc_flash_nand/</li>
<li>SPI: samples/drivers/jesd216/</li>
<li>QSPI : samples/drivers/soc_flash_qspi/</li>
<li>SDM Mailbox: sample/subsys/sip_svc/</li>
<li>USB 2.0 Host: samples/subsys/fs/fat_fs/</li>
<li>HPS DMA: samples/drivers/dma/mem_to_mem/</li>
<li>I3C: samples/drivers/i3c_sample_app_simics/</li>
</ul>
<p>In this regard, we will focus on building the "Hello World" sample that will allow us to test our development environment and run it in Simics® Simulator.</p>
<ul>
<li>Build the "Hello World" Zephyr application binary and place the built outputs in an "agilex5" directory in the current active directory.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zephyrproject/zephyr
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>west<span class="w"> </span>build<span class="w"> </span>-b<span class="w"> </span>intel_socfpga_agilex5_socdk<span class="w"> </span>samples/hello_world<span class="w"> </span>-d<span class="w"> </span>agilex5
</code></pre></div>
<p>Successful build console output should be similar to the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>Zephyr version: 3.6.0 (/home/msangele/Artifacts/zephyr_samples/agilex5_zgsrd/zephyrproject/zephyr), build: f1571bf6e7e2
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>[134/144] Linking C executable zephyr/zephyr_pre0.elf
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>[138/144] Linking C executable zephyr/zephyr_pre1.elf
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>[144/144] Linking C executable zephyr/zephyr.elf
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>Memory region         Used Size  Region Size  %age Used
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>           FLASH:          0 GB         0 GB
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>             RAM:      134048 B         8 MB      1.60%
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>        IDT_LIST:          0 GB         2 KB      0.00%
</code></pre></div>
<p>The output of this stage is:</p>
<ul>
<li>$TOP_FOLDER/zephyrproject/zephyr/agilex5/zephyr/zephyr.bin</li>
</ul>
<h3 id="creating-boot-images">Creating Boot Images<a class="headerlink" href="#creating-boot-images" title="Permanent link">&para;</a></h3>
<p>Three types of boot devices are supported:</p>
<ol>
<li><a href="#sd-card-image-binaries">SD Card</a></li>
<li><a href="#nand-binaries">NAND Flash</a></li>
<li><a href="#qspi-binaries">QSPI Flash</a></li>
</ol>
<h4 id="sd-card-image-binaries">SD Card Image binaries<a class="headerlink" href="#sd-card-image-binaries" title="Permanent link">&para;</a></h4>
<ul>
<li>Create FIP(Firmware Image Package) binary. This will pack the Zephyr binary and ATF BL31 binary into one single binary called FIP binary.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>mkdir<span class="w"> </span>sdcard_bin<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>sdcard_bin
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/arm-trusted-firmware-sdcard/build/agilex5/release/bl2.bin<span class="w"> </span>.
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="nv">$TOP_FOLDER</span>/fiptool<span class="w"> </span>create<span class="w"> </span>--soc-fw<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/arm-trusted-firmware-sdcard/build/agilex5/release/bl31.bin<span class="w"> </span>--nt-fw<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zephyrproject/zephyr/agilex5/zephyr/zephyr.bin<span class="w"> </span>fip.bin
</code></pre></div>
<p>To build the "SDCard Image" for simics use the following commands:</p>
<ul>
<li>Obtain the make_sdimage.sh script.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/sdcard_bin
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>wget<span class="w"> </span>https://releases.rocketboards.org/2023.12/zephyr/gsrd_zephyr/agilex5/cli/sdmmc_boot/make_sdimage.sh
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>chmod<span class="w"> </span>+x<span class="w"> </span>make_sdimage.sh
</code></pre></div>
<ul>
<li>Create the sdimage.img</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>touch<span class="w"> </span>dummy.tar.gz
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>sudo<span class="w"> </span>./make_sdimage.sh<span class="w"> </span>-k<span class="w"> </span>dummy.tar.gz<span class="w"> </span>-p<span class="w"> </span>fip.bin<span class="w"> </span>-o<span class="w"> </span>sdimage.img<span class="w"> </span>-g<span class="w"> </span>2G<span class="w"> </span>-pg<span class="w"> </span><span class="m">16</span>
</code></pre></div>
<p>To deactivate the environment when development is done execute:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>deactivate
</code></pre></div>
<h5 id="resulted-files">Resulted Files<a class="headerlink" href="#resulted-files" title="Permanent link">&para;</a></h5>
<p>After the build is completed successfully the most relevant files are:</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>bl2.bin</td>
<td>The FSBL that Simics will launch first</td>
</tr>
<tr>
<td>bl31.bin</td>
<td>The ATF BL31 (similar to legacy SSBL stage)</td>
</tr>
<tr>
<td>zephyr.bin</td>
<td>Zephyr Application/Kernel</td>
</tr>
<tr>
<td>fip.bin</td>
<td>Firmware Image Package</td>
</tr>
<tr>
<td>sdimage.img</td>
<td>Application image</td>
</tr>
</tbody>
</table>
<p>If you have not set up Simics Virtual Platform for Agilex™ 5, go to <a href="#simulation-setup">Simulation Setup</a>. 
For booting on Simics Virtual Platform for Agilex 5, refer <a href="#booting-from-sd-card-image-binaries">Booting from SD Card Image binaries</a></p>
<h4 id="nand-binaries">NAND binaries<a class="headerlink" href="#nand-binaries" title="Permanent link">&para;</a></h4>
<p>To build the "NAND Image" for simics use the following commands with the ATF created for NAND boot:</p>
<ul>
<li>Rebuild fip.bin with NAND ATF</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>mkdir<span class="w"> </span>nand_bin<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>nand_bin
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/arm-trusted-firmware-nand/build/agilex5/release/bl2.bin<span class="w"> </span>.
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="nv">$TOP_FOLDER</span>/fiptool<span class="w"> </span>create<span class="w"> </span>--soc-fw<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/arm-trusted-firmware-nand/build/agilex5/release/bl31.bin<span class="w">  </span>--nt-fw<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zephyrproject/zephyr/agilex5/zephyr/zephyr.bin<span class="w"> </span>fip.bin
</code></pre></div>
<ul>
<li>Create the nand_mem.img image and write the fip.bin within:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/nand_bin
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/zero<span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">8</span><span class="w"> </span><span class="nv">bs</span><span class="o">=</span>16MB<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;\0&#39;</span><span class="w"> </span><span class="s1">&#39;\377&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>nand_mem.img<span class="w"> </span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>fip.bin<span class="w"> </span><span class="nv">of</span><span class="o">=</span>nand_mem.img<span class="w"> </span><span class="nv">conv</span><span class="o">=</span>notrunc<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">seek</span><span class="o">=</span><span class="m">2097152</span>
</code></pre></div>
<p>To deactivate the environment when development is done and return to the main branch execute:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>deactivate
</code></pre></div>
<h5 id="resulted-files_1">Resulted Files<a class="headerlink" href="#resulted-files_1" title="Permanent link">&para;</a></h5>
<p>After the build is completed successfully the most relevant files are:</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>bl2.bin</td>
<td>The FSBL that Simics will launch first</td>
</tr>
<tr>
<td>bl31.bin</td>
<td>The ATF BL31 (similar to legacy SSBL stage)</td>
</tr>
<tr>
<td>zephyr.bin</td>
<td>Zephyr Application/Kernel</td>
</tr>
<tr>
<td>fip.bin</td>
<td>Firmware Image Package</td>
</tr>
<tr>
<td>nand_mem.img</td>
<td>NAND Application image</td>
</tr>
</tbody>
</table>
<p>If you have not set up Simics Virtual Platform for Agilex 5, go to <a href="#simulation-setup">Simulation Setup</a>. 
For booting on Simics Virtual Platform for Agilex 5, refer <a href="#booting-from-nand-binaries">Booting from NAND binaries</a></p>
<h4 id="qspi-binaries">QSPI binaries<a class="headerlink" href="#qspi-binaries" title="Permanent link">&para;</a></h4>
<p>To build the "QSPI Image" for simics use the following commands using the ATF built for QSPI boot:</p>
<ul>
<li>Rebuild fip.bin</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>mkdir<span class="w"> </span>qspi_bin<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>qspi_bin
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>cp<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/arm-trusted-firmware-qspi/build/agilex5/release/bl2.bin<span class="w"> </span>.
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="nv">$TOP_FOLDER</span>/fiptool<span class="w"> </span>create<span class="w"> </span>--soc-fw<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/arm-trusted-firmware-qspi/build/agilex5/release/bl31.bin<span class="w"> </span>--nt-fw<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zephyrproject/zephyr/agilex5/zephyr/zephyr.bin<span class="w"> </span>fip.bin
</code></pre></div>
<ul>
<li>Create pfg file:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/qspi_bin
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>tee<span class="w"> </span>qspi_flash_image_agilex5_boot.pfg<span class="w">  </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="s">&lt;pfg version=&quot;1&quot;&gt;</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="s">  &lt;settings custom_db_dir=&quot;./&quot; mode=&quot;ASX4&quot;/&gt;</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="s">  &lt;output_files&gt;</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="s">      &lt;output_file name=&quot;flash_image&quot; directory=&quot;.&quot; type=&quot;JIC&quot;&gt;</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="s">          &lt;file_options/&gt;</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="s">          &lt;secondary_file type=&quot;MAP&quot; name=&quot;flash_image_jic&quot;&gt;</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="s">              &lt;file_options/&gt;</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="s">          &lt;/secondary_file&gt;</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="s">          &lt;secondary_file type=&quot;SEC_RPD&quot; name=&quot;flash_image_jic&quot;&gt;</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="s">              &lt;file_options bitswap=&quot;1&quot;/&gt;</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="s">          &lt;/secondary_file&gt;</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="s">          &lt;flash_device_id&gt;Flash_Device_1&lt;/flash_device_id&gt;</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="s">      &lt;/output_file&gt;</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="s">  &lt;/output_files&gt;</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="s">  &lt;bitstreams&gt;</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="s">      &lt;bitstream id=&quot;Bitstream_1&quot;&gt;</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="s">          &lt;path hps_path=&quot;bl2.hex&quot;&gt;agilex5_factory.sof&lt;/path&gt;</span>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="s">      &lt;/bitstream&gt;</span>
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="s">  &lt;/bitstreams&gt;</span>
<a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a><span class="s">  &lt;raw_files&gt;</span>
<a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="s">      &lt;raw_file bitswap=&quot;1&quot; type=&quot;RBF&quot; id=&quot;Raw_File_1&quot;&gt;bin/fip.bin&lt;/raw_file&gt;</span>
<a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a><span class="s">  &lt;/raw_files&gt;</span>
<a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a><span class="s">  &lt;flash_devices&gt;</span>
<a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a><span class="s">      &lt;flash_device type=&quot;MT25QU02G&quot; id=&quot;Flash_Device_1&quot;&gt;</span>
<a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a><span class="s">          &lt;partition reserved=&quot;1&quot; fixed_s_addr=&quot;1&quot; s_addr=&quot;0x00000000&quot; e_addr=&quot;0x001FFFFF&quot; fixed_e_addr=&quot;1&quot; id=&quot;BOOT_INFO&quot; size=&quot;0&quot;/&gt;</span>
<a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a><span class="s">          &lt;partition reserved=&quot;0&quot; fixed_s_addr=&quot;0&quot; s_addr=&quot;auto&quot; e_addr=&quot;auto&quot; fixed_e_addr=&quot;0&quot; id=&quot;P1&quot; size=&quot;0&quot;/&gt;</span>
<a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a><span class="s">          &lt;partition reserved=&quot;0&quot; fixed_s_addr=&quot;0&quot; s_addr=&quot;0x03C00000&quot; e_addr=&quot;auto&quot; fixed_e_addr=&quot;0&quot; id=&quot;fip&quot; size=&quot;0&quot;/&gt;</span>
<a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a><span class="s">      &lt;/flash_device&gt;</span>
<a id="__codelineno-35-31" name="__codelineno-35-31" href="#__codelineno-35-31"></a><span class="s">      &lt;flash_loader&gt;A5ED065BB32AE6SR0&lt;/flash_loader&gt;</span>
<a id="__codelineno-35-32" name="__codelineno-35-32" href="#__codelineno-35-32"></a><span class="s">  &lt;/flash_devices&gt;</span>
<a id="__codelineno-35-33" name="__codelineno-35-33" href="#__codelineno-35-33"></a><span class="s">  &lt;assignments&gt;</span>
<a id="__codelineno-35-34" name="__codelineno-35-34" href="#__codelineno-35-34"></a><span class="s">      &lt;assignment page=&quot;0&quot; partition_id=&quot;P1&quot;&gt;</span>
<a id="__codelineno-35-35" name="__codelineno-35-35" href="#__codelineno-35-35"></a><span class="s">          &lt;bitstream_id&gt;Bitstream_1&lt;/bitstream_id&gt;</span>
<a id="__codelineno-35-36" name="__codelineno-35-36" href="#__codelineno-35-36"></a><span class="s">      &lt;/assignment&gt;</span>
<a id="__codelineno-35-37" name="__codelineno-35-37" href="#__codelineno-35-37"></a><span class="s">      &lt;assignment page=&quot;0&quot; partition_id=&quot;fip&quot;&gt;</span>
<a id="__codelineno-35-38" name="__codelineno-35-38" href="#__codelineno-35-38"></a><span class="s">          &lt;raw_file_id&gt;Raw_File_1&lt;/raw_file_id&gt;</span>
<a id="__codelineno-35-39" name="__codelineno-35-39" href="#__codelineno-35-39"></a><span class="s">      &lt;/assignment&gt;</span>
<a id="__codelineno-35-40" name="__codelineno-35-40" href="#__codelineno-35-40"></a><span class="s">  &lt;/assignments&gt;</span>
<a id="__codelineno-35-41" name="__codelineno-35-41" href="#__codelineno-35-41"></a><span class="s">&lt;/pfg&gt;</span>
<a id="__codelineno-35-42" name="__codelineno-35-42" href="#__codelineno-35-42"></a><span class="s">EOF</span>
</code></pre></div>
<ul>
<li>Create <em>bl2.hex</em> from <em>bl2.bin</em></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/qspi_bin
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>aarch64-none-linux-gnu-objcopy<span class="w"> </span>-v<span class="w"> </span>-I<span class="w"> </span>binary<span class="w"> </span>-O<span class="w"> </span>ihex<span class="w"> </span>--change-addresses<span class="w"> </span>0x00000000<span class="w"> </span>bl2.bin<span class="w"> </span>bl2.hex
</code></pre></div>
<ul>
<li>Create <em>flash_image_jic.rpd</em> qspi image from fip.bin and <em>bl2.hex</em>:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/qspi_bin
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/ghrd_a5ed065bb32ae6sr0_hps.sof<span class="w"> </span>agilex5_factory.sof
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>quartus_pfg<span class="w"> </span>-c<span class="w"> </span>qspi_flash_image_agilex5_boot.pfg
</code></pre></div>
<p>The output of this stage is:
- flash_image_jic.rpd</p>
<p>To deactivate the environment when development is done and return to the main branch execute:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>deactivate
</code></pre></div>
<h5 id="resulted-files_2">Resulted Files<a class="headerlink" href="#resulted-files_2" title="Permanent link">&para;</a></h5>
<p>After the build is completed successfully the most relevant files are:</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>bl2.bin</td>
<td>The FSBL that Simics will launch first</td>
</tr>
<tr>
<td>bl2.hex</td>
<td>The FSBL in hex format</td>
</tr>
<tr>
<td>bl31.bin</td>
<td>The ATF BL31 (similar to legacy SSBL stage)</td>
</tr>
<tr>
<td>zephyr.bin</td>
<td>Zephyr Application/Kernel</td>
</tr>
<tr>
<td>fip.bin</td>
<td>Firmware Image Package</td>
</tr>
<tr>
<td>flash_image_jic.rpd</td>
<td>QSPI Application image</td>
</tr>
</tbody>
</table>
<p>If you have not set up Simics Virtual Platform for Agilex 5, go to <a href="#simulation-setup">Simulation Setup</a>. </p>
<p>For booting on Simics Virtual Platform for Agilex 5, refer <a href="#booting-from-qspi-binaries">Booting from QSPI binaries</a></p>
<h3 id="simulation-setup">Simulation Setup<a class="headerlink" href="#simulation-setup" title="Permanent link">&para;</a></h3>
<p>We assume that the Simics® Simulator for Intel® FPGAs Simulator has been installed in a Linux System.</p>
<ul>
<li>Lets add the Simics binary to the path to make things easier:</li>
</ul>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:SIMICS_INSTALLATION/simics/bin/
</code></pre></div>
note: default path is "~/intelFPGA_pro/intel-fpga-ext_24.3/simics/bin"</p>
<ul>
<li>Create a Simics project directory under ZephyrGSRD directory:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>project-1
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>mkdir<span class="w"> </span>project-1
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="nb">cd</span><span class="w"> </span>project-1
</code></pre></div>
<p>Under the new project directory created, deploy the <em>agilex5e-universal</em> virtual platform:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>simics_intelfpga_cli<span class="w"> </span>--deploy<span class="w"> </span>agilex5e-universal
</code></pre></div>
<p>The above will produce the following:
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>Simics(R) Simulator for Intel(R) FPGA CLI:
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>INFO: Preparing to initialize /home/simicsUser/SimicsInstallDir/project-1 as a
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>Simics workspace
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>Project created successfully
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a># Observe that the directory has been initialized and the simics and simics-gui
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a># commands appears in the project directory. Also the target directory is
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a># created. This includes the target script corresponding to the deployed
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a># platform.
</code></pre></div></p>
<ul>
<li>Build the virtual platform components:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>make
</code></pre></div>
<p>Example of console output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>=== Environment Check ===
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>&#39;/home/simicsUser/SimicsInstallDir/project-1&#39; is up-to date
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>gcc version 9
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>=== Building module agilex5e-universal-board-comp ===
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>.
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>:
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>=== Building module agilex5e-universal-fpga-comp ===
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>.
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>:
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>=== Building module agilex5e-universal-system-comp ===
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>.
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>:
</code></pre></div>
<p>Note: You only have to setup the Agilex 5 Virtual Platform once (or until it has been remove)</p>
<h4 id="booting-on-simics-virtual-platform-for-agilex-5">Booting On Simics Virtual Platform for Agilex 5<a class="headerlink" href="#booting-on-simics-virtual-platform-for-agilex-5" title="Permanent link">&para;</a></h4>
<p>We assume that the following binaries are already available (either from the <a href="#prebuilt-binaries">Prebuilt Binaries</a> package or built from the steps in <a href="#build-instructions">Build Instructions</a>) :
   * bl2.bin
   * bl31.bin
   * zephyr.bin
   * sdimage.img /nand_mem.img / flash_image_jic.rpd</p>
<h5 id="booting-from-sd-card-image-binaries">Booting from SD Card Image binaries<a class="headerlink" href="#booting-from-sd-card-image-binaries" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Zephyr's SMP support allow us to select the boot core within simics. Select the boot core as follows:</p>
<table>
<thead>
<tr>
<th><em>Core Selection</em></th>
<th><em>Env-variable</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>A55</td>
<td>export cputype=a55</td>
</tr>
<tr>
<td>A76</td>
<td>export cputype=a76</td>
</tr>
</tbody>
</table>
</li>
</ul>
<ul>
<li>You will need a Simics script named zephyr.simics with the contents detailed in <a href="#key-points-for-zephyr">Key points for Zephyr</a>. Run the following to create the script:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/project-1
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="nv">cputypestring</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$cputype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;a76&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="nv">cputypestring</span><span class="o">=</span><span class="s1">&#39;$hps_boot_core = 2 </span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="s1">$hps_core0_1_power_on = TRUE </span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="s1">$hps_core2_power_on = TRUE </span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="s1">$hps_core3_power_on = TRUE&#39;</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="k">fi</span><span class="p">;</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a>tee<span class="w"> </span>zephyr_sdcard.simics<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="s"># TOP-LEVEL CONFIG Script TO BOOT ZEPHYR.</span>
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="s">local $board_name = &quot;system.board.fpga&quot;</span>
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a>
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="s"># Ensure the sdimage.img &amp; bl2.bin paths are relative to the simics executable#</span>
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a>
<a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="s"># Enable Console</span>
<a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="s">$create_hps_serial0_console=TRUE</span>
<a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a>
<a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="s"># Boot from SD Card</span>
<a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="s">$create_hps_sd_card=TRUE</span>
<a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a><span class="s">$create_hps_mmc=FALSE</span>
<a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a>
<a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a><span class="s"># SD Card boot Image file path</span>
<a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a><span class="s">$sd_image_filename = ../sdcard_bin/sdimage.img</span>
<a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a>
<a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="s"># First stage boot loader, ATF BL2 path</span>
<a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a><span class="s">$fsbl_image_filename = ../sdcard_bin/bl2.bin</span>
<a id="__codelineno-45-28" name="__codelineno-45-28" href="#__codelineno-45-28"></a><span class="s">EOF</span>
<a id="__codelineno-45-29" name="__codelineno-45-29" href="#__codelineno-45-29"></a>
<a id="__codelineno-45-30" name="__codelineno-45-30" href="#__codelineno-45-30"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cputypestring</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>zephyr_sdcard.simics<span class="w"> </span>
<a id="__codelineno-45-31" name="__codelineno-45-31" href="#__codelineno-45-31"></a>
<a id="__codelineno-45-32" name="__codelineno-45-32" href="#__codelineno-45-32"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;run-command-file &quot;targets/agilex5e-universal/agilex5e-universal.simics&quot;</span>
<a id="__codelineno-45-33" name="__codelineno-45-33" href="#__codelineno-45-33"></a><span class="s1">run&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>zephyr_sdcard.simics<span class="w"> </span>
</code></pre></div>
<h5 id="booting-from-nand-binaries">Booting from NAND binaries<a class="headerlink" href="#booting-from-nand-binaries" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Zephyr's SMP support allow us to select the boot core within simics. Select the boot core by as follows:</p>
<table>
<thead>
<tr>
<th>Core Selection</th>
<th>Env-variable</th>
</tr>
</thead>
<tbody>
<tr>
<td>A55</td>
<td>export cputype=a55</td>
</tr>
<tr>
<td>A76</td>
<td>export cputype=a76</td>
</tr>
</tbody>
</table>
</li>
</ul>
<ul>
<li>You will need a Simics script modified for NAND named zephyr.simics. This will take <a href="#key-points-for-zephyr">Key points for Zephyr</a> as base. Run the following to create the script:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/project-1
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="nv">cputypestring</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$cputype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;a76&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="nv">cputypestring</span><span class="o">=</span><span class="s1">&#39;$hps_boot_core = 2 </span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="s1">$hps_core0_1_power_on = TRUE </span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="s1">$hps_core2_power_on = TRUE </span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="s1">$hps_core3_power_on = TRUE &#39;</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="k">fi</span><span class="p">;</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>tee<span class="w"> </span>zephyr_nand.simics<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="s"># TOP-LEVEL CONFIG Script TO BOOT ZEPHYR.</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="s">local $board_name = &quot;system.board.fpga&quot;</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="s"># Ensure the nand_mem.img &amp; bl2.bin paths are relative to the simics executable</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="s"># First stage boot loader, ATF BL2 path</span>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="s">$fsbl_image_filename = ../nand_bin/bl2.bin</span>
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="s">#Boot from NAND</span>
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="s">$nand_data_image_filename = ../nand_bin/nand_mem.img </span>
<a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a><span class="s"># Enable Console</span>
<a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a><span class="s">$create_hps_serial0_console=TRUE</span>
<a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a><span class="s">EOF</span>
<a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a>
<a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cputypestring</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>zephyr_nand.simics<span class="w"> </span>
<a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a>
<a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;run-command-file &quot;targets/agilex5e-universal/agilex5e-universal.simics&quot;</span>
<a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a><span class="s1">run&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>zephyr_nand.simics<span class="w"> </span>
</code></pre></div>
<h5 id="booting-from-qspi-binaries">Booting from QSPI binaries<a class="headerlink" href="#booting-from-qspi-binaries" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Zephyr's SMP support allow us to select the boot core within simics. Select the boot core as follows:</p>
<table>
<thead>
<tr>
<th><em>Core Selection</em></th>
<th><em>Env-variable</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>A55</td>
<td>export cputype=a55</td>
</tr>
<tr>
<td>A76</td>
<td>export cputype=a76</td>
</tr>
</tbody>
</table>
</li>
</ul>
<ul>
<li>You will need a Simics script modified for QSPI named zephyr.simics. This will take <a href="#key-points-for-zephyr">Key points for Zephyr</a> as base. Run the following to create the script:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/project-1
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="nv">cputypestring</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$cputype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;a76&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="nv">cputypestring</span><span class="o">=</span><span class="s1">&#39;$hps_boot_core = 2 </span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="s1">$hps_core0_1_power_on = TRUE </span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="s1">$hps_core2_power_on = TRUE </span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="s1">$hps_core3_power_on = TRUE &#39;</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="k">fi</span><span class="p">;</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>tee<span class="w"> </span>zephyr_qspi.simics<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="s"># TOP-LEVEL CONFIG Script TO BOOT ZEPHYR.</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="s">local $board_name = &quot;system.board.fpga&quot;</span>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a>
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="s"># Ensure the nand_mem.img &amp; bl2.bin paths are relative to the simics executable</span>
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a>
<a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="s"># First stage boot loader, ATF BL2 path</span>
<a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="s">$fsbl_image_filename = ../qspi_bin/bl2.bin</span>
<a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a><span class="s">#Boot from QSPI</span>
<a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a><span class="s">$qspi_image_filename = ../qspi_bin/flash_image_jic.rpd  </span>
<a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a><span class="s"># Enable Console</span>
<a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a><span class="s">$create_hps_serial0_console=TRUE </span>
<a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a><span class="s">EOF</span>
<a id="__codelineno-47-23" name="__codelineno-47-23" href="#__codelineno-47-23"></a>
<a id="__codelineno-47-24" name="__codelineno-47-24" href="#__codelineno-47-24"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cputypestring</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>zephyr_qspi.simics<span class="w"> </span>
<a id="__codelineno-47-25" name="__codelineno-47-25" href="#__codelineno-47-25"></a>
<a id="__codelineno-47-26" name="__codelineno-47-26" href="#__codelineno-47-26"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;run-command-file &quot;targets/agilex5e-universal/agilex5e-universal.simics&quot;</span>
<a id="__codelineno-47-27" name="__codelineno-47-27" href="#__codelineno-47-27"></a><span class="s1">run&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>zephyr_qspi.simics<span class="w"> </span>
</code></pre></div>
<h3 id="running-hello-world">Running Hello World!<a class="headerlink" href="#running-hello-world" title="Permanent link">&para;</a></h3>
<p>To exercise this use case, follow the next steps once the Simulation setup has been completed:</p>
<ul>
<li>From the project directory, launch the simulation using the <em>zephyr.simics</em> (a soft link to the desired .simics file) target script. This will launch the simulator and the current terminal will become the Simics CLI:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/project-1
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>ln<span class="w"> </span>-s<span class="w"> </span>zephyr_sdcard.simics<span class="w">  </span>zephyr.simics
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>./simics<span class="w"> </span>zephyr.simics
</code></pre></div>
<ol>
<li>Wait to get "Hello World!" message in the target serial console.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a># Target Serial console&lt;/b&gt;
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>NOTICE:  DDR: Reset type is &#39;Power-On&#39;
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>NOTICE:  IOSSM: Calibration success status check...
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>NOTICE:  IOSSM: All EMIF instances within the IO96 have calibrated successfully!
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>NOTICE:  DDR: Calibration success
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>NOTICE:  ###DDR:init success###
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a>NOTICE:  SDMMC boot
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>NOTICE:  BL2: v2.11.0(release):QPDS24.3_REL_GSRD_PR
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>NOTICE:  BL2: Built : 14:04:49, Dec  6 2024
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>NOTICE:  BL2: Booting BL31
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>NOTICE:  BL31: Boot Core = 0
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>NOTICE:  BL31: CPU ID = 0
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>NOTICE:  BL31: v2.11.0(release):QPDS24.3_REL_GSRD_PR
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>NOTICE:  BL31: Built : 14:04:50, Dec  6 2024
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>*** Booting Zephyr OS build b755e7bab5f8 ***
<a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a>Secondary CPU core 1 (MPID:0x100) is up
<a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>Secondary CPU core 2 (MPID:0x200) is up
<a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a>Secondary CPU core 3 (MPID:0x300) is up
<a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a>Hello World! intel_socfpga_agilex5_socdk
</code></pre></div>
<h2 id="use-cases">Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">&para;</a></h2>
<p>The following sections provide instructions on how to exercise some supported use cases through cli using the <em>Intel Agilex® 5 E-Series Universal</em> virtual platform.
The compatible sample for Agilex™ 5 can be found at:</p>
<ul>
<li>{zephyrfolder}/samples/boards/intel_socfpga/cli</li>
</ul>
<p>The preconditions required to execute them are listed in the following section. To use the application built following the <a href="#build-instructions">Build Instructions</a>, jump to <a href="#simulation-setup">Simulation_Setup</a>.</p>
<h3 id="running-zephyr-command-line-application">Running Zephyr Command Line Application<a class="headerlink" href="#running-zephyr-command-line-application" title="Permanent link">&para;</a></h3>
<p>To demonstrate the use of some Zephyr peripherals/zephyr subsystems it supports commands like:</p>
<ul>
<li>device: Device commands</li>
<li>flash: Flash shell commands</li>
<li>fs: File system commands</li>
<li>gpio: GPIO commands</li>
<li>i2c: I2C commands</li>
<li>io96b: IO96B information</li>
<li>mailbox: Altera SoC FPGA SDM mailbox client commands</li>
<li>mdio: MDIO commands</li>
<li>net: Networking commands</li>
<li>psci: ARM PSCI interface commands</li>
<li>sip_svc: ARM SiP services commands</li>
<li>spi: spi commands</li>
<li>timer: Timer commands</li>
<li>i3c: I3C commands</li>
</ul>
<h5 id="cli-application-prebuilt-binaries">CLI application - Prebuilt binaries<a class="headerlink" href="#cli-application-prebuilt-binaries" title="Permanent link">&para;</a></h5>
<p>Note: The following steps assume you have followed the instructions in <a href="#setting-up-to-use-prebuilt-binaries">Setting Up to Use Prebuilt Binaries</a></p>
<ul>
<li>Select the sample based on app and boot device (e.g. nand):</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">app</span><span class="o">=</span>cli
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">bootdev</span><span class="o">=</span>sdmmc_boot<span class="w"> </span><span class="nv">bootimg</span><span class="o">=</span>sdimage.img
</code></pre></div>
<ul>
<li>Obtain the prebuilt binaries for the CLI sample app</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/prebuilt
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>wget<span class="w"> </span>-N<span class="w"> </span>https://releases.rocketboards.org/2024.11/zephyr/agilex5/hps_zephyr/<span class="nv">$app</span>/<span class="nv">$bootdev</span>/<span class="nv">$bootimg</span><span class="w"> </span>-P<span class="w"> </span><span class="nv">$app</span>/<span class="nv">$bootdev</span>/<span class="w"> </span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>wget<span class="w"> </span>-N<span class="w"> </span>https://releases.rocketboards.org/2024.11/zephyr/agilex5/hps_zephyr/<span class="nv">$app</span>/<span class="nv">$bootdev</span>/bl2.bin<span class="w"> </span>-P<span class="w"> </span><span class="nv">$app</span>/<span class="nv">$bootdev</span>/
</code></pre></div>
<ul>
<li>Prepare the binaries to run on Simics® Simulator</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>bin
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>bin/atf
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/prebuilt/<span class="nv">$app</span>/<span class="nv">$bootdev</span>/<span class="nv">$bootimg</span><span class="w"> </span>bin/<span class="w"> </span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>ln<span class="w"> </span>-s<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/prebuilt/<span class="nv">$app</span>/<span class="nv">$bootdev</span>/bl2.bin<span class="w"> </span>bin/atf/bl2.bin
</code></pre></div>
<p>To run the application, go to the section <a href="#cli-application---run">CLI application - Run</a></p>
<h5 id="cli-application-build-from-source">CLI application - Build-from-source<a class="headerlink" href="#cli-application-build-from-source" title="Permanent link">&para;</a></h5>
<p>There is a sample specially made for Agilex™ E-Series that can be found at <em>samples/boards/intel_socfpga/cli/</em> within the Zephyr folder. The following  instructions show how to build and run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zephyrproject/zephyr/
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>west<span class="w"> </span>build<span class="w"> </span>-b<span class="w"> </span>intel_socfpga_agilex5_socdk<span class="w"> </span>samples/boards/intel_socfpga/cli/<span class="w"> </span>-d<span class="w"> </span>agilex5<span class="w"> </span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="c1">#If you need to overwrite a previous build you need to add the --pristine flag as follows.</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="c1">#west build -b intel_socfpga_agilex5_socdk samples/boards/intel_socfpga/cli/ -d agilex5 --pristine</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
</code></pre></div>
<p>A. if you were using prebuilt binaries before this, perform this step: <a href="#organizing-the-build-from-source-binaries">Organizing the Build-From-Source Binaries</a>.</p>
<p>As the Zephyr application has been changed, you'll to create the bootable image according to the boot device you desire. Refer to <a href="#creating-boot-images">Creating Boot Images</a></p>
<p>Run the application following <a href="#cli-application---run">CLI_application - Run</a>.</p>
<h4 id="cli-application-run">CLI application - Run<a class="headerlink" href="#cli-application-run" title="Permanent link">&para;</a></h4>
<p>Once this sample is ready, you can run it in the same way as the 'hello world' sample, as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/project-1
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>./simics<span class="w"> </span>zephyr.simics
</code></pre></div>
<p>The following output and <em>agilex5$</em> prompt will appear:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>NOTICE:  return = 0 Hz
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>NOTICE:  mmc_clk = 200000000 Hz
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>NOTICE:  SDMMC boot
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>NOTICE:  BL2: v2.9.1(release):f0d41e37d
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>NOTICE:  BL2: Built : 08:55:04, Nov 17 2023
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>NOTICE:  BL2: Booting BL31
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>NOTICE:  BL31: Boot Core = 0
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>NOTICE:  BL31: CPU ID = 81000000
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a>NOTICE:  BL31: v2.9.1(release):f0d41e37d
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a>NOTICE:  BL31: Built : 08:55:08, Nov 17 2023
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>*** Booting Zephyr OS build 33d4a115fbed ***
<a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a>
<a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a>agilex5$ Secondary CPU core 1 (MPID:0x100) is up
<a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a>Secondary CPU core 2 (MPID:0x200) is up
<a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a>Secondary CPU core 3 (MPID:0x300) is up
<a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a>intel_socfpga_agilex5_socdk: Starting Command Line Interface...
<a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a>Enumeration started
<a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a>USB enumeration success
<a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a>
<a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a>agilex5$
</code></pre></div>
<p>At this point you can use the interactive command line and execute the following commands:
- help -&gt; Show all the available commands\
- fs -&gt; To interact with file system for storage devices
- gpio -&gt; To interact with the gpio ports
- i2c -&gt; To send and receive data from the i2c ports
- timer -&gt; To interact with the timer interrupts.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>agilex5$ help
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>You can try to call commands with &lt;-h&gt; or &lt;--help&gt; parameter for more information.
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>Available commands:
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>  device   :Device commands
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>  edac     :EDAC information
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>  flash    :Flash shell commands
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>  fs       :File system commands
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>  gpio     :GPIO commands
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>  help     :Prints the help message.
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a>  i2c      :I2C commands
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a>  i3c      :I3C commands
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a>  mailbox  :Intel SoC FPGA SDM mailbox client commands
<a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>  mdio     :MDIO commands
<a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a>  net      :Networking commands
<a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a>  psci     :ARM PSCI interface commands
<a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a>  sip_svc  :ARM SiP services commands
<a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a>  spi      :spi commands
<a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a>  timer    :Timer commands
<a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a>agilex5$
</code></pre></div>
<p>Let's execute blink through the gpio command to demonstrate the usage of the CLI(Command line interface):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>agilex5$ gpio help
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>gpio - GPIO commands
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>Subcommands:
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>  conf   :Configure GPIO: conf &lt;gpio_node_id&gt; &lt;pin&gt; &lt;mode(in/out)&gt;
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>  get    :Get GPIO value: get &lt;gpio_node_id&gt; &lt;pin&gt;
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>  set    :Set GPIO: set &lt;gpio_node_id&gt; &lt;pin&gt; &lt;value(0/1)&gt;
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>  blink  :Blink GPIO: blink &lt;gpio_node_id&gt; &lt;pin&gt;
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>agilex5$ gpio conf gpio@10c03300  5 out
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>Configuring gpio@10c03300 pin 5
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>agilex5$ gpio blink  gpio@10c03300  5  
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>Blinking port gpio@10c03300 pin 5. Hit any key to exit
<a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a>agilex5$
</code></pre></div>
<p>Note: GPIO port gpio@10c03200 pins 0 to 10 are used for sdcard boot and should not be used for other purposes.</p>
<h3 id="using-i3c">Using I3C<a class="headerlink" href="#using-i3c" title="Permanent link">&para;</a></h3>
<p>This use case is an extension to the CLI application. The CLI prebuilt or build from source binary can be used directly for this use case.</p>
<p>The Zephyr driver enabled 2 I3C devices and 1 I2C device of the modeled board components and attached to the I3C master's bus.
To test the I3C read and write operation to a device, set the <strong>inverted_loopback</strong> parameter to TRUE. This may be done in the zephyr.simics script.</p>
<p>Note: </p>
<ol>
<li>The 2 I3C device enabled have the PIDs 0xFB1122330001 and 0xFB1122330002. You'll have to enable <strong>inverted_loopback</strong> for the desired devices to read-back the write operation.<ul>
<li>Device #1: <strong>system.board.i3c0_device1.target-&gt;inverted_loopback=TRUE</strong></li>
<li>Device #2: <strong>system.board.i3c0_device2.target-&gt;inverted_loopback=TRUE</strong></li>
</ul>
</li>
<li>The 1 I2C device has the address 0x50.</li>
<li>The read-back values are inverted(by NOT bit-wise operation) at byte level. (E.g. write 0xAF -&gt; read returns 0x50).</li>
<li>For the first usage, the read FIFO will contain a 1-byte value of 0xF0 due to initialization (this is not a driver issue but the device model behaviour). Reads will flush the FIFO.</li>
<li>When the FIFO is empty, a read-back will have a default 1-byte value of 0xA5. Data after the 1<sup>st</sup> byte are random constant value.</li>
</ol>
<ul>
<li>For more details, refer to <a href="https://www.intel.com/content/www/us/en/docs/programmable/786901/23-4/i3c-device.html">Intel Agilex® 5 E-Series Virtual Platform User Guide - I3C Device</a></li>
</ul>
<p>Enable the (inverted)loopback in target simics script.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/project-1
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/^run$/i system.board.i3c0_device1.target-&gt;inverted_loopback=TRUE \</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="s1">system.board.i3c0_device2.target-&gt;inverted_loopback=TRUE&#39;</span><span class="w"> </span>zephyr.simics
</code></pre></div>
<p>If everything was done correctly we can execute "i3c" commands after running <strong>./simics zephyr.simics</strong> as shown below:</p>
<ul>
<li>Perform a dummy i3c read for the first use after boot. This is to clear the data in the RX fifo resulting from CCC operation during driver initialization. The output seen will be 0xf0.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>NOTICE:  return = 0 Hz
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>NOTICE:  mmc_clk = 200000000 Hz
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>NOTICE:  SDMMC boot
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>NOTICE:  BL2: v2.9.1(release):f0d41e37d
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>NOTICE:  BL2: Built : 08:55:04, Nov 17 2023
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>NOTICE:  BL2: Booting BL31
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>NOTICE:  BL31: Boot Core = 0
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>NOTICE:  BL31: CPU ID = 81000000
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>NOTICE:  BL31: v2.9.1(release):f0d41e37d
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>NOTICE:  BL31: Built : 08:55:08, Nov 17 2023
<a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a>*** Booting Zephyr OS build 33d4a115fbed ***
<a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a>
<a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a>agilex5$ Secondary CPU core 1 (MPID:0x100) is up
<a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a>Secondary CPU core 2 (MPID:0x200) is up
<a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a>Secondary CPU core 3 (MPID:0x300) is up
<a id="__codelineno-59-16" name="__codelineno-59-16" href="#__codelineno-59-16"></a>intel_socfpga_agilex5_socdk: Starting Command Line Interface...
<a id="__codelineno-59-17" name="__codelineno-59-17" href="#__codelineno-59-17"></a>Enumeration started
<a id="__codelineno-59-18" name="__codelineno-59-18" href="#__codelineno-59-18"></a>USB enumeration success
<a id="__codelineno-59-19" name="__codelineno-59-19" href="#__codelineno-59-19"></a>
<a id="__codelineno-59-20" name="__codelineno-59-20" href="#__codelineno-59-20"></a>agilex5$ %BLUE%i3c read i3c@10DA0000 0xfb11 0x22330001 0x1%ENDCOLOR%
<a id="__codelineno-59-21" name="__codelineno-59-21" href="#__codelineno-59-21"></a>
<a id="__codelineno-59-22" name="__codelineno-59-22" href="#__codelineno-59-22"></a>Read 1 bytes from i3c device with address (9)
<a id="__codelineno-59-23" name="__codelineno-59-23" href="#__codelineno-59-23"></a>
<a id="__codelineno-59-24" name="__codelineno-59-24" href="#__codelineno-59-24"></a>00000000: f0                                               |.                |
</code></pre></div>
<ul>
<li>Perform i3c commands for write and read test to I3C device.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>agilex5$ i3c write i3c@10DA0000 0xfb11 0x22330001 0xf0 0xca 0x14 0x52
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>To be Written data[0]: f0
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>To be Written data[1]: ca
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>To be Written data[2]: 14
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>To be Written data[3]: 52
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>Wrote 4 bytes: Device Dynamic address (9)
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a>agilex5$ i3c read i3c@10DA0000 0xfb11 0x22330001 0x4             
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a>
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a>Read 4 bytes from i3c device with address (9)
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a>
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a>00000000: 0f 35 eb ad                                      |.5..             |
</code></pre></div>
<ul>
<li>Perform i3c commands for write and read test to I2C device.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>agilex5$ i3c i2c_write i3c@10DA0000 0x50 0x08 0xb0 0x55 0xca 0xfe   
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>agilex5$ i3c i2c_read i3c@10DA0000 0x50 0x08 0x4                    
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>00000000: b0 55 ca fe                                      |.U..             |
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>agilex5$ 
</code></pre></div>
<h3 id="using-usb-20">Using USB 2.0<a class="headerlink" href="#using-usb-20" title="Permanent link">&para;</a></h3>
<p>To test file operations We can load the USB 2.0 device model: "usb-msd.craff" in Simics.</p>
<ul>
<li>Download the USB2.0 model:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/project-1
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>wget<span class="w"> </span>https://releases.rocketboards.org/2023.12/zephyr/gsrd_zephyr/agilex5/cli/usb-msd.craff
</code></pre></div>
<p>Then we need to modify our current zephyr.simics script to provide: <em>$usb_otg_image_filename</em> parameter as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/project-1
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;1i$usb_otg_image_filename = &quot;usb-msd.craff&quot;&#39;</span><span class="w"> </span>zephyr.simics
</code></pre></div>
<p>If  everything was done correctly we can execute "fs" commands after running =./simics zephyr.simics= as shown below:
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>NOTICE:  return = 0 Hz
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>NOTICE:  mmc_clk = 200000000 Hz
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>NOTICE:  QSPI boot
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>NOTICE:  BL2: v2.9.1(release):6e6d72e35
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>NOTICE:  BL2: Built : 08:50:06, Nov 17 2023
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>NOTICE:  BL2: Booting BL31
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>NOTICE:  BL31: Boot Core = 800
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>NOTICE:  BL31: CPU ID = 81000200
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>NOTICE:  BL31: v2.9.1(release):f0d41e37d
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a>NOTICE:  BL31: Built : 08:55:08, Nov 17 2023
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>*** Booting Zephyr OS build 33d4a115fbed ***
<a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>
<a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>agilex5$ Secondary CPU core 1 (MPID:0x0) is up
<a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a>Secondary CPU core 2 (MPID:0x100) is up
<a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a>Secondary CPU core 3 (MPID:0x300) is up
<a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a>intel_socfpga_agilex5_socdk: Starting Command Line Interface...
<a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a>Enumeration started
<a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a>USB enumeration success
<a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a>
<a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a>agilex5$ fs mount fat /USB2: 
<a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a>Successfully mounted fat fs:/USB2:
<a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a>agilex5$ fs ls USB2:/ 
<a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a>agilex5$ fs write USB2:/cafe.txt 0C 0A 0F 0F 0E
<a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a>Successfully written 5 bytes
<a id="__codelineno-64-25" name="__codelineno-64-25" href="#__codelineno-64-25"></a>agilex5$ fs read USB2:/cafe.txt                
<a id="__codelineno-64-26" name="__codelineno-64-26" href="#__codelineno-64-26"></a>File size: 5
<a id="__codelineno-64-27" name="__codelineno-64-27" href="#__codelineno-64-27"></a>00000000  0C 0A 0F 0F 0E                                   …..
<a id="__codelineno-64-28" name="__codelineno-64-28" href="#__codelineno-64-28"></a>Successfully read 5 bytes
<a id="__codelineno-64-29" name="__codelineno-64-29" href="#__codelineno-64-29"></a>agilex5$ fs ls USB2:/ 
<a id="__codelineno-64-30" name="__codelineno-64-30" href="#__codelineno-64-30"></a>      CAFE.TXT  size: 5          bytes
<a id="__codelineno-64-31" name="__codelineno-64-31" href="#__codelineno-64-31"></a>agilex5$
</code></pre></div></p>
<h2 id="exercising-zephyr-on-a-single-core">Exercising Zephyr on a single core.<a class="headerlink" href="#exercising-zephyr-on-a-single-core" title="Permanent link">&para;</a></h2>
<p>By default, SMP is enabled in Zephyr, and all the cores will be up and running. However, the user may choose the specific core on which the Zephyr application should run on a single core. This can be accomplished as follows:</p>
<h3 id="prebuilt-binaries-for-a55-and-a76">Prebuilt Binaries for A55 and A76<a class="headerlink" href="#prebuilt-binaries-for-a55-and-a76" title="Permanent link">&para;</a></h3>
<p>To execute the binaries prebuilt for A76, change the "cputype" in the steps for
<a href="#organizing-the-prebuilt-binaries">Organizing the Prebuilt Binaries</a> or
<a href="#cli-application---prebuilt-binaries">CLI application - Prebuilt binaries</a></p>
<h3 id="build-the-zephyr-application">Build the Zephyr Application<a class="headerlink" href="#build-the-zephyr-application" title="Permanent link">&para;</a></h3>
<p>The default build configuration targets the A55 core. The following steps will guide you in rebuilding the "Hello World" application for A76.
It's assumed you have already followed the <a href="#build-instructions">Build Instructions</a> with default settings.</p>
<ul>
<li>Load the profile and activate the python virtual environment</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>source  $TOP_FOLDER/.zephyrrc
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>source ~/.zephyrproject/.venv/bin/activate 
</code></pre></div>
<ul>
<li>Pick either core0(a55) or core2(a76):</li>
</ul>
<table>
<thead>
<tr>
<th><em>Core Selection</em></th>
<th><em>Env-variable</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>A55</td>
<td>export cputype=a55</td>
</tr>
<tr>
<td>A76</td>
<td>export cputype=a76</td>
</tr>
</tbody>
</table>
<ul>
<li>For demonstration purposes, we will create a new local branch so that we can revert to the default SMP configurations:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zephyrproject/zephyr
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>git<span class="w"> </span>checkout<span class="w"> </span>QPDS24.3_REL_GSRD_PR
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>git<span class="w"> </span>branch<span class="w"> </span>nosmp_<span class="nv">$cputype</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>git<span class="w"> </span>checkout<span class="w"> </span>nosmp_<span class="nv">$cputype</span>
</code></pre></div>
<ul>
<li>Modify the file in <em>$TOP_FOLDER/zephyrproject/zephyr/dts/arm64/intel/intel_socfpga_agilex5.dtsi</em>, to remove the rest of the cores:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$cputype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;a55&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;27,46d&#39;</span><span class="w"> </span>dts/arm64/intel/intel_socfpga_agilex5.dtsi<span class="p">;</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="k">else</span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;20,32d&#39;</span><span class="w"> </span>dts/arm64/intel/intel_socfpga_agilex5.dtsi<span class="p">;</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;28,33d&#39;</span><span class="w"> </span>dts/arm64/intel/intel_socfpga_agilex5.dtsi<span class="p">;</span>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="k">fi</span><span class="p">;</span>
</code></pre></div>
<p>For reference, the device tree should look like this:</p>
<p>A55:
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>13: #include &lt;zephyr/dt-bindings/gpio/gpio.h&gt;
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>14: 
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>15: / {
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>16:     cpus {
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>17:         #address-cells = &lt;1&gt;;
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>18:         #size-cells = &lt;0&gt;;
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a>19: 
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>20:         cpu@0 {
<a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a>21:             device_type = &quot;cpu&quot;;
<a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a>22:             compatible = &quot;arm,cortex-a55&quot;;
<a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a>23:             enable-method = &quot;psci&quot;;
<a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a>24:             reg = &lt;0&gt;;
<a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a>25:         };
<a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a>26:     };
<a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a>};
</code></pre></div></p>
<p>A76:
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>14: 
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>15: / {
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>16:     cpus {
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>17:         #address-cells = &lt;1&gt;;
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>18:         #size-cells = &lt;0&gt;;
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>19: 
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a>20: 
<a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a>21:         cpu@200 {
<a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a>22:             device_type = &quot;cpu&quot;;
<a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a>23:             compatible = &quot;arm,cortex-a76&quot;;
<a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a>24:             enable-method = &quot;psci&quot;;
<a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a>25:             reg = &lt;0&gt;;
<a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a>26:         };
<a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a>27: 
<a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a>28:     };
<a id="__codelineno-69-16" name="__codelineno-69-16" href="#__codelineno-69-16"></a>};
</code></pre></div>
Remove CONFIG_SMP=y and CONFIG_MP_MAX_NUM_CPUS=4 within intel_socfpga_agilex5_socdk_defconfig:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/CONFIG_SMP/d&#39;</span><span class="w"> </span>boards/arm64/intel_socfpga_agilex5_socdk/intel_socfpga_agilex5_socdk_defconfig
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/CONFIG_MP_MAX_NUM_CPUS/d&#39;</span><span class="w"> </span>boards/arm64/intel_socfpga_agilex5_socdk/intel_socfpga_agilex5_socdk_defconfig
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>git<span class="w"> </span>commit<span class="w"> </span>-a<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;smpremove_</span><span class="nv">$cputype</span><span class="s2">&quot;</span>
</code></pre></div>
<ul>
<li>Re-build the "Hello World" sample.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>west<span class="w"> </span>build<span class="w"> </span>-b<span class="w"> </span>intel_socfpga_agilex5_socdk<span class="w"> </span>samples/hello_world<span class="w"> </span>-d<span class="w"> </span>agilex5<span class="w"> </span>--pristine
</code></pre></div>
<ul>
<li>
<p>Prepare the binaries to run on Simics® Simulator</p>
<p>a. Remove obsolete folder and create the new fip binary.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>sdcard_bin
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>mkdir<span class="w"> </span>sdcard_bin<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>sdcard_bin
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="nv">$TOP_FOLDER</span>/fiptool<span class="w"> </span>create<span class="w"> </span>--soc-fw<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/arm-trusted-firmware-sdcard/build/agilex5/release/bl31.bin<span class="w">  </span>--nt-fw<span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zephyrproject/zephyr/agilex5/zephyr/zephyr.bin<span class="w"> </span>fip.bin
</code></pre></div>
<p>To create the boot image, we will use the creating <a href="#sd-card-image-binaries">SD Card Image binaries</a> section as base. Refer back to <a href="#creating-boot-images">Creating Boot Images</a> to boot from other boot devices.</p>
<ul>
<li>Obtain the make_sdimage.sh script.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/sdcard_bin
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>wget<span class="w"> </span>https://releases.rocketboards.org/2023.12/zephyr/gsrd_zephyr/agilex5/cli/sdmmc_boot/make_sdimage.sh
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>chmod<span class="w"> </span>+x<span class="w"> </span>make_sdimage.sh
</code></pre></div>
<ul>
<li>Create the sdimage.img</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>touch<span class="w"> </span>dummy.tar.gz
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>sudo<span class="w"> </span>./make_sdimage.sh<span class="w"> </span>-k<span class="w"> </span>dummy.tar.gz<span class="w"> </span>-p<span class="w"> </span>fip.bin<span class="w"> </span>-o<span class="w"> </span>sdimage.img<span class="w"> </span>-g<span class="w"> </span>2G<span class="w"> </span>-pg<span class="w"> </span><span class="m">16</span>&lt;/pre&gt;
</code></pre></div>
<p>Note:
To return to QPDS24.3_REL_GSRD_PR tag execute:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/zephyrproject/zephyr
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>git<span class="w"> </span>checkout<span class="w"> </span>QPDS24.3_REL_GSRD_PR
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>
</code></pre></div>
<h3 id="simulation-setup_1">Simulation Setup<a class="headerlink" href="#simulation-setup_1" title="Permanent link">&para;</a></h3>
<p>It is assumed you have executed the steps at least once in <a href="#simulation-setup">Simulation Setup</a> with default settings.</p>
<ul>
<li>Lets add the Simics binary to the path to make things easier:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>export PATH=$PATH:&amp;ltSimics installation dir&amp;gt/simics/bin/
</code></pre></div>
<ul>
<li>Configure the Simics top-level target script to run on a single core by adding the following parameters before the <strong>run-command-file</strong> command:</li>
</ul>
<p>A55:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>$hps_core0_power_on = TRUE 
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>$hps_core1_power_on = FALSE 
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>$hps_core2_power_on = FALSE 
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>$hps_core3_power_on = FALSE
</code></pre></div>
<p>A76:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>$hps_boot_core = 2 
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>$hps_core0_1_power_on = FALSE 
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>$hps_core2_power_on = TRUE 
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>$hps_core3_power_on = FALSE
</code></pre></div>
<p>This can be achieved by executing the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$TOP_FOLDER</span>/project-1
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="nv">cputypestring</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$cputype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;a55&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="nv">cputypestring</span><span class="o">=</span><span class="s1">&#39;$hps_boot_core = 0 </span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="s1">$hps_core0_power_on = TRUE </span>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="s1">$hps_core1_power_on = FALSE </span>
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="s1">$hps_core2_power_on = FALSE </span>
<a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="s1">$hps_core3_power_on = FALSE&#39;</span>
<a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="k">else</span>
<a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="nv">cputypestring</span><span class="o">=</span><span class="s1">&#39;$hps_boot_core = 2 </span>
<a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="s1">   $hps_core0_1_power_on = FALSE </span>
<a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="s1">   $hps_core2_power_on = TRUE </span>
<a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="s1">   $hps_core3_power_on = FALSE&#39;</span>
<a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a><span class="k">fi</span><span class="p">;</span>
<a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a>
<a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a>tee<span class="w"> </span>zephyr_sdcard.simics<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a><span class="s"># TOP-LEVEL CONFIG Script TO BOOT ZEPHYR.</span>
<a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a><span class="s">local $board_name = &quot;system.board.fpga&quot;</span>
<a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a>
<a id="__codelineno-79-20" name="__codelineno-79-20" href="#__codelineno-79-20"></a><span class="s"># Ensure the sdimage.img &amp; bl2.bin paths are relative to the simics executable#</span>
<a id="__codelineno-79-21" name="__codelineno-79-21" href="#__codelineno-79-21"></a>
<a id="__codelineno-79-22" name="__codelineno-79-22" href="#__codelineno-79-22"></a><span class="s"># Enable Console</span>
<a id="__codelineno-79-23" name="__codelineno-79-23" href="#__codelineno-79-23"></a><span class="s">$create_hps_serial0_console=TRUE</span>
<a id="__codelineno-79-24" name="__codelineno-79-24" href="#__codelineno-79-24"></a>
<a id="__codelineno-79-25" name="__codelineno-79-25" href="#__codelineno-79-25"></a><span class="s"># Boot from SD Card</span>
<a id="__codelineno-79-26" name="__codelineno-79-26" href="#__codelineno-79-26"></a><span class="s">$create_hps_sd_card=TRUE</span>
<a id="__codelineno-79-27" name="__codelineno-79-27" href="#__codelineno-79-27"></a><span class="s">$create_hps_mmc=FALSE</span>
<a id="__codelineno-79-28" name="__codelineno-79-28" href="#__codelineno-79-28"></a>
<a id="__codelineno-79-29" name="__codelineno-79-29" href="#__codelineno-79-29"></a><span class="s"># SD Card boot Image file path</span>
<a id="__codelineno-79-30" name="__codelineno-79-30" href="#__codelineno-79-30"></a><span class="s">$sd_image_filename = ../sdcard_bin/sdimage.img</span>
<a id="__codelineno-79-31" name="__codelineno-79-31" href="#__codelineno-79-31"></a>
<a id="__codelineno-79-32" name="__codelineno-79-32" href="#__codelineno-79-32"></a><span class="s"># First stage boot loader, ATF BL2 path</span>
<a id="__codelineno-79-33" name="__codelineno-79-33" href="#__codelineno-79-33"></a><span class="s">$fsbl_image_filename = ../arm-trusted-firmware-sdcard/build/agilex5/release/bl2.bin</span>
<a id="__codelineno-79-34" name="__codelineno-79-34" href="#__codelineno-79-34"></a><span class="s">EOF</span>
<a id="__codelineno-79-35" name="__codelineno-79-35" href="#__codelineno-79-35"></a>
<a id="__codelineno-79-36" name="__codelineno-79-36" href="#__codelineno-79-36"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cputypestring</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>zephyr_sdcard.simics<span class="w"> </span>
<a id="__codelineno-79-37" name="__codelineno-79-37" href="#__codelineno-79-37"></a>
<a id="__codelineno-79-38" name="__codelineno-79-38" href="#__codelineno-79-38"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;run-command-file &quot;targets/agilex5e-universal/agilex5e-universal.simics&quot;</span>
<a id="__codelineno-79-39" name="__codelineno-79-39" href="#__codelineno-79-39"></a><span class="s1">run&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>zephyr_sdcard.simics
</code></pre></div>
<p>Note: We based our approach on the SDCard script. For NAND boot and QSPI options, refer to <a href="#booting-from-nand-binaries">Booting from NAND binaries</a>
and <a href="#booting-from-qspi-binaries">Booting from QSPI binaries</a>.</p>
<h4 id="running-hello-world_1">Running Hello World<a class="headerlink" href="#running-hello-world_1" title="Permanent link">&para;</a></h4>
<ul>
<li>Run the hello world example:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>./simics<span class="w"> </span>zephyr.simics
</code></pre></div>
<ul>
<li>Wait to get "Hello World!" message in the target serial console.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>NOTICE:  return = 0 Hz
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>NOTICE:  mmc_clk = 200000000 Hz
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>NOTICE:  SDMMC boot
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>NOTICE:  BL2: v2.9.1(release):QPDS23.4_REL_GSRD_PR
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>NOTICE:  BL2: Built : 19:41:32, Dec 18 2023
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>NOTICE:  BL2: Booting BL31
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>NOTICE:  BL31: Boot Core = 800
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a>NOTICE:  BL31: CPU ID = 81000200
<a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a>NOTICE:  BL31: v2.9.1(release):QPDS23.4_REL_GSRD_PR
<a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a>NOTICE:  BL31: Built : 19:41:33, Dec 18 2023
<a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a>*** Booting Zephyr OS build 33d4a115fbed ***
<a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a>Hello World! intel_socfpga_agilex5_socdk
</code></pre></div>
<h4 id="configuration-reference">Configuration Reference<a class="headerlink" href="#configuration-reference" title="Permanent link">&para;</a></h4>
<p>You may rebuild and run on Simics for the target core based on the following configuration:</p>
<table>
<thead>
<tr>
<th><em>Config file</em></th>
<th><em>A55</em></th>
<th><em>A76</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>$TOP_FOLDER/zephyrproject/zephyr/dts/arm64/intel/intel_socfpga_agilex5.dtsi</td>
<td>At node <strong>cpu@0</strong> : <strong>compatible</strong> = "arm,cortex-a75"  <strong>reg</strong> =</td>
<td>At node <strong>cpu@0</strong> :  <strong>compatible</strong> = "arm,cortex-a76" <strong>reg</strong> =</td>
</tr>
<tr>
<td>$TOP_FOLDER/project-1/zephyr.simics</td>
<td>$hps_boot_core = 0</td>
<td>$hps_boot_core = 2</td>
</tr>
</tbody>
</table>
<h2 id="notices-disclaimers">Notices &amp; Disclaimers<a class="headerlink" href="#notices-disclaimers" title="Permanent link">&para;</a></h2>
<p>Altera<sup>&reg;</sup> Corporation technologies may require enabled hardware, software or service activation.
No product or component can be absolutely secure. 
Performance varies by use, configuration and other factors.
Your costs and results may vary. 
You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Altera or Intel products described herein. You agree to grant Altera Corporation a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.
No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Altera or Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document.
The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications.  Current characterized errata are available on request.
Altera disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.
You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. 
<sup>&copy;</sup> Altera Corporation.  Altera, the Altera logo, and other Altera marks are trademarks of Altera Corporation.  Other names and brands may be claimed as the property of others. </p>
<p>OpenCL* and the OpenCL* logo are trademarks of Apple Inc. used by permission of the Khronos Group™. </p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 12, 2024</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 7, 2024</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../linux-gsrd/ug-linux-gsrd-agilex5-virtual-platforms/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Linux GSRD" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Agilex™ 5 Intel Simics Virtual Platform Example User Guide - Linux GSRD
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../../e-series/premium/remote-debug/ug-remote-debug-agx5e-premium/" class="md-footer__link md-footer__link--next" aria-label="Next: Agilex™ 5 FPGA Remote Debug Example" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Agilex™ 5 FPGA Remote Debug Example
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.altera.com" target="_blank" rel="noopener" title="www.altera.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/altera-fpga" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/altera-fpga/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "navigation.indexes", "navigation.footer", "navigation.path", "search.suggest", "search.highlight", "content.code.copy", "navigation.indexes", "toc.integrate", "toc.follow"], "search": "../../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
        <script src="https://unpkg.com/tablefilter@0.7.3/dist/tablefilter/tablefilter.js"></script>
      
        <script src="../../../../../../assets/tables.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>